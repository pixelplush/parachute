let e=0;function t(e,t,a,d=!1){let o={};return _.Animations.forEach(r=>{d&&"back"===r||(o[r]={numFrames:a,prefix:`${e}_${t}_${r}`})}),o}async function a({x:e,y:t,z:a,radius:d,scale:o=3,name:r,framerate:n=4,animations:s,suffix:u=""}={}){let i={};return Object.keys(s).forEach(e=>{i[e]={framerate:n,frames:Array.from({length:s[e].numFrames},(t,a)=>`${s[e].prefix}${u||a}`),loop:!0}}),await Unicorn.AddObject(r,{type:"circle",scale:{x:o,y:o},friction:0,frictionAir:0,frictionStatic:0,bounce:1,animations:i,x:e,y:t,z:a,radius:d})}function d({x:e,y:t,z:a,scale:d=3,name:o,framerate:r=4,animations:n,suffix:s=""}={}){let u={};Object.keys(n).forEach(e=>{u[e]={framerate:r,frames:Array.from({length:n[e].numFrames},(t,a)=>`${n[e].prefix}${s||a}`),loop:!0}}),Unicorn.AddSprite(o,{scale:{x:d,y:d},animations:u,x:e,y:t,z:a,anchor:{x:.5,y:1}})}function o(e){Unicorn.RemoveGameObject(e)}async function r(d,r,n,s,u=null){f.playable;e++;const i="player_"+e;if(!f)throw"No GameTheme Defined";f.characters||(f.characters={});let c=!1;u&&f.playable.includes(u)||(s.character&&s.character.id?(u=s.character.id,c=!0):u=f.playable[$(f.playable.length)]),x["char_"+u]||(f.characters[u]||(f.characters[u]=c?s.character.path:u),I("char",u,"characters",f.characters[u],_.NumFrames));let l=await a({x:d,y:r,z:n,radius:36,name:i,animations:t("char",u,_.NumFrames)});return l.character=u,l.charName=i,l.endImage=`char_${u}_front0`,l.endScale=3,l.cleanup=()=>{o(l)},l}async function n(r,n,s,u={}){e++;const i="player_"+e;if(!f)throw"No GameTheme Defined";f.characters||(f.characters={});let c=_.NumFrames,l="",p={};if(u.character){const e=u.character;x["char_"+e.id]||(f.characters[e.id]=e.path,I("char",e.id,"characters",f.characters[e.id],c)),p=await a({x:r,y:n,z:s,radius:36,name:i,animations:t("char",e.id,c)}),p.character=e.id,p.charName=i,p.endImage=`char_${e.id}_front0`,p.endScale=3}else{if(u.wheelchairs){const e=u.wheelchairs;c=1,l="_wheel",I("wheelchair",e.path,"skins/equipment/wheelchairs",e.path,_.NumFrames)}if(!u.skintones)throw"No Body";{const e=u.skintones,o=u.expressions,f=u.hair;if(I("skin",e.path,"skins/body/skintones",e.path,c,l),p=await a({x:r,y:n,z:s,radius:36,name:i,animations:t("skin",e.path,c),suffix:l}),p.character=e.path,p.charName=i,p.endImage=`skin_${e.path}_front0`,p.endScale=3,o&&(I("expr",o.path,"skins/body/expressions",o.path,c,l,!0),d({x:r,y:n,z:s+1,name:i+"_expr",animations:t("expr",o.path,c,!0),suffix:l}),Unicorn.AttachToGameObject(i+"_expr",p,{distance:-39,angle:0})),f){u.onesies||(I("hair",f.path,"skins/body/hair",f.path,c,l),d({x:r,y:n,z:s+2,name:i+"_hair",animations:t("hair",f.path,c),suffix:l}),Unicorn.AttachToGameObject(i+"_hair",p,{distance:-39,angle:0}))}}if(u.wheelchairs){d({x:r,y:n,z:s+10,name:i+"_wheel",animations:t("wheelchair",u.wheelchairs.path,_.NumFrames)}),Unicorn.AttachToGameObject(i+"_wheel",p,{distance:-39,angle:0})}}const h=u.pants,y=u.shirts,m=u.dresses,g=u.onesies;h&&(I("pants",h.path,"skins/outfits/pants",h.path,c,l),d({x:r,y:n,z:s+3,name:i+"_pants",animations:t("pants",h.path,c),suffix:l}),Unicorn.AttachToGameObject(i+"_pants",p,{distance:-39,angle:0})),y&&(I("shirts",y.path,"skins/outfits/shirts",y.path,c,l),d({x:r,y:n,z:s+4,name:i+"_shirts",animations:t("shirts",y.path,c),suffix:l}),Unicorn.AttachToGameObject(i+"_shirts",p,{distance:-39,angle:0})),m&&(I("dress",m.path,"skins/outfits/dresses",m.path,c,l),d({x:r,y:n,z:s+5,name:i+"_dresses",animations:t("dress",m.path,c),suffix:l}),Unicorn.AttachToGameObject(i+"_dresses",p,{distance:-39,angle:0})),g&&(I("onesie",g.path,"skins/outfits/onesies",g.path,c,l),d({x:r,y:n,z:s+5,name:i+"_onesies",animations:t("onesie",g.path,c),suffix:l}),Unicorn.AttachToGameObject(i+"_onesies",p,{distance:-39,angle:0}));const b=["glasses","hats","masks","wands"];for(const e of b){const a=u[e];a&&(I("acc",a.path,"skins/accessories/"+e,a.path,c,l),d({x:r,y:n,z:s+10,name:i+"_acc_"+a.path,animations:t("acc",a.path,c),suffix:l}),Unicorn.AttachToGameObject(i+"_acc_"+a.path,p,{distance:-39,angle:0}))}const v=u.effects;return v&&(I("effect",v.path,"skins/effects",v.path,c,l),d({x:r,y:n,z:s+5,name:i+"_effects",animations:t("effect",v.path,c),suffix:l}),Unicorn.AttachToGameObject(i+"_effects",p,{distance:-39,angle:0})),p.cleanup=()=>{o(p)},p}async function s(d,o,r,n,s){if(!n||!n.pet||"pet_none"===n.pet.id)return null;e++;const u="pet_"+e;if(!f)throw"No GameTheme Defined";f.pets||(f.pets={});let i=n.pet.id.replace("pet_","");x["pet_"+i]||(f.pets[i]={path:n.pet.path,minIdle:n.pet.minIdle,maxIdle:n.pet.maxIdle},I("pet",i,"pets",n.pet.path,_.NumFrames));let c=await a({x:d,y:o,z:r,radius:24,name:u,framerate:s||4,animations:t("pet",f.pets[i].path,_.NumFrames)});return c.isStatic=!0,c.isSensor=!0,c.petName=i,c.charName=u,c.cleanup=()=>{Unicorn.RemoveGameObject(c),Unicorn.RemoveObject(u)},c}const u="https://api.pixelplush.dev/v1",i="https://stats.pixelplush.dev/v1";let c="PixelPlush Game",l="unknown",f={},p={},h="",y=1920,m=1080,g=.5,b=!1;const _={NumFrames:10,Animations:["front","left","back","right"]};let x={};var v="",w=!0;let k="",U=!0,S={};function $(e){return Math.floor(Math.random()*Math.floor(e))}function A(e){for(let t=e.length-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}}async function O(e){return await fetch("https://id.twitch.tv/oauth2/validate",{headers:{Authorization:"OAuth "+e}}).then(e=>e.json()).catch(e=>({error:e}))}async function j(e){return await fetch("https://api.pixelplush.dev/v1/auth/refresh?token="+e).then(e=>e.json()).catch(e=>({error:e}))}async function T(e,t=!1){let a=Object.keys(Ue).length;return window.location.host.startsWith("localhost")?0:fetch(u+"/analytics/heartbeat",{method:"POST",body:JSON.stringify({session:e?null:v,game:l,theme:c,channel:p.channel,players:Object.keys(Ue),count:a,finished:t})}).then(e=>e.json())}function I(e,t,a,d,o,r="",n=!1){if(!x[e+"_"+t+r]){x[e+"_"+t+r]=!0;for(let s=0;s<o;s++)for(let o=0;o<_.Animations.length;o++){const u=_.Animations[o];if(n&&"back"===u)continue;const i=`${d}_${u}`;r?Unicorn.Load(`${e}_${t}_${u}${r}`,`${h}/assets/${a}/${t}/${i}/${i}${r}.png`):Unicorn.Load(`${e}_${t}_${u}${s}`,`${h}/assets/${a}/${t}/${i}/${i}${s+1}.png`)}}}async function P(e,t,a,d){return p.oauth?fetch(i+"/scores/add",{method:"POST",body:JSON.stringify({token:p.oauth.replace("oauth:",""),channel:p.channel,game:l,theme:c,user:e,score:t,userId:a,username:d})}).then(e=>e.json()):{}}async function C(e,t,a,d,o){switch(t){case"report":{let t=null;if(p.oauth){let e=await O(p.oauth.replace("oauth:",""));e.user_id?(t="Valid",["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every(t=>e.scopes.includes(t))||(t="Need more permissions"),e.expires_in<1800&&(t="Token expires soon. Need to generate new link")):t="Invalid or expired token"}else t="No OAuth Token Provided";!async function(e,t){window.location.host.startsWith("localhost")||fetch(u+"/events/debug",{method:"POST",headers:{},body:JSON.stringify({channel:p.channel,user:e,game:l,theme:c,info:t})}).then(e=>e.json())}(e,`OAuth Token Status: ${t}\n\nGame: ${c}\n\nType: ${l}\n\nAgent: ${navigator.userAgent}\n\nLanguage: ${navigator.language}\n\nOptions:\n   ${Object.keys(p).filter(e=>"oauth"!==e&&"refreshToken"!==e&&p[e]).map(e=>`${e}:${p[e]}`).join("\n   ")}\n`)}break;case"debug":if(Unicorn.ToggleDebug(),b){let e=null;if(p.oauth){let t=await O(p.oauth.replace("oauth:",""));t.user_id?(e="Valid",["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every(e=>t.scopes.includes(e))||(e="Need more permissions"),t.expires_in<1800&&(e="Token expires soon. Need to generate new link")):e="Invalid or expired token"}else e="No OAuth Token Provided";const t=`OAuth Token Status: ${e}\n\nGame: ${c}\n\nType: ${l}\n\nOptions:\n   ${Object.keys(p).filter(e=>"oauth"!==e&&"refreshToken"!==e&&p[e]).map(e=>`${e}:${p[e]}`).join("\n   ")}\n`;Unicorn.AddText("pixelplush_debug",t,50,50,{fontFamily:"Pixeltype",fontSize:32,fontWeight:400,fill:16711680,lineJoin:"round",stroke:"#ff0000",strokeThickness:1})}else Unicorn.RemoveText("pixelplush_debug");break;case"clearcache":localStorage.setItem("pixelplush_token",""),localStorage.setItem("pixelplush_refresh","")}}window.setupGame=function(e,t,a){if(c=e,f=t,p=a,h=f.path||"",p.clouds=void 0===p.clouds||null===p.clouds?!p.overlay:"true"===p.clouds,g=void 0===p.volume||null===p.volume?0:parseInt(p.volume)/100,y=f.screenWidth||1920,m=f.screenHeight||1080,p.variations&&!p.didRandom){const e=p.variations.split(","),t=$(e.length),a=`${window.location.protocol}//${window.location.host}${window.location.pathname.substr(0,window.location.pathname.lastIndexOf("/"))}/${e[t]}${window.location.search}&didRandom=1`;window.location.href=a}p.readyTime&&(U=!1,setTimeout(()=>{U=!0,ComfyJS.Say("Parachute Drop is ready!")},parseInt(p.readyTime||1e3)))};const z=e=>{window.beforePhysicsUpdate&&window.beforePhysicsUpdate(e)},L=e=>{window.afterPhysicsUpdate&&window.afterPhysicsUpdate(e)};function D(e){console.log("scene init",e);const t=e.Layers.front,a=e.Layers.main,d=e.Layers.back;window.Unicorn={},window.Unicorn.Load=(t,a)=>e.Resources.load(t,a),window.Unicorn.AddBacklay=(e,t,a,o,r)=>d.addImage(e,t,{...r,x:a,y:o}),window.Unicorn.AddOverlay=(e,a,d,o,r)=>t.addImage(e,a,{...r,x:d,y:o}),window.Unicorn.AddObject=async(e,t)=>{if(t.sprite)a.addSprite(e,t.sprite,t);else if(t.gifs){const d=Object.keys(t.gifs);for(let o=0;o<d.length;o++){const r=d[o];await a.addGif(e,t.gifs[r].path,{x:0,y:0,scale:t.scale,framerate:t.gifs[r].framerate,loop:t.gifs[r].loop})}}else t.animations?Object.keys(t.animations).forEach(d=>{a.addAnimation(e,d,t.animations[d].frames,{x:0,y:0,scale:t.scale,framerate:t.animations[d].framerate,loop:t.animations[d].loop})}):a.addShape(e,t.type,t);const d=a.createAndAttachBody(e,{...t,shape:t.type});return d.sprite=a.get(e),d},window.Unicorn.AddSprite=(e,t)=>{t.animations&&Object.keys(t.animations).forEach(d=>{const o=a.addAnimation(e,d,t.animations[d].frames,{x:0,y:0,scale:t.scale,framerate:t.animations[d].framerate,loop:t.animations[d].loop});t.anchor&&o.anchor.set(t.anchor.x,t.anchor.y)})},window.Unicorn.AttachToGameObject=(e,t,d)=>{a.attachBody(e,t,d)},window.Unicorn.RemoveObject=e=>{a.remove(e)},window.Unicorn.RemoveGameObject=e=>{for(const t of e.attached)a.detachBody(t,e),a.remove(t);a.Physics.deleteBody(e)},window.Unicorn.AddText=(e,a,d,o,r)=>t.addText(e,a,{...r,x:d,y:o}),window.Unicorn.RemoveText=e=>{t.remove(e)},window.Unicorn.SetVelocity=(e,t,d)=>{a.Physics.setVelocity(e,{x:t,y:d})},window.Unicorn.PlaySound=(t,a)=>{e.Resources.playSound(t,a)},window.Unicorn.StopObjectAnimation=e=>{a.stopAnimation(e)},window.Unicorn.RemoveBacklay=e=>{d.remove(e)},window.Unicorn.RemoveOverlay=e=>{t.remove(e)},window.Unicorn.ToggleDebug=()=>{b=!b,a.Debug=b},async function(){if(Unicorn.Load("bg",`${h}/assets/${f.bg}.png`),!p.overlay){let e=Unicorn.AddBacklay("bg","bg",0,m-1080);e.scale.x=3,e.scale.y=3}if(f.target_versions)Object.keys(f.target_versions).forEach(e=>{let t=f.target_versions[e];if(Array.isArray(t.target)){t.target.map((t,a)=>Unicorn.Load("target"+e+a,`${h}/assets/${t}.png`))}else{Unicorn.Load("target"+e,`${h}/assets/${t.target}.png`)}if(Array.isArray(t.target_overlay)){t.target_overlay.map((t,a)=>Unicorn.Load("target_overlay"+e+a,`${h}/assets/${t}.png`))}else{Unicorn.Load("target_overlay"+e,`${h}/assets/${t.target_overlay}.png`)}if(t.target_effect){t.target_effect.map((t,a)=>Unicorn.Load("target_effect"+e+a,`${h}/assets/${t}.png`))}});else{if(Array.isArray(f.target)){f.target.map((e,t)=>Unicorn.Load("target"+t,`${h}/assets/${e}.png`))}else{Unicorn.Load("target",`${h}/assets/${f.target}.png`)}if(Array.isArray(f.target_overlay)){f.target_overlay.map((e,t)=>Unicorn.Load("target_overlay"+t,`${h}/assets/${e}.png`))}else if(f.target_overlay){Unicorn.Load("target_overlay",`${h}/assets/${f.target_overlay}.png`)}if(Array.isArray(f.target_frontlay)){f.target_frontlay.map((e,t)=>Unicorn.Load("target_frontlay"+t,`${h}/assets/${e}.png`))}else if(f.target_frontlay){Unicorn.Load("target_frontlay",`${h}/assets/${f.target_frontlay}.png`)}if(f.target_effect){f.target_effect.map((e,t)=>Unicorn.Load("target_effect"+t,`${h}/assets/${e}.png`))}}f.target_front&&Unicorn.Load("target_front",`${h}/assets/${f.target_front}.png`);f.target_boosh&&f.target_boosh.forEach((e,t)=>{Unicorn.Load("target_boosh"+t,`${h}/assets/${e}.png`)});f.target_splash&&f.target_splash.forEach((e,t)=>{Unicorn.Load("target_splash"+t,`${h}/assets/${e}.png`)});f.target_floaty&&f.target_floaty.forEach((e,t)=>{Unicorn.Load("target_floaty"+t,`${h}/assets/${e}.png`)});f.target_stickies&&f.target_stickies.forEach((e,t)=>{Unicorn.Load("target_sticky"+t,`${h}/assets/${e}.png`)});f.target_splishsplash&&f.target_splishsplash.forEach((e,t)=>{Unicorn.Load("target_splishsplash"+t,`${h}/assets/${e}.png`)});Unicorn.Load("star",h+"/assets/icons/star.png"),ie=Unicorn.AddOverlay("star","star",-1e3,-1e3,{scale:{x:3,y:3}}),ie.anchor.set(.5),f.parachutes.forEach(e=>Unicorn.Load(e,`${h}/assets/${e}.png`)),f.petparachutes?f.petparachutes.forEach(e=>Unicorn.Load(e,`${h}/assets/${e}.png`)):f.petparachutes=[];f.pridechutes&&Object.keys(f.pridechutes).forEach(e=>Unicorn.Load(f.pridechutes[e],`${h}/assets/${f.pridechutes[e]}.png`));Object.keys(f.characters).forEach(e=>{I(e,"characters",f.characters[e],_.NumFrames)}),f.clouds.forEach(e=>Unicorn.Load(e,`${h}/assets/${e}.png`)),f.droplets.forEach(e=>{Array.isArray(e)?e.forEach(e=>Unicorn.Load(e,`${h}/assets/${e}.png`)):Unicorn.Load(e,`${h}/assets/${e}.png`)}),f.target_sound&&Unicorn.Load("sfx-target-drop",`${h}/assets/${f.target_sound}`);p.notifVolume&&Unicorn.Load("sfx-group-queue",`${h}/assets/${f.queue_sound}`);Unicorn.Load("sfx-parachute-drop",`${h}/assets/${f.drop_sound}`),Unicorn.Load("sfx-parachute-flap",`${h}/assets/${f.parachute_sound}`),(await Unicorn.AddObject("WallLeft",{type:"rectangle",x:-200,y:0,width:400,height:2*m,friction:0,frictionAir:0,frictionStatic:0,bounce:1.1,isStatic:!0})).sprite.visible=!1,(await Unicorn.AddObject("WallRight",{type:"rectangle",x:y+200,y:0,width:400,height:2*m,friction:0,frictionAir:0,frictionStatic:0,bounce:1.1,isStatic:!0})).sprite.visible=!1,(await Unicorn.AddObject("WallBottom",{type:"rectangle",x:.5*y,y:m+100,friction:0,frictionAir:0,frictionStatic:0,bounce:1,width:y,height:200,isStatic:!0})).sprite.visible=!1,window.beforePhysicsUpdate=function(e){const t=Object.keys(Ue);for(let e=0;e<t.length;e++){const a=t[e],d=Ue[a];d.player&&(Math.abs(d.player.velocity.x)>50&&Unicorn.SetVelocity(d.player,50*(d.player.velocity.x<0?-1:1),d.player.velocity.y),d.player.velocity.y<-50&&Unicorn.SetVelocity(d.player,d.player.velocity.x,-50),d.player.position.y<.5*-m?d.player.velocity.y>10&&Unicorn.SetVelocity(d.player,d.player.velocity.x,10):d.player.position.y>300&&d.player.velocity.y>.5&&Unicorn.SetVelocity(d.player,d.player.velocity.x,.5))}const a=Object.keys(Re);for(let e=0;e<a.length;e++){const t=a[e],d=Re[t];Math.abs(d.velocity.x)>50&&Unicorn.SetVelocity(d,50*(d.velocity.x<0?-1:1),d.velocity.y)}},window.afterPhysicsUpdate=function(e){const t=Object.keys(Ue);for(let e=0;e<t.length;e++){const a=t[e],d=Ue[a];if(d.pet&&d.pet.position){let e=Math.min(3,Math.max(0,.3*(d.player.position.y-300)));d.petPara.scale.x=d.petPara.scale.y=e/2,d.petParaFlipDir&&d.player.velocity.x>0&&(d.petPara.scale.x=-e/2),d.pet.angle=d.player.angle,d.pet.position.x=Math.max(20,Math.min(y-20,d.player.position.x+d.petOffset)),d.pet.position.y=Math.min(d.player.position.y+20,m-46-50+(f.target_y_offset||0)),d.petPara.rotation=d.player.angle,d.petPara.position.x=d.pet.position.x,d.petPara.position.y=d.pet.position.y}}}}()}function E(e,t,a){!async function(e,t){const a=Object.keys(Ue);for(let t=0;t<a.length;t++){const d=a[t],o=Ue[d];if(o.player)if(o.isLanded){let e=d===$e?1:.3;if(!(p.spawnZombies&&o.score<=0)){if(o.end.alpha=e,o.player.sprites){const e=Object.keys(o.player.sprites);for(const t of e);}o.label.alpha=Math.round(e),o.scoreLabel.tint=o.label.tint=d===$e?16777215:3355443}if(o.pet&&(o.petEnd.alpha=e),d===$e){if(o.end.zIndex=o.scoreLabel.zIndex=o.label.zIndex=9e3,o.player.sprites){const e=Object.keys(o.player.sprites);for(const t of e);}o.pet&&(o.pet.zIndex=9001),o.label.position.x=o.player.position.x,o.label.position.y=o.player.position.y-80,o.scoreLabel.position.x=o.label.position.x+15,o.scoreLabel.position.y=o.label.position.y-30,o.label.style.fontSize=40,o.scoreLabel.style.fontSize=40,ie.x=o.scoreLabel.x-o.scoreLabel.width/2-15,ie.y=o.scoreLabel.y-5}else o.label.position.x=o.player.position.x,o.label.position.y=o.player.position.y-60,o.scoreLabel.position.y=o.label.position.y-30,o.scoreLabel.alpha=0,o.label.style.fontSize=34,o.scoreLabel.style.fontSize=34;if(p.spawnZombies&&!o.zombiefied)for(let e=0;e<De.length;e++){const t=De[e];if(o.end&&o.end.alpha>0&&Math.abs(o.end.x-t.position.x)<40){o.zombiefied=!0;const e={character:{id:Le,path:Le}};o.end.alpha=0;let t=await r(o.end.x,m-40,110,e);t.isSensor=!0,t.isStatic=!0,t.timeTilNextWalk=3e3+$(27e3),t.walkDirection=$(2)>0?"left":"right",t.label=o.label,Unicorn.PlayObjectAnimation(t.charName,t.walkDirection);let a=PIXI.utils.string2hex(o.nameColor.brighten(50).toHexString());Object.keys(t.animations).forEach(e=>{t.animations[e].tint=a}),De.push(t),f.target_particles&&Ne(f.target_particles[0],f.target_particles[1],o.end.x,m-40,10),f.target_boosh&&Be(o.end.x,m-40,100),f.target_splash&&Je(o.end.x,m-40,100),f.target_floaty&&Ge(o.end.x,m-40)}}}else{if(o.pet&&o.pet.position&&(o.pet.position.x=Math.max(20,Math.min(y-20,o.player.position.x+o.petOffset)),o.pet.position.y=Math.min(o.player.position.y+20,m-46-50+(f.target_y_offset||0)),o.petPara.position.x=o.pet.position.x,o.petPara.position.y=o.pet.position.y),o.player.position.y>m-46-50+(f.target_y_offset||0)||f.target_walls&&o.player.position.y>m-46-50+(f.target_collide_land||0)&&le/2-20>Math.abs(fe-o.player.position.x)){o.isLanded=!0,o.parachute.scale.x=o.parachute.scale.y=0,o.pet&&(o.petPara.scale.x=o.petPara.scale.y=0);let e=Unicorn.AddBacklay("end_"+d,o.player.endImage,o.player.position.x,o.player.position.y,{scale:{x:o.player.endScale,y:o.player.endScale}});if(e.anchor.set(.5),e.zIndex=20,e.visible=!1,o.player.isStatic=!0,o.player.isSensor=!0,o.player.isSleeping=!0,o.player.angle=0,Unicorn.StopObjectAnimation(o.player.charName),o.player.collisionFilter={group:-1,mask:0,category:2},f.target_walls?o.score=100*Math.max(0,le/2-35-Math.abs(fe-o.player.position.x))/(le/2-35):o.score=100*Math.max(0,le/2-Math.abs(fe-o.player.position.x))/(le/2),!p.spawnZombies||o.score>0){o.score;if(o.player.sprites){const e=Object.keys(o.player.sprites);for(const t of e);}}if(o.end=e,o.pet){let e=Unicorn.AddBacklay("petend_"+d,`pet_${o.petType}_front0`,o.pet.position.x,o.pet.position.y,{scale:{x:3,y:3}});e.anchor.set(.5),e.zIndex=30,o.pet.isStatic=!0,e.alpha=o.score>0?1:.3,o.petEnd=e}if(o.score>0){if(f.target_versions&&Z(),f.target_stickies&&qe(o.player.position.x,m-80),f.target_splishsplash&&Fe(o.player.position.x,m-81),f.target_effect){Q++;const e="te_"+Q;let t=await Unicorn.AddObject(e,{type:"circle",scale:{x:2,y:2},animations:{front:{framerate:.1,frames:Array.from({length:f.target_effect.length},(e,t)=>"target_effect"+t),loop:!1,onComplete:()=>{Unicorn.RemoveObject(e)}}},isSensor:!0,isStatic:!0,x:o.player.position.x,y:o.player.position.y,z:200,radius:.1});t.isSensor=!0,t.animations.front.anchor.y=1}if(ke&&f.target_versions[ke].target_effect){Q++;const e="te_"+Q;let t=await Unicorn.AddObject(e,{type:"circle",scale:{x:2,y:2},animations:{front:{framerate:8/60,frames:Array.from({length:f.target_versions[ke].target_effect.length},(e,t)=>`target_effect${ke}${t}`),loop:!1,onComplete:()=>{Unicorn.RemoveObject(e)}}},isSensor:!0,isStatic:!0,x:o.player.position.x,y:o.player.position.y,z:200,radius:.1});t.isSensor=!0,t.animations.front.anchor.y=1}if(f.target_animate_on_landed&&Z(2),f.target_particles&&Ne(f.target_particles[0],f.target_particles[1],o.player.position.x,o.player.position.y+40,10),f.target_boosh&&Be(o.player.position.x,o.player.position.y+40,10),f.target_splash&&Je(o.player.position.x,o.player.position.y+40,10),f.target_floaty&&Ge(o.player.position.x,o.player.position.y),f.target_sound&&Unicorn.PlaySound("sfx-target-drop",{volume:g}),o.scoreLabel.x=o.label.position.x,o.scoreLabel.y=o.label.position.y-30,o.scoreLabel.text=o.score.toFixed(2),o.pet&&f.hopper_trigger&&o.style&&o.style.pet)try{if(Object.keys(f.hopper_trigger).some(e=>o.style.pet[e]===f.hopper_trigger[e])){const e=f.special_hoppers[$(f.special_hoppers.length)];We(o.pet.position.x,o.pet.position.y,{id:"pet_"+e,path:e,minIdle:200,maxIdle:800}),o.petEnd.visible=!1}}catch(e){console.error(e)}if(!d.startsWith("test_")){if(p.messageFormat){let e=p.messageFormat.replace("USERNAME",o.name).replace("POINTS",o.score.toFixed(2)).replace("SHORTPTS",Math.floor(o.score));setTimeout(()=>{ComfyJS.Say(e)},5e3)}P(o.name,o.score.toFixed(2),o.userId,d)}}o.score>Se&&(Se=o.score,$e=d,e.zIndex=21),(!p.spawnZombies||o.score>0)&&(o.label.alpha=o.score>0?1:.3),Unicorn.RemoveBacklay("para_"+d),o.pet&&(Unicorn.RemoveBacklay("petpara_"+d),o.pet.cleanup(),delete o.pet,o.pet=null)}else if(o.player.position.y>300){let t=Math.min(3,Math.max(0,.3*(o.player.position.y-300)));0===o.parachute.scale.x&&t>0&&Unicorn.PlaySound("sfx-parachute-flap",{volume:g}),o.parachute.visible=!0,o.pet&&(o.petPara.visible=!0),o.parachute.scale.x=o.parachute.scale.y=t,o.paraFlipDir&&o.player.velocity.x>0&&(o.parachute.scale.x=-t),o.parachute.rotation=Math.sin(o.player.rotationOffset+e/1e3)*Math.PI/16,o.player.angle=Math.sin(o.player.rotationOffset+e/1e3)*Math.PI/16,o.parachute.position.x=o.player.position.x,o.parachute.position.y=o.player.position.y-10-(f.parachute_offset||0)}else o.parachute.visible=!1,o.parachute.scale.x=o.parachute.scale.y=0,o.pet&&(o.petPara.visible=!1,o.petPara.scale.x=o.petPara.scale.y=0);o.label.position.x=o.player.position.x,o.label.position.y=o.player.position.y-60}}for(let e=0;e<je.length;e++){let a=je[e];a.x-=t*a.speed,a.x+a.width/2<=0&&(a.x=y+a.width/2,a.y=$(500),a.speed=.01+.1*Math.random(),a.zIndex=a.speed)}for(let e=0;e<Te.length;e++){let a=Te[e];(a.vY<0||a.y<m-5)&&(a.x+=t/1e3*a.vX,a.y+=t/1e3*a.vY,a.vY<20&&(a.vY+=t/1e3*200))}for(let e=0;e<Ie.length;e++){let a=Ie[e];(a.vY<0||a.y<m-5)&&(a.x+=t/1e3*a.vX,a.y+=t/1e3*a.vY,a.vY+=t/1e3*200)}for(let e=0;e<Pe.length;e++){let a=Pe[e];const d=a.y>m-46-30+(f.target_y_offset||0),o=f.target_walls&&a.y>m-46-30+(f.target_collide_land||0)&&le/2-20>Math.abs(fe-a.x),r=d||o;(a.vY<0||!r)&&(a.x+=t/1e3*a.vX,a.y+=t/1e3*a.vY,a.vY+=t/1e3*200),o&&(a.x+=t/1e3*(a.vX<0?-4:4))}for(let e=0;e<Ce.length;e++){const a=Ce[e];if(a.timer+=t,a.splishes[a.frame].visible=!1,a.frame=Math.floor(a.timer/100),a.frame>=13){Ce.splice(e,1);for(let e=0;e<a.splishes.length;e++)Unicorn.RemoveOverlay(a.splishes[e].label)}else a.splishes[a.frame].visible=!0}for(let e=0;e<Ee.length;e++){let a=Ee[e];if(a.position.x<-50||a.position.y>y+50)Unicorn.RemoveObject(a.charName),Ee.splice(e,1),e--;else{const e=a.walkSpeed*("left"===a.walkDirection?-1:1);a.position.x+=e*t/1e3,Unicorn.SetPosition(a.charName,a.position.x,a.position.y)}}for(let e=0;e<ze.length;e++){let a=ze[e];a.lifetime>0&&(a.lifetime-=t/1e3,a.y-=80*t/1e3,a.x=a.refX+20*Math.sin(4*a.lifetime+a.timeOffset),a.lifetime<0&&(Unicorn.RemoveBacklay(a.label),ze.splice(e,1),e--))}for(let e=0;e<De.length;e++){const a=De[e];if(a.isHidden)continue;let d=!1;a.position.x<=20&&"left"===a.walkDirection&&(d=!0),a.position.x>=y-20&&"right"===a.walkDirection&&(d=!0),Math.abs(fe-a.position.x)<le/2+10&&(d=!0,a.position.x<fe?a.position.x=fe-le/2-10:a.position.x=fe+le/2+10),a.timeTilNextWalk-=t,a.timeTilNextWalk<=0&&(d=!0),d&&(a.timeTilNextWalk=3e3+$(27e3),a.walkDirection="right"===a.walkDirection?"left":"right",Unicorn.PlayObjectAnimation(a.charName,a.walkDirection)),a.position.x+=50*t/1e3*("left"===a.walkDirection?-1:1),a.label&&(a.label.x=a.position.x)}Y&&(X-=t,X<=0&&(X=45,Array.isArray(he)&&(he[_e].visible=!1,_e=(_e+1)%he.length,he[_e].visible=!0),ye&&Array.isArray(ye)&&(ye[xe].visible=!1,xe=(xe+1)%ye.length,ye[xe].visible=!0),me&&Array.isArray(me)&&(me[ve].visible=!1,ve=(ve+1)%me.length,me[ve].visible=!0)));V>0&&(V-=t,V<=0&&H());de>0&&(de-=t,de<=0&&(de=0,console.log("Raid mode complete"),ComfyJS.Say("/me Drop raid has ended")))}(e,t)}PenguinPlay.Create("unicorn-display",{width:y,height:m,background:"transparent",fonts:{custom:["Pixeltype","Pixellari"]},framerate:p.fps||60,onInit:function(e){console.log("initialized"),e.addScene("game-main",{onInit:D,onUpdate:E,layers:[{name:"front",options:{}},{name:"main",options:{physics:{walls:!1,beforeUpdate:z,afterUpdate:L}}},{name:"back",options:{}}]}),async function(){let e=!1;try{const t=(await fetch("https://www.pixelplush.dev/assets/shamelist.txt").then(e=>e.text())).split(",").map(e=>e.trim().toLowerCase());if(p.channel&&t&&t.includes(p.channel.toLowerCase())&&(console.log("This channel has been blocked for violating the PixelPlush Terms of Service."),w=!1),p.oauth&&(p.oauth=await async function(e,t){const a=localStorage.getItem("pixelplush_token"),d=localStorage.getItem("pixelplush_refresh");if(a){const e=await O(a);if(console.log("stored access token",e),e&&e.user_id&&e.scopes&&["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every(t=>e.scopes.includes(t)))return a}if(d){const e=await j(d);if(console.log("stored refresh token",e),e&&e.access_token&&e.scope&&["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every(t=>e.scope.includes(t)))return localStorage.setItem("pixelplush_token",e.access_token),localStorage.setItem("pixelplush_refresh",e.refresh_token),e.access_token}const o=await O(e);if(console.log("provided access token",o),o&&o.user_id&&o.scopes&&["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every(e=>o.scopes.includes(e)))return localStorage.setItem("pixelplush_token",e),localStorage.setItem("pixelplush_refresh",t),e;if(t){const e=await j(t);if(console.log("provided refresh token",e),e&&e.access_token&&e.scope&&["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every(t=>e.scope.includes(t)))return localStorage.setItem("pixelplush_token",e.access_token),localStorage.setItem("pixelplush_refresh",e.refresh_token),e.access_token}return console.log("no valid tokens"),null}(p.oauth.replace("oauth:",""),p.refreshToken)),f.requires)try{if(account=await fetch(i+"/accounts",{headers:{Twitch:p.oauth?p.oauth.replace("oauth:",""):void 0}}).then(e=>e.json()),console.log(account),account.error)throw"Login Error";if(!account.owned.includes(f.requires))throw"Item not owned"}catch(e){return void console.log("Auth Validate Failed",e)}if(await async function(){l="parachute",p.spawnZombies&&(console.log("zombie"),"instafluff"!==p.channel&&"maaya"!==p.channel&&(p.spawnZombies=""));p.notifVolume&&(W=parseInt(p.notifVolume)/100);p.command=p.command||"drop",p.cpDrop&&(S["Parachute Drop!"]={desc:"Drop into the PixelPlush Parachute Game!",color:"#F2C079",cost:parseInt(p.cpDropCost||50),callback:(e,t,a,d,o)=>{Ue[e]||oe(e,p.command,d,{},o)}});p.cpDroplets&&(S["Parachute Droplets"]={desc:"Add bouncing obstacles into the PixelPlush Parachute Game!",color:"#F2C079",cost:parseInt(p.cpDropletsCost||500),cooldown:parseInt(p.cpDropletsCD||5),callback:()=>{if(U)if(w)for(let e=0;e<5;e++)Ye(100);else p.oauth&&ComfyJS.Say("The Parachute Drop game needs your attention. Please contact the PixelPlush team on Discord.")}});p.cpQueue&&(S["Group Parachute"]={desc:"Queue everyone for a group drop in the PixelPlush Parachute Game!",color:"#F2C079",cost:parseInt(p.cpQueueCost||500),cooldown:parseInt(p.cpQueueCD||120),callback:()=>{if(U)if(w)if(te)ComfyJS.Say("/me Group Drop is already queued.");else{W>0&&Unicorn.PlaySound("sfx-group-queue",{volume:W}),ue(),te=!0;const e=6e4;ComfyJS.Say(`/me Parachutes are queued for the next 60 seconds. !${p.command} to join!`),setTimeout(()=>{ComfyJS.Say(`/me 30 seconds remaining. !${p.command} (${Object.keys(ee).length} in group)`)},e-3e4),setTimeout(()=>{ComfyJS.Say(`/me 10 seconds. !${p.command} (${Object.keys(ee).length} in group)`)},e-1e4),setTimeout(()=>{let e=Object.keys(ee);A(e),e.forEach(e=>{const t=ee[e];Ve(t.username,t.name,t.color,t.message,t.selectedPara||f.parachutes[$(f.parachutes.length)],t.selectedPetPara||f.petparachutes[$(f.petparachutes.length)],t.emote,t.emoji,t.extra)}),ee={}},e)}else p.oauth&&ComfyJS.Say("The Parachute Drop game needs your attention. Please contact the PixelPlush team on Discord.")}})}(),p.oauth){let t=await O(p.oauth.replace("oauth:",""));t.user_id?(e=!0,k=t.client_id,["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every(e=>t.scopes.includes(e))||(console.log("Need more permissions"),console.log("Current scopes",t.scopes)),t.expires_in<1800&&console.log("Token expires soon. Need to generate new link")):(console.log("Invalid token"),e=!1)}}catch(e){console.log(e)}ComfyJS.onCommand=oe,ComfyJS.onChat=re,ComfyJS.onCheer=ne,ComfyJS.onRaid=se,ComfyJS.onConnected=async(e,t,a)=>{if(a){Xe();let e=await T(!0);0!==e&&(v=e.session,setInterval(()=>{T(!1)},3e5));let t=await ComfyJS.GetChannelRewards(k,!0),a=Object.keys(S);for(let e=0;e<a.length;e++){let d=a[e];if(!t.some(e=>e.title===d))try{await ComfyJS.CreateChannelReward(k,{title:d,prompt:S[d].desc,cost:S[d].cost,is_enabled:!0,background_color:S[d].color,is_user_input_required:!1,is_max_per_stream_enabled:!1,max_per_stream:0,is_max_per_user_per_stream_enabled:!1,max_per_user_per_stream:0,is_global_cooldown_enabled:!!S[d].cooldown,global_cooldown_seconds:S[d].cooldown,should_redemptions_skip_request_queue:!0})}catch(e){console.log(e)}}}},ComfyJS.onReward=(e,t,a,d,o)=>{S[t]&&S[t].callback(e,t,a,d,o)},ComfyJS.Init(p.channel,p.oauth&&e?p.oauth.replace("oauth:",""):void 0,p.channel)}()},onUpdate:function(e,t){}});const R={parse:function(e,t){var a=t&&t.assetType?t.assetType:"svg",d=t&&t.buildUrl?t.buildUrl:function(e,t){return"png"===t?"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/"+e+".png":"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/"+e+".svg"},o=[];N.default.lastIndex=0;for(;;){var r=N.default.exec(e);if(!r)break;var n=r[0],s=q(G(n)).join("-");o.push({url:s?d(s,a):"",indices:[r.index,N.default.lastIndex],text:n,type:B})}return o}};R.toCodePoints=q;var M,N=(M=/(?:\ud83d\udc68\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c\udffb|\ud83d\udc68\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc]|\ud83d\udc68\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd]|\ud83d\udc68\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffc-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffd-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c\udffb|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb\udffc]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd\udfff]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffd]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffe]|\ud83e\uddd1\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c\udffb|\ud83e\uddd1\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb\udffc]|\ud83e\uddd1\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udffd]|\ud83e\uddd1\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udffe]|\ud83e\uddd1\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\u200d\ud83e\udd1d\u200d\ud83e\uddd1|\ud83d\udc6b\ud83c[\udffb-\udfff]|\ud83d\udc6c\ud83c[\udffb-\udfff]|\ud83d\udc6d\ud83c[\udffb-\udfff]|\ud83d[\udc6b-\udc6d])|(?:\ud83d[\udc68\udc69])(?:\ud83c[\udffb-\udfff])?\u200d(?:\u2695\ufe0f|\u2696\ufe0f|\u2708\ufe0f|\ud83c[\udf3e\udf73\udf93\udfa4\udfa8\udfeb\udfed]|\ud83d[\udcbb\udcbc\udd27\udd2c\ude80\ude92]|\ud83e[\uddaf-\uddb3\uddbc\uddbd])|(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75]|\u26f9)((?:\ud83c[\udffb-\udfff]|\ufe0f)\u200d[\u2640\u2642]\ufe0f)|(?:\ud83c[\udfc3\udfc4\udfca]|\ud83d[\udc6e\udc71\udc73\udc77\udc81\udc82\udc86\udc87\ude45-\ude47\ude4b\ude4d\ude4e\udea3\udeb4-\udeb6]|\ud83e[\udd26\udd35\udd37-\udd39\udd3d\udd3e\uddb8\uddb9\uddcd-\uddcf\uddd6-\udddd])(?:\ud83c[\udffb-\udfff])?\u200d[\u2640\u2642]\ufe0f|(?:\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f|\ud83c\udff3\ufe0f\u200d\ud83c\udf08|\ud83c\udff4\u200d\u2620\ufe0f|\ud83d\udc15\u200d\ud83e\uddba|\ud83d\udc41\u200d\ud83d\udde8|\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc6f\u200d\u2640\ufe0f|\ud83d\udc6f\u200d\u2642\ufe0f|\ud83e\udd3c\u200d\u2640\ufe0f|\ud83e\udd3c\u200d\u2642\ufe0f|\ud83e\uddde\u200d\u2640\ufe0f|\ud83e\uddde\u200d\u2642\ufe0f|\ud83e\udddf\u200d\u2640\ufe0f|\ud83e\udddf\u200d\u2642\ufe0f)|[#*0-9]\ufe0f?\u20e3|(?:[Â©Â®\u2122\u265f]\ufe0f)|(?:\ud83c[\udc04\udd70\udd71\udd7e\udd7f\ude02\ude1a\ude2f\ude37\udf21\udf24-\udf2c\udf36\udf7d\udf96\udf97\udf99-\udf9b\udf9e\udf9f\udfcd\udfce\udfd4-\udfdf\udff3\udff5\udff7]|\ud83d[\udc3f\udc41\udcfd\udd49\udd4a\udd6f\udd70\udd73\udd76-\udd79\udd87\udd8a-\udd8d\udda5\udda8\uddb1\uddb2\uddbc\uddc2-\uddc4\uddd1-\uddd3\udddc-\uddde\udde1\udde3\udde8\uddef\uddf3\uddfa\udecb\udecd-\udecf\udee0-\udee5\udee9\udef0\udef3]|[\u203c\u2049\u2139\u2194-\u2199\u21a9\u21aa\u231a\u231b\u2328\u23cf\u23ed-\u23ef\u23f1\u23f2\u23f8-\u23fa\u24c2\u25aa\u25ab\u25b6\u25c0\u25fb-\u25fe\u2600-\u2604\u260e\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262a\u262e\u262f\u2638-\u263a\u2640\u2642\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267b\u267f\u2692-\u2697\u2699\u269b\u269c\u26a0\u26a1\u26a7\u26aa\u26ab\u26b0\u26b1\u26bd\u26be\u26c4\u26c5\u26c8\u26cf\u26d1\u26d3\u26d4\u26e9\u26ea\u26f0-\u26f5\u26f8\u26fa\u26fd\u2702\u2708\u2709\u270f\u2712\u2714\u2716\u271d\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u2764\u27a1\u2934\u2935\u2b05-\u2b07\u2b1b\u2b1c\u2b50\u2b55\u3030\u303d\u3297\u3299])(?:\ufe0f|(?!\ufe0e))|(?:(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75\udd90]|[\u261d\u26f7\u26f9\u270c\u270d])(?:\ufe0f|(?!\ufe0e))|(?:\ud83c[\udf85\udfc2-\udfc4\udfc7\udfca]|\ud83d[\udc42\udc43\udc46-\udc50\udc66-\udc69\udc6e\udc70-\udc78\udc7c\udc81-\udc83\udc85-\udc87\udcaa\udd7a\udd95\udd96\ude45-\ude47\ude4b-\ude4f\udea3\udeb4-\udeb6\udec0\udecc]|\ud83e[\udd0f\udd18-\udd1c\udd1e\udd1f\udd26\udd30-\udd39\udd3d\udd3e\uddb5\uddb6\uddb8\uddb9\uddbb\uddcd-\uddcf\uddd1-\udddd]|[\u270a\u270b]))(?:\ud83c[\udffb-\udfff])?|(?:\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc73\udb40\udc63\udb40\udc74\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc77\udb40\udc6c\udb40\udc73\udb40\udc7f|\ud83c\udde6\ud83c[\udde8-\uddec\uddee\uddf1\uddf2\uddf4\uddf6-\uddfa\uddfc\uddfd\uddff]|\ud83c\udde7\ud83c[\udde6\udde7\udde9-\uddef\uddf1-\uddf4\uddf6-\uddf9\uddfb\uddfc\uddfe\uddff]|\ud83c\udde8\ud83c[\udde6\udde8\udde9\uddeb-\uddee\uddf0-\uddf5\uddf7\uddfa-\uddff]|\ud83c\udde9\ud83c[\uddea\uddec\uddef\uddf0\uddf2\uddf4\uddff]|\ud83c\uddea\ud83c[\udde6\udde8\uddea\uddec\udded\uddf7-\uddfa]|\ud83c\uddeb\ud83c[\uddee-\uddf0\uddf2\uddf4\uddf7]|\ud83c\uddec\ud83c[\udde6\udde7\udde9-\uddee\uddf1-\uddf3\uddf5-\uddfa\uddfc\uddfe]|\ud83c\udded\ud83c[\uddf0\uddf2\uddf3\uddf7\uddf9\uddfa]|\ud83c\uddee\ud83c[\udde8-\uddea\uddf1-\uddf4\uddf6-\uddf9]|\ud83c\uddef\ud83c[\uddea\uddf2\uddf4\uddf5]|\ud83c\uddf0\ud83c[\uddea\uddec-\uddee\uddf2\uddf3\uddf5\uddf7\uddfc\uddfe\uddff]|\ud83c\uddf1\ud83c[\udde6-\udde8\uddee\uddf0\uddf7-\uddfb\uddfe]|\ud83c\uddf2\ud83c[\udde6\udde8-\udded\uddf0-\uddff]|\ud83c\uddf3\ud83c[\udde6\udde8\uddea-\uddec\uddee\uddf1\uddf4\uddf5\uddf7\uddfa\uddff]|\ud83c\uddf4\ud83c\uddf2|\ud83c\uddf5\ud83c[\udde6\uddea-\udded\uddf0-\uddf3\uddf7-\uddf9\uddfc\uddfe]|\ud83c\uddf6\ud83c\udde6|\ud83c\uddf7\ud83c[\uddea\uddf4\uddf8\uddfa\uddfc]|\ud83c\uddf8\ud83c[\udde6-\uddea\uddec-\uddf4\uddf7-\uddf9\uddfb\uddfd-\uddff]|\ud83c\uddf9\ud83c[\udde6\udde8\udde9\uddeb-\udded\uddef-\uddf4\uddf7\uddf9\uddfb\uddfc\uddff]|\ud83c\uddfa\ud83c[\udde6\uddec\uddf2\uddf3\uddf8\uddfe\uddff]|\ud83c\uddfb\ud83c[\udde6\udde8\uddea\uddec\uddee\uddf3\uddfa]|\ud83c\uddfc\ud83c[\uddeb\uddf8]|\ud83c\uddfd\ud83c\uddf0|\ud83c\uddfe\ud83c[\uddea\uddf9]|\ud83c\uddff\ud83c[\udde6\uddf2\uddfc]|\ud83c[\udccf\udd8e\udd91-\udd9a\udde6-\uddff\ude01\ude32-\ude36\ude38-\ude3a\ude50\ude51\udf00-\udf20\udf2d-\udf35\udf37-\udf7c\udf7e-\udf84\udf86-\udf93\udfa0-\udfc1\udfc5\udfc6\udfc8\udfc9\udfcf-\udfd3\udfe0-\udff0\udff4\udff8-\udfff]|\ud83d[\udc00-\udc3e\udc40\udc44\udc45\udc51-\udc65\udc6a-\udc6d\udc6f\udc79-\udc7b\udc7d-\udc80\udc84\udc88-\udca9\udcab-\udcfc\udcff-\udd3d\udd4b-\udd4e\udd50-\udd67\udda4\uddfb-\ude44\ude48-\ude4a\ude80-\udea2\udea4-\udeb3\udeb7-\udebf\udec1-\udec5\uded0-\uded2\uded5\udeeb\udeec\udef4-\udefa\udfe0-\udfeb]|\ud83e[\udd0d\udd0e\udd10-\udd17\udd1d\udd20-\udd25\udd27-\udd2f\udd3a\udd3c\udd3f-\udd45\udd47-\udd71\udd73-\udd76\udd7a-\udda2\udda5-\uddaa\uddae-\uddb4\uddb7\uddba\uddbc-\uddca\uddd0\uddde-\uddff\ude70-\ude73\ude78-\ude7a\ude80-\ude82\ude90-\ude95]|[\u23e9-\u23ec\u23f0\u23f3\u267e\u26ce\u2705\u2728\u274c\u274e\u2753-\u2755\u2795-\u2797\u27b0\u27bf\ue50a])|\ufe0f/g)&&M.__esModule?M:{default:M};var B=R.TypeName="emoji";var J=/\uFE0F/g,F=String.fromCharCode(8205),G=function(e){return e.indexOf(F)<0?e.replace(J,""):e};function q(e){for(var t=[],a=0,d=0,o=0;o<e.length;)a=e.charCodeAt(o++),d?(t.push((65536+(d-55296<<10)+(a-56320)).toString(16)),d=0):a>55296&&a<=56319?d=a:t.push(a.toString(16));return t}let W=0,V=0,Y=!1,X=0;function Z(e=0){if(Y=!0,f.target_versions){Object.keys(we).forEach(e=>{Array.isArray(he)?we[e].target.forEach(e=>{e.visible=!1}):we[e].target.visible=!1,we[e].target_overlay.forEach(e=>{e.visible=!1})});const e=$(Object.keys(we).length);ke=Object.keys(we)[e],he=we[ke].target,ye=we[ke].target_overlay,Array.isArray(he)?he[_e].visible=!0:he.visible=!0,ye[xe].visible=!0}e>0&&(V=1e3*e)}function H(){Y=!1,Array.isArray(he)&&(he[_e].visible=!1,_e=0,he[_e].visible=!0),ye&&Array.isArray(ye)&&(ye[xe].visible=!1,xe=0,ye[xe].visible=!0),me&&Array.isArray(me)&&(me[ve].visible=!1,ve=0,me[ve].visible=!0)}let Q=0,K=!0,ee={},te=!1,ae=null,de=0;async function oe(e,t,a,d,o){if(document.hidden)return;(d.broadcaster||d.mod)&&await async function(e,t,a,d,o){switch(t){case"parachute":{const t=a.split(" ");C(e,t.shift());break}case"resetparachute":case"resetdrop":if(p.variations){const e=p.variations.split(","),t=$(e.length),a=`${window.location.protocol}//${window.location.host}${window.location.pathname.substr(0,window.location.pathname.lastIndexOf("/"))}/${e[t]}${window.location.search}`;window.location.href=a}else location.reload();break;case"deleteparachute":case"deletedrop":{let e=await ComfyJS.GetChannelRewards(k,!0),t=Object.keys(S);for(let a=0;a<t.length;a++){let d=t[a],o=e.find(e=>e.title===d);o&&await ComfyJS.DeleteChannelReward(k,o.id)}break}case"raiddrop":de=1e3*parseInt(a||60),console.log("Raid mode activated"),ComfyJS.Say(`/me Drop raid activated for ${de/1e3} seconds`);break;case"unqueuedrop":te&&(ComfyJS.Say("/me Group drop is no longer queued."),te=!1);break;case"queuedrop":te?ComfyJS.Say("/me Group drop is already queued."):(ue(),te=!0,ComfyJS.Say("/me Drops are queued this game. Mods can now type !startdrop to activate!"));break;case"startdrop":if(te){let e=Object.keys(ee);A(e),e.forEach(e=>{const t=ee[e];Ve(t.username,t.name,t.color,t.message,t.selectedPara||f.parachutes[$(f.parachutes.length)],t.selectedPetPara||f.petparachutes[$(f.petparachutes.length)],t.emote,t.emoji,t.extra)}),ee={}}break;case"queuecount":te&&ComfyJS.Say(`/me ${Object.keys(ee).length} people are ready to drop`);break;case"testdrop":for(var r=0;r<50;r++)Q++,Ve("test_"+Q,"test_"+Q,o.userColor||"#ffffff",Object.keys(f.characters)[$(Object.keys(f.characters).length)],f.parachutes[$(f.parachutes.length)],f.petparachutes[$(f.petparachutes.length)],"","",o);break;case"droplet":{let e=parseInt(a||Math.pow(10,$(6)));for(let t=0;t<5;t++)Ye(e);break}}}(e,t,a,0,o),await async function(e,t,a,d,o){switch(t){case"drophigh":case"drophighscore":case"dropbest":if(p.oauth){let e=await async function(){if(p.oauth){const e=new Date;e.setDate(e.getDate()-1);const t=e.toISOString().split("T")[0];return(await fetch(`${i}/scores/high?channel=${p.channel}&game=${l}&date=${t}`,{method:"GET"}).then(e=>e.json()))[0]}return null}();e&&e.score&&ComfyJS.Say(`/me The highest score in the past 24 hours is ${e.score} by ${e.user}`)}break;case"droplow":case"droplowscore":case"dropworst":if(p.oauth){let e=await async function(){if(p.oauth){const e=new Date;e.setDate(e.getDate()-1);const t=e.toISOString().split("T")[0];return(await fetch(`${i}/scores/low?channel=${p.channel}&game=${l}&date=${t}`,{method:"GET"}).then(e=>e.json()))[0]}return null}();e&&e.score&&ComfyJS.Say(`/me The lowest score in the past 24 hours is ${e.score} by ${e.user}`)}break;case"droptop":case"droptopscores":case"dropleaderboard":case"dropscores":if(p.oauth){let e=await async function(){if(p.oauth){const e=new Date;e.setDate(e.getDate()-1);const t=e.toISOString().split("T")[0];return await fetch(`${i}/scores/high?channel=${p.channel}&game=${l}&date=${t}`,{method:"GET"}).then(e=>e.json())}return[]}();if(e&&e.length>0){let t=Array.from(new Set(e.map(e=>e.userId))).slice(0,10).map(t=>e.find(e=>e.userId===t));ComfyJS.Say("/me Top players in the past 24 hours are "+t.map((e,t)=>`${t+1}. ${e.user} (${e.score})`).join(", "))}else ComfyJS.Say("/me There are no scores recorded in the past 24 hours")}break;case"droprecent":if(p.oauth){let e=await async function(){if(p.oauth){return await fetch(`${i}/scores/recent?channel=${p.channel}&game=${l}`,{method:"GET"}).then(e=>e.json())}return[]}();if(e&&e.length>0){let t=Array.from(new Set(e.map(e=>e.userId))).slice(0,10).map(t=>e.find(e=>e.userId===t));ComfyJS.Say("/me Latest scores are "+t.map((e,t)=>`${e.user} (${e.score})`).join(", "))}else ComfyJS.Say("/me There are no recent scores")}}}(0,t);let r=!1;if(!p.commandOn&&p.cpDrop||(r=t===p.command),("instafriend"===o.channel||"maaya"===o.channel)&&"testoutfit"===t){r=!0;const e=await fetch("https://www.pixelplush.dev/assets/catalog.json").then(e=>e.json()),t={};e.forEach(e=>{t[e.id]=e});let d={skintones:t.outfit_skin1,expressions:t.outfit_expr1,hair:t.outfit_hair1,hats:t.outfit_party_hat_pink,effects:t.outfit_effect_flies};a=d}if(p.outfit&&"outfit"===t){r=!0,ae||(ae=await fetch("https://www.pixelplush.dev/assets/catalog_outfits.json").then(e=>e.json()));let e={};for(const t of ae)e[t.type]||(e[t.type]=[]),e[t.type].push(t);let t={};if(Math.random()<.1){const a=e.equipment[$(e.equipment.length)];t.equipment={[a.group]:a.path}}const d=e.body.filter(e=>"skintones"===e.group),o=e.body.filter(e=>"expressions"===e.group),n=e.body.filter(e=>"hair"===e.group),s=d[$(d.length)],u=o[$(o.length)],i=n[$(n.length)];if(t.body={skintones:s.path,expressions:u.path,hair:i.path},Math.random()<.05);else{const a=e.outfits.filter(e=>"dresses"===e.group),d=e.outfits.filter(e=>"pants"===e.group),o=e.outfits.filter(e=>"shirts"===e.group);t.outfits={},Math.random()<.25&&(t.outfits.dresses=a[$(a.length)].path),Math.random()<.95&&(t.outfits.pants=d[$(d.length)].path),Math.random()<.95&&(t.outfits.shirts=o[$(o.length)].path)}let c={};for(const t of e.accessories)c[t.group]||(c[t.group]=[]),c[t.group].push(t);let l=Object.keys(c);t.accessories={};for(const e of l)Math.random()<.5&&(t.accessories[e]=c[e][$(c[e].length)].path);a=t}if(U)if(w){if(r){K&&p.hideTilDrop&&(K=!1,je.forEach(e=>e.visible=!0),be.forEach(e=>e.isSensor=!1),Array.isArray(he)?(he[_e].visible=!0,f.target_animate_on_landed||Z()):he.visible=!0,ye&&(Array.isArray(ye)?(ye[xe].visible=!0,f.target_animate_on_landed||Z()):ye.visible=!0),me&&(Array.isArray(me)?me[ve].visible=!0:me.visible=!0),ge&&(ge.visible=!0),p.spawnZombies&&De.forEach(e=>{e.isHidden=!1,e.position.y=m-40}));const d=R.parse(a,{assetType:"png"});if(!o.messageEmotes&&d.length>0)te?ee[o.username]={username:o.username,name:e,color:o.userColor||"#ffffff",message:a,emote:"",emoji:d[0].url,extra:o}:Ve(o.username,e,o.userColor||"#ffffff",a,f.parachutes[$(f.parachutes.length)],f.petparachutes[$(f.petparachutes.length)],"",d[0].url,o);else if(f.pridechutes){const d=Object.keys(f.pridechutes),r=o.messageEmotes?Object.keys(o.messageEmotes):[],n=r.map(e=>{const d=o.messageEmotes[e][0].split("-").map(e=>parseInt(e));return`!${t} ${a}`.substring(d[0],d[1]+1)}),s=n.filter(e=>e.toLowerCase().includes("pride"));let u=d.find(e=>s.some(t=>t.toLowerCase().includes(e)));if(u){const t=f.pridechutes[u];let d=r.find((e,t)=>!n[t].toLowerCase().includes(u));te?ee[o.username]={username:o.username,name:e,color:o.userColor||"#ffffff",message:a,selectedPara:t,selectedPetPara:t,emote:d,emoji:"",extra:o}:Ve(o.username,e,o.userColor||"#ffffff",a,t,t,d,"",o)}else te?ee[o.username]={username:o.username,name:e,color:o.userColor||"#ffffff",message:a,emote:o.messageEmotes?Object.keys(o.messageEmotes)[0]:"",emoji:"",extra:o}:Ve(o.username,e,o.userColor||"#ffffff",a,f.parachutes[$(f.parachutes.length)],f.petparachutes[$(f.petparachutes.length)],o.messageEmotes?Object.keys(o.messageEmotes)[0]:"","",o)}else te?ee[o.username]={username:o.username,name:e,color:o.userColor||"#ffffff",message:a,emote:o.messageEmotes?Object.keys(o.messageEmotes)[0]:"",emoji:"",extra:o}:Ve(o.username,e,o.userColor||"#ffffff",a,f.parachutes[$(f.parachutes.length)],f.petparachutes[$(f.petparachutes.length)],o.messageEmotes?Object.keys(o.messageEmotes)[0]:"","",o)}}else r&&p.oauth&&ComfyJS.Say("The Parachute Drop game needs your attention. Please contact the PixelPlush team on Discord.")}function re(e,t,a,d,o){document.hidden||de>0&&(Ue[e]||oe(e,p.command,t,a,o))}function ne(e,t,a,d,o){if(!document.hidden&&U&&w){for(let e=0;e<5;e++)Ye(t);if(t.startsWith("!")){let a=t.split(/ (.*)/);oe(e,a[0].slice(1).toLowerCase(),a[1]||"",d,o)}}}function se(e,t,a){document.hidden||U&&w&&p.raidMode&&(de=parseInt(p.raidMode),console.log("Raid mode activated"),ComfyJS.Say(`/me Drop raid activated for ${de/1e3} seconds`))}function ue(){Object.keys(Ue).forEach(e=>{Unicorn.RemoveBacklay("para_"+e),Unicorn.RemoveBacklay("petpara_"+e),Ue[e].player.cleanup(),Ue[e].pet&&Ue[e].pet.cleanup(),Unicorn.RemoveText("name_"+e),Unicorn.RemoveBacklay("end_"+e),Unicorn.RemoveBacklay("petend_"+e),Unicorn.RemoveText(e+"_points"),delete Ue[e]}),ie.x=-1e3,ie.y=-1e3,$e="",Se=0,ce&&clearTimeout(ce),Xe()}let ie,ce=null,le=368,fe=0,pe=0,he=null,ye=null,me=null,ge=null,be=[],_e=0,xe=0,ve=0,we={},ke=null,Ue={},Se=0,$e="",Ae={},Oe={},je=[],Te=[],Ie=[],Pe=[],Ce=[],ze=[],Le="zombie",De=[],Ee=[],Re={},Me=0;function Ne(e,t,a,d,o,r=""){Me++;let n=Math.min(Math.max(1,o),100);Unicorn.AddParticles("Splash_"+Me,{blendMode:PIXI.BLEND_MODES.DEFAULT,shape:"cone",angle:-Math.PI/2,spread:Math.PI/2,startColor:e,endColor:t,intensity:n,minSpeed:.05,maxSpeed:.25,gravityX:0,gravityY:3.5,fadeOut:!0,decay:1,image:r||void 0},a,d),function(e,t=2e3){setTimeout(()=>{Unicorn.RemoveParticles(e)},t)}("Splash_"+Me,150)}function Be(e,t,a,d=""){const o=f.target_boosh_scale||2;f.target_boosh.forEach((a,d)=>{for(let a=0;a<$(5);a++){Me++;let a=Unicorn.AddBacklay("boosh_"+Me,"target_boosh"+d,e,t+10,{scale:{x:o,y:o}});a.label="boosh_"+Me,a.zIndex=11,a.vX=$(50)-25,a.vY=-350+$(100),a.anchor.set(.5),Te.push(a)}})}function Je(e,t,a,d=""){const o=f.target_splash_scale||2;f.target_splash.forEach((a,d)=>{for(let a=0;a<$(2);a++){Me++;let a=Unicorn.AddBacklay("splash_"+Me,"target_splash"+d,e,t+10,{scale:{x:o,y:o}});a.label="splash_"+Me,a.zIndex=11,a.vX=$(100)-50,a.vY=-300+$(100),a.anchor.set(.5),Ie.push(a)}})}function Fe(e,t){const a=[];for(let d=0;d<13;d++){Me++;const o=Unicorn.AddOverlay("splishsplash_"+Me,"target_splishsplash"+d,e,t,{scale:{x:2,y:2}});o.visible=!1,o.label="splishsplash_"+Me,o.zIndex=11,o.anchor.set(.5),a.push(o)}a[0].visible=!0,Ce.push({splishes:a,timer:0,frame:0})}function Ge(e,t,a=""){for(let a=0;a<2;a++){const d=$(f.target_floaty.length);Me++;const o=$(10),r=$(10),n=a*Math.PI;let s=Unicorn.AddBacklay("floaty_"+Me,"target_floaty"+d,e-5+o,t+r,{scale:{x:3,y:3}});s.timeOffset=n,s.label="floaty_"+Me,s.zIndex=11,s.refX=e,s.refY=t,s.lifetime=3,s.anchor.set(.5),ze.push(s)}}function qe(e,t){const a=$(100)-50;Me++;let d=Unicorn.AddOverlay("sticky_"+Me,"target_sticky"+(a<0?0:1),e,t+10,{scale:{x:3,y:3}});d.label="sticky_"+Me,d.zIndex=200,d.vX=a,d.vY=-200+$(100),d.anchor.set(.5),Pe.push(d)}function We(e,t,a={}){Ne("#ffffff","#ffffff",e,t+40,5);let d=s(e,t,200,{pet:a},16/60);d.isSensor=!0,d.isStatic=!0,d.walkDirection=$(2)>0?"left":"right",d.walkSpeed=120,Unicorn.PlayObjectAnimation(d.charName,d.walkDirection),Ee.push(d)}async function Ve(e,t,d="#ffffff",u,c,l,f="",h="",m){if(!Ue[e]){Ue[e]={};let b=null,_=null,x=null,w=tinycolor(d),k=await async function(e){let t={};try{if(!e)return t;let a=await fetch(`${i}/accounts/twitch/design?username=${e}`).then(e=>e.json());return a&&(t=a.style||{}),t}catch(e){console.log(e)}}(e);if(f){let r=null;if(!Ae[f]){if(Ae[f]=!0,!f.startsWith("emotesv2_")){const a=`https://static-cdn.jtvnw.net/emoticons/v1/${f}/2.0`;return Unicorn.Load(`emote_${f}0`,a),void setTimeout(()=>{delete Ue[e],Ve(e,t,d,u,c,l,f,h,m)},500)}r=`https://static-cdn.jtvnw.net/emoticons/v2/${f}/default/dark/2.0`}let n=[];f.startsWith("emotesv2_")&&"boolean"!=typeof Ae[f]||(n=[`emote_${f}0`]),b=r?await async function({x:e,y:t,z:a,radius:d,scale:o=3,name:r,framerate:n,gifs:s,suffix:u=""}={}){let i={};return Object.keys(s).forEach(e=>{i[e]={framerate:n,path:s[e].path,loop:!0}}),await Unicorn.AddObject(r,{type:"circle",scale:{x:o,y:o},friction:0,frictionAir:0,frictionStatic:0,bounce:1,gifs:i,x:e,y:t,z:a,radius:d})}({x:$(y),y:-100-$(50),z:100,radius:36,scale:1.2,name:"player_"+e,gifs:{front:{path:r}}}):await a({x:$(y),y:-100-$(50),z:100,radius:36,scale:1.2,name:"player_"+e,framerate:n.length>1?Ae[f].framerate:void 0,animations:{front:{numFrames:n.length,prefix:"emote_"+f}}}),b.charName="player_"+e,b.endImage=n[0],b.endScale=1.2,b.cleanup=()=>{o(b)}}else if(h){if(!Oe[h])return Oe[h]=!0,Unicorn.Load(`emoji_${h}0`,h),void setTimeout(()=>{delete Ue[e],Ve(e,t,d,u,c,l,f,h,m)},500);b=await a({x:$(y),y:-100-$(50),z:100,radius:36,scale:1,name:"player_"+e,animations:{front:{numFrames:1,prefix:"emoji_"+h}}}),b.charName="player_"+e,b.endImage=`emoji_${h}0`,b.endScale=1,b.cleanup=()=>{o(b)}}else"string"!=typeof u?b=await n($(y),-100-$(50),100,u):k.skintones||k.character?(k.skintones&&delete k.character,b=await n($(y),-100-$(50),100,k)):b=await r($(y),-100-$(50),100,k,u);x=await s(-1e3,-1e3,200,k),x&&(_=x.petName);let U=Unicorn.AddBacklay("para_"+e,c,{scale:{x:0,y:0},x:-50,y:0,z:50});U.visible=!1,U.zIndex=11,U.scale.x=0,U.scale.y=0,U.anchor.set(.5,1);let S=Unicorn.AddText("name_"+e,t,-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:34,fontWeight:400,fill:d,lineJoin:"round",stroke:tinycolor.isReadable(w.toString(),"#000000")?"#000000":"#ffffff",strokeThickness:6});S.anchor.set(.5);let A=Unicorn.AddText(e+"_points","",-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:34,fontWeight:400,fill:"#ffd700",lineJoin:"round",stroke:"#000000",strokeThickness:6});A.anchor.set(.5);let O=null;_&&(O=Unicorn.AddBacklay("petpara_"+e,l||c,{scale:{x:0,y:0},x:-50,y:0,z:150}),O.visible=!1,O.zIndex=11,O.scale.x=0,O.scale.y=0,O.anchor.set(.5,1)),b.restitution=1,b.friction=0,b.frictionStatic=0,b.frictionAir=0,b.torque=-5+$(10),b.rotationOffset=Math.random()*Math.PI,Unicorn.SetVelocity(b,$(24)-12,0),Ue[e]={style:k,parachute:U,player:b,pet:x,petPara:O,petType:_,petOffset:30*Math.random()+(Math.random()>.5?-150:70),label:S,scoreLabel:A,nameColor:w},m&&(Ue[e].userId=m.userId,Ue[e].name=m.displayName||m.username),c&&c.includes("chute_plane")&&(Ue[e].paraFlipDir=!0),l&&l.includes("chute_plane")&&(Ue[e].petParaFlipDir=!0),Unicorn.PlaySound("sfx-parachute-drop",{volume:g}),ce&&clearTimeout(ce),ce=setTimeout(async()=>{if(await T(!1,!0),p.variations){const e=p.variations.split(","),t=$(e.length),a=`${window.location.protocol}//${window.location.host}${window.location.pathname.substr(0,window.location.pathname.lastIndexOf("/"))}/${e[t]}${window.location.search}`;window.location.href=a}else ue(),T(!0).then(e=>{v=e.session})},parseInt(p.cooldown||"90000"))}}async function Ye(e){if(!p.droplets)return;Me++;let t=null,a=0;a=$(f.droplets?f.droplets.length:6);let d=3;f.dropletSizes&&(d*=f.dropletSizes[a]);let o=f.droplets[a];Array.isArray(f.droplets[a])&&(o=f.droplets[a][$(f.droplets[a].length)]),t=await Unicorn.AddObject("droplet_"+Me,{type:"circle",sprite:o,scale:{x:1.5,y:1.5},x:$(y),y:-100-$(50),z:100,radius:.75*assetReference[o].width}),t.restitution=1,t.friction=.5*(5-a),t.frictionStatic=0,t.frictionAir=0,t.torque=-1+$(2),t.rotationOffset=Math.random()*Math.PI,t.mass*=20,Re[t.label]=t,Unicorn.SetVelocity(t,$(24)-12,0),setTimeout(()=>{delete Re[t.label],Unicorn.RemoveObject(t.label)},3e4)}async function Xe(){if(K=!0,ee={},te=!1,le=f.target_width||368,fe=le/2+$(y-le),pe=m-47+(f.target_offset||0),f.target_walls&&(fe<le/2+70?fe=le/2+70:fe>y-le/2-70&&(fe=y-le/2-70)),f.target_versions){const e=$(Object.keys(f.target_versions).length);Object.keys(f.target_versions).forEach((t,a)=>{e===a&&(ke=t);let d=f.target_versions[t];if(we[t]={},Array.isArray(d.target))if(f.target_random){he&&Unicorn.RemoveBacklay("target"+t);let e=$(d.target.length);he=Unicorn.AddBacklay("target"+t,"target"+t+e,fe,pe,{scale:{x:2,y:2}}),he.zIndex=10,he.anchor.set(.5),he.visible=!1,we[t].target=he}else{if(he)for(let e=0;e<he.length;e++)he[e]&&Unicorn.RemoveBacklay("target"+t+e);_e=0,he=[];for(let e=0;e<d.target.length;e++){let a=Unicorn.AddBacklay("target"+t+e,"target"+t+e,fe,pe,{scale:{x:2,y:2}});a.zIndex=10,a.anchor.set(.5),a.visible=!1,he.push(a)}we[t].target=he,he[_e].visible=!1,p.hideTilDrop||f.target_animate_on_landed||Z()}else he&&Unicorn.RemoveBacklay("target"+t),he=Unicorn.AddBacklay("target"+t,"target"+t,fe,pe,{scale:{x:2,y:2}}),he.zIndex=10,he.anchor.set(.5),he.visible=!1,we[t].target=he;if(d.target_overlay)if(Array.isArray(d.target_overlay)){if(ye)for(let e=0;e<ye.length;e++)ye[e]&&Unicorn.RemoveBacklay("target_overlay"+t+e);xe=0,ye=[];for(let e=0;e<d.target_overlay.length;e++){let a=Unicorn.AddBacklay("target_overlay"+t+e,"target_overlay"+t+e,fe,pe+(f.target_overlay_offset||0),{scale:{x:2,y:2}});a.zIndex=11,a.anchor.set(.5),a.visible=!1,ye.push(a)}we[t].target_overlay=ye,ye[xe].visible=!1,p.hideTilDrop||f.target_animate_on_landed||Z()}else ye&&Unicorn.RemoveBacklay("target_overlay"+t),ye=Unicorn.AddBacklay("target_overlay"+t,"target_overlay"+t,fe,pe,{scale:{x:2,y:2}}),ye.zIndex=11,ye.anchor.set(.5),ye.visible=!1,we[t].target_overlay=ye})}else{if(Array.isArray(f.target))if(f.target_random){he&&Unicorn.RemoveBacklay("target");let e=$(f.target.length);he=Unicorn.AddBacklay("target","target"+e,fe,pe,{scale:{x:2,y:2}}),he.zIndex=10,he.anchor.set(.5)}else{if(he)for(let e=0;e<he.length;e++)he[e]&&Unicorn.RemoveBacklay("target"+e);_e=0,he=[];for(let e=0;e<f.target.length;e++){let t=Unicorn.AddBacklay("target"+e,"target"+e,fe,pe,{scale:{x:2,y:2}});t.zIndex=10,t.anchor.set(.5),t.visible=!1,he.push(t)}he[_e].visible=!0,p.hideTilDrop||f.target_animate_on_landed||Z()}else he&&Unicorn.RemoveBacklay("target"),he=Unicorn.AddBacklay("target","target",fe,pe,{scale:{x:2,y:2}}),he.zIndex=10,he.anchor.set(.5);if(f.target_overlay)if(Array.isArray(f.target_overlay)){if(ye)for(let e=0;e<ye.length;e++)ye[e]&&Unicorn.RemoveBacklay("target_overlay"+e);xe=0,ye=[];for(let e=0;e<f.target_overlay.length;e++){let t=Unicorn.AddBacklay("target_overlay"+e,"target_overlay"+e,fe,pe+(f.target_overlay_offset||0),{scale:{x:2,y:2}});t.zIndex=11,t.anchor.set(.5),t.visible=!1,ye.push(t)}ye[xe].visible=!0,p.hideTilDrop||f.target_animate_on_landed||Z()}else ye&&Unicorn.RemoveBacklay("target_overlay"),ye=Unicorn.AddBacklay("target_overlay","target_overlay",fe,pe,{scale:{x:2,y:2}}),ye.zIndex=11,ye.anchor.set(.5)}if(f.target_frontlay)if(Array.isArray(f.target_frontlay)){if(me)for(let e=0;e<me.length;e++)me[e]&&Unicorn.RemoveOverlay("target_frontlay"+e);ve=0,me=[];for(let e=0;e<f.target_frontlay.length;e++){let t=Unicorn.AddOverlay("target_frontlay"+e,"target_frontlay"+e,fe,pe+(f.target_overlay_offset||0),{scale:{x:2,y:2}});t.zIndex=12,t.anchor.set(.5),t.visible=!1,me.push(t)}me[ve].visible=!0,p.hideTilDrop||f.target_animate_on_landed||Z()}else me&&Unicorn.RemoveOverlay("target_frontlay"),me=Unicorn.AddOverlay("target_frontlay","target_frontlay",fe,pe,{scale:{x:2,y:2}}),me.zIndex=2,me.anchor.set(.5);if(f.target_front&&(ge&&Unicorn.RemoveOverlay("target_front"),ge=Unicorn.AddOverlay("target_front","target_front",fe,pe,{scale:{x:2,y:2}}),ge.zIndex=100,ge.anchor.set(.5)),p.clouds&&0===je.length)for(let e=0;e<11;e++){Q++;let e=f.clouds[$(f.clouds.length)],t=Unicorn.AddOverlay("cloud_"+Q,e,$(y),$(500),{scale:{x:3,y:3}});t.alpha=p.overlay?.5:.9,t.anchor.set(.5),t.speed=.01+.1*Math.random(),t.zIndex=t.speed,je.push(t)}if(f.target_walls){be.length>0&&(Unicorn.RemoveObject("TargetTop"),Unicorn.RemoveObject("TargetLeft"),Unicorn.RemoveObject("TargetRight"),be=[]);let e=await Unicorn.AddObject("TargetTop",{type:"rectangle",x:fe,y:pe+f.target_walls/2+f.target_collide_land,width:le-50,height:10,isStatic:!0});e.sprite.visible=!1;let t=await Unicorn.AddObject("TargetLeft",{type:"rectangle",x:fe-le/2+27,y:pe+f.target_walls,width:10,height:100,isStatic:!0});t.sprite.visible=!1;let a=await Unicorn.AddObject("TargetRight",{type:"rectangle",x:fe+le/2-27,y:pe+f.target_walls,width:10,height:100,isStatic:!0});a.sprite.visible=!1,be.push(e),be.push(t),be.push(a)}p.hideTilDrop&&(je.forEach(e=>e.visible=!1),be.forEach(e=>e.isSensor=!0),f.target_animate_on_landed||(H(),ye&&Array.isArray(ye)&&(ye[xe].visible=!1),me&&Array.isArray(me)&&(me[ve].visible=!1)),Array.isArray(f.target)&&!f.target_random?he.forEach(e=>{e.visible=!1}):he.visible=!1,ye&&(Array.isArray(f.target_overlay)&&!f.target_random?ye.forEach(e=>{e.visible=!1}):ye.visible=!1),me&&(Array.isArray(f.target_frontlay)&&!f.target_random?me.forEach(e=>{e.visible=!1}):me.visible=!1),ge&&(ge.visible=!1));for(let e=0;e<Te.length;e++){let t=Te[e];Unicorn.RemoveBacklay(t.label)}Te=[];for(let e=0;e<Ie.length;e++){let t=Ie[e];Unicorn.RemoveBacklay(t.label)}Ie=[];for(let e=0;e<Pe.length;e++){let t=Pe[e];Unicorn.RemoveOverlay(t.label)}Pe=[];for(let e=0;e<Ee.length;e++){let t=Ee[e];Unicorn.RemoveObject(t.charName)}if(Ee=[],p.spawnZombies){const e=p.spawnZombies.split(",").map(e=>e.trim());Le=e[$(e.length)];const t=1;for(let e=0;e<t;e++){let e=$(y);Math.abs(fe-e)<le/2+10&&(e=fe+(e<fe?-le/2-10:le/2+10));const t={character:{id:Le,path:Le}};let a=await r(e,m-40,110,t);a.isSensor=!0,a.isStatic=!0,p.hideTilDrop&&(a.isHidden=!0,a.position.y=m+100),a.timeTilNextWalk=3e3+$(27e3),a.walkDirection=$(2)>0?"left":"right",Unicorn.PlayObjectAnimation(a.charName,a.walkDirection),De.push(a)}}}