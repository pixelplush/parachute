let e=0;function t(e,t,a,d=!1){let r={};return b.Animations.forEach(o=>{d&&"back"===o||(r[o]={numFrames:a,prefix:`${e}_${t}_${o}`})}),r}function a({x:e,y:t,z:a,radius:d,scale:r=3,name:o,framerate:u=4/60,animations:s,suffix:n=""}={}){let i={};return Object.keys(s).forEach(e=>{i[e]={framerate:u,frames:Array.from({length:s[e].numFrames},(t,a)=>`${s[e].prefix}${n||a}`),loop:!0}}),Unicorn.AddObject(o,{type:"circle",scale:{x:r,y:r},friction:0,frictionAir:0,frictionStatic:0,bounce:1,animations:i,x:e,y:t,z:a,radius:d})}function d({x:e,y:t,z:a,scale:d=3,name:r,framerate:o=4/60,animations:u,suffix:s=""}={}){let n={};Object.keys(u).forEach(e=>{n[e]={framerate:o,frames:Array.from({length:u[e].numFrames},(t,a)=>`${u[e].prefix}${s||a}`),loop:!0}});let i=Unicorn.AddSprite(r,{scale:{x:d,y:d},animations:n,x:e,y:t,z:a});return i.label=r,i.objectOffset=-39,Object.keys(u).forEach(e=>{i.animations[e].anchor.set(.5,1)}),i}function r(e){e.sprites&&Object.keys(e.sprites).forEach(t=>{Unicorn.RemoveSprite(e.sprites[t].label)}),Unicorn.RemoveObject(e.label)}function o(d,r,o,u,s=null){l.playable;e++;const n="player_"+e;if(!l)throw"No GameTheme Defined";l.characters||(l.characters={});let i=!1;s&&l.playable.includes(s)||(u.character&&u.character.id?(s=u.character.id,i=!0):s=l.playable[S(l.playable.length)]),_["char_"+s]||(l.characters[s]=i?u.character.path:s,T("char",s,"characters",l.characters[s],b.NumFrames));let c=a({x:d,y:r,z:o,radius:36,name:n,animations:t("char",s,b.NumFrames)});return c.character=s,c.charName=n,c.endImage=`char_${s}_front0`,c.endScale=3,c.cleanup=()=>{Unicorn.RemoveObject(n)},c}function u(o,u,s,n={}){e++;const i="player_"+e;if(!l)throw"No GameTheme Defined";l.characters||(l.characters={});let c=b.NumFrames,f="",p={};const h=[];if(n.character){const e=n.character;_["char_"+e.id]||(l.characters[e.id]=e.path,T("char",e.id,"characters",l.characters[e.id],c)),p=a({x:o,y:u,z:s,radius:36,name:i,animations:t("char",e.id,c)});const r=Object.keys(p.animations);for(const e of r)p.animations[e].visible=!1;p.character=e.id,p.charName=i,p.endImage=`char_${e.id}_front0`,p.endScale=3,p.sprites={},p.sprites.char=d({x:o,y:u,z:s,name:i+"_char",animations:t("char",e.id,c),suffix:f}),Unicorn.AttachSpriteToObject(i+"_char",i),h.push(i+"_char")}else{if(n.wheelchairs){const e=n.wheelchairs;c=1,f="_wheel",T("wheelchair",e.path,"skins/equipment/wheelchairs",e.path,b.NumFrames)}if(!n.skintones)throw"No Body";{const e=n.skintones,r=n.expressions,l=n.hair;if(T("skin",e.path,"skins/body/skintones",e.path,c,f),p=a({x:o,y:u,z:s,radius:36,name:i,animations:t("skin",e.path,c),suffix:f}),p.character=e.path,p.charName=i,p.endImage=`skin_${e.path}_front0`,p.endScale=3,p.sprites={},r&&(T("expr",r.path,"skins/body/expressions",r.path,c,f,!0),p.sprites.expr=d({x:o,y:u,z:s+1,name:i+"_expr",animations:t("expr",r.path,c,!0),suffix:f}),Unicorn.AttachSpriteToObject(i+"_expr",i),h.push(i+"_expr")),l){n.onesies||(T("hair",l.path,"skins/body/hair",l.path,c,f),p.sprites.hair=d({x:o,y:u,z:s+2,name:i+"_hair",animations:t("hair",l.path,c),suffix:f}),Unicorn.AttachSpriteToObject(i+"_hair",i),h.push(i+"_hair"))}}if(n.wheelchairs){const e=n.wheelchairs;p.sprites.wheelchair=d({x:o,y:u,z:s+10,name:i+"_wheel",animations:t("wheelchair",e.path,b.NumFrames)}),Unicorn.AttachSpriteToObject(i+"_wheel",i),h.push(i+"_wheel")}}const y=n.pants,m=n.shirts,g=n.dresses,x=n.onesies;y&&(T("pants",y.path,"skins/outfits/pants",y.path,c,f),p.sprites.pants=d({x:o,y:u,z:s+3,name:i+"_pants",animations:t("pants",y.path,c),suffix:f}),Unicorn.AttachSpriteToObject(i+"_pants",i),h.push(i+"_pants")),m&&(T("shirts",m.path,"skins/outfits/shirts",m.path,c,f),p.sprites.shirts=d({x:o,y:u,z:s+4,name:i+"_shirts",animations:t("shirts",m.path,c),suffix:f}),Unicorn.AttachSpriteToObject(i+"_shirts",i),h.push(i+"_shirts")),g&&(T("dress",g.path,"skins/outfits/dresses",g.path,c,f),p.sprites.dresses=d({x:o,y:u,z:s+5,name:i+"_dresses",animations:t("dress",g.path,c),suffix:f}),Unicorn.AttachSpriteToObject(i+"_dresses",i),h.push(i+"_dresses")),x&&(T("onesie",x.path,"skins/outfits/onesies",x.path,c,f),p.sprites.onesies=d({x:o,y:u,z:s+5,name:i+"_onesies",animations:t("onesie",x.path,c),suffix:f}),Unicorn.AttachSpriteToObject(i+"_onesies",i),h.push(i+"_onesies"));const v=["glasses","hats","masks","wands"];for(const e of v){const a=n[e];a&&(T("acc",a.path,"skins/accessories/"+e,a.path,c,f),p.sprites["acc_"+a.path]=d({x:o,y:u,z:s+10,name:i+"_acc_"+a.path,animations:t("acc",a.path,c),suffix:f}),Unicorn.AttachSpriteToObject(i+"_acc_"+a.path,i),h.push(i+"_acc_"+a.path))}const w=n.effects;return w&&(T("effect",w.path,"skins/effects",w.path,c,f),p.sprites.effects=d({x:o,y:u,z:s+5,name:i+"_effects",animations:t("effect",w.path,c),suffix:f}),Unicorn.AttachSpriteToObject(i+"_effects",i),h.push(i+"_effects")),p.cleanup=()=>{r(p)},p}function s(d,r,o,u,s){if(!u||!u.pet||"pet_none"===u.pet.id)return null;e++;const n="pet_"+e;if(!l)throw"No GameTheme Defined";l.pets||(l.pets={});let i=u.pet.id.replace("pet_","");_["pet_"+i]||(l.pets[i]={path:u.pet.path,minIdle:u.pet.minIdle,maxIdle:u.pet.maxIdle},T("pet",i,"pets",u.pet.path,b.NumFrames));let c=a({x:d,y:r,z:o,radius:24,name:n,framerate:s||4/60,animations:t("pet",l.pets[i].path,b.NumFrames)});return c.isStatic=!0,c.isSensor=!0,c.petName=i,c.charName=n,c.cleanup=()=>{Unicorn.RemoveObject(n)},c}const n="https://api.pixelplush.dev/v1";let i="PixelPlush Game",c="unknown",l={},f={},p="",h=1920,y=1080,m=.5,g=!1;const b={NumFrames:10,Animations:["front","left","back","right"]};let _={};var x="",v=!0;let w="",k=!0,$={};function S(e){return Math.floor(Math.random()*Math.floor(e))}function A(e){for(let t=e.length-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}}async function U(e){return await fetch("https://id.twitch.tv/oauth2/validate",{headers:{Authorization:"OAuth "+e}}).then(e=>e.json()).catch(e=>({error:e}))}function O(e,t,a,d,r){const o=d.dims;let u=document.createElement("canvas");u.width=t,u.height=a;let s=u.getContext("2d"),n=s.createImageData(t,a);if(r)for(let e=0;e<a;e++)for(let a=0;a<t;a++){const d=4*(e*t+a);n.data[d+0]=r.data[d+0],n.data[d+1]=r.data[d+1],n.data[d+2]=r.data[d+2],n.data[d+3]=r.data[d+3]}for(let e=o.top;e<o.top+o.height;e++)for(let a=o.left;a<o.left+o.width;a++){const r=a-o.left,u=(e-o.top)*o.width+r,s=4*u,i=4*(e*t+a);d.pixels[u]!==d.transparentIndex&&(n.data[i+0]=d.patch[s+0],n.data[i+1]=d.patch[s+1],n.data[i+2]=d.patch[s+2],n.data[i+3]=d.patch[s+3])}switch(s.putImageData(n,0,0),e){case 1:default:break;case 2:for(let e=o.top;e<o.top+o.height;e++)for(let a=o.left;a<o.left+o.width;a++){const d=4*(e*t+a);n.data[d+0]=0,n.data[d+1]=0,n.data[d+2]=0,n.data[d+3]=0}break;case 3:if(r)for(let e=o.top;e<o.top+o.height;e++)for(let a=o.left;a<o.left+o.width;a++){const d=4*(e*t+a);n.data[d+0]=r.data[d+0],n.data[d+1]=r.data[d+1],n.data[d+2]=r.data[d+2],n.data[d+3]=r.data[d+3]}}return{canvas:u,data:n}}async function j(e){let t=Object.keys(be).length;return window.location.host.startsWith("localhost")?0:fetch(n+"/analytics/heartbeat",{method:"POST",body:JSON.stringify({session:x,game:c,theme:i,channel:f.channel,players:Object.keys(be),count:t})}).then(e=>e.json())}function T(e,t,a,d,r,o="",u=!1){if(!_[e+"_"+t+o]){_[e+"_"+t+o]=!0;for(let s=0;s<r;s++)for(let r=0;r<b.Animations.length;r++){const n=b.Animations[r];if(u&&"back"===n)continue;const i=`${d}_${n}`;o?Unicorn.Load(`${e}_${t}_${n}${o}`,`${p}/assets/${a}/${t}/${i}/${i}${o}.png`):Unicorn.Load(`${e}_${t}_${n}${s}`,`${p}/assets/${a}/${t}/${i}/${i}${s+1}.png`)}}}async function I(e,t,a,d){return f.oauth?fetch(n+"/scores/add",{method:"POST",body:JSON.stringify({token:f.oauth.replace("oauth:",""),channel:f.channel,game:c,theme:i,user:e,score:t,userId:a,username:d})}).then(e=>e.json()):{}}window.setupGame=function(e,t,a){if(i=e,l=t,f=a,p=l.path||"",f.clouds=void 0===f.clouds||null===f.clouds?!f.overlay:"true"===f.clouds,m=void 0===f.volume||null===f.volume?0:parseInt(f.volume)/100,h=Math.min(window.innerWidth,l.screenWidth||1920),y=Math.min(window.innerHeight,l.screenHeight||1080),f.variations&&!f.didRandom){const e=f.variations.split(","),t=S(e.length),a=`${window.location.protocol}//${window.location.host}${window.location.pathname.substr(0,window.location.pathname.lastIndexOf("/"))}/${e[t]}${window.location.search}&didRandom=1`;window.location.href=a}f.readyTime&&(k=!1,setTimeout(()=>{k=!0,ComfyJS.Say("Parachute Drop is ready!")},parseInt(f.readyTime||1e3)))},window.WebFontConfig={custom:{families:["Pixeltype","Pixellari"]},active(){!async function(){try{const e=(await fetch("https://www.pixelplush.dev/assets/shamelist.txt").then(e=>e.text())).split(",").map(e=>e.trim().toLowerCase());if(f.channel&&e&&e.includes(f.channel.toLowerCase())&&(console.log("This channel has been blocked for violating the PixelPlush Terms of Service."),v=!1),l.requires)try{if(account=await fetch(n+"/accounts",{headers:{Twitch:f.oauth?f.oauth.replace("oauth:",""):void 0}}).then(e=>e.json()),console.log(account),account.error)throw"Login Error";if(!account.owned.includes(l.requires))throw"Item not owned"}catch(e){return void console.log("Auth Validate Failed",e)}await async function(){c="parachute",f.spawnZombies&&(console.log("zombie"),"instafluff"!==f.channel&&"maaya"!==f.channel&&(f.spawnZombies=""));f.notifVolume&&(N=parseInt(f.notifVolume)/100);f.command=f.command||"drop",f.cpDrop&&($["Parachute Drop!"]={desc:"Drop into the PixelPlush Parachute Game!",color:"#F2C079",cost:parseInt(f.cpDropCost||50),callback:(e,t,a,d,r)=>{be[e]||Q(e,f.command,d,{},r)}});f.cpDroplets&&($["Parachute Droplets"]={desc:"Add bouncing obstacles into the PixelPlush Parachute Game!",color:"#F2C079",cost:parseInt(f.cpDropletsCost||500),cooldown:parseInt(f.cpDropletsCD||5),callback:()=>{if(k)if(v)for(let e=0;e<5;e++)Fe(100);else f.oauth&&ComfyJS.Say("The Parachute Drop game needs your attention. Please contact the PixelPlush team on Discord.")}});f.cpQueue&&($["Group Parachute"]={desc:"Queue everyone for a group drop in the PixelPlush Parachute Game!",color:"#F2C079",cost:parseInt(f.cpQueueCost||500),cooldown:parseInt(f.cpQueueCD||120),callback:()=>{if(k)if(v)if(V)ComfyJS.Say("/me Group Drop is already queued.");else{N>0&&Unicorn.PlaySound("sfx-group-queue",{volume:N}),ae(),V=!0;const e=6e4;ComfyJS.Say(`/me Parachutes are queued for the next 60 seconds. !${f.command} to join!`),setTimeout(()=>{ComfyJS.Say(`/me 30 seconds remaining. !${f.command} (${Object.keys(X).length} in group)`)},e-3e4),setTimeout(()=>{ComfyJS.Say(`/me 10 seconds. !${f.command} (${Object.keys(X).length} in group)`)},e-1e4),setTimeout(()=>{let e=Object.keys(X);A(e),e.forEach(e=>{const t=X[e];Be(t.username,t.name,t.color,t.message,t.selectedPara||l.parachutes[S(l.parachutes.length)],t.selectedPetPara||l.petparachutes[S(l.petparachutes.length)],t.emote,t.emoji,t.extra)}),X={}},e)}else f.oauth&&ComfyJS.Say("The Parachute Drop game needs your attention. Please contact the PixelPlush team on Discord.")}})}()}catch(e){console.log(e)}Unicorn.Create("unicorn-display",{width:h,height:y,background:"transparent",init:qe,update:Ge,channel:f.channel,username:f.oauth?f.channel:void 0,password:f.oauth?f.oauth.replace("oauth:",""):void 0,onCommand:Q,onChat:K,screenWalls:!1,gravity:{x:0,y:1},framerate:f.fps||60}),ComfyJS.onCheer=ee,ComfyJS.onRaid=te,ComfyJS.onConnected=async(e,t,a)=>{if(a){Je();let e=await j();if(0!==e&&(x=e.session,setInterval(()=>{j()},6e4)),f.oauth){let e=await U(f.oauth.replace("oauth:",""));w=e.client_id,["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every(t=>e.scopes.includes(t))||console.log("Need more permissions"),e.expires_in<1800&&console.log("Token expires soon. Need to generate new link")}let t=await ComfyJS.GetChannelRewards(w,!0),a=Object.keys($);for(let e=0;e<a.length;e++){let d=a[e];if(!t.some(e=>e.title===d))try{await ComfyJS.CreateChannelReward(w,{title:d,prompt:$[d].desc,cost:$[d].cost,is_enabled:!0,background_color:$[d].color,is_user_input_required:!1,is_max_per_stream_enabled:!1,max_per_stream:0,is_max_per_user_per_stream_enabled:!1,max_per_user_per_stream:0,is_global_cooldown_enabled:!!$[d].cooldown,global_cooldown_seconds:$[d].cooldown,should_redemptions_skip_request_queue:!0})}catch(e){console.log(e)}}}},ComfyJS.onReward=(e,t,a,d,r)=>{$[t]&&$[t].callback(e,t,a,d,r)}}()}},function(){const e=document.createElement("script");e.src=("https:"===document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",e.type="text/javascript",e.async="true";const t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();const P={parse:function(e,t){var a=t&&t.assetType?t.assetType:"svg",d=t&&t.buildUrl?t.buildUrl:function(e,t){return"png"===t?"https://twemoji.maxcdn.com/2/72x72/"+e+".png":"https://twemoji.maxcdn.com/2/svg/"+e+".svg"},r=[];M.default.lastIndex=0;for(;;){var o=M.default.exec(e);if(!o)break;var u=o[0],s=R(L(u)).join("-");r.push({url:s?d(s,a):"",indices:[o.index,M.default.lastIndex],text:u,type:E})}return r}};P.toCodePoints=R;var C,M=(C=/(?:\ud83d\udc68\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c\udffb|\ud83d\udc68\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc]|\ud83d\udc68\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd]|\ud83d\udc68\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffc-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffd-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c\udffb|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb\udffc]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd\udfff]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffd]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffe]|\ud83e\uddd1\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c\udffb|\ud83e\uddd1\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb\udffc]|\ud83e\uddd1\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udffd]|\ud83e\uddd1\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udffe]|\ud83e\uddd1\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\u200d\ud83e\udd1d\u200d\ud83e\uddd1|\ud83d\udc6b\ud83c[\udffb-\udfff]|\ud83d\udc6c\ud83c[\udffb-\udfff]|\ud83d\udc6d\ud83c[\udffb-\udfff]|\ud83d[\udc6b-\udc6d])|(?:\ud83d[\udc68\udc69])(?:\ud83c[\udffb-\udfff])?\u200d(?:\u2695\ufe0f|\u2696\ufe0f|\u2708\ufe0f|\ud83c[\udf3e\udf73\udf93\udfa4\udfa8\udfeb\udfed]|\ud83d[\udcbb\udcbc\udd27\udd2c\ude80\ude92]|\ud83e[\uddaf-\uddb3\uddbc\uddbd])|(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75]|\u26f9)((?:\ud83c[\udffb-\udfff]|\ufe0f)\u200d[\u2640\u2642]\ufe0f)|(?:\ud83c[\udfc3\udfc4\udfca]|\ud83d[\udc6e\udc71\udc73\udc77\udc81\udc82\udc86\udc87\ude45-\ude47\ude4b\ude4d\ude4e\udea3\udeb4-\udeb6]|\ud83e[\udd26\udd35\udd37-\udd39\udd3d\udd3e\uddb8\uddb9\uddcd-\uddcf\uddd6-\udddd])(?:\ud83c[\udffb-\udfff])?\u200d[\u2640\u2642]\ufe0f|(?:\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f|\ud83c\udff3\ufe0f\u200d\ud83c\udf08|\ud83c\udff4\u200d\u2620\ufe0f|\ud83d\udc15\u200d\ud83e\uddba|\ud83d\udc41\u200d\ud83d\udde8|\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc6f\u200d\u2640\ufe0f|\ud83d\udc6f\u200d\u2642\ufe0f|\ud83e\udd3c\u200d\u2640\ufe0f|\ud83e\udd3c\u200d\u2642\ufe0f|\ud83e\uddde\u200d\u2640\ufe0f|\ud83e\uddde\u200d\u2642\ufe0f|\ud83e\udddf\u200d\u2640\ufe0f|\ud83e\udddf\u200d\u2642\ufe0f)|[#*0-9]\ufe0f?\u20e3|(?:[Â©Â®\u2122\u265f]\ufe0f)|(?:\ud83c[\udc04\udd70\udd71\udd7e\udd7f\ude02\ude1a\ude2f\ude37\udf21\udf24-\udf2c\udf36\udf7d\udf96\udf97\udf99-\udf9b\udf9e\udf9f\udfcd\udfce\udfd4-\udfdf\udff3\udff5\udff7]|\ud83d[\udc3f\udc41\udcfd\udd49\udd4a\udd6f\udd70\udd73\udd76-\udd79\udd87\udd8a-\udd8d\udda5\udda8\uddb1\uddb2\uddbc\uddc2-\uddc4\uddd1-\uddd3\udddc-\uddde\udde1\udde3\udde8\uddef\uddf3\uddfa\udecb\udecd-\udecf\udee0-\udee5\udee9\udef0\udef3]|[\u203c\u2049\u2139\u2194-\u2199\u21a9\u21aa\u231a\u231b\u2328\u23cf\u23ed-\u23ef\u23f1\u23f2\u23f8-\u23fa\u24c2\u25aa\u25ab\u25b6\u25c0\u25fb-\u25fe\u2600-\u2604\u260e\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262a\u262e\u262f\u2638-\u263a\u2640\u2642\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267b\u267f\u2692-\u2697\u2699\u269b\u269c\u26a0\u26a1\u26a7\u26aa\u26ab\u26b0\u26b1\u26bd\u26be\u26c4\u26c5\u26c8\u26cf\u26d1\u26d3\u26d4\u26e9\u26ea\u26f0-\u26f5\u26f8\u26fa\u26fd\u2702\u2708\u2709\u270f\u2712\u2714\u2716\u271d\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u2764\u27a1\u2934\u2935\u2b05-\u2b07\u2b1b\u2b1c\u2b50\u2b55\u3030\u303d\u3297\u3299])(?:\ufe0f|(?!\ufe0e))|(?:(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75\udd90]|[\u261d\u26f7\u26f9\u270c\u270d])(?:\ufe0f|(?!\ufe0e))|(?:\ud83c[\udf85\udfc2-\udfc4\udfc7\udfca]|\ud83d[\udc42\udc43\udc46-\udc50\udc66-\udc69\udc6e\udc70-\udc78\udc7c\udc81-\udc83\udc85-\udc87\udcaa\udd7a\udd95\udd96\ude45-\ude47\ude4b-\ude4f\udea3\udeb4-\udeb6\udec0\udecc]|\ud83e[\udd0f\udd18-\udd1c\udd1e\udd1f\udd26\udd30-\udd39\udd3d\udd3e\uddb5\uddb6\uddb8\uddb9\uddbb\uddcd-\uddcf\uddd1-\udddd]|[\u270a\u270b]))(?:\ud83c[\udffb-\udfff])?|(?:\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc73\udb40\udc63\udb40\udc74\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc77\udb40\udc6c\udb40\udc73\udb40\udc7f|\ud83c\udde6\ud83c[\udde8-\uddec\uddee\uddf1\uddf2\uddf4\uddf6-\uddfa\uddfc\uddfd\uddff]|\ud83c\udde7\ud83c[\udde6\udde7\udde9-\uddef\uddf1-\uddf4\uddf6-\uddf9\uddfb\uddfc\uddfe\uddff]|\ud83c\udde8\ud83c[\udde6\udde8\udde9\uddeb-\uddee\uddf0-\uddf5\uddf7\uddfa-\uddff]|\ud83c\udde9\ud83c[\uddea\uddec\uddef\uddf0\uddf2\uddf4\uddff]|\ud83c\uddea\ud83c[\udde6\udde8\uddea\uddec\udded\uddf7-\uddfa]|\ud83c\uddeb\ud83c[\uddee-\uddf0\uddf2\uddf4\uddf7]|\ud83c\uddec\ud83c[\udde6\udde7\udde9-\uddee\uddf1-\uddf3\uddf5-\uddfa\uddfc\uddfe]|\ud83c\udded\ud83c[\uddf0\uddf2\uddf3\uddf7\uddf9\uddfa]|\ud83c\uddee\ud83c[\udde8-\uddea\uddf1-\uddf4\uddf6-\uddf9]|\ud83c\uddef\ud83c[\uddea\uddf2\uddf4\uddf5]|\ud83c\uddf0\ud83c[\uddea\uddec-\uddee\uddf2\uddf3\uddf5\uddf7\uddfc\uddfe\uddff]|\ud83c\uddf1\ud83c[\udde6-\udde8\uddee\uddf0\uddf7-\uddfb\uddfe]|\ud83c\uddf2\ud83c[\udde6\udde8-\udded\uddf0-\uddff]|\ud83c\uddf3\ud83c[\udde6\udde8\uddea-\uddec\uddee\uddf1\uddf4\uddf5\uddf7\uddfa\uddff]|\ud83c\uddf4\ud83c\uddf2|\ud83c\uddf5\ud83c[\udde6\uddea-\udded\uddf0-\uddf3\uddf7-\uddf9\uddfc\uddfe]|\ud83c\uddf6\ud83c\udde6|\ud83c\uddf7\ud83c[\uddea\uddf4\uddf8\uddfa\uddfc]|\ud83c\uddf8\ud83c[\udde6-\uddea\uddec-\uddf4\uddf7-\uddf9\uddfb\uddfd-\uddff]|\ud83c\uddf9\ud83c[\udde6\udde8\udde9\uddeb-\udded\uddef-\uddf4\uddf7\uddf9\uddfb\uddfc\uddff]|\ud83c\uddfa\ud83c[\udde6\uddec\uddf2\uddf3\uddf8\uddfe\uddff]|\ud83c\uddfb\ud83c[\udde6\udde8\uddea\uddec\uddee\uddf3\uddfa]|\ud83c\uddfc\ud83c[\uddeb\uddf8]|\ud83c\uddfd\ud83c\uddf0|\ud83c\uddfe\ud83c[\uddea\uddf9]|\ud83c\uddff\ud83c[\udde6\uddf2\uddfc]|\ud83c[\udccf\udd8e\udd91-\udd9a\udde6-\uddff\ude01\ude32-\ude36\ude38-\ude3a\ude50\ude51\udf00-\udf20\udf2d-\udf35\udf37-\udf7c\udf7e-\udf84\udf86-\udf93\udfa0-\udfc1\udfc5\udfc6\udfc8\udfc9\udfcf-\udfd3\udfe0-\udff0\udff4\udff8-\udfff]|\ud83d[\udc00-\udc3e\udc40\udc44\udc45\udc51-\udc65\udc6a-\udc6d\udc6f\udc79-\udc7b\udc7d-\udc80\udc84\udc88-\udca9\udcab-\udcfc\udcff-\udd3d\udd4b-\udd4e\udd50-\udd67\udda4\uddfb-\ude44\ude48-\ude4a\ude80-\udea2\udea4-\udeb3\udeb7-\udebf\udec1-\udec5\uded0-\uded2\uded5\udeeb\udeec\udef4-\udefa\udfe0-\udfeb]|\ud83e[\udd0d\udd0e\udd10-\udd17\udd1d\udd20-\udd25\udd27-\udd2f\udd3a\udd3c\udd3f-\udd45\udd47-\udd71\udd73-\udd76\udd7a-\udda2\udda5-\uddaa\uddae-\uddb4\uddb7\uddba\uddbc-\uddca\uddd0\uddde-\uddff\ude70-\ude73\ude78-\ude7a\ude80-\ude82\ude90-\ude95]|[\u23e9-\u23ec\u23f0\u23f3\u267e\u26ce\u2705\u2728\u274c\u274e\u2753-\u2755\u2795-\u2797\u27b0\u27bf\ue50a])|\ufe0f/g)&&C.__esModule?C:{default:C};var E=P.TypeName="emoji";var z=/\uFE0F/g,D=String.fromCharCode(8205),L=function(e){return e.indexOf(D)<0?e.replace(z,""):e};function R(e){for(var t=[],a=0,d=0,r=0;r<e.length;)a=e.charCodeAt(r++),d?(t.push((65536+(d-55296<<10)+(a-56320)).toString(16)),d=0):a>55296&&a<=56319?d=a:t.push(a.toString(16));return t}let N=0,B=0,F=!1,J=0;function q(e=0){if(F=!0,l.target_versions){Object.keys(me).forEach(e=>{Array.isArray(ne)?me[e].target.forEach(e=>{e.visible=!1}):me[e].target.visible=!1,me[e].target_overlay.forEach(e=>{e.visible=!1})});const e=S(Object.keys(me).length);ge=Object.keys(me)[e],ne=me[ge].target,ie=me[ge].target_overlay,Array.isArray(ne)?ne[pe].visible=!0:ne.visible=!0,ie[he].visible=!0}e>0&&(B=1e3*e)}function G(){F=!1,Array.isArray(ne)&&(ne[pe].visible=!1,pe=0,ne[pe].visible=!0),ie&&Array.isArray(ie)&&(ie[he].visible=!1,he=0,ie[he].visible=!0),ce&&Array.isArray(ce)&&(ce[ye].visible=!1,ye=0,ce[ye].visible=!0)}let W=0,Y=!0,X={},V=!1,Z=null,H=0;async function Q(e,t,a,d,r){if(document.hidden)return;(d.broadcaster||d.mod)&&await async function(e,t,a,d,r){switch(t){case"parachute":{const e=a.split(" ");!async function(e,t,a,d,r){switch(t){case"debug":if(g)Unicorn.RemoveText("pixelplush_debug"),g=!1;else{g=!0;let e=null;if(f.oauth){let t=await U(f.oauth.replace("oauth:",""));["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every(e=>t.scopes.includes(e))||(e="Need more permissions"),t.expires_in<1800&&(e="Token expires soon. Need to generate new link"),e||(e="Valid")}else e="No OAuth Token Provided";const t=`OAuth Token Status: ${e}\n\nGame: ${i}\n\nType: ${c}\n\nOptions:\n   ${Object.keys(f).filter(e=>"oauth"!==e&&f[e]).map(e=>`${e}:${f[e]}`).join("\n   ")}\n`;Unicorn.AddText("pixelplush_debug",t,50,50,{fontFamily:"Pixeltype",fontSize:32,fontWeight:400,fill:16711680,lineJoin:"round",stroke:"#ff0000",strokeThickness:1})}}}(0,e.shift());break}case"resetparachute":case"resetdrop":if(f.variations){const e=f.variations.split(","),t=S(e.length),a=`${window.location.protocol}//${window.location.host}${window.location.pathname.substr(0,window.location.pathname.lastIndexOf("/"))}/${e[t]}${window.location.search}`;window.location.href=a}else location.reload();break;case"deleteparachute":case"deletedrop":{let e=await ComfyJS.GetChannelRewards(w,!0),t=Object.keys($);for(let a=0;a<t.length;a++){let d=t[a],r=e.find(e=>e.title===d);r&&await ComfyJS.DeleteChannelReward(w,r.id)}break}case"raiddrop":H=1e3*parseInt(a||60),console.log("Raid mode activated"),ComfyJS.Say(`/me Drop raid activated for ${H/1e3} seconds`);break;case"unqueuedrop":V&&(ComfyJS.Say("/me Group drop is no longer queued."),V=!1);break;case"queuedrop":V?ComfyJS.Say("/me Group drop is already queued."):(ae(),V=!0,ComfyJS.Say("/me Drops are queued this game. Mods can now type !startdrop to activate!"));break;case"startdrop":if(V){let e=Object.keys(X);A(e),e.forEach(e=>{const t=X[e];Be(t.username,t.name,t.color,t.message,t.selectedPara||l.parachutes[S(l.parachutes.length)],t.selectedPetPara||l.petparachutes[S(l.petparachutes.length)],t.emote,t.emoji,t.extra)}),X={}}break;case"queuecount":V&&ComfyJS.Say(`/me ${Object.keys(X).length} people are ready to drop`);break;case"testdrop":for(var o=0;o<50;o++)W++,Be("test_"+W,"test_"+W,r.userColor||"#ffffff",Object.keys(l.characters)[S(Object.keys(l.characters).length)],l.parachutes[S(l.parachutes.length)],l.petparachutes[S(l.petparachutes.length)],"","",r);break;case"droplet":{let e=parseInt(a||Math.pow(10,S(6)));for(let t=0;t<5;t++)Fe(e);break}}}(0,t,a,0,r),await async function(e,t,a,d,r){switch(t){case"drophigh":case"drophighscore":case"dropbest":if(f.oauth){let e=await async function(){if(f.oauth){const e=new Date;e.setDate(e.getDate()-1);const t=e.toISOString().split("T")[0];return(await fetch(`${n}/scores/high?channel=${f.channel}&game=${c}&date=${t}`,{method:"GET"}).then(e=>e.json()))[0]}return null}();e&&e.score&&ComfyJS.Say(`/me The highest score in the past 24 hours is ${e.score} by ${e.user}`)}break;case"droplow":case"droplowscore":case"dropworst":if(f.oauth){let e=await async function(){if(f.oauth){const e=new Date;e.setDate(e.getDate()-1);const t=e.toISOString().split("T")[0];return(await fetch(`${n}/scores/low?channel=${f.channel}&game=${c}&date=${t}`,{method:"GET"}).then(e=>e.json()))[0]}return null}();e&&e.score&&ComfyJS.Say(`/me The lowest score in the past 24 hours is ${e.score} by ${e.user}`)}break;case"droptop":case"droptopscores":case"dropleaderboard":case"dropscores":if(f.oauth){let e=await async function(){if(f.oauth){const e=new Date;e.setDate(e.getDate()-1);const t=e.toISOString().split("T")[0];return await fetch(`${n}/scores/high?channel=${f.channel}&game=${c}&date=${t}`,{method:"GET"}).then(e=>e.json())}return[]}();if(e&&e.length>0){let t=Array.from(new Set(e.map(e=>e.userId))).slice(0,10).map(t=>e.find(e=>e.userId===t));ComfyJS.Say("/me Top players in the past 24 hours are "+t.map((e,t)=>`${t+1}. ${e.user} (${e.score})`).join(", "))}else ComfyJS.Say("/me There are no scores recorded in the past 24 hours")}break;case"droprecent":if(f.oauth){let e=await async function(){if(f.oauth){return await fetch(`${n}/scores/recent?channel=${f.channel}&game=${c}`,{method:"GET"}).then(e=>e.json())}return[]}();if(e&&e.length>0){let t=Array.from(new Set(e.map(e=>e.userId))).slice(0,10).map(t=>e.find(e=>e.userId===t));ComfyJS.Say("/me Latest scores are "+t.map((e,t)=>`${e.user} (${e.score})`).join(", "))}else ComfyJS.Say("/me There are no recent scores")}}}(0,t);let o=!1;if(!f.commandOn&&f.cpDrop||(o=t===f.command),("instafriend"===r.channel||"maaya"===r.channel)&&"testoutfit"===t){o=!0;const e=await fetch("https://www.pixelplush.dev/assets/catalog.json").then(e=>e.json()),t={};e.forEach(e=>{t[e.id]=e});let d={skintones:t.outfit_skin1,expressions:t.outfit_expr1,hair:t.outfit_hair1,hats:t.outfit_party_hat_pink,effects:t.outfit_effect_flies};a=d}if(f.outfit&&"outfit"===t){o=!0,Z||(Z=await fetch("https://www.pixelplush.dev/assets/catalog_outfits.json").then(e=>e.json()));let e={};for(const t of Z)e[t.type]||(e[t.type]=[]),e[t.type].push(t);let t={};if(Math.random()<.1){const a=e.equipment[S(e.equipment.length)];t.equipment={[a.group]:a.path}}const d=e.body.filter(e=>"skintones"===e.group),r=e.body.filter(e=>"expressions"===e.group),u=e.body.filter(e=>"hair"===e.group),s=d[S(d.length)],n=r[S(r.length)],i=u[S(u.length)];if(t.body={skintones:s.path,expressions:n.path,hair:i.path},Math.random()<.05);else{const a=e.outfits.filter(e=>"dresses"===e.group),d=e.outfits.filter(e=>"pants"===e.group),r=e.outfits.filter(e=>"shirts"===e.group);t.outfits={},Math.random()<.25&&(t.outfits.dresses=a[S(a.length)].path),Math.random()<.95&&(t.outfits.pants=d[S(d.length)].path),Math.random()<.95&&(t.outfits.shirts=r[S(r.length)].path)}let c={};for(const t of e.accessories)c[t.group]||(c[t.group]=[]),c[t.group].push(t);let l=Object.keys(c);t.accessories={};for(const e of l)Math.random()<.5&&(t.accessories[e]=c[e][S(c[e].length)].path);a=t}if(k)if(v){if(o){Y&&f.hideTilDrop&&(Y=!1,ke.forEach(e=>e.visible=!0),fe.forEach(e=>e.isSensor=!1),Array.isArray(ne)?(ne[pe].visible=!0,l.target_animate_on_landed||q()):ne.visible=!0,ie&&(Array.isArray(ie)?(ie[he].visible=!0,l.target_animate_on_landed||q()):ie.visible=!0),ce&&(Array.isArray(ce)?ce[ye].visible=!0:ce.visible=!0),le&&(le.visible=!0),f.spawnZombies&&Te.forEach(e=>{e.isHidden=!1,e.position.y=y-40}));const d=P.parse(a,{assetType:"png"});if(!r.messageEmotes&&d.length>0)V?X[r.username]={username:r.username,name:e,color:r.userColor||"#ffffff",message:a,emote:"",emoji:d[0].url,extra:r}:Be(r.username,e,r.userColor||"#ffffff",a,l.parachutes[S(l.parachutes.length)],l.petparachutes[S(l.petparachutes.length)],"",d[0].url,r);else if(l.pridechutes){const d=Object.keys(l.pridechutes),o=r.messageEmotes?Object.keys(r.messageEmotes):[],u=o.map(e=>{const d=r.messageEmotes[e][0].split("-").map(e=>parseInt(e));return`!${t} ${a}`.substring(d[0],d[1]+1)}),s=u.filter(e=>e.toLowerCase().includes("pride"));let n=d.find(e=>s.some(t=>t.toLowerCase().includes(e)));if(n){const t=l.pridechutes[n];let d=o.find((e,t)=>!u[t].toLowerCase().includes(n));V?X[r.username]={username:r.username,name:e,color:r.userColor||"#ffffff",message:a,selectedPara:t,selectedPetPara:t,emote:d,emoji:"",extra:r}:Be(r.username,e,r.userColor||"#ffffff",a,t,t,d,"",r)}else V?X[r.username]={username:r.username,name:e,color:r.userColor||"#ffffff",message:a,emote:r.messageEmotes?Object.keys(r.messageEmotes)[0]:"",emoji:"",extra:r}:Be(r.username,e,r.userColor||"#ffffff",a,l.parachutes[S(l.parachutes.length)],l.petparachutes[S(l.petparachutes.length)],r.messageEmotes?Object.keys(r.messageEmotes)[0]:"","",r)}else V?X[r.username]={username:r.username,name:e,color:r.userColor||"#ffffff",message:a,emote:r.messageEmotes?Object.keys(r.messageEmotes)[0]:"",emoji:"",extra:r}:Be(r.username,e,r.userColor||"#ffffff",a,l.parachutes[S(l.parachutes.length)],l.petparachutes[S(l.petparachutes.length)],r.messageEmotes?Object.keys(r.messageEmotes)[0]:"","",r)}}else o&&f.oauth&&ComfyJS.Say("The Parachute Drop game needs your attention. Please contact the PixelPlush team on Discord.")}function K(e,t,a,d,r){document.hidden||H>0&&(be[e]||Q(e,f.command,t,a,r))}function ee(e,t,a,d,r){if(!document.hidden&&k&&v){for(let e=0;e<5;e++)Fe(t);if(t.startsWith("!")){let a=t.split(/ (.*)/);Q(e,a[0].slice(1).toLowerCase(),a[1]||"",d,r)}}}function te(e,t,a){document.hidden||k&&v&&f.raidMode&&(H=parseInt(f.raidMode),console.log("Raid mode activated"),ComfyJS.Say(`/me Drop raid activated for ${H/1e3} seconds`))}function ae(){Object.keys(be).forEach(e=>{Unicorn.RemoveBacklay("para_"+e),Unicorn.RemoveBacklay("petpara_"+e),be[e].player.cleanup(),be[e].pet&&be[e].pet.cleanup(),Unicorn.RemoveText("name_"+e),Unicorn.RemoveBacklay("end_"+e),Unicorn.RemoveBacklay("petend_"+e),Unicorn.RemoveText(e+"_points"),delete be[e]}),de.x=-1e3,de.y=-1e3,xe="",_e=0,re&&clearTimeout(re),Je()}let de,re=null,oe=368,ue=0,se=0,ne=null,ie=null,ce=null,le=null,fe=[],pe=0,he=0,ye=0,me={},ge=null,be={},_e=0,xe="",ve={},we={},ke=[],$e=[],Se=[],Ae=[],Ue=[],Oe=[],je="zombie",Te=[],Ie=[],Pe={},Ce=0;function Me(e,t,a,d,r,o=""){Ce++;let u=Math.min(Math.max(1,r),100);Unicorn.AddParticles("Splash_"+Ce,{blendMode:PIXI.BLEND_MODES.DEFAULT,shape:"cone",angle:-Math.PI/2,spread:Math.PI/2,startColor:e,endColor:t,intensity:u,minSpeed:.05,maxSpeed:.25,gravityX:0,gravityY:3.5,fadeOut:!0,decay:1,image:o||void 0},a,d),function(e,t=2e3){setTimeout(()=>{Unicorn.RemoveParticles(e)},t)}("Splash_"+Ce,150)}function Ee(e,t,a,d=""){const r=l.target_boosh_scale||2;l.target_boosh.forEach((a,d)=>{for(let a=0;a<S(5);a++){Ce++;let a=Unicorn.AddBacklay("boosh_"+Ce,"target_boosh"+d,e,t+10,{scale:{x:r,y:r}});a.label="boosh_"+Ce,a.zIndex=11,a.vX=S(50)-25,a.vY=-350+S(100),a.anchor.set(.5),$e.push(a)}})}function ze(e,t,a,d=""){const r=l.target_splash_scale||2;l.target_splash.forEach((a,d)=>{for(let a=0;a<S(2);a++){Ce++;let a=Unicorn.AddBacklay("splash_"+Ce,"target_splash"+d,e,t+10,{scale:{x:r,y:r}});a.label="splash_"+Ce,a.zIndex=11,a.vX=S(100)-50,a.vY=-300+S(100),a.anchor.set(.5),Se.push(a)}})}function De(e,t){const a=[];for(let d=0;d<13;d++){Ce++;const r=Unicorn.AddOverlay("splishsplash_"+Ce,"target_splishsplash"+d,e,t,{scale:{x:2,y:2}});r.visible=!1,r.label="splishsplash_"+Ce,r.zIndex=11,r.anchor.set(.5),a.push(r)}a[0].visible=!0,Ue.push({splishes:a,timer:0,frame:0})}function Le(e,t,a=""){for(let a=0;a<2;a++){const d=S(l.target_floaty.length);Ce++;const r=S(10),o=S(10),u=a*Math.PI;let s=Unicorn.AddBacklay("floaty_"+Ce,"target_floaty"+d,e-5+r,t+o,{scale:{x:3,y:3}});s.timeOffset=u,s.label="floaty_"+Ce,s.zIndex=11,s.refX=e,s.refY=t,s.lifetime=3,s.anchor.set(.5),Oe.push(s)}}function Re(e,t){const a=S(100)-50;Ce++;let d=Unicorn.AddOverlay("sticky_"+Ce,"target_sticky"+(a<0?0:1),e,t+10,{scale:{x:3,y:3}});d.label="sticky_"+Ce,d.zIndex=200,d.vX=a,d.vY=-200+S(100),d.anchor.set(.5),Ae.push(d)}function Ne(e,t,a={}){Me("#ffffff","#ffffff",e,t+40,5);let d=s(e,t,200,{pet:a},16/60);d.isSensor=!0,d.isStatic=!0,d.walkDirection=S(2)>0?"left":"right",d.walkSpeed=120,Unicorn.PlayObjectAnimation(d.charName,d.walkDirection),Ie.push(d)}async function Be(e,t,d="#ffffff",i,c,l,p="",y="",g){let b=4/60;if(!be[e]){be[e]={};let _=null,x=null,v=null,w=tinycolor(d),k=await async function(e){let t={};try{if(!e)return t;let a=await fetch(`${n}/accounts/twitch/design?username=${e}`).then(e=>e.json());return a&&(t=a.style||{}),t}catch(e){console.log(e)}}(e);if(p){if(!ve[p]){if(ve[p]=!0,p.startsWith("emotesv2_")){let a=`https://static-cdn.jtvnw.net/emoticons/v2/${p}/default/dark/2.0`,r=await fetchGif(a);if(r.length>0){const a=function(e,t){const a=Math.min(...e.map(e=>e.delay)),d=Math.max(...e.map(e=>e.dims.width)),r=Math.max(...e.map(e=>e.dims.height));let o=0,u=null;for(let s=0;s<e.length;s++){const n=O(e[s].disposalType,d,r,e[s],u);u=n.data;for(let u=0;u<e[s].delay;u+=a)Unicorn.LoadCustom(`${t}${o}`,n.canvas,"texture",{width:d,height:r}),o++}return{frames:o,minDelay:a,width:d,height:r}}(r,"emote_"+p);ve[p]={frames:a.frames,framerate:1/60*(1e3/a.minDelay)},setTimeout(()=>{delete be[e],Be(e,t,d,i,c,l,p,y,g)},500)}else Unicorn.Load(`emote_${p}0`,a),setTimeout(()=>{delete be[e],Be(e,t,d,i,c,l,p,y,g)},500)}else{let a=`https://static-cdn.jtvnw.net/emoticons/v1/${p}/2.0`;Unicorn.Load(`emote_${p}0`,a),setTimeout(()=>{delete be[e],Be(e,t,d,i,c,l,p,y,g)},500)}return}let o=[];if(p.startsWith("emotesv2_")&&"boolean"!=typeof ve[p]){b=ve[p].framerate;for(let e=0;e<ve[p].frames;e++)o.push(`emote_${p}${e}`)}else o=[`emote_${p}0`];_=a({x:S(h),y:-100-S(50),z:100,radius:36,scale:1.2,name:"player_"+e,framerate:ve[p].framerate,animations:{front:{numFrames:o.length,prefix:"emote_"+p}}}),_.charName="player_"+e,_.endImage=o[0],_.endScale=1.2,_.cleanup=()=>{r(_)}}else if(y){if(!we[y])return we[y]=!0,Unicorn.Load(`emoji_${y}0`,y),void setTimeout(()=>{delete be[e],Be(e,t,d,i,c,l,p,y,g)},500);_=a({x:S(h),y:-100-S(50),z:100,radius:36,scale:1,name:"player_"+e,animations:{front:{numFrames:1,prefix:"emoji_"+y}}}),_.charName="player_"+e,_.endImage=`emoji_${y}0`,_.endScale=1,_.cleanup=()=>{r(_)}}else"string"!=typeof i?_=u(S(h),-100-S(50),100,i):k.skintones||k.character?(k.skintones&&delete k.character,_=u(S(h),-100-S(50),100,k)):_=o(S(h),-100-S(50),100,k,i);v=s(-1e3,-1e3,200,k),v&&(x=v.petName);let $=Unicorn.AddBacklay("para_"+e,c,{scale:{x:0,y:0},x:-50,y:0,z:50});$.visible=!1,$.zIndex=11,$.scale.x=0,$.scale.y=0,$.anchor.set(.5,1);let A=Unicorn.AddText("name_"+e,t,-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:34,fontWeight:400,fill:d,lineJoin:"round",stroke:tinycolor.isReadable(w.toString(),"#000000")?"#000000":"#ffffff",strokeThickness:6});A.anchor.set(.5);let U=Unicorn.AddText(e+"_points","",-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:34,fontWeight:400,fill:"#ffd700",lineJoin:"round",stroke:"#000000",strokeThickness:6});U.anchor.set(.5);let j=null;x&&(j=Unicorn.AddBacklay("petpara_"+e,l||c,{scale:{x:0,y:0},x:-50,y:0,z:150}),j.visible=!1,j.zIndex=11,j.scale.x=0,j.scale.y=0,j.anchor.set(.5,1)),_.restitution=1,_.friction=0,_.frictionStatic=0,_.frictionAir=0,_.torque=-5+S(10),_.rotationOffset=Math.random()*Math.PI,Unicorn.SetVelocity(_.charName,S(24)-12,0),be[e]={style:k,parachute:$,player:_,pet:v,petPara:j,petType:x,petOffset:30*Math.random()+(Math.random()>.5?-150:70),label:A,scoreLabel:U,nameColor:w},g&&(be[e].userId=g.userId,be[e].name=g.displayName||g.username),c&&c.includes("chute_plane")&&(be[e].paraFlipDir=!0),l&&l.includes("chute_plane")&&(be[e].petParaFlipDir=!0),Unicorn.PlaySound("sfx-parachute-drop",{volume:m}),re&&clearTimeout(re),re=setTimeout(()=>{if(f.variations){const e=f.variations.split(","),t=S(e.length),a=`${window.location.protocol}//${window.location.host}${window.location.pathname.substr(0,window.location.pathname.lastIndexOf("/"))}/${e[t]}${window.location.search}`;window.location.href=a}else ae()},parseInt(f.cooldown||"90000"))}}async function Fe(e){if(!f.droplets)return;Ce++;let t=null,a=0;a=S(l.droplets?l.droplets.length:6);let d=3;l.dropletSizes&&(d*=l.dropletSizes[a]);let r=l.droplets[a];Array.isArray(l.droplets[a])&&(r=l.droplets[a][S(l.droplets[a].length)]),t=Unicorn.AddObject("droplet_"+Ce,{type:"circle",sprite:r,scale:{x:1.5,y:1.5},x:S(h),y:-100-S(50),z:100,radius:.75*assetReference[r].width}),t.restitution=1,t.friction=.5*(5-a),t.frictionStatic=0,t.frictionAir=0,t.torque=-1+S(2),t.rotationOffset=Math.random()*Math.PI,t.mass*=20,Pe[t.label]=t,Unicorn.SetVelocity("droplet_"+Ce,S(24)-12,0),setTimeout(()=>{delete Pe[t.label],Unicorn.RemoveObject(t.label)},3e4)}function Je(){if(Y=!0,X={},V=!1,oe=l.target_width||368,ue=oe/2+S(h-oe),se=y-47+(l.target_offset||0),l.target_walls&&(ue<oe/2+70?ue=oe/2+70:ue>h-oe/2-70&&(ue=h-oe/2-70)),l.target_versions){const e=S(Object.keys(l.target_versions).length);Object.keys(l.target_versions).forEach((t,a)=>{e===a&&(ge=t);let d=l.target_versions[t];if(me[t]={},Array.isArray(d.target))if(l.target_random){ne&&Unicorn.RemoveBacklay("target"+t);let e=S(d.target.length);ne=Unicorn.AddBacklay("target"+t,"target"+t+e,ue,se,{scale:{x:2,y:2}}),ne.zIndex=10,ne.anchor.set(.5),ne.visible=!1,me[t].target=ne}else{if(ne)for(let e=0;e<ne.length;e++)ne[e]&&Unicorn.RemoveBacklay("target"+t+e);pe=0,ne=[];for(let e=0;e<d.target.length;e++){let a=Unicorn.AddBacklay("target"+t+e,"target"+t+e,ue,se,{scale:{x:2,y:2}});a.zIndex=10,a.anchor.set(.5),a.visible=!1,ne.push(a)}me[t].target=ne,ne[pe].visible=!1,f.hideTilDrop||l.target_animate_on_landed||q()}else ne&&Unicorn.RemoveBacklay("target"+t),ne=Unicorn.AddBacklay("target"+t,"target"+t,ue,se,{scale:{x:2,y:2}}),ne.zIndex=10,ne.anchor.set(.5),ne.visible=!1,me[t].target=ne;if(d.target_overlay)if(Array.isArray(d.target_overlay)){if(ie)for(let e=0;e<ie.length;e++)ie[e]&&Unicorn.RemoveBacklay("target_overlay"+t+e);he=0,ie=[];for(let e=0;e<d.target_overlay.length;e++){let a=Unicorn.AddBacklay("target_overlay"+t+e,"target_overlay"+t+e,ue,se+(l.target_overlay_offset||0),{scale:{x:2,y:2}});a.zIndex=11,a.anchor.set(.5),a.visible=!1,ie.push(a)}me[t].target_overlay=ie,ie[he].visible=!1,f.hideTilDrop||l.target_animate_on_landed||q()}else ie&&Unicorn.RemoveBacklay("target_overlay"+t),ie=Unicorn.AddBacklay("target_overlay"+t,"target_overlay"+t,ue,se,{scale:{x:2,y:2}}),ie.zIndex=11,ie.anchor.set(.5),ie.visible=!1,me[t].target_overlay=ie})}else{if(Array.isArray(l.target))if(l.target_random){ne&&Unicorn.RemoveBacklay("target");let e=S(l.target.length);ne=Unicorn.AddBacklay("target","target"+e,ue,se,{scale:{x:2,y:2}}),ne.zIndex=10,ne.anchor.set(.5)}else{if(ne)for(let e=0;e<ne.length;e++)ne[e]&&Unicorn.RemoveBacklay("target"+e);pe=0,ne=[];for(let e=0;e<l.target.length;e++){let t=Unicorn.AddBacklay("target"+e,"target"+e,ue,se,{scale:{x:2,y:2}});t.zIndex=10,t.anchor.set(.5),t.visible=!1,ne.push(t)}ne[pe].visible=!0,f.hideTilDrop||l.target_animate_on_landed||q()}else ne&&Unicorn.RemoveBacklay("target"),ne=Unicorn.AddBacklay("target","target",ue,se,{scale:{x:2,y:2}}),ne.zIndex=10,ne.anchor.set(.5);if(l.target_overlay)if(Array.isArray(l.target_overlay)){if(ie)for(let e=0;e<ie.length;e++)ie[e]&&Unicorn.RemoveBacklay("target_overlay"+e);he=0,ie=[];for(let e=0;e<l.target_overlay.length;e++){let t=Unicorn.AddBacklay("target_overlay"+e,"target_overlay"+e,ue,se+(l.target_overlay_offset||0),{scale:{x:2,y:2}});t.zIndex=11,t.anchor.set(.5),t.visible=!1,ie.push(t)}ie[he].visible=!0,f.hideTilDrop||l.target_animate_on_landed||q()}else ie&&Unicorn.RemoveBacklay("target_overlay"),ie=Unicorn.AddBacklay("target_overlay","target_overlay",ue,se,{scale:{x:2,y:2}}),ie.zIndex=11,ie.anchor.set(.5)}if(l.target_frontlay)if(Array.isArray(l.target_frontlay)){if(ce)for(let e=0;e<ce.length;e++)ce[e]&&Unicorn.RemoveOverlay("target_frontlay"+e);ye=0,ce=[];for(let e=0;e<l.target_frontlay.length;e++){let t=Unicorn.AddOverlay("target_frontlay"+e,"target_frontlay"+e,ue,se+(l.target_overlay_offset||0),{scale:{x:2,y:2}});t.zIndex=12,t.anchor.set(.5),t.visible=!1,ce.push(t)}ce[ye].visible=!0,f.hideTilDrop||l.target_animate_on_landed||q()}else ce&&Unicorn.RemoveOverlay("target_frontlay"),ce=Unicorn.AddOverlay("target_frontlay","target_frontlay",ue,se,{scale:{x:2,y:2}}),ce.zIndex=2,ce.anchor.set(.5);if(l.target_front&&(le&&Unicorn.RemoveOverlay("target_front"),le=Unicorn.AddOverlay("target_front","target_front",ue,se,{scale:{x:2,y:2}}),le.zIndex=100,le.anchor.set(.5)),f.clouds&&0===ke.length)for(let e=0;e<11;e++){W++;let e=l.clouds[S(l.clouds.length)],t=Unicorn.AddOverlay("cloud_"+W,e,S(h),S(500),{scale:{x:3,y:3}});t.alpha=f.overlay?.5:.9,t.anchor.set(.5),t.speed=.01+.1*Math.random(),t.zIndex=t.speed,ke.push(t)}if(l.target_walls){fe.length>0&&(Unicorn.RemoveObject("TargetTop"),Unicorn.RemoveObject("TargetLeft"),Unicorn.RemoveObject("TargetRight"),fe=[]);let e=Unicorn.AddObject("TargetTop",{type:"rectangle",x:ue,y:se+l.target_walls/2+l.target_collide_land,width:oe-50,height:10,isStatic:!0});e.sprite.visible=!1;let t=Unicorn.AddObject("TargetLeft",{type:"rectangle",x:ue-oe/2+27,y:se+l.target_walls,width:10,height:100,isStatic:!0});t.sprite.visible=!1;let a=Unicorn.AddObject("TargetRight",{type:"rectangle",x:ue+oe/2-27,y:se+l.target_walls,width:10,height:100,isStatic:!0});a.sprite.visible=!1,fe.push(e),fe.push(t),fe.push(a)}f.hideTilDrop&&(ke.forEach(e=>e.visible=!1),fe.forEach(e=>e.isSensor=!0),l.target_animate_on_landed||(G(),ie&&Array.isArray(ie)&&(ie[he].visible=!1),ce&&Array.isArray(ce)&&(ce[ye].visible=!1)),Array.isArray(l.target)&&!l.target_random?ne.forEach(e=>{e.visible=!1}):ne.visible=!1,ie&&(Array.isArray(l.target_overlay)&&!l.target_random?ie.forEach(e=>{e.visible=!1}):ie.visible=!1),ce&&(Array.isArray(l.target_frontlay)&&!l.target_random?ce.forEach(e=>{e.visible=!1}):ce.visible=!1),le&&(le.visible=!1));for(let e=0;e<$e.length;e++){let t=$e[e];Unicorn.RemoveBacklay(t.label)}$e=[];for(let e=0;e<Se.length;e++){let t=Se[e];Unicorn.RemoveBacklay(t.label)}Se=[];for(let e=0;e<Ae.length;e++){let t=Ae[e];Unicorn.RemoveOverlay(t.label)}Ae=[];for(let e=0;e<Ie.length;e++){let t=Ie[e];Unicorn.RemoveObject(t.charName)}if(Ie=[],f.spawnZombies){const e=f.spawnZombies.split(",").map(e=>e.trim());je=e[S(e.length)];const t=1;for(let e=0;e<t;e++){let e=S(h);Math.abs(ue-e)<oe/2+10&&(e=ue+(e<ue?-oe/2-10:oe/2+10));let t=o(e,y-40,110,{character:{id:je,path:je}});t.isSensor=!0,t.isStatic=!0,f.hideTilDrop&&(t.isHidden=!0,t.position.y=y+100),t.timeTilNextWalk=3e3+S(27e3),t.walkDirection=S(2)>0?"left":"right",Unicorn.PlayObjectAnimation(t.charName,t.walkDirection),Te.push(t)}}setTimeout(()=>{document.querySelector("#unicorn-display > canvas").removeAttribute("hidden")},2e3)}function qe(){if(document.querySelector("#unicorn-display > canvas").setAttribute("hidden","hidden"),PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,Unicorn.Load("bg",`${p}/assets/${l.bg}.png`),!f.overlay){let e=Unicorn.AddBacklay("bg","bg",0,y-1080);e.scale.x=3,e.scale.y=3}if(l.target_versions)Object.keys(l.target_versions).forEach(e=>{let t=l.target_versions[e];if(Array.isArray(t.target)){t.target.map((t,a)=>Unicorn.Load("target"+e+a,`${p}/assets/${t}.png`))}else{Unicorn.Load("target"+e,`${p}/assets/${t.target}.png`)}if(Array.isArray(t.target_overlay)){t.target_overlay.map((t,a)=>Unicorn.Load("target_overlay"+e+a,`${p}/assets/${t}.png`))}else{Unicorn.Load("target_overlay"+e,`${p}/assets/${t.target_overlay}.png`)}if(t.target_effect){t.target_effect.map((t,a)=>Unicorn.Load("target_effect"+e+a,`${p}/assets/${t}.png`))}});else{if(Array.isArray(l.target)){l.target.map((e,t)=>Unicorn.Load("target"+t,`${p}/assets/${e}.png`))}else{Unicorn.Load("target",`${p}/assets/${l.target}.png`)}if(Array.isArray(l.target_overlay)){l.target_overlay.map((e,t)=>Unicorn.Load("target_overlay"+t,`${p}/assets/${e}.png`))}else if(l.target_overlay){Unicorn.Load("target_overlay",`${p}/assets/${l.target_overlay}.png`)}if(Array.isArray(l.target_frontlay)){l.target_frontlay.map((e,t)=>Unicorn.Load("target_frontlay"+t,`${p}/assets/${e}.png`))}else if(l.target_frontlay){Unicorn.Load("target_frontlay",`${p}/assets/${l.target_frontlay}.png`)}if(l.target_effect){l.target_effect.map((e,t)=>Unicorn.Load("target_effect"+t,`${p}/assets/${e}.png`))}}l.target_front&&Unicorn.Load("target_front",`${p}/assets/${l.target_front}.png`),l.target_boosh&&l.target_boosh.forEach((e,t)=>{Unicorn.Load("target_boosh"+t,`${p}/assets/${e}.png`)}),l.target_splash&&l.target_splash.forEach((e,t)=>{Unicorn.Load("target_splash"+t,`${p}/assets/${e}.png`)}),l.target_floaty&&l.target_floaty.forEach((e,t)=>{Unicorn.Load("target_floaty"+t,`${p}/assets/${e}.png`)}),l.target_stickies&&l.target_stickies.forEach((e,t)=>{Unicorn.Load("target_sticky"+t,`${p}/assets/${e}.png`)}),l.target_splishsplash&&l.target_splishsplash.forEach((e,t)=>{Unicorn.Load("target_splishsplash"+t,`${p}/assets/${e}.png`)}),Unicorn.Load("star",p+"/assets/icons/star.png"),de=Unicorn.AddOverlay("star","star",-1e3,-1e3,{scale:{x:3,y:3}}),de.anchor.set(.5),l.parachutes.forEach(e=>Unicorn.Load(e,`${p}/assets/${e}.png`)),l.petparachutes?l.petparachutes.forEach(e=>Unicorn.Load(e,`${p}/assets/${e}.png`)):l.petparachutes=[],l.pridechutes&&Object.keys(l.pridechutes).forEach(e=>Unicorn.Load(l.pridechutes[e],`${p}/assets/${l.pridechutes[e]}.png`)),Object.keys(l.characters).forEach(e=>{T(e,"characters",l.characters[e],b.NumFrames)}),l.clouds.forEach(e=>Unicorn.Load(e,`${p}/assets/${e}.png`)),l.droplets.forEach(e=>{Array.isArray(e)?e.forEach(e=>Unicorn.Load(e,`${p}/assets/${e}.png`)):Unicorn.Load(e,`${p}/assets/${e}.png`)}),l.target_sound&&Unicorn.Load("sfx-target-drop",`${p}/assets/${l.target_sound}`),f.notifVolume&&Unicorn.Load("sfx-group-queue",`${p}/assets/${l.queue_sound}`),Unicorn.Load("sfx-parachute-drop",`${p}/assets/${l.drop_sound}`),Unicorn.Load("sfx-parachute-flap",`${p}/assets/${l.parachute_sound}`),Unicorn.AddObject("WallLeft",{type:"rectangle",x:-200,y:0,width:400,height:2*y,friction:0,frictionAir:0,frictionStatic:0,bounce:1.1,isStatic:!0}).sprite.visible=!1,Unicorn.AddObject("WallRight",{type:"rectangle",x:h+200,y:0,width:400,height:2*y,friction:0,frictionAir:0,frictionStatic:0,bounce:1.1,isStatic:!0}).sprite.visible=!1,Unicorn.AddObject("WallBottom",{type:"rectangle",x:.5*h,y:y+100,friction:0,frictionAir:0,frictionStatic:0,bounce:1,width:h,height:200,isStatic:!0}).sprite.visible=!1,Matter.Events.on(physics,"beforeUpdate",(function(e){const t=Object.keys(be);for(let e=0;e<t.length;e++){const a=t[e],d=be[a];d.player&&(Math.abs(d.player.velocity.x)>50&&Matter.Body.setVelocity(d.player,{x:50*(d.player.velocity.x<0?-1:1),y:d.player.velocity.y}),d.player.velocity.y<-50&&Matter.Body.setVelocity(d.player,{x:d.player.velocity.x,y:-50}),d.player.position.y<.5*-y?d.player.velocity.y>10&&Matter.Body.setVelocity(d.player,{x:d.player.velocity.x,y:10}):d.player.position.y>300&&d.player.velocity.y>.5&&Matter.Body.setVelocity(d.player,{x:d.player.velocity.x,y:.5}))}const a=Object.keys(Pe);for(let e=0;e<a.length;e++){const t=a[e],d=Pe[t];Math.abs(d.velocity.x)>50&&Matter.Body.setVelocity(d,{x:50*(d.velocity.x<0?-1:1),y:d.velocity.y})}})),Matter.Events.on(physics,"afterUpdate",(function(e){const t=Object.keys(be);for(let e=0;e<t.length;e++){const a=t[e],d=be[a];if(d.pet){let e=Math.min(3,Math.max(0,.3*(d.player.position.y-300)));d.petPara.scale.x=d.petPara.scale.y=e/2,d.petParaFlipDir&&d.player.velocity.x>0&&(d.petPara.scale.x=-e/2),d.pet.angle=d.player.angle,d.pet.position.x=Math.max(20,Math.min(h-20,d.player.position.x+d.petOffset)),d.pet.position.y=Math.min(d.player.position.y+20,y-46-50+(l.target_y_offset||0)),d.petPara.rotation=d.player.angle,d.petPara.position.x=d.pet.position.x,d.petPara.position.y=d.pet.position.y}}}))}function Ge(e,t){const a=Object.keys(be);for(let t=0;t<a.length;t++){const d=a[t],r=be[d];if(r.player)if(r.isLanded){let e=d===xe?1:.3;if(!(f.spawnZombies&&r.score<=0)){if(r.end.alpha=e,r.player.animations[r.player.currentAnimation].alpha=e,r.player.sprites){const t=Object.keys(r.player.sprites);for(const a of t){const t=r.player.sprites[a];t.animations[t.currentAnimation].alpha=e}}r.label.alpha=Math.round(e),r.scoreLabel.tint=r.label.tint=d===xe?16777215:3355443}if(r.pet&&(r.petEnd.alpha=e),d===xe){if(r.end.zIndex=r.scoreLabel.zIndex=r.label.zIndex=9e3,r.player.animations[r.player.currentAnimation].zIndex+=9e3,r.player.sprites){const e=Object.keys(r.player.sprites);for(const t of e){const e=r.player.sprites[t];e.animations[e.currentAnimation].zIndex+=9e3}}r.pet&&(r.pet.zIndex=9001),r.label.position.x=r.player.position.x,r.label.position.y=r.player.position.y-80,r.scoreLabel.position.x=r.label.position.x+15,r.scoreLabel.position.y=r.label.position.y-30,r.label.style.fontSize=40,r.scoreLabel.style.fontSize=40,de.x=r.scoreLabel.x-r.scoreLabel.width/2-15,de.y=r.scoreLabel.y-5}else r.label.position.x=r.player.position.x,r.label.position.y=r.player.position.y-60,r.scoreLabel.position.y=r.label.position.y-30,r.scoreLabel.alpha=0,r.label.style.fontSize=34,r.scoreLabel.style.fontSize=34;if(f.spawnZombies&&!r.zombiefied)for(let e=0;e<Te.length;e++){const t=Te[e];if(r.end&&r.end.alpha>0&&Math.abs(r.end.x-t.position.x)<40){r.zombiefied=!0;const e={character:{id:je,path:je}};r.end.alpha=0;let t=o(r.end.x,y-40,110,e);t.isSensor=!0,t.isStatic=!0,t.timeTilNextWalk=3e3+S(27e3),t.walkDirection=S(2)>0?"left":"right",t.label=r.label,Unicorn.PlayObjectAnimation(t.charName,t.walkDirection);let a=PIXI.utils.string2hex(r.nameColor.brighten(50).toHexString());Object.keys(t.animations).forEach(e=>{t.animations[e].tint=a}),Te.push(t),l.target_particles&&Me(l.target_particles[0],l.target_particles[1],r.end.x,y-40,10),l.target_boosh&&Ee(r.end.x,y-40),l.target_splash&&ze(r.end.x,y-40),l.target_floaty&&Le(r.end.x,y-40)}}}else{if(r.pet&&(r.pet.position.x=Math.max(20,Math.min(h-20,r.player.position.x+r.petOffset)),r.pet.position.y=Math.min(r.player.position.y+20,y-46-50+(l.target_y_offset||0)),r.petPara.position.x=r.pet.position.x,r.petPara.position.y=r.pet.position.y),r.player.position.y>y-46-50+(l.target_y_offset||0)||l.target_walls&&r.player.position.y>y-46-50+(l.target_collide_land||0)&&oe/2-20>Math.abs(ue-r.player.position.x)){r.isLanded=!0,r.parachute.scale.x=r.parachute.scale.y=0,r.pet&&(r.petPara.scale.x=r.petPara.scale.y=0);let e=Unicorn.AddBacklay("end_"+d,r.player.endImage,r.player.position.x,r.player.position.y,{scale:{x:r.player.endScale,y:r.player.endScale}});if(r.player.animations&&(e.tint=r.player.animations.front.tint),e.anchor.set(.5),e.zIndex=20,e.visible=!1,r.player.isStatic=!0,r.player.isSensor=!0,r.player.isSleeping=!0,r.player.angle=0,Unicorn.StopObjectAnimation(r.player.charName),r.player.animations[r.player.currentAnimation].zIndex++,r.player.collisionFilter={group:-1,mask:0,category:2},l.target_walls?r.score=100*Math.max(0,oe/2-35-Math.abs(ue-r.player.position.x))/(oe/2-35):r.score=100*Math.max(0,oe/2-Math.abs(ue-r.player.position.x))/(oe/2),!f.spawnZombies||r.score>0){const e=r.score>0?1:.3;if(r.player.animations[r.player.currentAnimation].alpha=e,r.player.sprites){const t=Object.keys(r.player.sprites);for(const a of t){const t=r.player.sprites[a];t.animations[t.currentAnimation].alpha=e}}}if(r.end=e,r.pet){let e=Unicorn.AddBacklay("petend_"+d,`pet_${r.petType}_front0`,r.pet.position.x,r.pet.position.y,{scale:{x:3,y:3}});r.pet.animations&&(e.tint=r.pet.animations.front.tint),e.anchor.set(.5),e.zIndex=30,r.pet.isStatic=!0,e.alpha=r.score>0?1:.3,r.petEnd=e}if(r.score>0){if(l.target_versions&&q(),l.target_stickies&&Re(r.player.position.x,y-80),l.target_splishsplash&&De(r.player.position.x,y-81),l.target_effect){W++;const e="te_"+W;let t=Unicorn.AddObject(e,{type:"circle",scale:{x:2,y:2},animations:{front:{framerate:4/60,frames:Array.from({length:l.target_effect.length},(e,t)=>"target_effect"+t),loop:!1,onComplete:()=>{Unicorn.RemoveObject(e)}}},isSensor:!0,isStatic:!0,x:r.player.position.x,y:r.player.position.y,z:200,radius:.1});t.isSensor=!0,t.animations.front.anchor.y=1}if(ge&&l.target_versions[ge].target_effect){W++;const e="te_"+W;let t=Unicorn.AddObject(e,{type:"circle",scale:{x:2,y:2},animations:{front:{framerate:4/60,frames:Array.from({length:l.target_versions[ge].target_effect.length},(e,t)=>`target_effect${ge}${t}`),loop:!1,onComplete:()=>{Unicorn.RemoveObject(e)}}},isSensor:!0,isStatic:!0,x:r.player.position.x,y:r.player.position.y,z:200,radius:.1});t.isSensor=!0,t.animations.front.anchor.y=1}if(l.target_animate_on_landed&&q(2),l.target_particles&&Me(l.target_particles[0],l.target_particles[1],r.player.position.x,r.player.position.y+40,10),l.target_boosh&&Ee(r.player.position.x,r.player.position.y+40),l.target_splash&&ze(r.player.position.x,r.player.position.y+40),l.target_floaty&&Le(r.player.position.x,r.player.position.y),l.target_sound&&Unicorn.PlaySound("sfx-target-drop",{volume:m}),r.scoreLabel.x=r.label.position.x,r.scoreLabel.y=r.label.position.y-30,r.scoreLabel.text=r.score.toFixed(2),r.pet&&l.hopper_trigger&&r.style&&r.style.pet)try{if(Object.keys(l.hopper_trigger).some(e=>r.style.pet[e]===l.hopper_trigger[e])){const e=l.special_hoppers[S(l.special_hoppers.length)];Ne(r.pet.position.x,r.pet.position.y,{id:"pet_"+e,path:e,minIdle:200,maxIdle:800}),r.petEnd.visible=!1}}catch(e){console.error(e)}if(!d.startsWith("test_")){if(f.messageFormat){let e=f.messageFormat.replace("USERNAME",r.name).replace("POINTS",r.score.toFixed(2)).replace("SHORTPTS",Math.floor(r.score));setTimeout(()=>{ComfyJS.Say(e)},5e3)}I(r.name,r.score.toFixed(2),r.userId,d)}}r.score>_e&&(_e=r.score,xe=d,e.zIndex=21),(!f.spawnZombies||r.score>0)&&(r.label.alpha=r.score>0?1:.3),Unicorn.RemoveBacklay("para_"+d),r.pet&&(Unicorn.RemoveObject(r.pet.label),Unicorn.RemoveBacklay("petpara_"+d))}else if(r.player.position.y>300){let t=Math.min(3,Math.max(0,.3*(r.player.position.y-300)));0===r.parachute.scale.x&&t>0&&Unicorn.PlaySound("sfx-parachute-flap",{volume:m}),r.parachute.visible=!0,r.pet&&(r.petPara.visible=!0),r.parachute.scale.x=r.parachute.scale.y=t,r.paraFlipDir&&r.player.velocity.x>0&&(r.parachute.scale.x=-t),r.parachute.rotation=Math.sin(r.player.rotationOffset+e/1e3)*Math.PI/16,r.player.angle=Math.sin(r.player.rotationOffset+e/1e3)*Math.PI/16,r.parachute.position.x=r.player.position.x,r.parachute.position.y=r.player.position.y-10-(l.parachute_offset||0)}else r.parachute.visible=!1,r.parachute.scale.x=r.parachute.scale.y=0,r.pet&&(r.petPara.visible=!1,r.petPara.scale.x=r.petPara.scale.y=0);r.label.position.x=r.player.position.x,r.label.position.y=r.player.position.y-60}}for(let e=0;e<ke.length;e++){let a=ke[e];a.x-=t*a.speed,a.x+a.width/2<=0&&(a.x=h+a.width/2,a.y=S(500),a.speed=.01+.1*Math.random(),a.zIndex=a.speed)}for(let e=0;e<$e.length;e++){let a=$e[e];(a.vY<0||a.y<y-5)&&(a.x+=t/1e3*a.vX,a.y+=t/1e3*a.vY,a.vY<20&&(a.vY+=t/1e3*200))}for(let e=0;e<Se.length;e++){let a=Se[e];(a.vY<0||a.y<y-5)&&(a.x+=t/1e3*a.vX,a.y+=t/1e3*a.vY,a.vY+=t/1e3*200)}for(let e=0;e<Ae.length;e++){let a=Ae[e];const d=a.y>y-46-30+(l.target_y_offset||0),r=l.target_walls&&a.y>y-46-30+(l.target_collide_land||0)&&oe/2-20>Math.abs(ue-a.x),o=d||r;(a.vY<0||!o)&&(a.x+=t/1e3*a.vX,a.y+=t/1e3*a.vY,a.vY+=t/1e3*200),r&&(a.x+=t/1e3*(a.vX<0?-4:4))}for(let e=0;e<Ue.length;e++){const a=Ue[e];if(a.timer+=t,a.splishes[a.frame].visible=!1,a.frame=Math.floor(a.timer/100),a.frame>=13){Ue.splice(e,1);for(let e=0;e<a.splishes.length;e++)Unicorn.RemoveOverlay(a.splishes[e].label)}else a.splishes[a.frame].visible=!0}for(let e=0;e<Ie.length;e++){let a=Ie[e];if(a.position.x<-50||a.position.y>h+50)Unicorn.RemoveObject(a.charName),Ie.splice(e,1),e--;else{const e=a.walkSpeed*("left"===a.walkDirection?-1:1);a.position.x+=e*t/1e3,Unicorn.SetPosition(a.charName,a.position.x,a.position.y)}}for(let e=0;e<Oe.length;e++){let a=Oe[e];a.lifetime>0&&(a.lifetime-=t/1e3,a.y-=80*t/1e3,a.x=a.refX+20*Math.sin(4*a.lifetime+a.timeOffset),a.lifetime<0&&(Unicorn.RemoveBacklay(a.label),Oe.splice(e,1),e--))}for(let e=0;e<Te.length;e++){const a=Te[e];if(a.isHidden)continue;let d=!1;a.position.x<=20&&"left"===a.walkDirection&&(d=!0),a.position.x>=h-20&&"right"===a.walkDirection&&(d=!0),Math.abs(ue-a.position.x)<oe/2+10&&(d=!0,a.position.x<ue?a.position.x=ue-oe/2-10:a.position.x=ue+oe/2+10),a.timeTilNextWalk-=t,a.timeTilNextWalk<=0&&(d=!0),d&&(a.timeTilNextWalk=3e3+S(27e3),a.walkDirection="right"===a.walkDirection?"left":"right",Unicorn.PlayObjectAnimation(a.charName,a.walkDirection)),a.position.x+=50*t/1e3*("left"===a.walkDirection?-1:1),a.label&&(a.label.x=a.position.x)}F&&(J-=t,J<=0&&(J=60,Array.isArray(ne)&&(ne[pe].visible=!1,pe=(pe+1)%ne.length,ne[pe].visible=!0),ie&&Array.isArray(ie)&&(ie[he].visible=!1,he=(he+1)%ie.length,ie[he].visible=!0),ce&&Array.isArray(ce)&&(ce[ye].visible=!1,ye=(ye+1)%ce.length,ce[ye].visible=!0))),B>0&&(B-=t,B<=0&&G()),H>0&&(H-=t,H<=0&&(H=0,console.log("Raid mode complete"),ComfyJS.Say("/me Drop raid has ended")))}