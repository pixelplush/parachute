let e=0;const t=["front","back","left","right"];let a={};function o({x:e,y:a,z:o,radius:r,scale:s=3,name:n,framerate:i=4/60,prefix:l}={}){let c={};return t.forEach(e=>{c[e]={framerate:i,frames:Array.from({length:10},(t,a)=>`${l}_${e}${a}`),loop:!0}}),Unicorn.AddObject(n,{type:"circle",scale:{x:s,y:s},friction:0,frictionAir:0,frictionStatic:0,bounce:1,animations:c,x:e,y:a,z:o,radius:r})}function r(r,s,n,i,c=null){l.playable;e++;const d="player_"+e;if(!l)throw"No GameTheme Defined";l.characters||(l.characters={});let h=!1;if(c&&l.playable.includes(c)||(i.character&&i.character.id?(c=i.character.id,h=!0):c=l.playable[b(l.playable.length)]),!a[c]){a[c]=!0,l.characters[c]=h?i.character.path:c;for(let e=0;e<10;e++)for(let a=0;a<t.length;a++){const o=`${l.characters[c]}_${t[a]}`;Unicorn.Load(`${c}_${t[a]}${e}`,`${p}/assets/characters/${c}/${o}/${o}${e+1}.png`)}}let f=o({x:r,y:s,z:n,radius:36,name:d,prefix:c});return f.character=c,f.charName=d,f.endImage=c+"_front0",f.endScale=3,f}const s="https://api.pixelplush.dev/v1";let n="PixelPlush Game",i="unknown",l={},c={},p="",d=1920,h=1080,f=.5;var m="",y=!0;let u="",g=!0,_={};function b(e){return Math.floor(Math.random()*Math.floor(e))}function x(e){for(let t=e.length-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}}async function v(e){let t=Object.keys(X).length;return fetch(s+"/analytics/heartbeat",{method:"POST",body:JSON.stringify({session:m,game:i,theme:n,channel:c.channel,players:Object.keys(X),count:t})}).then(e=>e.json())}async function w(e,t,a,o){return c.oauth?fetch(s+"/scores/add",{method:"POST",body:JSON.stringify({token:c.oauth.replace("oauth:",""),channel:c.channel,game:i,theme:n,user:e,score:t,userId:a,username:o})}).then(e=>e.json()):{}}window.setupGame=function(e,t,a){if(n=e,l=t,c=a,p=l.path||"",c.clouds=void 0===c.clouds||null===c.clouds?!c.overlay:"true"===c.clouds,f=void 0===c.volume||null===c.volume?0:parseInt(c.volume)/100,d=Math.min(window.innerWidth,1920),h=Math.min(window.innerHeight,1080),c.variations&&!c.didRandom){const e=c.variations.split(","),t=b(e.length),a=`${window.location.protocol}//${window.location.host}${window.location.pathname.substr(0,window.location.pathname.lastIndexOf("/"))}/${e[t]}${window.location.search}&didRandom=1`;window.location.href=a}c.readyTime&&(g=!1,setTimeout(()=>{g=!0,ComfyJS.Say("Parachute Drop is ready!")},parseInt(c.readyTime||1e3)))},window.WebFontConfig={custom:{families:["Pixeltype"]},active(){!async function(){if(document.hidden)return void document.addEventListener("visibilitychange",()=>{location.reload()},!1);try{const e=(await fetch("https://www.pixelplush.dev/assets/shamelist.txt").then(e=>e.text())).split(",").map(e=>e.trim().toLowerCase());if(c.channel&&e&&e.includes(c.channel.toLowerCase())&&(console.log("This channel has been blocked for violating the PixelPlush Terms of Service."),y=!1),l.requires)try{if(account=await fetch(s+"/accounts",{headers:{Twitch:c.oauth?c.oauth.replace("oauth:",""):void 0}}).then(e=>e.json()),console.log(account),account.error)throw"Login Error";if(!account.owned.includes(l.requires))throw"Item not owned"}catch(e){return void console.log("Auth Validate Failed",e)}!async function(){i="parachute",c.cpDrop&&(_["Parachute Drop!"]={desc:"Drop into the PixelPlush Parachute Game!",color:"#F2C079",cost:parseInt(c.cpDropCost||50),callback:(e,t,a,o,r)=>{g&&(y?(P&&c.hideTilDrop&&(P=!1,Q.forEach(e=>e.visible=!0),J.forEach(e=>e.isSensor=!1),Array.isArray(R)?(R[q].visible=!0,l.target_animate_on_landed||A()):R.visible=!0,B&&(Array.isArray(B)?(B[F].visible=!0,l.target_animate_on_landed||A()):B.visible=!0),N&&(N.visible=!0),c.spawnZombies&&ae.forEach(e=>{e.isHidden=!1,e.position.y=h-40})),I?j.push({username:r.username,name:e,color:r.userColor||"#ffffff",message:o,emote:r.messageEmotes?Object.keys(r.messageEmotes)[0]:"",emoji:"",extra:r}):ie(r.username,e,r.userColor||"#ffffff",o,l.parachutes[b(l.parachutes.length)],l.petparachutes[b(l.petparachutes.length)],r.messageEmotes?Object.keys(r.messageEmotes)[0]:"","",r)):c.oauth&&ComfyJS.Say("The Parachute Drop game needs your attention. Please contact the PixelPlush team on Discord."))}});c.cpDroplets&&(_["Parachute Droplets"]={desc:"Add bouncing obstacles into the PixelPlush Parachute Game!",color:"#F2C079",cost:parseInt(c.cpDropletsCost||500),cooldown:parseInt(c.cpDropletsCD||5),callback:()=>{if(g)if(y)for(let e=0;e<5;e++)le(100);else c.oauth&&ComfyJS.Say("The Parachute Drop game needs your attention. Please contact the PixelPlush team on Discord.")}});c.cpQueue&&(_["Group Parachute"]={desc:"Queue everyone for a group drop in the PixelPlush Parachute Game!",color:"#F2C079",cost:parseInt(c.cpQueueCost||500),cooldown:parseInt(c.cpQueueCD||120),callback:()=>{if(g)if(y)if(I)ComfyJS.Say("/me Group Drop is already queued.");else{c.queueSound&&Unicorn.PlaySound("sfx-group-queue",{volume:f}),I=!0,Object.keys(X).forEach(e=>{Unicorn.RemoveBacklay("para_"+e),Unicorn.RemoveBacklay("petpara_"+e),Unicorn.RemoveObject(X[e].player.charName),X[e].pet&&Unicorn.RemoveObject(X[e].pet.charName),Unicorn.RemoveText("name_"+e),Unicorn.RemoveBacklay("end_"+e),Unicorn.RemoveBacklay("petend_"+e),Unicorn.RemoveText(e+"_points"),delete X[e]}),C.x=-1e3,C.y=-1e3,H="",Y=0,D&&clearTimeout(D);const e=6e4;ComfyJS.Say(`/me Parachutes are queued for the next 60 seconds. !${c.command||"drop"} to join!`),setTimeout(()=>{ComfyJS.Say(`/me 30 seconds remaining. !${c.command||"drop"} to join!`)},e-3e4),setTimeout(()=>{ComfyJS.Say("/me 10 seconds. !"+(c.command||"drop"))},e-1e4),setTimeout(()=>{x(j),j.forEach(e=>{ie(e.username,e.name,e.color,e.message,e.selectedPara||l.parachutes[b(l.parachutes.length)],e.selectedPetPara||l.petparachutes[b(l.petparachutes.length)],e.emote,e.emoji,e.extra)}),j=[]},e)}else c.oauth&&ComfyJS.Say("The Parachute Drop game needs your attention. Please contact the PixelPlush team on Discord.")}})}()}catch(e){console.log(e)}Unicorn.Create("unicorn-display",{width:d,height:h,background:"transparent",init:ce,update:pe,channel:c.channel,username:c.oauth?c.channel:void 0,password:c.oauth?c.oauth.replace("oauth:",""):void 0,onCommand:O,onChat:T,screenWalls:!1,gravity:{x:0,y:1}}),ComfyJS.onCheer=E,ComfyJS.onConnected=async(e,t,a)=>{if(a){!function(){L=l.target_width||368,M=L/2+b(d-L),z=h-47+(l.target_offset||0),l.target_walls&&(M<L/2+70?M=L/2+70:M>d-L/2-70&&(M=d-L/2-70));if(l.target_versions){const e=b(Object.keys(l.target_versions).length);Object.keys(l.target_versions).forEach((t,a)=>{e===a&&(W=t);let o=l.target_versions[t];if(G[t]={},Array.isArray(o.target))if(l.target_random){let e=b(o.target.length);R=Unicorn.AddBacklay("target"+t+e,"target"+t+e,M,z,{scale:{x:2,y:2}}),R.zIndex=10,R.anchor.set(.5),R.visible=!1,G[t].target=R}else{q=0,R=[];for(let e=0;e<o.target.length;e++){let a=Unicorn.AddBacklay("target"+t+e,"target"+t+e,M,z,{scale:{x:2,y:2}});a.zIndex=10,a.anchor.set(.5),a.visible=!1,R.push(a)}G[t].target=R,R[q].visible=!1,c.hideTilDrop||l.target_animate_on_landed||A()}else R=Unicorn.AddBacklay("target"+t,"target"+t,M,z,{scale:{x:2,y:2}}),R.zIndex=10,R.anchor.set(.5),R.visible=!1,G[t].target=R;if(o.target_overlay)if(Array.isArray(o.target_overlay)){F=0,B=[];for(let e=0;e<o.target_overlay.length;e++){let a=Unicorn.AddBacklay("target_overlay"+t+e,"target_overlay"+t+e,M,z,{scale:{x:2,y:2}});a.zIndex=11,a.anchor.set(.5),a.visible=!1,B.push(a)}G[t].target_overlay=B,B[F].visible=!1,c.hideTilDrop||l.target_animate_on_landed||A()}else B=Unicorn.AddBacklay("target_overlay"+t,"target_overlay"+t,M,z,{scale:{x:2,y:2}}),B.zIndex=11,B.anchor.set(.5),B.visible=!1,G[t].target_overlay=B})}else{if(Array.isArray(l.target))if(l.target_random){let e=b(l.target.length);R=Unicorn.AddBacklay("target"+e,"target"+e,M,z,{scale:{x:2,y:2}}),R.zIndex=10,R.anchor.set(.5)}else{q=0,R=[];for(let e=0;e<l.target.length;e++){let t=Unicorn.AddBacklay("target"+e,"target"+e,M,z,{scale:{x:2,y:2}});t.zIndex=10,t.anchor.set(.5),t.visible=!1,R.push(t)}R[q].visible=!0,c.hideTilDrop||l.target_animate_on_landed||A()}else R=Unicorn.AddBacklay("target","target",M,z,{scale:{x:2,y:2}}),R.zIndex=10,R.anchor.set(.5);if(l.target_overlay)if(Array.isArray(l.target_overlay)){F=0,B=[];for(let e=0;e<l.target_overlay.length;e++){let t=Unicorn.AddBacklay("target_overlay"+e,"target_overlay"+e,M,z,{scale:{x:2,y:2}});t.zIndex=11,t.anchor.set(.5),t.visible=!1,B.push(t)}B[F].visible=!0,c.hideTilDrop||l.target_animate_on_landed||A()}else B=Unicorn.AddBacklay("target_overlay","target_overlay",M,z,{scale:{x:2,y:2}}),B.zIndex=11,B.anchor.set(.5)}l.target_front&&(N=Unicorn.AddOverlay("target_front","target_front",M,z,{scale:{x:2,y:2}}),N.anchor.set(.5));if(c.clouds)for(let e=0;e<11;e++){k++;let e=l.clouds[b(l.clouds.length)],t=Unicorn.AddOverlay("cloud_"+k,e,b(d),b(500),{scale:{x:3,y:3}});t.alpha=c.overlay?.5:.9,t.anchor.set(.5),t.speed=.01+.1*Math.random(),t.zIndex=t.speed,Q.push(t)}if(l.target_walls){let e=Unicorn.AddObject("TargetTop",{type:"rectangle",x:M,y:z+l.target_walls/2+l.target_collide_land,width:L-50,height:10,isStatic:!0});e.sprite.visible=!1;let t=Unicorn.AddObject("TargetLeft",{type:"rectangle",x:M-L/2+27,y:z+l.target_walls,width:10,height:100,isStatic:!0});t.sprite.visible=!1;let a=Unicorn.AddObject("TargetRight",{type:"rectangle",x:M+L/2-27,y:z+l.target_walls,width:10,height:100,isStatic:!0});a.sprite.visible=!1,J.push(e),J.push(t),J.push(a)}c.hideTilDrop&&(Q.forEach(e=>e.visible=!1),J.forEach(e=>e.isSensor=!0),Array.isArray(l.target)&&!l.target_random?R.forEach(e=>{e.visible=!1}):R.visible=!1,B&&(Array.isArray(l.target_overlay)&&!l.target_random?B.forEach(e=>{e.visible=!1}):B.visible=!1),N&&(N.visible=!1));if(c.spawnZombies){const e=c.spawnZombies.split(",").map(e=>e.trim());te=e[b(e.length)];const t=1;for(let e=0;e<t;e++){let e=b(d);Math.abs(M-e)<L/2+10&&(e=M+(e<M?-L/2-10:L/2+10));let t=r(e,h-40,110,{character:{id:te,path:te}});t.isSensor=!0,t.isStatic=!0,c.hideTilDrop&&(t.isHidden=!0,t.position.y=h+100),t.timeTilNextWalk=3e3+b(27e3),t.walkDirection=b(2)>0?"left":"right",Unicorn.PlayObjectAnimation(t.charName,t.walkDirection),ae.push(t)}}}();let e=await v();if(0!==e&&(m=e.session,setInterval(()=>{v()},6e4)),c.oauth){let e=await async function(e){return await fetch("https://id.twitch.tv/oauth2/validate",{headers:{Authorization:"OAuth "+e}}).then(e=>e.json()).catch(e=>({error:e}))}(c.oauth.replace("oauth:",""));u=e.client_id,["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every(t=>e.scopes.includes(t))||console.log("Need more permissions"),e.expires_in<1800&&console.log("Token expires soon. Need to generate new link")}let t=await ComfyJS.GetChannelRewards(u,!0),a=Object.keys(_);for(let e=0;e<a.length;e++){let o=a[e];if(!t.some(e=>e.title===o))try{await ComfyJS.CreateChannelReward(u,{title:o,prompt:_[o].desc,cost:_[o].cost,is_enabled:!0,background_color:_[o].color,is_user_input_required:!1,is_max_per_stream_enabled:!1,max_per_stream:0,is_max_per_user_per_stream_enabled:!1,max_per_user_per_stream:0,is_global_cooldown_enabled:!!_[o].cooldown,global_cooldown_seconds:_[o].cooldown,should_redemptions_skip_request_queue:!0})}catch(e){console.log(e)}}}},ComfyJS.onReward=(e,t,a,o,r)=>{_[t]&&_[t].callback(e,t,a,o,r)}}()}},function(){const e=document.createElement("script");e.src=("https:"===document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",e.type="text/javascript",e.async="true";const t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();let $=0,S=!1,U=0;function A(e=0){if(S=!0,l.target_versions){Object.keys(G).forEach(e=>{Array.isArray(R)?G[e].target.forEach(e=>{e.visible=!1}):G[e].target.visible=!1,G[e].target_overlay.forEach(e=>{e.visible=!1})});const e=b(Object.keys(G).length);W=Object.keys(G)[e],R=G[W].target,B=G[W].target_overlay,Array.isArray(R)?R[q].visible=!0:R.visible=!0,B[F].visible=!0}e>0&&($=1e3*e)}let k=0,P=!0,j=[],I=!1;async function O(e,t,a,o,r){if(document.hidden)return;if((o.broadcaster||o.mod)&&("resetparachute"===t||"resetdrop"===t))if(c.variations){const e=c.variations.split(","),t=b(e.length),a=`${window.location.protocol}//${window.location.host}${window.location.pathname.substr(0,window.location.pathname.lastIndexOf("/"))}/${e[t]}${window.location.search}`;window.location.href=a}else location.reload();if((o.broadcaster||o.mod)&&("deleteparachute"===t||"deletedrop"===t)){let e=await ComfyJS.GetChannelRewards(u,!0),t=Object.keys(_);for(let a=0;a<t.length;a++){let o=t[a],r=e.find(e=>e.title===o);r&&await ComfyJS.DeleteChannelReward(u,r.id)}}if((o.broadcaster||o.mod)&&"unqueuedrop"===t&&I&&(ComfyJS.Say("/me Group drop is no longer queued."),I=!1),(o.broadcaster||o.mod)&&"queuedrop"===t&&(I?"MySperrr"===e?ComfyJS.Say("/me Damn it, Sim. It's already queued!"):ComfyJS.Say("/me Group drop is already queued."):(I=!0,Object.keys(X).forEach(e=>{Unicorn.RemoveBacklay("para_"+e),Unicorn.RemoveBacklay("petpara_"+e),Unicorn.RemoveObject(X[e].player.charName),X[e].pet&&Unicorn.RemoveObject(X[e].pet.charName),Unicorn.RemoveText("name_"+e),Unicorn.RemoveBacklay("end_"+e),Unicorn.RemoveBacklay("petend_"+e),Unicorn.RemoveText(e+"_points"),delete X[e]}),C.x=-1e3,C.y=-1e3,H="",Y=0,D&&clearTimeout(D),ComfyJS.Say("/me Drops are queued this game. !startdrop to activate!"))),(o.broadcaster||o.mod)&&"startdrop"===t&&I&&(x(j),j.forEach(e=>{ie(e.username,e.name,e.color,e.message,e.selectedPara||l.parachutes[b(l.parachutes.length)],e.selectedPetPara||l.petparachutes[b(l.petparachutes.length)],e.emote,e.emoji,e.extra)}),j=[]),(o.broadcaster||o.mod)&&"testdrop"===t)for(var n=0;n<50;n++)k++,ie("test_"+k,"test_"+k,r.userColor||"#ffffff",Object.keys(l.characters)[b(Object.keys(l.characters).length)],l.parachutes[b(l.parachutes.length)],l.petparachutes[b(l.petparachutes.length)],"","",r);if((o.broadcaster||o.mod)&&"droplet"===t){let e=parseInt(a||Math.pow(10,b(6)));for(let t=0;t<5;t++)le(e)}if(("drophigh"===t||"drophighscore"===t||"dropbest"===t)&&c.oauth){let e=await async function(){if(c.oauth){const e=new Date;e.setDate(e.getDate()-1);const t=e.toISOString().split("T")[0];return(await fetch(`${s}/scores/high?channel=${c.channel}&game=${i}&date=${t}`,{method:"GET"}).then(e=>e.json()))[0]}return null}();e&&e.score&&ComfyJS.Say(`/me The highest score in the past 24 hours is ${e.score} by ${e.user}`)}if(("droplow"===t||"droplowscore"===t||"dropworst"===t)&&c.oauth){let e=await async function(){if(c.oauth){const e=new Date;e.setDate(e.getDate()-1);const t=e.toISOString().split("T")[0];return(await fetch(`${s}/scores/low?channel=${c.channel}&game=${i}&date=${t}`,{method:"GET"}).then(e=>e.json()))[0]}return null}();e&&e.score&&ComfyJS.Say(`/me The lowest score in the past 24 hours is ${e.score} by ${e.user}`)}if(("droptop"===t||"droptopscores"===t||"dropleaderboard"===t||"dropscores"===t)&&c.oauth){let e=await async function(){if(c.oauth){const e=new Date;e.setDate(e.getDate()-1);const t=e.toISOString().split("T")[0];return await fetch(`${s}/scores/high?channel=${c.channel}&game=${i}&date=${t}`,{method:"GET"}).then(e=>e.json())}return[]}();if(e&&e.length>0){let t=Array.from(new Set(e.map(e=>e.userId))).slice(0,10).map(t=>e.find(e=>e.userId===t));ComfyJS.Say("/me Top players in the past 24 hours are "+t.map((e,t)=>`${t+1}. ${e.user} (${e.score})`).join(", "))}else ComfyJS.Say("/me There are no scores recorded in the past 24 hours")}if("droprecent"===t&&c.oauth){let e=await async function(){if(c.oauth){return await fetch(`${s}/scores/recent?channel=${c.channel}&game=${i}`,{method:"GET"}).then(e=>e.json())}return[]}();if(e&&e.length>0){let t=Array.from(new Set(e.map(e=>e.userId))).slice(0,10).map(t=>e.find(e=>e.userId===t));ComfyJS.Say("/me Latest scores are "+t.map((e,t)=>`${e.user} (${e.score})`).join(", "))}else ComfyJS.Say("/me There are no recent scores")}let p=!1;if(!c.commandOn&&c.cpDrop||!c.command||t!==c.command||(p=!0),!c.commandOn&&c.cpDrop||c.command||"drop"!==t||(p=!0),g)if(y){if(p){P&&c.hideTilDrop&&(P=!1,Q.forEach(e=>e.visible=!0),J.forEach(e=>e.isSensor=!1),Array.isArray(R)?(R[q].visible=!0,l.target_animate_on_landed||A()):R.visible=!0,B&&(Array.isArray(B)?(B[F].visible=!0,l.target_animate_on_landed||A()):B.visible=!0),N&&(N.visible=!0),c.spawnZombies&&ae.forEach(e=>{e.isHidden=!1,e.position.y=h-40}));const o=twemoji.parse(a,{assetType:"png"});if(!r.messageEmotes&&o.length>0)I?j.push({username:r.username,name:e,color:r.userColor||"#ffffff",message:a,emote:"",emoji:o[0].url,extra:r}):ie(r.username,e,r.userColor||"#ffffff",a,l.parachutes[b(l.parachutes.length)],l.petparachutes[b(l.petparachutes.length)],"",o[0].url,r);else if(l.pridechutes){const o=Object.keys(l.pridechutes),s=r.messageEmotes?Object.keys(r.messageEmotes):[],n=s.map(e=>{const o=r.messageEmotes[e][0].split("-").map(e=>parseInt(e));return`!${t} ${a}`.substring(o[0],o[1]+1)}),i=n.filter(e=>e.toLowerCase().includes("pride"));let c=o.find(e=>i.some(t=>t.toLowerCase().includes(e)));if(c){const t=l.pridechutes[c];let o=s.find((e,t)=>!n[t].toLowerCase().includes(c));I?j.push({username:r.username,name:e,color:r.userColor||"#ffffff",message:a,selectedPara:t,selectedPetPara:t,emote:o,emoji:"",extra:r}):ie(r.username,e,r.userColor||"#ffffff",a,t,t,o,"",r)}else I?j.push({username:r.username,name:e,color:r.userColor||"#ffffff",message:a,emote:r.messageEmotes?Object.keys(r.messageEmotes)[0]:"",emoji:"",extra:r}):ie(r.username,e,r.userColor||"#ffffff",a,l.parachutes[b(l.parachutes.length)],l.petparachutes[b(l.petparachutes.length)],r.messageEmotes?Object.keys(r.messageEmotes)[0]:"","",r)}else I?j.push({username:r.username,name:e,color:r.userColor||"#ffffff",message:a,emote:r.messageEmotes?Object.keys(r.messageEmotes)[0]:"",emoji:"",extra:r}):ie(r.username,e,r.userColor||"#ffffff",a,l.parachutes[b(l.parachutes.length)],l.petparachutes[b(l.petparachutes.length)],r.messageEmotes?Object.keys(r.messageEmotes)[0]:"","",r)}}else p&&c.oauth&&ComfyJS.Say("The Parachute Drop game needs your attention. Please contact the PixelPlush team on Discord.")}function T(e,t,a,o,r){document.hidden}function E(e,t,a,o,r){if(!document.hidden&&g&&y)for(let e=0;e<5;e++)le(t)}let C,D=null,L=368,M=0,z=0,R=null,B=null,N=null,J=[],q=0,F=0,G={},W=null,X={},Y=0,H="",Z={},V={},Q=[],K=[],ee=[],te="zombie",ae=[],oe=0;function re(e,t,a,o,r,s=""){oe++;let n=Math.min(Math.max(1,r),100);Unicorn.AddParticles("Splash_"+oe,{blendMode:PIXI.BLEND_MODES.DEFAULT,shape:"cone",angle:-Math.PI/2,spread:Math.PI/2,startColor:e,endColor:t,intensity:n,minSpeed:.05,maxSpeed:.25,gravityX:0,gravityY:3.5,fadeOut:!0,decay:1,image:s||void 0},a,o),function(e,t=2e3){setTimeout(()=>{Unicorn.RemoveParticles(e)},t)}("Splash_"+oe,150)}function se(e,t,a,o=""){const r=l.target_boosh_scale||2;l.target_boosh.forEach((a,o)=>{for(let a=0;a<b(5);a++){oe++;let o=Unicorn.AddBacklay("boosh_"+oe,"target_boosh"+a,e,t+10,{scale:{x:r,y:r}});o.zIndex=11,o.vX=b(50)-25,o.vY=-350+b(100),o.anchor.set(.5),K.push(o)}})}function ne(e,t,a,o=""){const r=l.target_splash_scale||2;l.target_splash.forEach((a,o)=>{for(let a=0;a<b(5);a++){oe++;let o=Unicorn.AddBacklay("splash_"+oe,"target_splash"+a,e,t+10,{scale:{x:r,y:r}});o.zIndex=11,o.vX=b(100)-50,o.vY=-300+b(100),o.anchor.set(.5),ee.push(o)}})}async function ie(n,i,h="#ffffff",m,y,u,g="",_="",x){let v=4/60;if(!X[n]){X[n]={};let $=null,S=null,U=null,A=tinycolor(h),k=await async function(e){let t={};try{if(!e)return t;let a=await fetch(`${s}/accounts/twitch/design?username=${e}`).then(e=>e.json());return a&&(t=a.style||{}),t}catch(e){console.log(e)}}(n);if(g){if(!Z[g]){if(Z[g]=!0,g.startsWith("emotesv2_")){let e=`https://static-cdn.jtvnw.net/emoticons/v2/${g}/default/dark/2.0`,t=await fetchGif(e);if(t.length>0){const e=function(e,t){const a=Math.min(...e.map(e=>e.delay)),o=Math.max(...e.map(e=>e.dims.width)),r=Math.max(...e.map(e=>e.dims.height)),s=o,n=r;let i=0;for(let n=0;n<e.length;n++){let l=document.createElement("canvas");l.width=o,l.height=r;let c=l.getContext("2d"),p=c.createImageData(o,r);if(1===e[n].disposalType){let t=n;for(let a=e[t].dims.top;a<r;a++)for(let r=e[t].dims.left;r<o;r++)a>=e[t].dims.top&&r>=e[t].dims.left&&a<e[t].dims.top+e[t].dims.height&&r<e[t].dims.left+e[t].dims.width&&e[t].pixels[a*s+r]!==e[t].transparentIndex?(p.data[a*s*4+4*r+0]=e[t].patch[a*s*4+4*r+0],p.data[a*s*4+4*r+1]=e[t].patch[a*s*4+4*r+1],p.data[a*s*4+4*r+2]=e[t].patch[a*s*4+4*r+2],p.data[a*s*4+4*r+3]=e[t].patch[a*s*4+4*r+3]):0===t&&(p.data[a*s*4+4*r+0]=e[0].patch[a*s*4+4*r+0],p.data[a*s*4+4*r+1]=e[0].patch[a*s*4+4*r+1],p.data[a*s*4+4*r+2]=e[0].patch[a*s*4+4*r+2],p.data[a*s*4+4*r+3]=e[0].patch[a*s*4+4*r+3])}else if(3===e[n].disposalType){let t=null;for(let a=0;a<=n;a++){for(let t=0;t<r;t++)for(let r=0;r<o;r++)if(t>=e[a].dims.top&&r>=e[a].dims.left&&t<e[a].dims.top+e[a].dims.height&&r<e[a].dims.left+e[a].dims.width){const o=(t-e[a].dims.top)*e[a].dims.width+(r-e[a].dims.left),n=(t-e[a].dims.top)*e[a].dims.width*4+4*(r-e[a].dims.left);e[a].pixels[o]!==e[a].transparentIndex?(p.data[t*s*4+4*r+0]=e[a].patch[n+0],p.data[t*s*4+4*r+1]=e[a].patch[n+1],p.data[t*s*4+4*r+2]=e[a].patch[n+2],p.data[t*s*4+4*r+3]=e[a].patch[n+3]):(p.data[t*s*4+4*r+0]=0,p.data[t*s*4+4*r+1]=0,p.data[t*s*4+4*r+2]=0,p.data[t*s*4+4*r+3]=0)}0===a&&(t=p.data.slice())}}else{let t=n;for(let a=e[t].dims.top;a<r;a++)for(let r=e[t].dims.left;r<o;r++){const o=(a-e[t].dims.top)*e[t].dims.width+(r-e[t].dims.left),n=(a-e[t].dims.top)*e[t].dims.width*4+4*(r-e[t].dims.left);a>=e[t].dims.top&&r>=e[t].dims.left&&a<e[t].dims.top+e[t].dims.height&&r<e[t].dims.left+e[t].dims.width&&e[t].pixels[o]!==e[t].transparentIndex&&(p.data[a*s*4+4*r+0]=e[t].patch[n+0],p.data[a*s*4+4*r+1]=e[t].patch[n+1],p.data[a*s*4+4*r+2]=e[t].patch[n+2],p.data[a*s*4+4*r+3]=e[t].patch[n+3])}}c.putImageData(p,0,0);for(let s=0;s<e[n].delay;s+=a)Unicorn.LoadCustom(`${t}${i}`,l,"texture",{width:o,height:r}),i++}return{frames:i,minDelay:a,width:s,height:n}}(t,"emote_"+g);Z[g]={frames:e.frames,framerate:1/60*(1e3/e.minDelay)},setTimeout(()=>{delete X[n],ie(n,i,h,m,y,u,g,_,x)},500)}else Unicorn.Load(`emote_${g}0`,e),setTimeout(()=>{delete X[n],ie(n,i,h,m,y,u,g,_,x)},500)}else{let e=`https://static-cdn.jtvnw.net/emoticons/v1/${g}/2.0`;Unicorn.Load(`emote_${g}0`,e),setTimeout(()=>{delete X[n],ie(n,i,h,m,y,u,g,_,x)},500)}return}let e=[];if(g.startsWith("emotesv2_")&&"boolean"!=typeof Z[g]){v=Z[g].framerate;for(let t=0;t<Z[g].frames;t++)e.push(`emote_${g}${t}`)}else e=[`emote_${g}0`];$=o({x:b(d),y:-100-b(50),z:100,radius:36,scale:1.2,name:"player_"+n,framerate:Z[g].framerate,animations:{front:{numFrames:e.length,prefix:"emote_"+g}}}),$.charName="player_"+n,$.endImage=e[0],$.endScale=1.2}else if(_){if(!V[_])return V[_]=!0,Unicorn.Load(`emoji_${_}0`,_),void setTimeout(()=>{delete X[n],ie(n,i,h,m,y,u,g,_,x)},500);$=o({x:b(d),y:-100-b(50),z:100,radius:36,scale:1,name:"player_"+n,animations:{front:{numFrames:1,prefix:"emoji_"+_}}}),$.charName="player_"+n,$.endImage=`emoji_${_}0`,$.endScale=1}else if($=r(b(d),-100-b(50),100,k,m),"boybear"===$.character||"girlbear"===$.character){var w=PIXI.utils.string2hex(A.brighten(50).toHexString());Object.keys($.animations).forEach(e=>{$.animations[e].tint=w})}U=function(r,s,n,i){if(!i||!i.pet||"pet_none"===i.pet.id)return null;e++;const c="pet_"+e;if(!l)throw"No GameTheme Defined";l.pets||(l.pets={});let d=i.pet.id.replace("pet_","");if(!a[d]){a[d]=!0,l.pets[d]={path:i.pet.path,minIdle:i.pet.minIdle,maxIdle:i.pet.maxIdle};for(let e=0;e<10;e++)for(let a=0;a<t.length;a++){const o=`${i.pet.path}_${t[a]}`;Unicorn.Load(o+e,`${p}/assets/pets/${d}/${o}/${o}${e+1}.png`)}}let h=o({x:r,y:s,z:n,radius:24,name:c,prefix:l.pets[d].path});return h.isStatic=!0,h.isSensor=!0,h.petName=d,h.charName=c,h}(-1e3,-1e3,200,k),U&&(S=U.petName);let P=Unicorn.AddBacklay("para_"+n,y,{scale:{x:0,y:0},x:-50,y:0,z:50});P.visible=!1,P.zIndex=11,P.scale.x=0,P.scale.y=0,P.anchor.set(.5,1);let j=Unicorn.AddText("name_"+n,i,-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:40,fontWeight:"bold",fill:h,lineJoin:"round",stroke:tinycolor.isReadable(A.toString(),"#000000")?"#000000":"#ffffff",strokeThickness:6});j.anchor.set(.5);let I=Unicorn.AddText(n+"_points","",-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:40,fontWeight:"bold",fill:"#ffd700",lineJoin:"round",stroke:"#000000",strokeThickness:6});I.anchor.set(.5);let O=null;S&&(O=Unicorn.AddBacklay("petpara_"+n,u||y,{scale:{x:0,y:0},x:-50,y:0,z:150}),O.visible=!1,O.zIndex=11,O.scale.x=0,O.scale.y=0,O.anchor.set(.5,1)),$.restitution=1,$.friction=0,$.frictionStatic=0,$.frictionAir=0,$.torque=-5+b(10),$.rotationOffset=Math.random()*Math.PI,Unicorn.SetVelocity($.charName,b(24)-12,0),X[n]={parachute:P,player:$,pet:U,petPara:O,petType:S,petOffset:30*Math.random()+(Math.random()>.5?-150:70),label:j,scoreLabel:I,nameColor:A},x&&(X[n].userId=x.userId,X[n].name=x.displayName||x.username),y&&y.includes("chute_plane")&&(X[n].paraFlipDir=!0),u&&u.includes("chute_plane")&&(X[n].petParaFlipDir=!0),Unicorn.PlaySound("sfx-parachute-drop",{volume:f}),D&&clearTimeout(D),D=setTimeout(()=>{if(c.variations){const e=c.variations.split(","),t=b(e.length),a=`${window.location.protocol}//${window.location.host}${window.location.pathname.substr(0,window.location.pathname.lastIndexOf("/"))}/${e[t]}${window.location.search}`;window.location.href=a}else location.reload()},parseInt(c.cooldown||"90000"))}}async function le(e){if(!c.droplets)return;oe++;let t=null,a=0;a=b(6);let o=3;l.dropletSizes&&(o*=l.dropletSizes[a]);let r=l.droplets[a];Array.isArray(l.droplets[a])&&(r=l.droplets[a][b(l.droplets[a].length)]),t=Unicorn.AddObject("droplet_"+oe,{type:"circle",sprite:r,scale:{x:o,y:o},x:b(d),y:-100-b(50),z:100,radius:a/5*4+20}),t.restitution=1,t.friction=.5*(5-a),t.frictionStatic=0,t.frictionAir=0,t.torque=-1+b(2),t.rotationOffset=Math.random()*Math.PI,Unicorn.SetVelocity("droplet_"+oe,b(24)-12,0),setTimeout(()=>{Unicorn.RemoveObject(t.label)},3e4)}function ce(){if(PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,Unicorn.Load("map",`${p}/assets/${l.bg}.png`),!c.overlay){var e=Unicorn.AddBacklay("map","map",0,h-1080);e.scale.x=3,e.scale.y=3}if(l.target_versions)Object.keys(l.target_versions).forEach(e=>{let t=l.target_versions[e];if(Array.isArray(t.target)){t.target.map((t,a)=>Unicorn.Load("target"+e+a,`${p}/assets/${t}.png`))}else{Unicorn.Load("target"+e,`${p}/assets/${t.target}.png`)}if(Array.isArray(t.target_overlay)){t.target_overlay.map((t,a)=>Unicorn.Load("target_overlay"+e+a,`${p}/assets/${t}.png`))}else{Unicorn.Load("target_overlay"+e,`${p}/assets/${t.target_overlay}.png`)}if(t.target_effect){t.target_effect.map((t,a)=>Unicorn.Load("target_effect"+e+a,`${p}/assets/${t}.png`))}});else{if(Array.isArray(l.target)){l.target.map((e,t)=>Unicorn.Load("target"+t,`${p}/assets/${e}.png`))}else{Unicorn.Load("target",`${p}/assets/${l.target}.png`)}if(Array.isArray(l.target_overlay)){l.target_overlay.map((e,t)=>Unicorn.Load("target_overlay"+t,`${p}/assets/${e}.png`))}else if(l.target_overlay){Unicorn.Load("target_overlay",`${p}/assets/${l.target_overlay}.png`)}if(l.target_effect){l.target_effect.map((e,t)=>Unicorn.Load("target_effect"+t,`${p}/assets/${e}.png`))}}l.target_front&&Unicorn.Load("target_front",`${p}/assets/${l.target_front}.png`),l.target_boosh&&l.target_boosh.forEach((e,t)=>{Unicorn.Load("target_boosh"+t,`${p}/assets/${e}.png`)}),l.target_splash&&l.target_splash.forEach((e,t)=>{Unicorn.Load("target_splash"+t,`${p}/assets/${e}.png`)}),Unicorn.Load("star",p+"/assets/icons/star.png"),C=Unicorn.AddOverlay("star","star",-1e3,-1e3,{scale:{x:3,y:3}}),C.anchor.set(.5),l.parachutes.forEach(e=>Unicorn.Load(e,`${p}/assets/${e}.png`)),l.petparachutes?l.petparachutes.forEach(e=>Unicorn.Load(e,`${p}/assets/${e}.png`)):l.petparachutes=[],l.pridechutes&&Object.keys(l.pridechutes).forEach(e=>Unicorn.Load(l.pridechutes[e],`${p}/assets/${l.pridechutes[e]}.png`)),Object.keys(l.characters).forEach(e=>{for(let t=0;t<10;t++){let a=l.characters[e];Unicorn.Load(`${e}_${t}`,`${p}/assets/characters/${e}/${a}_front/${a}_front${t+1}.png`)}}),l.clouds.forEach(e=>Unicorn.Load(e,`${p}/assets/${e}.png`)),l.droplets.forEach(e=>{Array.isArray(e)?e.forEach(e=>Unicorn.Load(e,`${p}/assets/${e}.png`)):Unicorn.Load(e,`${p}/assets/${e}.png`)}),l.target_sound&&Unicorn.Load("sfx-target-drop",`${p}/assets/${l.target_sound}`),c.queueSound&&Unicorn.Load("sfx-group-queue",`${p}/assets/${l.queue_sound}`),Unicorn.Load("sfx-parachute-drop",`${p}/assets/${l.drop_sound}`),Unicorn.Load("sfx-parachute-flap",`${p}/assets/${l.parachute_sound}`),Unicorn.AddObject("WallLeft",{type:"rectangle",x:-200,y:0,width:400,height:2*h,friction:0,frictionAir:0,frictionStatic:0,bounce:1,isStatic:!0}).sprite.visible=!1,Unicorn.AddObject("WallRight",{type:"rectangle",x:d+200,y:0,width:400,height:2*h,friction:0,frictionAir:0,frictionStatic:0,bounce:1.01,isStatic:!0}).sprite.visible=!1,Unicorn.AddObject("WallBottom",{type:"rectangle",x:.5*d,y:h+100,friction:0,frictionAir:0,frictionStatic:0,bounce:1.01,width:d,height:200,isStatic:!0}).sprite.visible=!1,Matter.Events.on(physics,"beforeUpdate",(function(e){const t=Object.keys(X);for(let e=0;e<t.length;e++){const a=t[e],o=X[a];o.player&&(o.player.position.y<.5*-h?o.player.velocity.y>10&&Matter.Body.setVelocity(o.player,{x:o.player.velocity.x,y:10}):o.player.position.y>300&&o.player.velocity.y>.5&&Matter.Body.setVelocity(o.player,{x:o.player.velocity.x,y:.5}))}})),Matter.Events.on(physics,"afterUpdate",(function(e){const t=Object.keys(X);for(let e=0;e<t.length;e++){const a=t[e],o=X[a];if(o.pet){let e=Math.min(3,Math.max(0,.3*(o.player.position.y-300)));o.petPara.scale.x=o.petPara.scale.y=e/2,o.petParaFlipDir&&o.player.velocity.x>0&&(o.petPara.scale.x=-e/2),o.pet.angle=o.player.angle,o.pet.position.x=Math.max(20,Math.min(d-20,o.player.position.x+o.petOffset)),o.pet.position.y=Math.min(o.player.position.y+20,h-46-50+(l.target_y_offset||0)),o.petPara.rotation=o.player.angle,o.petPara.position.x=o.pet.position.x,o.petPara.position.y=o.pet.position.y}}}))}function pe(e,t){const a=Object.keys(X);for(let t=0;t<a.length;t++){const o=a[t],s=X[o];if(s.player)if(s.isLanded){let e=o===H?1:.3;if(c.spawnZombies&&s.score<=0||(s.end.alpha=e,s.label.alpha=Math.round(e),s.scoreLabel.tint=s.label.tint=o===H?16777215:3355443),s.pet&&(s.petEnd.alpha=e),o===H?(s.end.zIndex=s.scoreLabel.zIndex=s.label.zIndex=9e3,s.pet&&(s.pet.zIndex=9001),s.label.position.x=s.player.position.x,s.label.position.y=s.player.position.y-80,s.scoreLabel.position.x=s.label.position.x+15,s.scoreLabel.position.y=s.label.position.y-30,s.label.style.fontSize=46,s.scoreLabel.style.fontSize=46,C.x=s.scoreLabel.x-s.scoreLabel.width/2-15,C.y=s.scoreLabel.y-5):(s.label.position.x=s.player.position.x,s.label.position.y=s.player.position.y-60,s.scoreLabel.position.y=s.label.position.y-30,s.scoreLabel.alpha=0,s.label.style.fontSize=40,s.scoreLabel.style.fontSize=40),c.spawnZombies&&!s.zombiefied){s.zombiefied=!0;for(let e=0;e<ae.length;e++){const t=ae[e];if(s.end&&s.end.alpha>0&&Math.abs(s.end.x-t.position.x)<40){const e={character:{id:te,path:te}};s.end.alpha=0;let t=r(s.end.x,h-40,110,e);t.isSensor=!0,t.isStatic=!0,t.timeTilNextWalk=3e3+b(27e3),t.walkDirection=b(2)>0?"left":"right",t.label=s.label,Unicorn.PlayObjectAnimation(t.charName,t.walkDirection);let a=PIXI.utils.string2hex(s.nameColor.brighten(50).toHexString());Object.keys(t.animations).forEach(e=>{t.animations[e].tint=a}),ae.push(t),l.target_particles&&re(l.target_particles[0],l.target_particles[1],s.end.x,h-40,10),l.target_boosh&&se(s.end.x,h-40),l.target_splash&&ne(s.end.x,h-40)}}}}else{if(s.pet&&(s.pet.position.x=Math.max(20,Math.min(d-20,s.player.position.x+s.petOffset)),s.pet.position.y=Math.min(s.player.position.y+20,h-46-50+(l.target_y_offset||0)),s.petPara.position.x=s.pet.position.x,s.petPara.position.y=s.pet.position.y),s.player.position.y>h-46-50+(l.target_y_offset||0)||l.target_walls&&s.player.position.y>h-46-50+(l.target_collide_land||0)&&L/2-20>Math.abs(M-s.player.position.x)){s.isLanded=!0,s.parachute.scale.x=s.parachute.scale.y=0,s.pet&&(s.petPara.scale.x=s.petPara.scale.y=0);let e=Unicorn.AddBacklay("end_"+o,s.player.endImage,s.player.position.x,s.player.position.y,{scale:{x:s.player.endScale,y:s.player.endScale}});if(s.player.animations&&(e.tint=s.player.animations.front.tint),e.anchor.set(.5),e.zIndex=20,s.player.isStatic=!0,l.target_walls?s.score=100*Math.max(0,L/2-20-Math.abs(M-s.player.position.x))/(L/2-20):s.score=100*Math.max(0,L/2-Math.abs(M-s.player.position.x))/(L/2),(!c.spawnZombies||s.score>0)&&(e.alpha=s.score>0?1:.3),s.end=e,s.pet){let e=Unicorn.AddBacklay("petend_"+o,s.petType+"_front0",s.pet.position.x,s.pet.position.y,{scale:{x:3,y:3}});s.pet.animations&&(e.tint=s.pet.animations.front.tint),e.anchor.set(.5),e.zIndex=30,s.pet.isStatic=!0,e.alpha=s.score>0?1:.3,s.petEnd=e}if(s.score>0){if(l.target_versions&&A(),l.target_effect){k++;const e="te_"+k;let t=Unicorn.AddObject(e,{type:"circle",scale:{x:2,y:2},animations:{front:{framerate:4/60,frames:Array.from({length:l.target_effect.length},(e,t)=>"target_effect"+t),loop:!1,onComplete:()=>{Unicorn.RemoveObject(e)}}},isSensor:!0,isStatic:!0,x:s.player.position.x,y:s.player.position.y,z:200,radius:.1});t.isSensor=!0,t.animations.front.anchor.y=1}if(W&&l.target_versions[W].target_effect){k++;const e="te_"+k;let t=Unicorn.AddObject(e,{type:"circle",scale:{x:2,y:2},animations:{front:{framerate:4/60,frames:Array.from({length:l.target_versions[W].target_effect.length},(e,t)=>`target_effect${W}${t}`),loop:!1,onComplete:()=>{Unicorn.RemoveObject(e)}}},isSensor:!0,isStatic:!0,x:s.player.position.x,y:s.player.position.y,z:200,radius:.1});t.isSensor=!0,t.animations.front.anchor.y=1}if(l.target_animate_on_landed&&A(2),l.target_particles&&re(l.target_particles[0],l.target_particles[1],s.player.position.x,s.player.position.y+40,10),l.target_boosh&&se(s.player.position.x,s.player.position.y+40),l.target_splash&&ne(s.player.position.x,s.player.position.y+40),l.target_sound&&Unicorn.PlaySound("sfx-target-drop",{volume:f}),s.scoreLabel.x=s.label.position.x,s.scoreLabel.y=s.label.position.y-30,s.scoreLabel.text=s.score.toFixed(2),!o.startsWith("test_")){if(c.messageFormat){let e=c.messageFormat.replace("USERNAME",s.name).replace("POINTS",s.score.toFixed(2)).replace("SHORTPTS",Math.floor(s.score));setTimeout(()=>{ComfyJS.Say(e)},5e3)}w(s.name,s.score.toFixed(2),s.userId,o)}}s.score>Y&&(Y=s.score,H=o,e.zIndex=21),(!c.spawnZombies||s.score>0)&&(s.label.alpha=s.score>0?1:.3),Unicorn.RemoveObject(s.player.label),Unicorn.RemoveBacklay("para_"+o),s.pet&&(Unicorn.RemoveObject(s.pet.label),Unicorn.RemoveBacklay("petpara_"+o))}else if(s.player.position.y>300){let t=Math.min(3,Math.max(0,.3*(s.player.position.y-300)));0===s.parachute.scale.x&&t>0&&Unicorn.PlaySound("sfx-parachute-flap",{volume:f}),s.parachute.visible=!0,s.pet&&(s.petPara.visible=!0),s.parachute.scale.x=s.parachute.scale.y=t,s.paraFlipDir&&s.player.velocity.x>0&&(s.parachute.scale.x=-t),s.parachute.rotation=Math.sin(s.player.rotationOffset+e/1e3)*Math.PI/16,s.player.angle=Math.sin(s.player.rotationOffset+e/1e3)*Math.PI/16,s.parachute.position.x=s.player.position.x,s.parachute.position.y=s.player.position.y-10-(l.parachute_offset||0)}else s.parachute.visible=!1,s.parachute.scale.x=s.parachute.scale.y=0,s.pet&&(s.petPara.visible=!1,s.petPara.scale.x=s.petPara.scale.y=0);s.label.position.x=s.player.position.x,s.label.position.y=s.player.position.y-60}}Q.forEach((e,a)=>{e.x-=t*e.speed,e.x+e.width/2<=0&&(e.x=d+e.width/2,e.y=b(500),e.speed=.01+.1*Math.random(),e.zIndex=e.speed)}),K.forEach(e=>{(e.vY<0||e.y<h-5)&&(e.x+=t/1e3*e.vX,e.y+=t/1e3*e.vY,e.vY<20&&(e.vY+=t/1e3*200))}),ee.forEach(e=>{(e.vY<0||e.y<h-5)&&(e.x+=t/1e3*e.vX,e.y+=t/1e3*e.vY,e.vY+=t/1e3*200)});for(let e=0;e<ae.length;e++){const a=ae[e];if(a.isHidden)continue;let o=!1;a.position.x<=20&&"left"===a.walkDirection&&(o=!0),a.position.x>=d-20&&"right"===a.walkDirection&&(o=!0),Math.abs(M-a.position.x)<L/2+10&&(o=!0,a.position.x<M?a.position.x=M-L/2-10:a.position.x=M+L/2+10),a.timeTilNextWalk-=t,a.timeTilNextWalk<=0&&(o=!0),o&&(a.timeTilNextWalk=3e3+b(27e3),a.walkDirection="right"===a.walkDirection?"left":"right",Unicorn.PlayObjectAnimation(a.charName,a.walkDirection)),a.position.x+=50*t/1e3*("left"===a.walkDirection?-1:1),a.label&&(a.label.x=a.position.x)}S&&(U-=t,U<=0&&(U=60,Array.isArray(R)&&(R[q].visible=!1,q=(q+1)%R.length,R[q].visible=!0),B&&Array.isArray(B)&&(B[F].visible=!1,F=(F+1)%B.length,B[F].visible=!0))),$>0&&($-=t,$<=0&&(S=!1,Array.isArray(R)&&(R[q].visible=!1,q=0,R[q].visible=!0),B&&Array.isArray(B)&&(R[F].visible=!1,F=0,R[F].visible=!0)))}