let e=0;function t(e,t,d){let a={};return m.Animations.forEach(r=>{a[r]={numFrames:d,prefix:`${e}_${t}_${r}`}}),a}function d({x:e,y:t,z:d,radius:a,scale:r=3,name:u,framerate:o=4/60,animations:s,suffix:n=""}={}){let i={};return Object.keys(s).forEach(e=>{i[e]={framerate:o,frames:Array.from({length:s[e].numFrames},(t,d)=>`${s[e].prefix}${n||d}`),loop:!0}}),Unicorn.AddObject(u,{type:"circle",scale:{x:r,y:r},friction:0,frictionAir:0,frictionStatic:0,bounce:1,animations:i,x:e,y:t,z:d,radius:a})}function a({x:e,y:t,z:d,scale:a=3,name:r,framerate:u=4/60,animations:o,suffix:s=""}={}){let n={};Object.keys(o).forEach(e=>{n[e]={framerate:u,frames:Array.from({length:o[e].numFrames},(t,d)=>`${o[e].prefix}${s||d}`),loop:!0}});let i=Unicorn.AddSprite(r,{scale:{x:a,y:a},animations:n,x:e,y:t,z:d});return i.label=r,i.objectOffset=-39,Object.keys(o).forEach(e=>{i.animations[e].anchor.set(.5,1)}),i}function r(a,r,u,o,s=null){c.playable;e++;const n="player_"+e;if(!c)throw"No GameTheme Defined";c.characters||(c.characters={});let i=!1;s&&c.playable.includes(s)||(o.character&&o.character.id?(s=o.character.id,i=!0):s=c.playable[k(c.playable.length)]),g["char_"+s]||(c.characters[s]=i?o.character.path:s,U("char",s,"characters",c.characters[s],m.NumFrames));let l=d({x:a,y:r,z:u,radius:36,name:n,animations:t("char",s,m.NumFrames)});return l.character=s,l.charName=n,l.endImage=`char_${s}_front0`,l.endScale=3,l.cleanup=()=>{Unicorn.RemoveObject(n)},l}function u(r,u,o,s={}){e++;const n="player_"+e;if(!c)throw"No GameTheme Defined";c.characters||(c.characters={});let i=m.NumFrames,l="",f={};const p=[];if(s.character){const e=s.character;g["char_"+e.id]||(c.characters[e.id]=e.path,U("char",e.id,"characters",c.characters[e.id],i)),f=d({x:r,y:u,z:o,radius:36,name:n,animations:t("char",e.id,i)}),f.character=e.id,f.charName=n,f.endImage=`char_${e}_front0`,f.endScale=3,f.sprites={}}else{if(s.equipment){const e=Object.keys(s.equipment);if(e.length>0){const t=e[0],d=s.equipment[t];i=1,l="_wheel",U("eq",d,"skins/equipment/"+t,d,m.NumFrames)}}if(!s.body||!s.body.skintones)throw"No Body";{const e=s.body.skintones,c=s.body.expressions,h=s.body.hair;U("skin",e,"skins/body/skintones",e,i,l),f=d({x:r,y:u,z:o,radius:36,name:n,animations:t("skin",e,i),suffix:l}),f.character=e,f.charName=n,f.endImage=`skin_${e}_front0`,f.endScale=3,f.sprites={},U("expr",c,"skins/body/expressions",c,i,l),f.sprites.expr=a({x:r,y:u,z:o+1,name:n+"_expr",animations:t("expr",c,i),suffix:l}),Unicorn.AttachSpriteToObject(n+"_expr",n),p.push(n+"_expr"),U("hair",h,"skins/body/hair",h,i,l),f.sprites.hair=a({x:r,y:u,z:o+2,name:n+"_hair",animations:t("hair",h,i),suffix:l}),Unicorn.AttachSpriteToObject(n+"_hair",n),p.push(n+"_hair")}if(s.equipment){const e=Object.keys(s.equipment);if(e.length>0){const d=e[0],i=s.equipment[d];f.sprites.eq=a({x:r,y:u,z:o+10,name:n+"_eq",animations:t("eq",i,m.NumFrames)}),Unicorn.AttachSpriteToObject(n+"_eq",n),p.push(n+"_eq")}}}if(s.outfits){const e=s.outfits.pants,d=s.outfits.shirts,c=s.outfits.dresses;e&&(U("pants",e,"skins/outfits/pants",e,i,l),f.sprites.pants=a({x:r,y:u,z:o+3,name:n+"_pants",animations:t("pants",e,i),suffix:l}),Unicorn.AttachSpriteToObject(n+"_pants",n),p.push(n+"_pants")),d&&(U("shirts",d,"skins/outfits/shirts",d,i,l),f.sprites.shirts=a({x:r,y:u,z:o+4,name:n+"_shirts",animations:t("shirts",d,i),suffix:l}),Unicorn.AttachSpriteToObject(n+"_shirts",n),p.push(n+"_shirts")),c&&(U("dress",c,"skins/outfits/dresses",c,i,l),f.sprites.dresses=a({x:r,y:u,z:o+5,name:n+"_dresses",animations:t("dress",c,i),suffix:l}),Unicorn.AttachSpriteToObject(n+"_dresses",n),p.push(n+"_dresses"))}if(s.accessories)for(const e in s.accessories){const d=s.accessories[e];U("acc",d,"skins/accessories/"+e,d,i,l),f.sprites["acc_"+d]=a({x:r,y:u,z:o+10,name:n+"_acc_"+d,animations:t("acc",d,i),suffix:l}),Unicorn.AttachSpriteToObject(n+"_acc_"+d,n),p.push(n+"_acc_"+d)}return f.cleanup=()=>{Unicorn.RemoveObject(f.charName);for(let e=0;e<p.length;e++)Unicorn.RemoveSprite(p[e])},f}function o(a,r,u,o,s){if(!o||!o.pet||"pet_none"===o.pet.id)return null;e++;const n="pet_"+e;if(!c)throw"No GameTheme Defined";c.pets||(c.pets={});let i=o.pet.id.replace("pet_","");g["pet_"+i]||(c.pets[i]={path:o.pet.path,minIdle:o.pet.minIdle,maxIdle:o.pet.maxIdle},U("pet",i,"pets",o.pet.path,m.NumFrames));let l=d({x:a,y:r,z:u,radius:24,name:n,framerate:s||4/60,animations:t("pet",c.pets[i].path,m.NumFrames)});return l.isStatic=!0,l.isSensor=!0,l.petName=i,l.charName=n,l.cleanup=()=>{Unicorn.RemoveObject(n)},l}const s="https://api.pixelplush.dev/v1";let n="PixelPlush Game",i="unknown",c={},l={},f="",p=1920,h=1080,y=.5;const m={NumFrames:10,Animations:["front","left","back","right"]};let g={};var b="",_=!0;let x="",v=!0,w={};function k(e){return Math.floor(Math.random()*Math.floor(e))}function $(e){for(let t=e.length-1;t>0;t--){const d=Math.floor(Math.random()*(t+1));[e[t],e[d]]=[e[d],e[t]]}}function S(e,t,d,a,r){const u=a.dims;let o=document.createElement("canvas");o.width=t,o.height=d;let s=o.getContext("2d"),n=s.createImageData(t,d);if(r)for(let e=0;e<d;e++)for(let d=0;d<t;d++){const a=4*(e*t+d);n.data[a+0]=r.data[a+0],n.data[a+1]=r.data[a+1],n.data[a+2]=r.data[a+2],n.data[a+3]=r.data[a+3]}for(let e=u.top;e<u.top+u.height;e++)for(let d=u.left;d<u.left+u.width;d++){const r=d-u.left,o=(e-u.top)*u.width+r,s=4*o,i=4*(e*t+d);a.pixels[o]!==a.transparentIndex&&(n.data[i+0]=a.patch[s+0],n.data[i+1]=a.patch[s+1],n.data[i+2]=a.patch[s+2],n.data[i+3]=a.patch[s+3])}switch(s.putImageData(n,0,0),e){case 1:default:break;case 2:for(let e=u.top;e<u.top+u.height;e++)for(let d=u.left;d<u.left+u.width;d++){const a=4*(e*t+d);n.data[a+0]=0,n.data[a+1]=0,n.data[a+2]=0,n.data[a+3]=0}break;case 3:if(r)for(let e=u.top;e<u.top+u.height;e++)for(let d=u.left;d<u.left+u.width;d++){const a=4*(e*t+d);n.data[a+0]=r.data[a+0],n.data[a+1]=r.data[a+1],n.data[a+2]=r.data[a+2],n.data[a+3]=r.data[a+3]}}return{canvas:o,data:n}}async function A(e){let t=Object.keys(ye).length;return window.location.host.startsWith("localhost")?0:fetch(s+"/analytics/heartbeat",{method:"POST",body:JSON.stringify({session:b,game:i,theme:n,channel:l.channel,players:Object.keys(ye),count:t})}).then(e=>e.json())}function U(e,t,d,a,r,u=""){if(!g[e+"_"+t+u]){g[e+"_"+t+u]=!0;for(let o=0;o<r;o++)for(let r=0;r<m.Animations.length;r++){const s=m.Animations[r],n=`${a}_${s}`;u?Unicorn.Load(`${e}_${t}_${s}${u}`,`${f}/assets/${d}/${t}/${n}/${n}${u}.png`):Unicorn.Load(`${e}_${t}_${s}${o}`,`${f}/assets/${d}/${t}/${n}/${n}${o+1}.png`)}}}async function O(e,t,d,a){return l.oauth?fetch(s+"/scores/add",{method:"POST",body:JSON.stringify({token:l.oauth.replace("oauth:",""),channel:l.channel,game:i,theme:n,user:e,score:t,userId:d,username:a})}).then(e=>e.json()):{}}window.setupGame=function(e,t,d){if(n=e,c=t,l=d,f=c.path||"",l.clouds=void 0===l.clouds||null===l.clouds?!l.overlay:"true"===l.clouds,y=void 0===l.volume||null===l.volume?0:parseInt(l.volume)/100,p=Math.min(window.innerWidth,c.screenWidth||1920),h=Math.min(window.innerHeight,c.screenHeight||1080),l.variations&&!l.didRandom){const e=l.variations.split(","),t=k(e.length),d=`${window.location.protocol}//${window.location.host}${window.location.pathname.substr(0,window.location.pathname.lastIndexOf("/"))}/${e[t]}${window.location.search}&didRandom=1`;window.location.href=d}l.readyTime&&(v=!1,setTimeout(()=>{v=!0,ComfyJS.Say("Parachute Drop is ready!")},parseInt(l.readyTime||1e3)))},window.WebFontConfig={custom:{families:["Pixeltype","Pixellari"]},active(){!async function(){try{const e=(await fetch("https://www.pixelplush.dev/assets/shamelist.txt").then(e=>e.text())).split(",").map(e=>e.trim().toLowerCase());if(l.channel&&e&&e.includes(l.channel.toLowerCase())&&(console.log("This channel has been blocked for violating the PixelPlush Terms of Service."),_=!1),c.requires)try{if(account=await fetch(s+"/accounts",{headers:{Twitch:l.oauth?l.oauth.replace("oauth:",""):void 0}}).then(e=>e.json()),console.log(account),account.error)throw"Login Error";if(!account.owned.includes(c.requires))throw"Item not owned"}catch(e){return void console.log("Auth Validate Failed",e)}await async function(){i="parachute",l.spawnZombies&&(console.log("zombie"),"instafluff"!==l.channel&&"maaya"!==l.channel&&(l.spawnZombies=""));l.notifVolume&&(L=parseInt(l.notifVolume)/100);l.command=l.command||"drop",l.cpDrop&&(w["Parachute Drop!"]={desc:"Drop into the PixelPlush Parachute Game!",color:"#F2C079",cost:parseInt(l.cpDropCost||50),callback:(e,t,d,a,r)=>{ye[e]||V(e,l.command,a,{},r)}});l.cpDroplets&&(w["Parachute Droplets"]={desc:"Add bouncing obstacles into the PixelPlush Parachute Game!",color:"#F2C079",cost:parseInt(l.cpDropletsCost||500),cooldown:parseInt(l.cpDropletsCD||5),callback:()=>{if(v)if(_)for(let e=0;e<5;e++)Re(100);else l.oauth&&ComfyJS.Say("The Parachute Drop game needs your attention. Please contact the PixelPlush team on Discord.")}});l.cpQueue&&(w["Group Parachute"]={desc:"Queue everyone for a group drop in the PixelPlush Parachute Game!",color:"#F2C079",cost:parseInt(l.cpQueueCost||500),cooldown:parseInt(l.cpQueueCD||120),callback:()=>{if(v)if(_)if(W)ComfyJS.Say("/me Group Drop is already queued.");else{L>0&&Unicorn.PlaySound("sfx-group-queue",{volume:L}),K(),W=!0;const e=6e4;ComfyJS.Say(`/me Parachutes are queued for the next 60 seconds. !${l.command} to join!`),setTimeout(()=>{ComfyJS.Say(`/me 30 seconds remaining. !${l.command} (${Object.keys(G).length} in group)`)},e-3e4),setTimeout(()=>{ComfyJS.Say(`/me 10 seconds. !${l.command} (${Object.keys(G).length} in group)`)},e-1e4),setTimeout(()=>{let e=Object.keys(G);$(e),e.forEach(e=>{const t=G[e];ze(t.username,t.name,t.color,t.message,t.selectedPara||c.parachutes[k(c.parachutes.length)],t.selectedPetPara||c.petparachutes[k(c.petparachutes.length)],t.emote,t.emoji,t.extra)}),G={}},e)}else l.oauth&&ComfyJS.Say("The Parachute Drop game needs your attention. Please contact the PixelPlush team on Discord.")}})}()}catch(e){console.log(e)}Unicorn.Create("unicorn-display",{width:p,height:h,background:"transparent",init:Be,update:qe,channel:l.channel,username:l.oauth?l.channel:void 0,password:l.oauth?l.oauth.replace("oauth:",""):void 0,onCommand:V,onChat:Z,screenWalls:!1,gravity:{x:0,y:1},framerate:l.fps||60}),ComfyJS.onCheer=H,ComfyJS.onRaid=Q,ComfyJS.onConnected=async(e,t,d)=>{if(d){Ne();let e=await A();if(0!==e&&(b=e.session,setInterval(()=>{A()},6e4)),l.oauth){let e=await async function(e){return await fetch("https://id.twitch.tv/oauth2/validate",{headers:{Authorization:"OAuth "+e}}).then(e=>e.json()).catch(e=>({error:e}))}(l.oauth.replace("oauth:",""));x=e.client_id,["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every(t=>e.scopes.includes(t))||console.log("Need more permissions"),e.expires_in<1800&&console.log("Token expires soon. Need to generate new link")}let t=await ComfyJS.GetChannelRewards(x,!0),d=Object.keys(w);for(let e=0;e<d.length;e++){let a=d[e];if(!t.some(e=>e.title===a))try{await ComfyJS.CreateChannelReward(x,{title:a,prompt:w[a].desc,cost:w[a].cost,is_enabled:!0,background_color:w[a].color,is_user_input_required:!1,is_max_per_stream_enabled:!1,max_per_stream:0,is_max_per_user_per_stream_enabled:!1,max_per_user_per_stream:0,is_global_cooldown_enabled:!!w[a].cooldown,global_cooldown_seconds:w[a].cooldown,should_redemptions_skip_request_queue:!0})}catch(e){console.log(e)}}}},ComfyJS.onReward=(e,t,d,a,r)=>{w[t]&&w[t].callback(e,t,d,a,r)}}()}},function(){const e=document.createElement("script");e.src=("https:"===document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",e.type="text/javascript",e.async="true";const t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();const j={parse:function(e,t){var d=t&&t.assetType?t.assetType:"svg",a=t&&t.buildUrl?t.buildUrl:function(e,t){return"png"===t?"https://twemoji.maxcdn.com/2/72x72/"+e+".png":"https://twemoji.maxcdn.com/2/svg/"+e+".svg"},r=[];T.default.lastIndex=0;for(;;){var u=T.default.exec(e);if(!u)break;var o=u[0],s=D(E(o)).join("-");r.push({url:s?a(s,d):"",indices:[u.index,T.default.lastIndex],text:o,type:P})}return r}};j.toCodePoints=D;var I,T=(I=/(?:\ud83d\udc68\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c\udffb|\ud83d\udc68\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc]|\ud83d\udc68\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd]|\ud83d\udc68\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffc-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffd-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c\udffb|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb\udffc]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd\udfff]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffd]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffe]|\ud83e\uddd1\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c\udffb|\ud83e\uddd1\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb\udffc]|\ud83e\uddd1\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udffd]|\ud83e\uddd1\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udffe]|\ud83e\uddd1\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\u200d\ud83e\udd1d\u200d\ud83e\uddd1|\ud83d\udc6b\ud83c[\udffb-\udfff]|\ud83d\udc6c\ud83c[\udffb-\udfff]|\ud83d\udc6d\ud83c[\udffb-\udfff]|\ud83d[\udc6b-\udc6d])|(?:\ud83d[\udc68\udc69])(?:\ud83c[\udffb-\udfff])?\u200d(?:\u2695\ufe0f|\u2696\ufe0f|\u2708\ufe0f|\ud83c[\udf3e\udf73\udf93\udfa4\udfa8\udfeb\udfed]|\ud83d[\udcbb\udcbc\udd27\udd2c\ude80\ude92]|\ud83e[\uddaf-\uddb3\uddbc\uddbd])|(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75]|\u26f9)((?:\ud83c[\udffb-\udfff]|\ufe0f)\u200d[\u2640\u2642]\ufe0f)|(?:\ud83c[\udfc3\udfc4\udfca]|\ud83d[\udc6e\udc71\udc73\udc77\udc81\udc82\udc86\udc87\ude45-\ude47\ude4b\ude4d\ude4e\udea3\udeb4-\udeb6]|\ud83e[\udd26\udd35\udd37-\udd39\udd3d\udd3e\uddb8\uddb9\uddcd-\uddcf\uddd6-\udddd])(?:\ud83c[\udffb-\udfff])?\u200d[\u2640\u2642]\ufe0f|(?:\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f|\ud83c\udff3\ufe0f\u200d\ud83c\udf08|\ud83c\udff4\u200d\u2620\ufe0f|\ud83d\udc15\u200d\ud83e\uddba|\ud83d\udc41\u200d\ud83d\udde8|\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc6f\u200d\u2640\ufe0f|\ud83d\udc6f\u200d\u2642\ufe0f|\ud83e\udd3c\u200d\u2640\ufe0f|\ud83e\udd3c\u200d\u2642\ufe0f|\ud83e\uddde\u200d\u2640\ufe0f|\ud83e\uddde\u200d\u2642\ufe0f|\ud83e\udddf\u200d\u2640\ufe0f|\ud83e\udddf\u200d\u2642\ufe0f)|[#*0-9]\ufe0f?\u20e3|(?:[Â©Â®\u2122\u265f]\ufe0f)|(?:\ud83c[\udc04\udd70\udd71\udd7e\udd7f\ude02\ude1a\ude2f\ude37\udf21\udf24-\udf2c\udf36\udf7d\udf96\udf97\udf99-\udf9b\udf9e\udf9f\udfcd\udfce\udfd4-\udfdf\udff3\udff5\udff7]|\ud83d[\udc3f\udc41\udcfd\udd49\udd4a\udd6f\udd70\udd73\udd76-\udd79\udd87\udd8a-\udd8d\udda5\udda8\uddb1\uddb2\uddbc\uddc2-\uddc4\uddd1-\uddd3\udddc-\uddde\udde1\udde3\udde8\uddef\uddf3\uddfa\udecb\udecd-\udecf\udee0-\udee5\udee9\udef0\udef3]|[\u203c\u2049\u2139\u2194-\u2199\u21a9\u21aa\u231a\u231b\u2328\u23cf\u23ed-\u23ef\u23f1\u23f2\u23f8-\u23fa\u24c2\u25aa\u25ab\u25b6\u25c0\u25fb-\u25fe\u2600-\u2604\u260e\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262a\u262e\u262f\u2638-\u263a\u2640\u2642\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267b\u267f\u2692-\u2697\u2699\u269b\u269c\u26a0\u26a1\u26a7\u26aa\u26ab\u26b0\u26b1\u26bd\u26be\u26c4\u26c5\u26c8\u26cf\u26d1\u26d3\u26d4\u26e9\u26ea\u26f0-\u26f5\u26f8\u26fa\u26fd\u2702\u2708\u2709\u270f\u2712\u2714\u2716\u271d\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u2764\u27a1\u2934\u2935\u2b05-\u2b07\u2b1b\u2b1c\u2b50\u2b55\u3030\u303d\u3297\u3299])(?:\ufe0f|(?!\ufe0e))|(?:(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75\udd90]|[\u261d\u26f7\u26f9\u270c\u270d])(?:\ufe0f|(?!\ufe0e))|(?:\ud83c[\udf85\udfc2-\udfc4\udfc7\udfca]|\ud83d[\udc42\udc43\udc46-\udc50\udc66-\udc69\udc6e\udc70-\udc78\udc7c\udc81-\udc83\udc85-\udc87\udcaa\udd7a\udd95\udd96\ude45-\ude47\ude4b-\ude4f\udea3\udeb4-\udeb6\udec0\udecc]|\ud83e[\udd0f\udd18-\udd1c\udd1e\udd1f\udd26\udd30-\udd39\udd3d\udd3e\uddb5\uddb6\uddb8\uddb9\uddbb\uddcd-\uddcf\uddd1-\udddd]|[\u270a\u270b]))(?:\ud83c[\udffb-\udfff])?|(?:\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc73\udb40\udc63\udb40\udc74\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc77\udb40\udc6c\udb40\udc73\udb40\udc7f|\ud83c\udde6\ud83c[\udde8-\uddec\uddee\uddf1\uddf2\uddf4\uddf6-\uddfa\uddfc\uddfd\uddff]|\ud83c\udde7\ud83c[\udde6\udde7\udde9-\uddef\uddf1-\uddf4\uddf6-\uddf9\uddfb\uddfc\uddfe\uddff]|\ud83c\udde8\ud83c[\udde6\udde8\udde9\uddeb-\uddee\uddf0-\uddf5\uddf7\uddfa-\uddff]|\ud83c\udde9\ud83c[\uddea\uddec\uddef\uddf0\uddf2\uddf4\uddff]|\ud83c\uddea\ud83c[\udde6\udde8\uddea\uddec\udded\uddf7-\uddfa]|\ud83c\uddeb\ud83c[\uddee-\uddf0\uddf2\uddf4\uddf7]|\ud83c\uddec\ud83c[\udde6\udde7\udde9-\uddee\uddf1-\uddf3\uddf5-\uddfa\uddfc\uddfe]|\ud83c\udded\ud83c[\uddf0\uddf2\uddf3\uddf7\uddf9\uddfa]|\ud83c\uddee\ud83c[\udde8-\uddea\uddf1-\uddf4\uddf6-\uddf9]|\ud83c\uddef\ud83c[\uddea\uddf2\uddf4\uddf5]|\ud83c\uddf0\ud83c[\uddea\uddec-\uddee\uddf2\uddf3\uddf5\uddf7\uddfc\uddfe\uddff]|\ud83c\uddf1\ud83c[\udde6-\udde8\uddee\uddf0\uddf7-\uddfb\uddfe]|\ud83c\uddf2\ud83c[\udde6\udde8-\udded\uddf0-\uddff]|\ud83c\uddf3\ud83c[\udde6\udde8\uddea-\uddec\uddee\uddf1\uddf4\uddf5\uddf7\uddfa\uddff]|\ud83c\uddf4\ud83c\uddf2|\ud83c\uddf5\ud83c[\udde6\uddea-\udded\uddf0-\uddf3\uddf7-\uddf9\uddfc\uddfe]|\ud83c\uddf6\ud83c\udde6|\ud83c\uddf7\ud83c[\uddea\uddf4\uddf8\uddfa\uddfc]|\ud83c\uddf8\ud83c[\udde6-\uddea\uddec-\uddf4\uddf7-\uddf9\uddfb\uddfd-\uddff]|\ud83c\uddf9\ud83c[\udde6\udde8\udde9\uddeb-\udded\uddef-\uddf4\uddf7\uddf9\uddfb\uddfc\uddff]|\ud83c\uddfa\ud83c[\udde6\uddec\uddf2\uddf3\uddf8\uddfe\uddff]|\ud83c\uddfb\ud83c[\udde6\udde8\uddea\uddec\uddee\uddf3\uddfa]|\ud83c\uddfc\ud83c[\uddeb\uddf8]|\ud83c\uddfd\ud83c\uddf0|\ud83c\uddfe\ud83c[\uddea\uddf9]|\ud83c\uddff\ud83c[\udde6\uddf2\uddfc]|\ud83c[\udccf\udd8e\udd91-\udd9a\udde6-\uddff\ude01\ude32-\ude36\ude38-\ude3a\ude50\ude51\udf00-\udf20\udf2d-\udf35\udf37-\udf7c\udf7e-\udf84\udf86-\udf93\udfa0-\udfc1\udfc5\udfc6\udfc8\udfc9\udfcf-\udfd3\udfe0-\udff0\udff4\udff8-\udfff]|\ud83d[\udc00-\udc3e\udc40\udc44\udc45\udc51-\udc65\udc6a-\udc6d\udc6f\udc79-\udc7b\udc7d-\udc80\udc84\udc88-\udca9\udcab-\udcfc\udcff-\udd3d\udd4b-\udd4e\udd50-\udd67\udda4\uddfb-\ude44\ude48-\ude4a\ude80-\udea2\udea4-\udeb3\udeb7-\udebf\udec1-\udec5\uded0-\uded2\uded5\udeeb\udeec\udef4-\udefa\udfe0-\udfeb]|\ud83e[\udd0d\udd0e\udd10-\udd17\udd1d\udd20-\udd25\udd27-\udd2f\udd3a\udd3c\udd3f-\udd45\udd47-\udd71\udd73-\udd76\udd7a-\udda2\udda5-\uddaa\uddae-\uddb4\uddb7\uddba\uddbc-\uddca\uddd0\uddde-\uddff\ude70-\ude73\ude78-\ude7a\ude80-\ude82\ude90-\ude95]|[\u23e9-\u23ec\u23f0\u23f3\u267e\u26ce\u2705\u2728\u274c\u274e\u2753-\u2755\u2795-\u2797\u27b0\u27bf\ue50a])|\ufe0f/g)&&I.__esModule?I:{default:I};var P=j.TypeName="emoji";var C=/\uFE0F/g,M=String.fromCharCode(8205),E=function(e){return e.indexOf(M)<0?e.replace(C,""):e};function D(e){for(var t=[],d=0,a=0,r=0;r<e.length;)d=e.charCodeAt(r++),a?(t.push((65536+(a-55296<<10)+(d-56320)).toString(16)),a=0):d>55296&&d<=56319?a=d:t.push(d.toString(16));return t}let L=0,z=0,R=!1,N=0;function B(e=0){if(R=!0,c.target_versions){Object.keys(pe).forEach(e=>{Array.isArray(ue)?pe[e].target.forEach(e=>{e.visible=!1}):pe[e].target.visible=!1,pe[e].target_overlay.forEach(e=>{e.visible=!1})});const e=k(Object.keys(pe).length);he=Object.keys(pe)[e],ue=pe[he].target,oe=pe[he].target_overlay,Array.isArray(ue)?ue[ce].visible=!0:ue.visible=!0,oe[le].visible=!0}e>0&&(z=1e3*e)}function q(){R=!1,Array.isArray(ue)&&(ue[ce].visible=!1,ce=0,ue[ce].visible=!0),oe&&Array.isArray(oe)&&(oe[le].visible=!1,le=0,oe[le].visible=!0),se&&Array.isArray(se)&&(se[fe].visible=!1,fe=0,se[fe].visible=!0)}let F=0,J=!0,G={},W=!1,Y=null,X=0;async function V(e,t,d,a,r){if(document.hidden)return;(a.broadcaster||a.mod)&&await async function(e,t,d,a,r){switch(t){case"resetparachute":case"resetdrop":if(l.variations){const e=l.variations.split(","),t=k(e.length),d=`${window.location.protocol}//${window.location.host}${window.location.pathname.substr(0,window.location.pathname.lastIndexOf("/"))}/${e[t]}${window.location.search}`;window.location.href=d}else location.reload();break;case"deleteparachute":case"deletedrop":{let e=await ComfyJS.GetChannelRewards(x,!0),t=Object.keys(w);for(let d=0;d<t.length;d++){let a=t[d],r=e.find(e=>e.title===a);r&&await ComfyJS.DeleteChannelReward(x,r.id)}break}case"raiddrop":X=1e3*parseInt(d||60),console.log("Raid mode activated"),ComfyJS.Say(`/me Drop raid activated for ${X/1e3} seconds`);break;case"unqueuedrop":W&&(ComfyJS.Say("/me Group drop is no longer queued."),W=!1);break;case"queuedrop":W?ComfyJS.Say("/me Group drop is already queued."):(K(),W=!0,ComfyJS.Say("/me Drops are queued this game. Mods can now type !startdrop to activate!"));break;case"startdrop":if(W){let e=Object.keys(G);$(e),e.forEach(e=>{const t=G[e];ze(t.username,t.name,t.color,t.message,t.selectedPara||c.parachutes[k(c.parachutes.length)],t.selectedPetPara||c.petparachutes[k(c.petparachutes.length)],t.emote,t.emoji,t.extra)}),G={}}break;case"queuecount":W&&ComfyJS.Say(`/me ${Object.keys(G).length} people are ready to drop`);break;case"testdrop":for(var u=0;u<50;u++)F++,ze("test_"+F,"test_"+F,r.userColor||"#ffffff",Object.keys(c.characters)[k(Object.keys(c.characters).length)],c.parachutes[k(c.parachutes.length)],c.petparachutes[k(c.petparachutes.length)],"","",r);break;case"droplet":{let e=parseInt(d||Math.pow(10,k(6)));for(let t=0;t<5;t++)Re(e);break}}}(0,t,d,0,r),await async function(e,t,d,a,r){switch(t){case"drophigh":case"drophighscore":case"dropbest":if(l.oauth){let e=await async function(){if(l.oauth){const e=new Date;e.setDate(e.getDate()-1);const t=e.toISOString().split("T")[0];return(await fetch(`${s}/scores/high?channel=${l.channel}&game=${i}&date=${t}`,{method:"GET"}).then(e=>e.json()))[0]}return null}();e&&e.score&&ComfyJS.Say(`/me The highest score in the past 24 hours is ${e.score} by ${e.user}`)}break;case"droplow":case"droplowscore":case"dropworst":if(l.oauth){let e=await async function(){if(l.oauth){const e=new Date;e.setDate(e.getDate()-1);const t=e.toISOString().split("T")[0];return(await fetch(`${s}/scores/low?channel=${l.channel}&game=${i}&date=${t}`,{method:"GET"}).then(e=>e.json()))[0]}return null}();e&&e.score&&ComfyJS.Say(`/me The lowest score in the past 24 hours is ${e.score} by ${e.user}`)}break;case"droptop":case"droptopscores":case"dropleaderboard":case"dropscores":if(l.oauth){let e=await async function(){if(l.oauth){const e=new Date;e.setDate(e.getDate()-1);const t=e.toISOString().split("T")[0];return await fetch(`${s}/scores/high?channel=${l.channel}&game=${i}&date=${t}`,{method:"GET"}).then(e=>e.json())}return[]}();if(e&&e.length>0){let t=Array.from(new Set(e.map(e=>e.userId))).slice(0,10).map(t=>e.find(e=>e.userId===t));ComfyJS.Say("/me Top players in the past 24 hours are "+t.map((e,t)=>`${t+1}. ${e.user} (${e.score})`).join(", "))}else ComfyJS.Say("/me There are no scores recorded in the past 24 hours")}break;case"droprecent":if(l.oauth){let e=await async function(){if(l.oauth){return await fetch(`${s}/scores/recent?channel=${l.channel}&game=${i}`,{method:"GET"}).then(e=>e.json())}return[]}();if(e&&e.length>0){let t=Array.from(new Set(e.map(e=>e.userId))).slice(0,10).map(t=>e.find(e=>e.userId===t));ComfyJS.Say("/me Latest scores are "+t.map((e,t)=>`${e.user} (${e.score})`).join(", "))}else ComfyJS.Say("/me There are no recent scores")}}}(0,t);let u=!1;if(!l.commandOn&&l.cpDrop||(u=t===l.command),("instafriend"===r.channel||"maaya"===r.channel)&&"testoutfit"===t){u=!0,d={body:{skintones:"skin1",expressions:"expr1",hair:"hair1"},outfits:{pants:"pants1",shirts:"shirt1"},accessories:{hats:"party_hat_pink"}}}if(l.outfit&&"outfit"===t){u=!0,Y||(Y=await fetch("https://www.pixelplush.dev/assets/catalog_outfits.json").then(e=>e.json()));let e={};for(const t of Y)e[t.type]||(e[t.type]=[]),e[t.type].push(t);let t={};if(Math.random()<.1){const d=e.equipment[k(e.equipment.length)];t.equipment={[d.group]:d.path}}const a=e.body.filter(e=>"skintones"===e.group),r=e.body.filter(e=>"expressions"===e.group),o=e.body.filter(e=>"hair"===e.group),s=a[k(a.length)],n=r[k(r.length)],i=o[k(o.length)];if(t.body={skintones:s.path,expressions:n.path,hair:i.path},Math.random()<.05);else{const d=e.outfits.filter(e=>"dresses"===e.group),a=e.outfits.filter(e=>"pants"===e.group),r=e.outfits.filter(e=>"shirts"===e.group);t.outfits={},Math.random()<.25&&(t.outfits.dresses=d[k(d.length)].path),Math.random()<.95&&(t.outfits.pants=a[k(a.length)].path),Math.random()<.95&&(t.outfits.shirts=r[k(r.length)].path)}let c={};for(const t of e.accessories)c[t.group]||(c[t.group]=[]),c[t.group].push(t);let l=Object.keys(c);t.accessories={};for(const e of l)Math.random()<.5&&(t.accessories[e]=c[e][k(c[e].length)].path);d=t}if(v)if(_){if(u){J&&l.hideTilDrop&&(J=!1,xe.forEach(e=>e.visible=!0),ie.forEach(e=>e.isSensor=!1),Array.isArray(ue)?(ue[ce].visible=!0,c.target_animate_on_landed||B()):ue.visible=!0,oe&&(Array.isArray(oe)?(oe[le].visible=!0,c.target_animate_on_landed||B()):oe.visible=!0),se&&(Array.isArray(se)?se[fe].visible=!0:se.visible=!0),ne&&(ne.visible=!0),l.spawnZombies&&Ue.forEach(e=>{e.isHidden=!1,e.position.y=h-40}));const a=j.parse(d,{assetType:"png"});if(!r.messageEmotes&&a.length>0)W?G[r.username]={username:r.username,name:e,color:r.userColor||"#ffffff",message:d,emote:"",emoji:a[0].url,extra:r}:ze(r.username,e,r.userColor||"#ffffff",d,c.parachutes[k(c.parachutes.length)],c.petparachutes[k(c.petparachutes.length)],"",a[0].url,r);else if(c.pridechutes){const a=Object.keys(c.pridechutes),u=r.messageEmotes?Object.keys(r.messageEmotes):[],o=u.map(e=>{const a=r.messageEmotes[e][0].split("-").map(e=>parseInt(e));return`!${t} ${d}`.substring(a[0],a[1]+1)}),s=o.filter(e=>e.toLowerCase().includes("pride"));let n=a.find(e=>s.some(t=>t.toLowerCase().includes(e)));if(n){const t=c.pridechutes[n];let a=u.find((e,t)=>!o[t].toLowerCase().includes(n));W?G[r.username]={username:r.username,name:e,color:r.userColor||"#ffffff",message:d,selectedPara:t,selectedPetPara:t,emote:a,emoji:"",extra:r}:ze(r.username,e,r.userColor||"#ffffff",d,t,t,a,"",r)}else W?G[r.username]={username:r.username,name:e,color:r.userColor||"#ffffff",message:d,emote:r.messageEmotes?Object.keys(r.messageEmotes)[0]:"",emoji:"",extra:r}:ze(r.username,e,r.userColor||"#ffffff",d,c.parachutes[k(c.parachutes.length)],c.petparachutes[k(c.petparachutes.length)],r.messageEmotes?Object.keys(r.messageEmotes)[0]:"","",r)}else W?G[r.username]={username:r.username,name:e,color:r.userColor||"#ffffff",message:d,emote:r.messageEmotes?Object.keys(r.messageEmotes)[0]:"",emoji:"",extra:r}:ze(r.username,e,r.userColor||"#ffffff",d,c.parachutes[k(c.parachutes.length)],c.petparachutes[k(c.petparachutes.length)],r.messageEmotes?Object.keys(r.messageEmotes)[0]:"","",r)}}else u&&l.oauth&&ComfyJS.Say("The Parachute Drop game needs your attention. Please contact the PixelPlush team on Discord.")}function Z(e,t,d,a,r){document.hidden||X>0&&(ye[e]||V(e,l.command,t,d,r))}function H(e,t,d,a,r){if(!document.hidden&&v&&_){for(let e=0;e<5;e++)Re(t);if(t.startsWith("!")){let d=t.split(/ (.*)/);V(e,d[0].slice(1).toLowerCase(),d[1]||"",a,r)}}}function Q(e,t,d){document.hidden||v&&_&&l.raidMode&&(X=parseInt(l.raidMode),console.log("Raid mode activated"),ComfyJS.Say(`/me Drop raid activated for ${X/1e3} seconds`))}function K(){Object.keys(ye).forEach(e=>{Unicorn.RemoveBacklay("para_"+e),Unicorn.RemoveBacklay("petpara_"+e),ye[e].player.cleanup(),ye[e].pet&&ye[e].pet.cleanup(),Unicorn.RemoveText("name_"+e),Unicorn.RemoveBacklay("end_"+e),Unicorn.RemoveBacklay("petend_"+e),Unicorn.RemoveText(e+"_points"),delete ye[e]}),ee.x=-1e3,ee.y=-1e3,ge="",me=0,te&&clearTimeout(te),Ne()}let ee,te=null,de=368,ae=0,re=0,ue=null,oe=null,se=null,ne=null,ie=[],ce=0,le=0,fe=0,pe={},he=null,ye={},me=0,ge="",be={},_e={},xe=[],ve=[],we=[],ke=[],$e=[],Se=[],Ae="zombie",Ue=[],Oe=[],je={},Ie=0;function Te(e,t,d,a,r,u=""){Ie++;let o=Math.min(Math.max(1,r),100);Unicorn.AddParticles("Splash_"+Ie,{blendMode:PIXI.BLEND_MODES.DEFAULT,shape:"cone",angle:-Math.PI/2,spread:Math.PI/2,startColor:e,endColor:t,intensity:o,minSpeed:.05,maxSpeed:.25,gravityX:0,gravityY:3.5,fadeOut:!0,decay:1,image:u||void 0},d,a),function(e,t=2e3){setTimeout(()=>{Unicorn.RemoveParticles(e)},t)}("Splash_"+Ie,150)}function Pe(e,t,d,a=""){const r=c.target_boosh_scale||2;c.target_boosh.forEach((d,a)=>{for(let d=0;d<k(5);d++){Ie++;let d=Unicorn.AddBacklay("boosh_"+Ie,"target_boosh"+a,e,t+10,{scale:{x:r,y:r}});d.label="boosh_"+Ie,d.zIndex=11,d.vX=k(50)-25,d.vY=-350+k(100),d.anchor.set(.5),ve.push(d)}})}function Ce(e,t,d,a=""){const r=c.target_splash_scale||2;c.target_splash.forEach((d,a)=>{for(let d=0;d<k(2);d++){Ie++;let d=Unicorn.AddBacklay("splash_"+Ie,"target_splash"+a,e,t+10,{scale:{x:r,y:r}});d.label="splash_"+Ie,d.zIndex=11,d.vX=k(100)-50,d.vY=-300+k(100),d.anchor.set(.5),we.push(d)}})}function Me(e,t){const d=[];for(let a=0;a<13;a++){Ie++;const r=Unicorn.AddOverlay("splishsplash_"+Ie,"target_splishsplash"+a,e,t,{scale:{x:2,y:2}});r.visible=!1,r.label="splishsplash_"+Ie,r.zIndex=11,r.anchor.set(.5),d.push(r)}d[0].visible=!0,$e.push({splishes:d,timer:0,frame:0})}function Ee(e,t,d=""){for(let d=0;d<2;d++){const a=k(c.target_floaty.length);Ie++;const r=k(10),u=k(10),o=d*Math.PI;let s=Unicorn.AddBacklay("floaty_"+Ie,"target_floaty"+a,e-5+r,t+u,{scale:{x:3,y:3}});s.timeOffset=o,s.label="floaty_"+Ie,s.zIndex=11,s.refX=e,s.refY=t,s.lifetime=3,s.anchor.set(.5),Se.push(s)}}function De(e,t){const d=k(100)-50;Ie++;let a=Unicorn.AddOverlay("sticky_"+Ie,"target_sticky"+(d<0?0:1),e,t+10,{scale:{x:3,y:3}});a.label="sticky_"+Ie,a.zIndex=200,a.vX=d,a.vY=-200+k(100),a.anchor.set(.5),ke.push(a)}function Le(e,t,d={}){Te("#ffffff","#ffffff",e,t+40,5);let a=o(e,t,200,{pet:d},16/60);a.isSensor=!0,a.isStatic=!0,a.walkDirection=k(2)>0?"left":"right",a.walkSpeed=120,Unicorn.PlayObjectAnimation(a.charName,a.walkDirection),Oe.push(a)}async function ze(e,t,a="#ffffff",n,i,c,f="",h="",m){let g=4/60;if(!ye[e]){ye[e]={};let b=null,_=null,x=null,v=tinycolor(a),w=await async function(e){let t={};try{if(!e)return t;let d=await fetch(`${s}/accounts/twitch/design?username=${e}`).then(e=>e.json());return d&&(t=d.style||{}),t}catch(e){console.log(e)}}(e);if(f){if(!be[f]){if(be[f]=!0,f.startsWith("emotesv2_")){let d=`https://static-cdn.jtvnw.net/emoticons/v2/${f}/default/dark/2.0`,r=await fetchGif(d);if(r.length>0){const d=function(e,t){const d=Math.min(...e.map(e=>e.delay)),a=Math.max(...e.map(e=>e.dims.width)),r=Math.max(...e.map(e=>e.dims.height));let u=0,o=null;for(let s=0;s<e.length;s++){const n=S(e[s].disposalType,a,r,e[s],o);o=n.data;for(let o=0;o<e[s].delay;o+=d)Unicorn.LoadCustom(`${t}${u}`,n.canvas,"texture",{width:a,height:r}),u++}return{frames:u,minDelay:d,width:a,height:r}}(r,"emote_"+f);be[f]={frames:d.frames,framerate:1/60*(1e3/d.minDelay)},setTimeout(()=>{delete ye[e],ze(e,t,a,n,i,c,f,h,m)},500)}else Unicorn.Load(`emote_${f}0`,d),setTimeout(()=>{delete ye[e],ze(e,t,a,n,i,c,f,h,m)},500)}else{let d=`https://static-cdn.jtvnw.net/emoticons/v1/${f}/2.0`;Unicorn.Load(`emote_${f}0`,d),setTimeout(()=>{delete ye[e],ze(e,t,a,n,i,c,f,h,m)},500)}return}let r=[];if(f.startsWith("emotesv2_")&&"boolean"!=typeof be[f]){g=be[f].framerate;for(let e=0;e<be[f].frames;e++)r.push(`emote_${f}${e}`)}else r=[`emote_${f}0`];b=d({x:k(p),y:-100-k(50),z:100,radius:36,scale:1.2,name:"player_"+e,framerate:be[f].framerate,animations:{front:{numFrames:r.length,prefix:"emote_"+f}}}),b.charName="player_"+e,b.endImage=r[0],b.endScale=1.2}else if(h){if(!_e[h])return _e[h]=!0,Unicorn.Load(`emoji_${h}0`,h),void setTimeout(()=>{delete ye[e],ze(e,t,a,n,i,c,f,h,m)},500);b=d({x:k(p),y:-100-k(50),z:100,radius:36,scale:1,name:"player_"+e,animations:{front:{numFrames:1,prefix:"emoji_"+h}}}),b.charName="player_"+e,b.endImage=`emoji_${h}0`,b.endScale=1}else b="instafriend"===m.channel||"maaya"===m.channel?"string"!=typeof n?u(k(p),-100-k(50),100,n):w.outfit?u(k(p),-100-k(50),100,w.outfit):r(k(p),-100-k(50),100,w,n):"string"==typeof n?r(k(p),-100-k(50),100,w,n):u(k(p),-100-k(50),100,n);x=o(-1e3,-1e3,200,w),x&&(_=x.petName);let $=Unicorn.AddBacklay("para_"+e,i,{scale:{x:0,y:0},x:-50,y:0,z:50});$.visible=!1,$.zIndex=11,$.scale.x=0,$.scale.y=0,$.anchor.set(.5,1);let A=Unicorn.AddText("name_"+e,t,-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:34,fontWeight:400,fill:a,lineJoin:"round",stroke:tinycolor.isReadable(v.toString(),"#000000")?"#000000":"#ffffff",strokeThickness:6});A.anchor.set(.5);let U=Unicorn.AddText(e+"_points","",-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:34,fontWeight:400,fill:"#ffd700",lineJoin:"round",stroke:"#000000",strokeThickness:6});U.anchor.set(.5);let O=null;_&&(O=Unicorn.AddBacklay("petpara_"+e,c||i,{scale:{x:0,y:0},x:-50,y:0,z:150}),O.visible=!1,O.zIndex=11,O.scale.x=0,O.scale.y=0,O.anchor.set(.5,1)),b.restitution=1,b.friction=0,b.frictionStatic=0,b.frictionAir=0,b.torque=-5+k(10),b.rotationOffset=Math.random()*Math.PI,Unicorn.SetVelocity(b.charName,k(24)-12,0),ye[e]={style:w,parachute:$,player:b,pet:x,petPara:O,petType:_,petOffset:30*Math.random()+(Math.random()>.5?-150:70),label:A,scoreLabel:U,nameColor:v},m&&(ye[e].userId=m.userId,ye[e].name=m.displayName||m.username),i&&i.includes("chute_plane")&&(ye[e].paraFlipDir=!0),c&&c.includes("chute_plane")&&(ye[e].petParaFlipDir=!0),Unicorn.PlaySound("sfx-parachute-drop",{volume:y}),te&&clearTimeout(te),te=setTimeout(()=>{if(l.variations){const e=l.variations.split(","),t=k(e.length),d=`${window.location.protocol}//${window.location.host}${window.location.pathname.substr(0,window.location.pathname.lastIndexOf("/"))}/${e[t]}${window.location.search}`;window.location.href=d}else K()},parseInt(l.cooldown||"90000"))}}async function Re(e){if(!l.droplets)return;Ie++;let t=null,d=0;d=k(c.droplets?c.droplets.length:6);let a=3;c.dropletSizes&&(a*=c.dropletSizes[d]);let r=c.droplets[d];Array.isArray(c.droplets[d])&&(r=c.droplets[d][k(c.droplets[d].length)]),t=Unicorn.AddObject("droplet_"+Ie,{type:"circle",sprite:r,scale:{x:1.5,y:1.5},x:k(p),y:-100-k(50),z:100,radius:.75*assetReference[r].width}),t.restitution=1,t.friction=.5*(5-d),t.frictionStatic=0,t.frictionAir=0,t.torque=-1+k(2),t.rotationOffset=Math.random()*Math.PI,t.mass*=20,je[t.label]=t,Unicorn.SetVelocity("droplet_"+Ie,k(24)-12,0),setTimeout(()=>{delete je[t.label],Unicorn.RemoveObject(t.label)},3e4)}function Ne(){if(J=!0,G={},W=!1,de=c.target_width||368,ae=de/2+k(p-de),re=h-47+(c.target_offset||0),c.target_walls&&(ae<de/2+70?ae=de/2+70:ae>p-de/2-70&&(ae=p-de/2-70)),c.target_versions){const e=k(Object.keys(c.target_versions).length);Object.keys(c.target_versions).forEach((t,d)=>{e===d&&(he=t);let a=c.target_versions[t];if(pe[t]={},Array.isArray(a.target))if(c.target_random){ue&&Unicorn.RemoveBacklay("target"+t);let e=k(a.target.length);ue=Unicorn.AddBacklay("target"+t,"target"+t+e,ae,re,{scale:{x:2,y:2}}),ue.zIndex=10,ue.anchor.set(.5),ue.visible=!1,pe[t].target=ue}else{if(ue)for(let e=0;e<ue.length;e++)ue[e]&&Unicorn.RemoveBacklay("target"+t+e);ce=0,ue=[];for(let e=0;e<a.target.length;e++){let d=Unicorn.AddBacklay("target"+t+e,"target"+t+e,ae,re,{scale:{x:2,y:2}});d.zIndex=10,d.anchor.set(.5),d.visible=!1,ue.push(d)}pe[t].target=ue,ue[ce].visible=!1,l.hideTilDrop||c.target_animate_on_landed||B()}else ue&&Unicorn.RemoveBacklay("target"+t),ue=Unicorn.AddBacklay("target"+t,"target"+t,ae,re,{scale:{x:2,y:2}}),ue.zIndex=10,ue.anchor.set(.5),ue.visible=!1,pe[t].target=ue;if(a.target_overlay)if(Array.isArray(a.target_overlay)){if(oe)for(let e=0;e<oe.length;e++)oe[e]&&Unicorn.RemoveBacklay("target_overlay"+t+e);le=0,oe=[];for(let e=0;e<a.target_overlay.length;e++){let d=Unicorn.AddBacklay("target_overlay"+t+e,"target_overlay"+t+e,ae,re+(c.target_overlay_offset||0),{scale:{x:2,y:2}});d.zIndex=11,d.anchor.set(.5),d.visible=!1,oe.push(d)}pe[t].target_overlay=oe,oe[le].visible=!1,l.hideTilDrop||c.target_animate_on_landed||B()}else oe&&Unicorn.RemoveBacklay("target_overlay"+t),oe=Unicorn.AddBacklay("target_overlay"+t,"target_overlay"+t,ae,re,{scale:{x:2,y:2}}),oe.zIndex=11,oe.anchor.set(.5),oe.visible=!1,pe[t].target_overlay=oe})}else{if(Array.isArray(c.target))if(c.target_random){ue&&Unicorn.RemoveBacklay("target");let e=k(c.target.length);ue=Unicorn.AddBacklay("target","target"+e,ae,re,{scale:{x:2,y:2}}),ue.zIndex=10,ue.anchor.set(.5)}else{if(ue)for(let e=0;e<ue.length;e++)ue[e]&&Unicorn.RemoveBacklay("target"+e);ce=0,ue=[];for(let e=0;e<c.target.length;e++){let t=Unicorn.AddBacklay("target"+e,"target"+e,ae,re,{scale:{x:2,y:2}});t.zIndex=10,t.anchor.set(.5),t.visible=!1,ue.push(t)}ue[ce].visible=!0,l.hideTilDrop||c.target_animate_on_landed||B()}else ue&&Unicorn.RemoveBacklay("target"),ue=Unicorn.AddBacklay("target","target",ae,re,{scale:{x:2,y:2}}),ue.zIndex=10,ue.anchor.set(.5);if(c.target_overlay)if(Array.isArray(c.target_overlay)){if(oe)for(let e=0;e<oe.length;e++)oe[e]&&Unicorn.RemoveBacklay("target_overlay"+e);le=0,oe=[];for(let e=0;e<c.target_overlay.length;e++){let t=Unicorn.AddBacklay("target_overlay"+e,"target_overlay"+e,ae,re+(c.target_overlay_offset||0),{scale:{x:2,y:2}});t.zIndex=11,t.anchor.set(.5),t.visible=!1,oe.push(t)}oe[le].visible=!0,l.hideTilDrop||c.target_animate_on_landed||B()}else oe&&Unicorn.RemoveBacklay("target_overlay"),oe=Unicorn.AddBacklay("target_overlay","target_overlay",ae,re,{scale:{x:2,y:2}}),oe.zIndex=11,oe.anchor.set(.5)}if(c.target_frontlay)if(Array.isArray(c.target_frontlay)){if(se)for(let e=0;e<se.length;e++)se[e]&&Unicorn.RemoveOverlay("target_frontlay"+e);fe=0,se=[];for(let e=0;e<c.target_frontlay.length;e++){let t=Unicorn.AddOverlay("target_frontlay"+e,"target_frontlay"+e,ae,re+(c.target_overlay_offset||0),{scale:{x:2,y:2}});t.zIndex=12,t.anchor.set(.5),t.visible=!1,se.push(t)}se[fe].visible=!0,l.hideTilDrop||c.target_animate_on_landed||B()}else se&&Unicorn.RemoveOverlay("target_frontlay"),se=Unicorn.AddOverlay("target_frontlay","target_frontlay",ae,re,{scale:{x:2,y:2}}),se.zIndex=2,se.anchor.set(.5);if(c.target_front&&(ne&&Unicorn.RemoveOverlay("target_front"),ne=Unicorn.AddOverlay("target_front","target_front",ae,re,{scale:{x:2,y:2}}),ne.zIndex=100,ne.anchor.set(.5)),l.clouds&&0===xe.length)for(let e=0;e<11;e++){F++;let e=c.clouds[k(c.clouds.length)],t=Unicorn.AddOverlay("cloud_"+F,e,k(p),k(500),{scale:{x:3,y:3}});t.alpha=l.overlay?.5:.9,t.anchor.set(.5),t.speed=.01+.1*Math.random(),t.zIndex=t.speed,xe.push(t)}if(c.target_walls){ie.length>0&&(Unicorn.RemoveObject("TargetTop"),Unicorn.RemoveObject("TargetLeft"),Unicorn.RemoveObject("TargetRight"),ie=[]);let e=Unicorn.AddObject("TargetTop",{type:"rectangle",x:ae,y:re+c.target_walls/2+c.target_collide_land,width:de-50,height:10,isStatic:!0});e.sprite.visible=!1;let t=Unicorn.AddObject("TargetLeft",{type:"rectangle",x:ae-de/2+27,y:re+c.target_walls,width:10,height:100,isStatic:!0});t.sprite.visible=!1;let d=Unicorn.AddObject("TargetRight",{type:"rectangle",x:ae+de/2-27,y:re+c.target_walls,width:10,height:100,isStatic:!0});d.sprite.visible=!1,ie.push(e),ie.push(t),ie.push(d)}l.hideTilDrop&&(xe.forEach(e=>e.visible=!1),ie.forEach(e=>e.isSensor=!0),c.target_animate_on_landed||(q(),oe&&Array.isArray(oe)&&(oe[le].visible=!1),se&&Array.isArray(se)&&(se[fe].visible=!1)),Array.isArray(c.target)&&!c.target_random?ue.forEach(e=>{e.visible=!1}):ue.visible=!1,oe&&(Array.isArray(c.target_overlay)&&!c.target_random?oe.forEach(e=>{e.visible=!1}):oe.visible=!1),se&&(Array.isArray(c.target_frontlay)&&!c.target_random?se.forEach(e=>{e.visible=!1}):se.visible=!1),ne&&(ne.visible=!1));for(let e=0;e<ve.length;e++){let t=ve[e];Unicorn.RemoveBacklay(t.label)}ve=[];for(let e=0;e<we.length;e++){let t=we[e];Unicorn.RemoveBacklay(t.label)}we=[];for(let e=0;e<ke.length;e++){let t=ke[e];Unicorn.RemoveOverlay(t.label)}ke=[];for(let e=0;e<Oe.length;e++){let t=Oe[e];Unicorn.RemoveObject(t.charName)}if(Oe=[],l.spawnZombies){const e=l.spawnZombies.split(",").map(e=>e.trim());Ae=e[k(e.length)];const t=1;for(let e=0;e<t;e++){let e=k(p);Math.abs(ae-e)<de/2+10&&(e=ae+(e<ae?-de/2-10:de/2+10));let t=r(e,h-40,110,{character:{id:Ae,path:Ae}});t.isSensor=!0,t.isStatic=!0,l.hideTilDrop&&(t.isHidden=!0,t.position.y=h+100),t.timeTilNextWalk=3e3+k(27e3),t.walkDirection=k(2)>0?"left":"right",Unicorn.PlayObjectAnimation(t.charName,t.walkDirection),Ue.push(t)}}setTimeout(()=>{document.querySelector("#unicorn-display > canvas").removeAttribute("hidden")},2e3)}function Be(){if(document.querySelector("#unicorn-display > canvas").setAttribute("hidden","hidden"),PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,Unicorn.Load("bg",`${f}/assets/${c.bg}.png`),!l.overlay){let e=Unicorn.AddBacklay("bg","bg",0,h-1080);e.scale.x=3,e.scale.y=3}if(c.target_versions)Object.keys(c.target_versions).forEach(e=>{let t=c.target_versions[e];if(Array.isArray(t.target)){t.target.map((t,d)=>Unicorn.Load("target"+e+d,`${f}/assets/${t}.png`))}else{Unicorn.Load("target"+e,`${f}/assets/${t.target}.png`)}if(Array.isArray(t.target_overlay)){t.target_overlay.map((t,d)=>Unicorn.Load("target_overlay"+e+d,`${f}/assets/${t}.png`))}else{Unicorn.Load("target_overlay"+e,`${f}/assets/${t.target_overlay}.png`)}if(t.target_effect){t.target_effect.map((t,d)=>Unicorn.Load("target_effect"+e+d,`${f}/assets/${t}.png`))}});else{if(Array.isArray(c.target)){c.target.map((e,t)=>Unicorn.Load("target"+t,`${f}/assets/${e}.png`))}else{Unicorn.Load("target",`${f}/assets/${c.target}.png`)}if(Array.isArray(c.target_overlay)){c.target_overlay.map((e,t)=>Unicorn.Load("target_overlay"+t,`${f}/assets/${e}.png`))}else if(c.target_overlay){Unicorn.Load("target_overlay",`${f}/assets/${c.target_overlay}.png`)}if(Array.isArray(c.target_frontlay)){c.target_frontlay.map((e,t)=>Unicorn.Load("target_frontlay"+t,`${f}/assets/${e}.png`))}else if(c.target_frontlay){Unicorn.Load("target_frontlay",`${f}/assets/${c.target_frontlay}.png`)}if(c.target_effect){c.target_effect.map((e,t)=>Unicorn.Load("target_effect"+t,`${f}/assets/${e}.png`))}}c.target_front&&Unicorn.Load("target_front",`${f}/assets/${c.target_front}.png`),c.target_boosh&&c.target_boosh.forEach((e,t)=>{Unicorn.Load("target_boosh"+t,`${f}/assets/${e}.png`)}),c.target_splash&&c.target_splash.forEach((e,t)=>{Unicorn.Load("target_splash"+t,`${f}/assets/${e}.png`)}),c.target_floaty&&c.target_floaty.forEach((e,t)=>{Unicorn.Load("target_floaty"+t,`${f}/assets/${e}.png`)}),c.target_stickies&&c.target_stickies.forEach((e,t)=>{Unicorn.Load("target_sticky"+t,`${f}/assets/${e}.png`)}),c.target_splishsplash&&c.target_splishsplash.forEach((e,t)=>{Unicorn.Load("target_splishsplash"+t,`${f}/assets/${e}.png`)}),Unicorn.Load("star",f+"/assets/icons/star.png"),ee=Unicorn.AddOverlay("star","star",-1e3,-1e3,{scale:{x:3,y:3}}),ee.anchor.set(.5),c.parachutes.forEach(e=>Unicorn.Load(e,`${f}/assets/${e}.png`)),c.petparachutes?c.petparachutes.forEach(e=>Unicorn.Load(e,`${f}/assets/${e}.png`)):c.petparachutes=[],c.pridechutes&&Object.keys(c.pridechutes).forEach(e=>Unicorn.Load(c.pridechutes[e],`${f}/assets/${c.pridechutes[e]}.png`)),Object.keys(c.characters).forEach(e=>{U(e,"characters",c.characters[e],m.NumFrames)}),c.clouds.forEach(e=>Unicorn.Load(e,`${f}/assets/${e}.png`)),c.droplets.forEach(e=>{Array.isArray(e)?e.forEach(e=>Unicorn.Load(e,`${f}/assets/${e}.png`)):Unicorn.Load(e,`${f}/assets/${e}.png`)}),c.target_sound&&Unicorn.Load("sfx-target-drop",`${f}/assets/${c.target_sound}`),l.notifVolume&&Unicorn.Load("sfx-group-queue",`${f}/assets/${c.queue_sound}`),Unicorn.Load("sfx-parachute-drop",`${f}/assets/${c.drop_sound}`),Unicorn.Load("sfx-parachute-flap",`${f}/assets/${c.parachute_sound}`),Unicorn.AddObject("WallLeft",{type:"rectangle",x:-200,y:0,width:400,height:2*h,friction:0,frictionAir:0,frictionStatic:0,bounce:1.1,isStatic:!0}).sprite.visible=!1,Unicorn.AddObject("WallRight",{type:"rectangle",x:p+200,y:0,width:400,height:2*h,friction:0,frictionAir:0,frictionStatic:0,bounce:1.1,isStatic:!0}).sprite.visible=!1,Unicorn.AddObject("WallBottom",{type:"rectangle",x:.5*p,y:h+100,friction:0,frictionAir:0,frictionStatic:0,bounce:1,width:p,height:200,isStatic:!0}).sprite.visible=!1,Matter.Events.on(physics,"beforeUpdate",(function(e){const t=Object.keys(ye);for(let e=0;e<t.length;e++){const d=t[e],a=ye[d];a.player&&(Math.abs(a.player.velocity.x)>50&&Matter.Body.setVelocity(a.player,{x:50*(a.player.velocity.x<0?-1:1),y:a.player.velocity.y}),a.player.velocity.y<-50&&Matter.Body.setVelocity(a.player,{x:a.player.velocity.x,y:-50}),a.player.position.y<.5*-h?a.player.velocity.y>10&&Matter.Body.setVelocity(a.player,{x:a.player.velocity.x,y:10}):a.player.position.y>300&&a.player.velocity.y>.5&&Matter.Body.setVelocity(a.player,{x:a.player.velocity.x,y:.5}))}const d=Object.keys(je);for(let e=0;e<d.length;e++){const t=d[e],a=je[t];Math.abs(a.velocity.x)>50&&Matter.Body.setVelocity(a,{x:50*(a.velocity.x<0?-1:1),y:a.velocity.y})}})),Matter.Events.on(physics,"afterUpdate",(function(e){const t=Object.keys(ye);for(let e=0;e<t.length;e++){const d=t[e],a=ye[d];if(a.pet){let e=Math.min(3,Math.max(0,.3*(a.player.position.y-300)));a.petPara.scale.x=a.petPara.scale.y=e/2,a.petParaFlipDir&&a.player.velocity.x>0&&(a.petPara.scale.x=-e/2),a.pet.angle=a.player.angle,a.pet.position.x=Math.max(20,Math.min(p-20,a.player.position.x+a.petOffset)),a.pet.position.y=Math.min(a.player.position.y+20,h-46-50+(c.target_y_offset||0)),a.petPara.rotation=a.player.angle,a.petPara.position.x=a.pet.position.x,a.petPara.position.y=a.pet.position.y}}}))}function qe(e,t){const d=Object.keys(ye);for(let t=0;t<d.length;t++){const a=d[t],u=ye[a];if(u.player)if(u.isLanded){let e=a===ge?1:.3;if(!(l.spawnZombies&&u.score<=0)){if(u.end.alpha=e,u.player.animations[u.player.currentAnimation].alpha=e,u.player.sprites){const t=Object.keys(u.player.sprites);for(const d of t){const t=u.player.sprites[d];t.animations[t.currentAnimation].alpha=e}}u.label.alpha=Math.round(e),u.scoreLabel.tint=u.label.tint=a===ge?16777215:3355443}if(u.pet&&(u.petEnd.alpha=e),a===ge){if(u.end.zIndex=u.scoreLabel.zIndex=u.label.zIndex=9e3,u.player.animations[u.player.currentAnimation].zIndex+=9e3,u.player.sprites){const e=Object.keys(u.player.sprites);for(const t of e){const e=u.player.sprites[t];e.animations[e.currentAnimation].zIndex+=9e3}}u.pet&&(u.pet.zIndex=9001),u.label.position.x=u.player.position.x,u.label.position.y=u.player.position.y-80,u.scoreLabel.position.x=u.label.position.x+15,u.scoreLabel.position.y=u.label.position.y-30,u.label.style.fontSize=40,u.scoreLabel.style.fontSize=40,ee.x=u.scoreLabel.x-u.scoreLabel.width/2-15,ee.y=u.scoreLabel.y-5}else u.label.position.x=u.player.position.x,u.label.position.y=u.player.position.y-60,u.scoreLabel.position.y=u.label.position.y-30,u.scoreLabel.alpha=0,u.label.style.fontSize=34,u.scoreLabel.style.fontSize=34;if(l.spawnZombies&&!u.zombiefied)for(let e=0;e<Ue.length;e++){const t=Ue[e];if(u.end&&u.end.alpha>0&&Math.abs(u.end.x-t.position.x)<40){u.zombiefied=!0;const e={character:{id:Ae,path:Ae}};u.end.alpha=0;let t=r(u.end.x,h-40,110,e);t.isSensor=!0,t.isStatic=!0,t.timeTilNextWalk=3e3+k(27e3),t.walkDirection=k(2)>0?"left":"right",t.label=u.label,Unicorn.PlayObjectAnimation(t.charName,t.walkDirection);let d=PIXI.utils.string2hex(u.nameColor.brighten(50).toHexString());Object.keys(t.animations).forEach(e=>{t.animations[e].tint=d}),Ue.push(t),c.target_particles&&Te(c.target_particles[0],c.target_particles[1],u.end.x,h-40,10),c.target_boosh&&Pe(u.end.x,h-40),c.target_splash&&Ce(u.end.x,h-40),c.target_floaty&&Ee(u.end.x,h-40)}}}else{if(u.pet&&(u.pet.position.x=Math.max(20,Math.min(p-20,u.player.position.x+u.petOffset)),u.pet.position.y=Math.min(u.player.position.y+20,h-46-50+(c.target_y_offset||0)),u.petPara.position.x=u.pet.position.x,u.petPara.position.y=u.pet.position.y),u.player.position.y>h-46-50+(c.target_y_offset||0)||c.target_walls&&u.player.position.y>h-46-50+(c.target_collide_land||0)&&de/2-20>Math.abs(ae-u.player.position.x)){u.isLanded=!0,u.parachute.scale.x=u.parachute.scale.y=0,u.pet&&(u.petPara.scale.x=u.petPara.scale.y=0);let e=Unicorn.AddBacklay("end_"+a,u.player.endImage,u.player.position.x,u.player.position.y,{scale:{x:u.player.endScale,y:u.player.endScale}});if(u.player.animations&&(e.tint=u.player.animations.front.tint),e.anchor.set(.5),e.zIndex=20,e.visible=!1,u.player.isStatic=!0,u.player.isSensor=!0,u.player.isSleeping=!0,u.player.angle=0,Unicorn.StopObjectAnimation(u.player.charName),u.player.animations[u.player.currentAnimation].zIndex++,u.player.collisionFilter={group:-1,mask:0,category:2},c.target_walls?u.score=100*Math.max(0,de/2-35-Math.abs(ae-u.player.position.x))/(de/2-35):u.score=100*Math.max(0,de/2-Math.abs(ae-u.player.position.x))/(de/2),!l.spawnZombies||u.score>0){const e=u.score>0?1:.3;if(u.player.animations[u.player.currentAnimation].alpha=e,u.player.sprites){const t=Object.keys(u.player.sprites);for(const d of t){const t=u.player.sprites[d];t.animations[t.currentAnimation].alpha=e}}}if(u.end=e,u.pet){let e=Unicorn.AddBacklay("petend_"+a,`pet_${u.petType}_front0`,u.pet.position.x,u.pet.position.y,{scale:{x:3,y:3}});u.pet.animations&&(e.tint=u.pet.animations.front.tint),e.anchor.set(.5),e.zIndex=30,u.pet.isStatic=!0,e.alpha=u.score>0?1:.3,u.petEnd=e}if(u.score>0){if(c.target_versions&&B(),c.target_stickies&&De(u.player.position.x,h-80),c.target_splishsplash&&Me(u.player.position.x,h-81),c.target_effect){F++;const e="te_"+F;let t=Unicorn.AddObject(e,{type:"circle",scale:{x:2,y:2},animations:{front:{framerate:4/60,frames:Array.from({length:c.target_effect.length},(e,t)=>"target_effect"+t),loop:!1,onComplete:()=>{Unicorn.RemoveObject(e)}}},isSensor:!0,isStatic:!0,x:u.player.position.x,y:u.player.position.y,z:200,radius:.1});t.isSensor=!0,t.animations.front.anchor.y=1}if(he&&c.target_versions[he].target_effect){F++;const e="te_"+F;let t=Unicorn.AddObject(e,{type:"circle",scale:{x:2,y:2},animations:{front:{framerate:4/60,frames:Array.from({length:c.target_versions[he].target_effect.length},(e,t)=>`target_effect${he}${t}`),loop:!1,onComplete:()=>{Unicorn.RemoveObject(e)}}},isSensor:!0,isStatic:!0,x:u.player.position.x,y:u.player.position.y,z:200,radius:.1});t.isSensor=!0,t.animations.front.anchor.y=1}if(c.target_animate_on_landed&&B(2),c.target_particles&&Te(c.target_particles[0],c.target_particles[1],u.player.position.x,u.player.position.y+40,10),c.target_boosh&&Pe(u.player.position.x,u.player.position.y+40),c.target_splash&&Ce(u.player.position.x,u.player.position.y+40),c.target_floaty&&Ee(u.player.position.x,u.player.position.y),c.target_sound&&Unicorn.PlaySound("sfx-target-drop",{volume:y}),u.scoreLabel.x=u.label.position.x,u.scoreLabel.y=u.label.position.y-30,u.scoreLabel.text=u.score.toFixed(2),u.pet&&c.hopper_trigger&&u.style&&u.style.pet)try{if(Object.keys(c.hopper_trigger).some(e=>u.style.pet[e]===c.hopper_trigger[e])){const e=c.special_hoppers[k(c.special_hoppers.length)];Le(u.pet.position.x,u.pet.position.y,{id:"pet_"+e,path:e,minIdle:200,maxIdle:800}),u.petEnd.visible=!1}}catch(e){console.error(e)}if(!a.startsWith("test_")){if(l.messageFormat){let e=l.messageFormat.replace("USERNAME",u.name).replace("POINTS",u.score.toFixed(2)).replace("SHORTPTS",Math.floor(u.score));setTimeout(()=>{ComfyJS.Say(e)},5e3)}O(u.name,u.score.toFixed(2),u.userId,a)}}u.score>me&&(me=u.score,ge=a,e.zIndex=21),(!l.spawnZombies||u.score>0)&&(u.label.alpha=u.score>0?1:.3),Unicorn.RemoveBacklay("para_"+a),u.pet&&(Unicorn.RemoveObject(u.pet.label),Unicorn.RemoveBacklay("petpara_"+a))}else if(u.player.position.y>300){let t=Math.min(3,Math.max(0,.3*(u.player.position.y-300)));0===u.parachute.scale.x&&t>0&&Unicorn.PlaySound("sfx-parachute-flap",{volume:y}),u.parachute.visible=!0,u.pet&&(u.petPara.visible=!0),u.parachute.scale.x=u.parachute.scale.y=t,u.paraFlipDir&&u.player.velocity.x>0&&(u.parachute.scale.x=-t),u.parachute.rotation=Math.sin(u.player.rotationOffset+e/1e3)*Math.PI/16,u.player.angle=Math.sin(u.player.rotationOffset+e/1e3)*Math.PI/16,u.parachute.position.x=u.player.position.x,u.parachute.position.y=u.player.position.y-10-(c.parachute_offset||0)}else u.parachute.visible=!1,u.parachute.scale.x=u.parachute.scale.y=0,u.pet&&(u.petPara.visible=!1,u.petPara.scale.x=u.petPara.scale.y=0);u.label.position.x=u.player.position.x,u.label.position.y=u.player.position.y-60}}for(let e=0;e<xe.length;e++){let d=xe[e];d.x-=t*d.speed,d.x+d.width/2<=0&&(d.x=p+d.width/2,d.y=k(500),d.speed=.01+.1*Math.random(),d.zIndex=d.speed)}for(let e=0;e<ve.length;e++){let d=ve[e];(d.vY<0||d.y<h-5)&&(d.x+=t/1e3*d.vX,d.y+=t/1e3*d.vY,d.vY<20&&(d.vY+=t/1e3*200))}for(let e=0;e<we.length;e++){let d=we[e];(d.vY<0||d.y<h-5)&&(d.x+=t/1e3*d.vX,d.y+=t/1e3*d.vY,d.vY+=t/1e3*200)}for(let e=0;e<ke.length;e++){let d=ke[e];const a=d.y>h-46-30+(c.target_y_offset||0),r=c.target_walls&&d.y>h-46-30+(c.target_collide_land||0)&&de/2-20>Math.abs(ae-d.x),u=a||r;(d.vY<0||!u)&&(d.x+=t/1e3*d.vX,d.y+=t/1e3*d.vY,d.vY+=t/1e3*200),r&&(d.x+=t/1e3*(d.vX<0?-4:4))}for(let e=0;e<$e.length;e++){const d=$e[e];if(d.timer+=t,d.splishes[d.frame].visible=!1,d.frame=Math.floor(d.timer/100),d.frame>=13){$e.splice(e,1);for(let e=0;e<d.splishes.length;e++)Unicorn.RemoveOverlay(d.splishes[e].label)}else d.splishes[d.frame].visible=!0}for(let e=0;e<Oe.length;e++){let d=Oe[e];if(d.position.x<-50||d.position.y>p+50)Unicorn.RemoveObject(d.charName),Oe.splice(e,1),e--;else{const e=d.walkSpeed*("left"===d.walkDirection?-1:1);d.position.x+=e*t/1e3,Unicorn.SetPosition(d.charName,d.position.x,d.position.y)}}for(let e=0;e<Se.length;e++){let d=Se[e];d.lifetime>0&&(d.lifetime-=t/1e3,d.y-=80*t/1e3,d.x=d.refX+20*Math.sin(4*d.lifetime+d.timeOffset),d.lifetime<0&&(Unicorn.RemoveBacklay(d.label),Se.splice(e,1),e--))}for(let e=0;e<Ue.length;e++){const d=Ue[e];if(d.isHidden)continue;let a=!1;d.position.x<=20&&"left"===d.walkDirection&&(a=!0),d.position.x>=p-20&&"right"===d.walkDirection&&(a=!0),Math.abs(ae-d.position.x)<de/2+10&&(a=!0,d.position.x<ae?d.position.x=ae-de/2-10:d.position.x=ae+de/2+10),d.timeTilNextWalk-=t,d.timeTilNextWalk<=0&&(a=!0),a&&(d.timeTilNextWalk=3e3+k(27e3),d.walkDirection="right"===d.walkDirection?"left":"right",Unicorn.PlayObjectAnimation(d.charName,d.walkDirection)),d.position.x+=50*t/1e3*("left"===d.walkDirection?-1:1),d.label&&(d.label.x=d.position.x)}R&&(N-=t,N<=0&&(N=60,Array.isArray(ue)&&(ue[ce].visible=!1,ce=(ce+1)%ue.length,ue[ce].visible=!0),oe&&Array.isArray(oe)&&(oe[le].visible=!1,le=(le+1)%oe.length,oe[le].visible=!0),se&&Array.isArray(se)&&(se[fe].visible=!1,fe=(fe+1)%se.length,se[fe].visible=!0))),z>0&&(z-=t,z<=0&&q()),X>0&&(X-=t,X<=0&&(X=0,console.log("Raid mode complete"),ComfyJS.Say("/me Drop raid has ended")))}