let e=0;function t(e,t){let d={};return m.Animations.forEach(a=>{d[a]={numFrames:t,prefix:`${e}_${a}`}}),d}function d({x:e,y:t,z:d,radius:a,scale:u=3,name:o,framerate:r=4/60,animations:n,suffix:s=""}={}){let i={};return Object.keys(n).forEach(e=>{i[e]={framerate:r,frames:Array.from({length:n[e].numFrames},(t,d)=>`${n[e].prefix}${s||d}`),loop:!0}}),Unicorn.AddObject(o,{type:"circle",scale:{x:u,y:u},friction:0,frictionAir:0,frictionStatic:0,bounce:1,animations:i,x:e,y:t,z:d,radius:a})}function a({x:e,y:t,z:d,scale:a=3,name:u,framerate:o=4/60,animations:r,suffix:n=""}={}){let s={};Object.keys(r).forEach(e=>{s[e]={framerate:o,frames:Array.from({length:r[e].numFrames},(t,d)=>`${r[e].prefix}${n||d}`),loop:!0}});let i=Unicorn.AddSprite(u,{scale:{x:a,y:a},animations:s,x:e,y:t,z:d});return i.label=u,i}function u(a,u,o,r,n=null){i.playable;e++;const s="player_"+e;if(!i)throw"No GameTheme Defined";i.characters||(i.characters={});let c=!1;n&&i.playable.includes(n)||(r.character&&r.character.id?(n=r.character.id,c=!0):n=i.playable[w(i.playable.length)]),y[n]||(i.characters[n]=c?r.character.path:n,k(n,"characters",i.characters[n],m.NumFrames));let l=d({x:a,y:u,z:o,radius:36,name:s,animations:t(n,m.NumFrames)});return l.character=n,l.charName=s,l.endImage=n+"_front0",l.endScale=3,l}function o(a,u,o,r,n){if(!r||!r.pet||"pet_none"===r.pet.id)return null;e++;const s="pet_"+e;if(!i)throw"No GameTheme Defined";i.pets||(i.pets={});let c=r.pet.id.replace("pet_","");y[c]||(i.pets[c]={path:r.pet.path,minIdle:r.pet.minIdle,maxIdle:r.pet.maxIdle},k(c,"pets",r.pet.path,m.NumFrames));let l=d({x:a,y:u,z:o,radius:24,name:s,framerate:n||4/60,animations:t(i.pets[c].path,m.NumFrames)});return l.isStatic=!0,l.isSensor=!0,l.petName=c,l.charName=s,l}const r="https://api.pixelplush.dev/v1";let n="PixelPlush Game",s="unknown",i={},c={},l="",f=1920,p=1080,h=.5;const m={NumFrames:10,Animations:["front","left","back","right"]};let y={};var g="",b=!0;let _="",x=!0,v={};function w(e){return Math.floor(Math.random()*Math.floor(e))}function S(e){for(let t=e.length-1;t>0;t--){const d=Math.floor(Math.random()*(t+1));[e[t],e[d]]=[e[d],e[t]]}}function $(e,t,d,a,u){const o=a.dims;let r=document.createElement("canvas");r.width=t,r.height=d;let n=r.getContext("2d"),s=n.createImageData(t,d);if(u)for(let e=0;e<d;e++)for(let d=0;d<t;d++){const a=4*(e*t+d);s.data[a+0]=u.data[a+0],s.data[a+1]=u.data[a+1],s.data[a+2]=u.data[a+2],s.data[a+3]=u.data[a+3]}for(let e=o.top;e<o.top+o.height;e++)for(let d=o.left;d<o.left+o.width;d++){const u=d-o.left,r=(e-o.top)*o.width+u,n=4*r,i=4*(e*t+d);a.pixels[r]!==a.transparentIndex&&(s.data[i+0]=a.patch[n+0],s.data[i+1]=a.patch[n+1],s.data[i+2]=a.patch[n+2],s.data[i+3]=a.patch[n+3])}switch(n.putImageData(s,0,0),e){case 1:default:break;case 2:for(let e=o.top;e<o.top+o.height;e++)for(let d=o.left;d<o.left+o.width;d++){const a=4*(e*t+d);s.data[a+0]=0,s.data[a+1]=0,s.data[a+2]=0,s.data[a+3]=0}break;case 3:if(u)for(let e=o.top;e<o.top+o.height;e++)for(let d=o.left;d<o.left+o.width;d++){const a=4*(e*t+d);s.data[a+0]=u.data[a+0],s.data[a+1]=u.data[a+1],s.data[a+2]=u.data[a+2],s.data[a+3]=u.data[a+3]}}return{canvas:r,data:s}}async function U(e){let t=Object.keys(ie).length;return fetch(r+"/analytics/heartbeat",{method:"POST",body:JSON.stringify({session:g,game:s,theme:n,channel:c.channel,players:Object.keys(ie),count:t})}).then(e=>e.json())}function k(e,t,d,a,u=""){if(!y[e+u]){y[e+u]=!0;for(let o=0;o<a;o++)for(let a=0;a<m.Animations.length;a++){const r=m.Animations[a],n=`${d}_${r}`;u?Unicorn.Load(`${e}_${r}${u}`,`${l}/assets/${t}/${e}/${n}/${n}${u}.png`):Unicorn.Load(`${e}_${r}${o}`,`${l}/assets/${t}/${e}/${n}/${n}${o+1}.png`)}}}async function A(e,t,d,a){return c.oauth?fetch(r+"/scores/add",{method:"POST",body:JSON.stringify({token:c.oauth.replace("oauth:",""),channel:c.channel,game:s,theme:n,user:e,score:t,userId:d,username:a})}).then(e=>e.json()):{}}window.setupGame=function(e,t,d){if(n=e,i=t,c=d,l=i.path||"",c.clouds=void 0===c.clouds||null===c.clouds?!c.overlay:"true"===c.clouds,h=void 0===c.volume||null===c.volume?0:parseInt(c.volume)/100,f=Math.min(window.innerWidth,1920),p=Math.min(window.innerHeight,1080),c.variations&&!c.didRandom){const e=c.variations.split(","),t=w(e.length),d=`${window.location.protocol}//${window.location.host}${window.location.pathname.substr(0,window.location.pathname.lastIndexOf("/"))}/${e[t]}${window.location.search}&didRandom=1`;window.location.href=d}c.readyTime&&(x=!1,setTimeout(()=>{x=!0,ComfyJS.Say("Parachute Drop is ready!")},parseInt(c.readyTime||1e3)))},window.WebFontConfig={custom:{families:["Pixeltype","Pixellari"]},active(){!async function(){if(document.hidden)return void document.addEventListener("visibilitychange",()=>{location.reload()},!1);try{const e=(await fetch("https://www.pixelplush.dev/assets/shamelist.txt").then(e=>e.text())).split(",").map(e=>e.trim().toLowerCase());if(c.channel&&e&&e.includes(c.channel.toLowerCase())&&(console.log("This channel has been blocked for violating the PixelPlush Terms of Service."),b=!1),i.requires)try{if(account=await fetch(r+"/accounts",{headers:{Twitch:c.oauth?c.oauth.replace("oauth:",""):void 0}}).then(e=>e.json()),console.log(account),account.error)throw"Login Error";if(!account.owned.includes(i.requires))throw"Item not owned"}catch(e){return void console.log("Auth Validate Failed",e)}!async function(){s="parachute",c.notifVolume&&(L=parseInt(c.notifVolume)/100);c.cpDrop&&(v["Parachute Drop!"]={desc:"Drop into the PixelPlush Parachute Game!",color:"#F2C079",cost:parseInt(c.cpDropCost||50),callback:(e,t,d,a,u)=>{x&&(b?(F&&c.hideTilDrop&&(F=!1,he.forEach(e=>e.visible=!0),ue.forEach(e=>e.isSensor=!1),Array.isArray(te)?(te[oe].visible=!0,i.target_animate_on_landed||N()):te.visible=!0,de&&(Array.isArray(de)?(de[re].visible=!0,i.target_animate_on_landed||N()):de.visible=!0),ae&&(ae.visible=!0),c.spawnZombies&&_e.forEach(e=>{e.isHidden=!1,e.position.y=p-40})),J?q.push({username:u.username,name:e,color:u.userColor||"#ffffff",message:a,emote:u.messageEmotes?Object.keys(u.messageEmotes)[0]:"",emoji:"",extra:u}):Ae(u.username,e,u.userColor||"#ffffff",a,i.parachutes[w(i.parachutes.length)],i.petparachutes[w(i.petparachutes.length)],u.messageEmotes?Object.keys(u.messageEmotes)[0]:"","",u)):c.oauth&&ComfyJS.Say("The Parachute Drop game needs your attention. Please contact the PixelPlush team on Discord."))}});c.cpDroplets&&(v["Parachute Droplets"]={desc:"Add bouncing obstacles into the PixelPlush Parachute Game!",color:"#F2C079",cost:parseInt(c.cpDropletsCost||500),cooldown:parseInt(c.cpDropletsCD||5),callback:()=>{if(x)if(b)for(let e=0;e<5;e++)je(100);else c.oauth&&ComfyJS.Say("The Parachute Drop game needs your attention. Please contact the PixelPlush team on Discord.")}});c.cpQueue&&(v["Group Parachute"]={desc:"Queue everyone for a group drop in the PixelPlush Parachute Game!",color:"#F2C079",cost:parseInt(c.cpQueueCost||500),cooldown:parseInt(c.cpQueueCD||120),callback:()=>{if(x)if(b)if(J)ComfyJS.Say("/me Group Drop is already queued.");else{L>0&&Unicorn.PlaySound("sfx-group-queue",{volume:L}),V(),J=!0;const e=6e4;ComfyJS.Say(`/me Parachutes are queued for the next 60 seconds. !${c.command||"drop"} to join!`),setTimeout(()=>{ComfyJS.Say(`/me 30 seconds remaining. !${c.command||"drop"} to join!`)},e-3e4),setTimeout(()=>{ComfyJS.Say("/me 10 seconds. !"+(c.command||"drop"))},e-1e4),setTimeout(()=>{S(q),q.forEach(e=>{Ae(e.username,e.name,e.color,e.message,e.selectedPara||i.parachutes[w(i.parachutes.length)],e.selectedPetPara||i.petparachutes[w(i.petparachutes.length)],e.emote,e.emoji,e.extra)}),q=[]},e)}else c.oauth&&ComfyJS.Say("The Parachute Drop game needs your attention. Please contact the PixelPlush team on Discord.")}})}()}catch(e){console.log(e)}Unicorn.Create("unicorn-display",{width:f,height:p,background:"transparent",init:Pe,update:Te,channel:c.channel,username:c.oauth?c.channel:void 0,password:c.oauth?c.oauth.replace("oauth:",""):void 0,onCommand:W,onChat:X,screenWalls:!1,gravity:{x:0,y:1}}),ComfyJS.onCheer=Y,ComfyJS.onConnected=async(e,t,d)=>{if(d){Oe();let e=await U();if(0!==e&&(g=e.session,setInterval(()=>{U()},6e4)),c.oauth){let e=await async function(e){return await fetch("https://id.twitch.tv/oauth2/validate",{headers:{Authorization:"OAuth "+e}}).then(e=>e.json()).catch(e=>({error:e}))}(c.oauth.replace("oauth:",""));_=e.client_id,["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every(t=>e.scopes.includes(t))||console.log("Need more permissions"),e.expires_in<1800&&console.log("Token expires soon. Need to generate new link")}let t=await ComfyJS.GetChannelRewards(_,!0),d=Object.keys(v);for(let e=0;e<d.length;e++){let a=d[e];if(!t.some(e=>e.title===a))try{await ComfyJS.CreateChannelReward(_,{title:a,prompt:v[a].desc,cost:v[a].cost,is_enabled:!0,background_color:v[a].color,is_user_input_required:!1,is_max_per_stream_enabled:!1,max_per_stream:0,is_max_per_user_per_stream_enabled:!1,max_per_user_per_stream:0,is_global_cooldown_enabled:!!v[a].cooldown,global_cooldown_seconds:v[a].cooldown,should_redemptions_skip_request_queue:!0})}catch(e){console.log(e)}}}},ComfyJS.onReward=(e,t,d,a,u)=>{v[t]&&v[t].callback(e,t,d,a,u)}}()}},function(){const e=document.createElement("script");e.src=("https:"===document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",e.type="text/javascript",e.async="true";const t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();const j={parse:function(e,t){var d=t&&t.assetType?t.assetType:"svg",a=t&&t.buildUrl?t.buildUrl:function(e,t){return"png"===t?"https://twemoji.maxcdn.com/2/72x72/"+e+".png":"https://twemoji.maxcdn.com/2/svg/"+e+".svg"},u=[];P.default.lastIndex=0;for(;;){var o=P.default.exec(e);if(!o)break;var r=o[0],n=D(E(r)).join("-");u.push({url:n?a(n,d):"",indices:[o.index,P.default.lastIndex],text:r,type:T})}return u}};j.toCodePoints=D;var O,P=(O=/(?:\ud83d\udc68\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c\udffb|\ud83d\udc68\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc]|\ud83d\udc68\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd]|\ud83d\udc68\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffc-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffd-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c\udffb|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb\udffc]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd\udfff]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffd]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffe]|\ud83e\uddd1\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c\udffb|\ud83e\uddd1\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb\udffc]|\ud83e\uddd1\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udffd]|\ud83e\uddd1\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udffe]|\ud83e\uddd1\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\u200d\ud83e\udd1d\u200d\ud83e\uddd1|\ud83d\udc6b\ud83c[\udffb-\udfff]|\ud83d\udc6c\ud83c[\udffb-\udfff]|\ud83d\udc6d\ud83c[\udffb-\udfff]|\ud83d[\udc6b-\udc6d])|(?:\ud83d[\udc68\udc69])(?:\ud83c[\udffb-\udfff])?\u200d(?:\u2695\ufe0f|\u2696\ufe0f|\u2708\ufe0f|\ud83c[\udf3e\udf73\udf93\udfa4\udfa8\udfeb\udfed]|\ud83d[\udcbb\udcbc\udd27\udd2c\ude80\ude92]|\ud83e[\uddaf-\uddb3\uddbc\uddbd])|(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75]|\u26f9)((?:\ud83c[\udffb-\udfff]|\ufe0f)\u200d[\u2640\u2642]\ufe0f)|(?:\ud83c[\udfc3\udfc4\udfca]|\ud83d[\udc6e\udc71\udc73\udc77\udc81\udc82\udc86\udc87\ude45-\ude47\ude4b\ude4d\ude4e\udea3\udeb4-\udeb6]|\ud83e[\udd26\udd35\udd37-\udd39\udd3d\udd3e\uddb8\uddb9\uddcd-\uddcf\uddd6-\udddd])(?:\ud83c[\udffb-\udfff])?\u200d[\u2640\u2642]\ufe0f|(?:\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f|\ud83c\udff3\ufe0f\u200d\ud83c\udf08|\ud83c\udff4\u200d\u2620\ufe0f|\ud83d\udc15\u200d\ud83e\uddba|\ud83d\udc41\u200d\ud83d\udde8|\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc6f\u200d\u2640\ufe0f|\ud83d\udc6f\u200d\u2642\ufe0f|\ud83e\udd3c\u200d\u2640\ufe0f|\ud83e\udd3c\u200d\u2642\ufe0f|\ud83e\uddde\u200d\u2640\ufe0f|\ud83e\uddde\u200d\u2642\ufe0f|\ud83e\udddf\u200d\u2640\ufe0f|\ud83e\udddf\u200d\u2642\ufe0f)|[#*0-9]\ufe0f?\u20e3|(?:[Â©Â®\u2122\u265f]\ufe0f)|(?:\ud83c[\udc04\udd70\udd71\udd7e\udd7f\ude02\ude1a\ude2f\ude37\udf21\udf24-\udf2c\udf36\udf7d\udf96\udf97\udf99-\udf9b\udf9e\udf9f\udfcd\udfce\udfd4-\udfdf\udff3\udff5\udff7]|\ud83d[\udc3f\udc41\udcfd\udd49\udd4a\udd6f\udd70\udd73\udd76-\udd79\udd87\udd8a-\udd8d\udda5\udda8\uddb1\uddb2\uddbc\uddc2-\uddc4\uddd1-\uddd3\udddc-\uddde\udde1\udde3\udde8\uddef\uddf3\uddfa\udecb\udecd-\udecf\udee0-\udee5\udee9\udef0\udef3]|[\u203c\u2049\u2139\u2194-\u2199\u21a9\u21aa\u231a\u231b\u2328\u23cf\u23ed-\u23ef\u23f1\u23f2\u23f8-\u23fa\u24c2\u25aa\u25ab\u25b6\u25c0\u25fb-\u25fe\u2600-\u2604\u260e\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262a\u262e\u262f\u2638-\u263a\u2640\u2642\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267b\u267f\u2692-\u2697\u2699\u269b\u269c\u26a0\u26a1\u26a7\u26aa\u26ab\u26b0\u26b1\u26bd\u26be\u26c4\u26c5\u26c8\u26cf\u26d1\u26d3\u26d4\u26e9\u26ea\u26f0-\u26f5\u26f8\u26fa\u26fd\u2702\u2708\u2709\u270f\u2712\u2714\u2716\u271d\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u2764\u27a1\u2934\u2935\u2b05-\u2b07\u2b1b\u2b1c\u2b50\u2b55\u3030\u303d\u3297\u3299])(?:\ufe0f|(?!\ufe0e))|(?:(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75\udd90]|[\u261d\u26f7\u26f9\u270c\u270d])(?:\ufe0f|(?!\ufe0e))|(?:\ud83c[\udf85\udfc2-\udfc4\udfc7\udfca]|\ud83d[\udc42\udc43\udc46-\udc50\udc66-\udc69\udc6e\udc70-\udc78\udc7c\udc81-\udc83\udc85-\udc87\udcaa\udd7a\udd95\udd96\ude45-\ude47\ude4b-\ude4f\udea3\udeb4-\udeb6\udec0\udecc]|\ud83e[\udd0f\udd18-\udd1c\udd1e\udd1f\udd26\udd30-\udd39\udd3d\udd3e\uddb5\uddb6\uddb8\uddb9\uddbb\uddcd-\uddcf\uddd1-\udddd]|[\u270a\u270b]))(?:\ud83c[\udffb-\udfff])?|(?:\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc73\udb40\udc63\udb40\udc74\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc77\udb40\udc6c\udb40\udc73\udb40\udc7f|\ud83c\udde6\ud83c[\udde8-\uddec\uddee\uddf1\uddf2\uddf4\uddf6-\uddfa\uddfc\uddfd\uddff]|\ud83c\udde7\ud83c[\udde6\udde7\udde9-\uddef\uddf1-\uddf4\uddf6-\uddf9\uddfb\uddfc\uddfe\uddff]|\ud83c\udde8\ud83c[\udde6\udde8\udde9\uddeb-\uddee\uddf0-\uddf5\uddf7\uddfa-\uddff]|\ud83c\udde9\ud83c[\uddea\uddec\uddef\uddf0\uddf2\uddf4\uddff]|\ud83c\uddea\ud83c[\udde6\udde8\uddea\uddec\udded\uddf7-\uddfa]|\ud83c\uddeb\ud83c[\uddee-\uddf0\uddf2\uddf4\uddf7]|\ud83c\uddec\ud83c[\udde6\udde7\udde9-\uddee\uddf1-\uddf3\uddf5-\uddfa\uddfc\uddfe]|\ud83c\udded\ud83c[\uddf0\uddf2\uddf3\uddf7\uddf9\uddfa]|\ud83c\uddee\ud83c[\udde8-\uddea\uddf1-\uddf4\uddf6-\uddf9]|\ud83c\uddef\ud83c[\uddea\uddf2\uddf4\uddf5]|\ud83c\uddf0\ud83c[\uddea\uddec-\uddee\uddf2\uddf3\uddf5\uddf7\uddfc\uddfe\uddff]|\ud83c\uddf1\ud83c[\udde6-\udde8\uddee\uddf0\uddf7-\uddfb\uddfe]|\ud83c\uddf2\ud83c[\udde6\udde8-\udded\uddf0-\uddff]|\ud83c\uddf3\ud83c[\udde6\udde8\uddea-\uddec\uddee\uddf1\uddf4\uddf5\uddf7\uddfa\uddff]|\ud83c\uddf4\ud83c\uddf2|\ud83c\uddf5\ud83c[\udde6\uddea-\udded\uddf0-\uddf3\uddf7-\uddf9\uddfc\uddfe]|\ud83c\uddf6\ud83c\udde6|\ud83c\uddf7\ud83c[\uddea\uddf4\uddf8\uddfa\uddfc]|\ud83c\uddf8\ud83c[\udde6-\uddea\uddec-\uddf4\uddf7-\uddf9\uddfb\uddfd-\uddff]|\ud83c\uddf9\ud83c[\udde6\udde8\udde9\uddeb-\udded\uddef-\uddf4\uddf7\uddf9\uddfb\uddfc\uddff]|\ud83c\uddfa\ud83c[\udde6\uddec\uddf2\uddf3\uddf8\uddfe\uddff]|\ud83c\uddfb\ud83c[\udde6\udde8\uddea\uddec\uddee\uddf3\uddfa]|\ud83c\uddfc\ud83c[\uddeb\uddf8]|\ud83c\uddfd\ud83c\uddf0|\ud83c\uddfe\ud83c[\uddea\uddf9]|\ud83c\uddff\ud83c[\udde6\uddf2\uddfc]|\ud83c[\udccf\udd8e\udd91-\udd9a\udde6-\uddff\ude01\ude32-\ude36\ude38-\ude3a\ude50\ude51\udf00-\udf20\udf2d-\udf35\udf37-\udf7c\udf7e-\udf84\udf86-\udf93\udfa0-\udfc1\udfc5\udfc6\udfc8\udfc9\udfcf-\udfd3\udfe0-\udff0\udff4\udff8-\udfff]|\ud83d[\udc00-\udc3e\udc40\udc44\udc45\udc51-\udc65\udc6a-\udc6d\udc6f\udc79-\udc7b\udc7d-\udc80\udc84\udc88-\udca9\udcab-\udcfc\udcff-\udd3d\udd4b-\udd4e\udd50-\udd67\udda4\uddfb-\ude44\ude48-\ude4a\ude80-\udea2\udea4-\udeb3\udeb7-\udebf\udec1-\udec5\uded0-\uded2\uded5\udeeb\udeec\udef4-\udefa\udfe0-\udfeb]|\ud83e[\udd0d\udd0e\udd10-\udd17\udd1d\udd20-\udd25\udd27-\udd2f\udd3a\udd3c\udd3f-\udd45\udd47-\udd71\udd73-\udd76\udd7a-\udda2\udda5-\uddaa\uddae-\uddb4\uddb7\uddba\uddbc-\uddca\uddd0\uddde-\uddff\ude70-\ude73\ude78-\ude7a\ude80-\ude82\ude90-\ude95]|[\u23e9-\u23ec\u23f0\u23f3\u267e\u26ce\u2705\u2728\u274c\u274e\u2753-\u2755\u2795-\u2797\u27b0\u27bf\ue50a])|\ufe0f/g)&&O.__esModule?O:{default:O};var T=j.TypeName="emoji";var I=/\uFE0F/g,C=String.fromCharCode(8205),E=function(e){return e.indexOf(C)<0?e.replace(I,""):e};function D(e){for(var t=[],d=0,a=0,u=0;u<e.length;)d=e.charCodeAt(u++),a?(t.push((65536+(a-55296<<10)+(d-56320)).toString(16)),a=0):d>55296&&d<=56319?a=d:t.push(d.toString(16));return t}let L=0,M=0,z=!1,R=0;function N(e=0){if(z=!0,i.target_versions){Object.keys(ne).forEach(e=>{Array.isArray(te)?ne[e].target.forEach(e=>{e.visible=!1}):ne[e].target.visible=!1,ne[e].target_overlay.forEach(e=>{e.visible=!1})});const e=w(Object.keys(ne).length);se=Object.keys(ne)[e],te=ne[se].target,de=ne[se].target_overlay,Array.isArray(te)?te[oe].visible=!0:te.visible=!0,de[re].visible=!0}e>0&&(M=1e3*e)}let B=0,F=!0,q=[],J=!1,G=null;async function W(e,t,d,a,u){if(document.hidden)return;if((a.broadcaster||a.mod)&&("resetparachute"===t||"resetdrop"===t))if(c.variations){const e=c.variations.split(","),t=w(e.length),d=`${window.location.protocol}//${window.location.host}${window.location.pathname.substr(0,window.location.pathname.lastIndexOf("/"))}/${e[t]}${window.location.search}`;window.location.href=d}else location.reload();if((a.broadcaster||a.mod)&&("deleteparachute"===t||"deletedrop"===t)){let e=await ComfyJS.GetChannelRewards(_,!0),t=Object.keys(v);for(let d=0;d<t.length;d++){let a=t[d],u=e.find(e=>e.title===a);u&&await ComfyJS.DeleteChannelReward(_,u.id)}}if((a.broadcaster||a.mod)&&"unqueuedrop"===t&&J&&(ComfyJS.Say("/me Group drop is no longer queued."),J=!1),(a.broadcaster||a.mod)&&"queuedrop"===t&&(J?ComfyJS.Say("/me Group drop is already queued."):(V(),J=!0,ComfyJS.Say("/me Drops are queued this game. !startdrop to activate!"))),(a.broadcaster||a.mod)&&"startdrop"===t&&J&&(S(q),q.forEach(e=>{Ae(e.username,e.name,e.color,e.message,e.selectedPara||i.parachutes[w(i.parachutes.length)],e.selectedPetPara||i.petparachutes[w(i.petparachutes.length)],e.emote,e.emoji,e.extra)}),q=[]),(a.broadcaster||a.mod)&&"testdrop"===t)for(var o=0;o<50;o++)B++,Ae("test_"+B,"test_"+B,u.userColor||"#ffffff",Object.keys(i.characters)[w(Object.keys(i.characters).length)],i.parachutes[w(i.parachutes.length)],i.petparachutes[w(i.petparachutes.length)],"","",u);if((a.broadcaster||a.mod)&&"droplet"===t){let e=parseInt(d||Math.pow(10,w(6)));for(let t=0;t<5;t++)je(e)}if(("drophigh"===t||"drophighscore"===t||"dropbest"===t)&&c.oauth){let e=await async function(){if(c.oauth){const e=new Date;e.setDate(e.getDate()-1);const t=e.toISOString().split("T")[0];return(await fetch(`${r}/scores/high?channel=${c.channel}&game=${s}&date=${t}`,{method:"GET"}).then(e=>e.json()))[0]}return null}();e&&e.score&&ComfyJS.Say(`/me The highest score in the past 24 hours is ${e.score} by ${e.user}`)}if(("droplow"===t||"droplowscore"===t||"dropworst"===t)&&c.oauth){let e=await async function(){if(c.oauth){const e=new Date;e.setDate(e.getDate()-1);const t=e.toISOString().split("T")[0];return(await fetch(`${r}/scores/low?channel=${c.channel}&game=${s}&date=${t}`,{method:"GET"}).then(e=>e.json()))[0]}return null}();e&&e.score&&ComfyJS.Say(`/me The lowest score in the past 24 hours is ${e.score} by ${e.user}`)}if(("droptop"===t||"droptopscores"===t||"dropleaderboard"===t||"dropscores"===t)&&c.oauth){let e=await async function(){if(c.oauth){const e=new Date;e.setDate(e.getDate()-1);const t=e.toISOString().split("T")[0];return await fetch(`${r}/scores/high?channel=${c.channel}&game=${s}&date=${t}`,{method:"GET"}).then(e=>e.json())}return[]}();if(e&&e.length>0){let t=Array.from(new Set(e.map(e=>e.userId))).slice(0,10).map(t=>e.find(e=>e.userId===t));ComfyJS.Say("/me Top players in the past 24 hours are "+t.map((e,t)=>`${t+1}. ${e.user} (${e.score})`).join(", "))}else ComfyJS.Say("/me There are no scores recorded in the past 24 hours")}if("droprecent"===t&&c.oauth){let e=await async function(){if(c.oauth){return await fetch(`${r}/scores/recent?channel=${c.channel}&game=${s}`,{method:"GET"}).then(e=>e.json())}return[]}();if(e&&e.length>0){let t=Array.from(new Set(e.map(e=>e.userId))).slice(0,10).map(t=>e.find(e=>e.userId===t));ComfyJS.Say("/me Latest scores are "+t.map((e,t)=>`${e.user} (${e.score})`).join(", "))}else ComfyJS.Say("/me There are no recent scores")}let n=!1;if(!c.commandOn&&c.cpDrop||!c.command||t!==c.command||(n=!0),!c.commandOn&&c.cpDrop||c.command||"drop"!==t||(n=!0),c.outfit&&"outfit"===t){n=!0,G||(G=await fetch("https://www.pixelplush.dev/assets/catalog_outfits.json").then(e=>e.json()));let e={};for(const t of G)e[t.type]||(e[t.type]=[]),e[t.type].push(t);let t={};if(Math.random()<.1){const d=e.equipment[w(e.equipment.length)];t.equipment={[d.group]:d.path}}const a=e.body.filter(e=>"skintones"===e.group),u=e.body.filter(e=>"expressions"===e.group),o=e.body.filter(e=>"hair"===e.group),r=a[w(a.length)],s=u[w(u.length)],i=o[w(o.length)];if(t.body={skintones:r.path,expressions:s.path,hair:i.path},Math.random()<.05);else{const d=e.outfits.filter(e=>"dresses"===e.group),a=e.outfits.filter(e=>"pants"===e.group),u=e.outfits.filter(e=>"shirts"===e.group);t.outfits={},Math.random()<.25&&(t.outfits.dresses=d[w(d.length)].path),Math.random()<.95&&(t.outfits.pants=a[w(a.length)].path),Math.random()<.95&&(t.outfits.shirts=u[w(u.length)].path)}let c={};for(const t of e.accessories)c[t.group]||(c[t.group]=[]),c[t.group].push(t);let l=Object.keys(c);t.accessories={};for(const e of l)Math.random()<.5&&(t.accessories[e]=c[e][w(c[e].length)].path);d=t}if(x)if(b){if(n){F&&c.hideTilDrop&&(F=!1,he.forEach(e=>e.visible=!0),ue.forEach(e=>e.isSensor=!1),Array.isArray(te)?(te[oe].visible=!0,i.target_animate_on_landed||N()):te.visible=!0,de&&(Array.isArray(de)?(de[re].visible=!0,i.target_animate_on_landed||N()):de.visible=!0),ae&&(ae.visible=!0),c.spawnZombies&&_e.forEach(e=>{e.isHidden=!1,e.position.y=p-40}));const a=j.parse(d,{assetType:"png"});if(!u.messageEmotes&&a.length>0)J?q.push({username:u.username,name:e,color:u.userColor||"#ffffff",message:d,emote:"",emoji:a[0].url,extra:u}):Ae(u.username,e,u.userColor||"#ffffff",d,i.parachutes[w(i.parachutes.length)],i.petparachutes[w(i.petparachutes.length)],"",a[0].url,u);else if(i.pridechutes){const a=Object.keys(i.pridechutes),o=u.messageEmotes?Object.keys(u.messageEmotes):[],r=o.map(e=>{const a=u.messageEmotes[e][0].split("-").map(e=>parseInt(e));return`!${t} ${d}`.substring(a[0],a[1]+1)}),n=r.filter(e=>e.toLowerCase().includes("pride"));let s=a.find(e=>n.some(t=>t.toLowerCase().includes(e)));if(s){const t=i.pridechutes[s];let a=o.find((e,t)=>!r[t].toLowerCase().includes(s));J?q.push({username:u.username,name:e,color:u.userColor||"#ffffff",message:d,selectedPara:t,selectedPetPara:t,emote:a,emoji:"",extra:u}):Ae(u.username,e,u.userColor||"#ffffff",d,t,t,a,"",u)}else J?q.push({username:u.username,name:e,color:u.userColor||"#ffffff",message:d,emote:u.messageEmotes?Object.keys(u.messageEmotes)[0]:"",emoji:"",extra:u}):Ae(u.username,e,u.userColor||"#ffffff",d,i.parachutes[w(i.parachutes.length)],i.petparachutes[w(i.petparachutes.length)],u.messageEmotes?Object.keys(u.messageEmotes)[0]:"","",u)}else J?q.push({username:u.username,name:e,color:u.userColor||"#ffffff",message:d,emote:u.messageEmotes?Object.keys(u.messageEmotes)[0]:"",emoji:"",extra:u}):Ae(u.username,e,u.userColor||"#ffffff",d,i.parachutes[w(i.parachutes.length)],i.petparachutes[w(i.petparachutes.length)],u.messageEmotes?Object.keys(u.messageEmotes)[0]:"","",u)}}else n&&c.oauth&&ComfyJS.Say("The Parachute Drop game needs your attention. Please contact the PixelPlush team on Discord.")}function X(e,t,d,a,u){document.hidden}function Y(e,t,d,a,u){if(!document.hidden&&x&&b){for(let e=0;e<5;e++)je(t);if(t.startsWith("!")){let d=t.split(/ (.*)/);W(e,d[0].slice(1).toLowerCase(),d[1]||"",a,u)}}}function V(){Object.keys(ie).forEach(e=>{Unicorn.RemoveBacklay("para_"+e),Unicorn.RemoveBacklay("petpara_"+e),Unicorn.RemoveObject(ie[e].player.charName),ie[e].pet&&Unicorn.RemoveObject(ie[e].pet.charName),Unicorn.RemoveText("name_"+e),Unicorn.RemoveBacklay("end_"+e),Unicorn.RemoveBacklay("petend_"+e),Unicorn.RemoveText(e+"_points"),delete ie[e]}),Z.x=-1e3,Z.y=-1e3,le="",ce=0,H&&clearTimeout(H),Oe()}let Z,H=null,Q=368,K=0,ee=0,te=null,de=null,ae=null,ue=[],oe=0,re=0,ne={},se=null,ie={},ce=0,le="",fe={},pe={},he=[],me=[],ye=[],ge=[],be="zombie",_e=[],xe=[],ve=0;function we(e,t,d,a,u,o=""){ve++;let r=Math.min(Math.max(1,u),100);Unicorn.AddParticles("Splash_"+ve,{blendMode:PIXI.BLEND_MODES.DEFAULT,shape:"cone",angle:-Math.PI/2,spread:Math.PI/2,startColor:e,endColor:t,intensity:r,minSpeed:.05,maxSpeed:.25,gravityX:0,gravityY:3.5,fadeOut:!0,decay:1,image:o||void 0},d,a),function(e,t=2e3){setTimeout(()=>{Unicorn.RemoveParticles(e)},t)}("Splash_"+ve,150)}function Se(e,t,d,a=""){const u=i.target_boosh_scale||2;i.target_boosh.forEach((d,a)=>{for(let d=0;d<w(5);d++){ve++;let d=Unicorn.AddBacklay("boosh_"+ve,"target_boosh"+a,e,t+10,{scale:{x:u,y:u}});d.label="boosh_"+ve,d.zIndex=11,d.vX=w(50)-25,d.vY=-350+w(100),d.anchor.set(.5),me.push(d)}})}function $e(e,t,d,a=""){const u=i.target_splash_scale||2;i.target_splash.forEach((d,a)=>{for(let d=0;d<w(2);d++){ve++;let d=Unicorn.AddBacklay("splash_"+ve,"target_splash"+a,e,t+10,{scale:{x:u,y:u}});d.label="splash_"+ve,d.zIndex=11,d.vX=w(100)-50,d.vY=-300+w(100),d.anchor.set(.5),ye.push(d)}})}function Ue(e,t,d=""){for(let d=0;d<2;d++){const a=w(i.target_floaty.length);ve++;const u=w(10),o=w(10),r=d*Math.PI;let n=Unicorn.AddBacklay("floaty_"+ve,"target_floaty"+a,e-5+u,t+o,{scale:{x:3,y:3}});n.timeOffset=r,n.label="floaty_"+ve,n.zIndex=11,n.refX=e,n.refY=t,n.lifetime=3,n.anchor.set(.5),ge.push(n)}}function ke(e,t,d={}){we("#ffffff","#ffffff",e,t+40,5);let a=o(e,t,200,{pet:d},16/60);a.isSensor=!0,a.isStatic=!0,a.walkDirection=w(2)>0?"left":"right",a.walkSpeed=120,Unicorn.PlayObjectAnimation(a.charName,a.walkDirection),xe.push(a)}async function Ae(n,s,l="#ffffff",p,g,b,_="",x="",v){let S=4/60;if(!ie[n]){ie[n]={};let U=null,A=null,j=null,O=tinycolor(l),P=await async function(e){let t={};try{if(!e)return t;let d=await fetch(`${r}/accounts/twitch/design?username=${e}`).then(e=>e.json());return d&&(t=d.style||{}),t}catch(e){console.log(e)}}(n);if(_){if(!fe[_]){if(fe[_]=!0,_.startsWith("emotesv2_")){let e=`https://static-cdn.jtvnw.net/emoticons/v2/${_}/default/dark/2.0`,t=await fetchGif(e);if(t.length>0){const e=function(e,t){const d=Math.min(...e.map(e=>e.delay)),a=Math.max(...e.map(e=>e.dims.width)),u=Math.max(...e.map(e=>e.dims.height));let o=0,r=null;for(let n=0;n<e.length;n++){const s=$(e[n].disposalType,a,u,e[n],r);r=s.data;for(let r=0;r<e[n].delay;r+=d)Unicorn.LoadCustom(`${t}${o}`,s.canvas,"texture",{width:a,height:u}),o++}return{frames:o,minDelay:d,width:a,height:u}}(t,"emote_"+_);fe[_]={frames:e.frames,framerate:1/60*(1e3/e.minDelay)},setTimeout(()=>{delete ie[n],Ae(n,s,l,p,g,b,_,x,v)},500)}else Unicorn.Load(`emote_${_}0`,e),setTimeout(()=>{delete ie[n],Ae(n,s,l,p,g,b,_,x,v)},500)}else{let e=`https://static-cdn.jtvnw.net/emoticons/v1/${_}/2.0`;Unicorn.Load(`emote_${_}0`,e),setTimeout(()=>{delete ie[n],Ae(n,s,l,p,g,b,_,x,v)},500)}return}let e=[];if(_.startsWith("emotesv2_")&&"boolean"!=typeof fe[_]){S=fe[_].framerate;for(let t=0;t<fe[_].frames;t++)e.push(`emote_${_}${t}`)}else e=[`emote_${_}0`];U=d({x:w(f),y:-100-w(50),z:100,radius:36,scale:1.2,name:"player_"+n,framerate:fe[_].framerate,animations:{front:{numFrames:e.length,prefix:"emote_"+_}}}),U.charName="player_"+n,U.endImage=e[0],U.endScale=1.2}else if(x){if(!pe[x])return pe[x]=!0,Unicorn.Load(`emoji_${x}0`,x),void setTimeout(()=>{delete ie[n],Ae(n,s,l,p,g,b,_,x,v)},500);U=d({x:w(f),y:-100-w(50),z:100,radius:36,scale:1,name:"player_"+n,animations:{front:{numFrames:1,prefix:"emoji_"+x}}}),U.charName="player_"+n,U.endImage=`emoji_${x}0`,U.endScale=1}else U="string"==typeof p?u(w(f),-100-w(50),100,P,p):function(u,o,r,n={}){e++;const s="player_"+e;if(!i)throw"No GameTheme Defined";let c=m.NumFrames,l="",f={};if(n.character){const e=n.character;y[e]||(i.characters[e]=e,k(e,"characters",i.characters[e],c)),f=d({x:u,y:o,z:r,radius:36,name:s,animations:t(e,c)}),f.character=e,f.charName=s,f.endImage=e+"_front0",f.endScale=3,f.sprites={}}else{if(n.equipment){const e=Object.keys(n.equipment);if(e.length>0){const t=e[0],d=n.equipment[t];c=1,l="_wheel",k(d,"skins/equipment/"+t,d,m.NumFrames)}}if(!n.body||!n.body.skintones)throw"No Body";{const e=n.body.skintones,i=n.body.expressions,p=n.body.hair;k(e,"skins/body/skintones",e,c,l),f=d({x:u,y:o,z:r,radius:36,name:s,animations:t(e,c),suffix:l}),f.character=e,f.charName=s,f.endImage=e+"_front0",f.endScale=3,f.sprites={},k(i,"skins/body/expressions",i,c,l),f.sprites.expr=a({x:u,y:o,z:r+1,name:s+"_expr",animations:t(i,c),suffix:l}),Unicorn.AttachSpriteToObject(s+"_expr",s),k(p,"skins/body/hair",p,c,l),f.sprites.hair=a({x:u,y:o,z:r+2,name:s+"_hair",animations:t(p,c),suffix:l}),Unicorn.AttachSpriteToObject(s+"_hair",s)}if(n.equipment){const e=Object.keys(n.equipment);if(e.length>0){const d=e[0],i=n.equipment[d];f.sprites.eq=a({x:u,y:o,z:r+10,name:s+"_eq",animations:t(i,m.NumFrames)}),Unicorn.AttachSpriteToObject(s+"_eq",s)}}}if(n.outfits){const e=n.outfits.pants,d=n.outfits.shirts,i=n.outfits.dresses;e&&(k(e,"skins/outfits/pants",e,c,l),f.sprites.pants=a({x:u,y:o,z:r+3,name:s+"_pants",animations:t(e,c),suffix:l}),Unicorn.AttachSpriteToObject(s+"_pants",s)),d&&(k(d,"skins/outfits/shirts",d,c,l),f.sprites.shirts=a({x:u,y:o,z:r+4,name:s+"_shirts",animations:t(d,c),suffix:l}),Unicorn.AttachSpriteToObject(s+"_shirts",s)),i&&(k(i,"skins/outfits/dresses",i,c,l),f.sprites.dresses=a({x:u,y:o,z:r+5,name:s+"_dresses",animations:t(i,c),suffix:l}),Unicorn.AttachSpriteToObject(s+"_dresses",s))}if(n.accessories)for(const e in n.accessories){const d=n.accessories[e];k(d,"skins/accessories/"+e,d,c,l),f.sprites["acc_"+d]=a({x:u,y:o,z:r+10,name:s+"_acc_"+d,animations:t(d,c),suffix:l}),Unicorn.AttachSpriteToObject(s+"_acc_"+d,s)}return f}(w(f),-100-w(50),100,p);j=o(-1e3,-1e3,200,P),j&&(A=j.petName);let T=Unicorn.AddBacklay("para_"+n,g,{scale:{x:0,y:0},x:-50,y:0,z:50});T.visible=!1,T.zIndex=11,T.scale.x=0,T.scale.y=0,T.anchor.set(.5,1);let I=Unicorn.AddText("name_"+n,s,-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:34,fontWeight:400,fill:l,lineJoin:"round",stroke:tinycolor.isReadable(O.toString(),"#000000")?"#000000":"#ffffff",strokeThickness:6});I.anchor.set(.5);let C=Unicorn.AddText(n+"_points","",-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:34,fontWeight:400,fill:"#ffd700",lineJoin:"round",stroke:"#000000",strokeThickness:6});C.anchor.set(.5);let E=null;A&&(E=Unicorn.AddBacklay("petpara_"+n,b||g,{scale:{x:0,y:0},x:-50,y:0,z:150}),E.visible=!1,E.zIndex=11,E.scale.x=0,E.scale.y=0,E.anchor.set(.5,1)),U.restitution=1,U.friction=0,U.frictionStatic=0,U.frictionAir=0,U.torque=-5+w(10),U.rotationOffset=Math.random()*Math.PI,Unicorn.SetVelocity(U.charName,w(24)-12,0),ie[n]={style:P,parachute:T,player:U,pet:j,petPara:E,petType:A,petOffset:30*Math.random()+(Math.random()>.5?-150:70),label:I,scoreLabel:C,nameColor:O},v&&(ie[n].userId=v.userId,ie[n].name=v.displayName||v.username),g&&g.includes("chute_plane")&&(ie[n].paraFlipDir=!0),b&&b.includes("chute_plane")&&(ie[n].petParaFlipDir=!0),Unicorn.PlaySound("sfx-parachute-drop",{volume:h}),H&&clearTimeout(H),H=setTimeout(()=>{if(c.variations){const e=c.variations.split(","),t=w(e.length),d=`${window.location.protocol}//${window.location.host}${window.location.pathname.substr(0,window.location.pathname.lastIndexOf("/"))}/${e[t]}${window.location.search}`;window.location.href=d}else V()},parseInt(c.cooldown||"90000"))}}async function je(e){if(!c.droplets)return;ve++;let t=null,d=0;d=w(6);let a=3;i.dropletSizes&&(a*=i.dropletSizes[d]);let u=i.droplets[d];Array.isArray(i.droplets[d])&&(u=i.droplets[d][w(i.droplets[d].length)]),t=Unicorn.AddObject("droplet_"+ve,{type:"circle",sprite:u,scale:{x:1.5,y:1.5},x:w(f),y:-100-w(50),z:100,radius:.75*assetReference[u].width}),t.restitution=1,t.friction=.5*(5-d),t.frictionStatic=0,t.frictionAir=0,t.torque=-1+w(2),t.rotationOffset=Math.random()*Math.PI,Unicorn.SetVelocity("droplet_"+ve,w(24)-12,0),setTimeout(()=>{Unicorn.RemoveObject(t.label)},3e4)}function Oe(){if(F=!0,q=[],J=!1,Q=i.target_width||368,K=Q/2+w(f-Q),ee=p-47+(i.target_offset||0),i.target_walls&&(K<Q/2+70?K=Q/2+70:K>f-Q/2-70&&(K=f-Q/2-70)),i.target_versions){const e=w(Object.keys(i.target_versions).length);Object.keys(i.target_versions).forEach((t,d)=>{e===d&&(se=t);let a=i.target_versions[t];if(ne[t]={},Array.isArray(a.target))if(i.target_random){te&&Unicorn.RemoveBacklay("target"+t);let e=w(a.target.length);te=Unicorn.AddBacklay("target"+t,"target"+t+e,K,ee,{scale:{x:2,y:2}}),te.zIndex=10,te.anchor.set(.5),te.visible=!1,ne[t].target=te}else{if(te)for(let e=0;e<te.length;e++)te[e]&&Unicorn.RemoveBacklay("target"+t+e);oe=0,te=[];for(let e=0;e<a.target.length;e++){let d=Unicorn.AddBacklay("target"+t+e,"target"+t+e,K,ee,{scale:{x:2,y:2}});d.zIndex=10,d.anchor.set(.5),d.visible=!1,te.push(d)}ne[t].target=te,te[oe].visible=!1,c.hideTilDrop||i.target_animate_on_landed||N()}else te&&Unicorn.RemoveBacklay("target"+t),te=Unicorn.AddBacklay("target"+t,"target"+t,K,ee,{scale:{x:2,y:2}}),te.zIndex=10,te.anchor.set(.5),te.visible=!1,ne[t].target=te;if(a.target_overlay)if(Array.isArray(a.target_overlay)){if(de)for(let e=0;e<de.length;e++)de[e]&&Unicorn.RemoveBacklay("target_overlay"+t+e);re=0,de=[];for(let e=0;e<a.target_overlay.length;e++){let d=Unicorn.AddBacklay("target_overlay"+t+e,"target_overlay"+t+e,K,ee,{scale:{x:2,y:2}});d.zIndex=11,d.anchor.set(.5),d.visible=!1,de.push(d)}ne[t].target_overlay=de,de[re].visible=!1,c.hideTilDrop||i.target_animate_on_landed||N()}else de&&Unicorn.RemoveBacklay("target_overlay"+t),de=Unicorn.AddBacklay("target_overlay"+t,"target_overlay"+t,K,ee,{scale:{x:2,y:2}}),de.zIndex=11,de.anchor.set(.5),de.visible=!1,ne[t].target_overlay=de})}else{if(Array.isArray(i.target))if(i.target_random){te&&Unicorn.RemoveBacklay("target");let e=w(i.target.length);te=Unicorn.AddBacklay("target","target"+e,K,ee,{scale:{x:2,y:2}}),te.zIndex=10,te.anchor.set(.5)}else{if(te)for(let e=0;e<te.length;e++)te[e]&&Unicorn.RemoveBacklay("target"+e);oe=0,te=[];for(let e=0;e<i.target.length;e++){let t=Unicorn.AddBacklay("target"+e,"target"+e,K,ee,{scale:{x:2,y:2}});t.zIndex=10,t.anchor.set(.5),t.visible=!1,te.push(t)}te[oe].visible=!0,c.hideTilDrop||i.target_animate_on_landed||N()}else te&&Unicorn.RemoveBacklay("target"),te=Unicorn.AddBacklay("target","target",K,ee,{scale:{x:2,y:2}}),te.zIndex=10,te.anchor.set(.5);if(i.target_overlay)if(Array.isArray(i.target_overlay)){if(de)for(let e=0;e<de.length;e++)de[e]&&Unicorn.RemoveBacklay("target_overlay"+e);re=0,de=[];for(let e=0;e<i.target_overlay.length;e++){let t=Unicorn.AddBacklay("target_overlay"+e,"target_overlay"+e,K,ee,{scale:{x:2,y:2}});t.zIndex=11,t.anchor.set(.5),t.visible=!1,de.push(t)}de[re].visible=!0,c.hideTilDrop||i.target_animate_on_landed||N()}else de&&Unicorn.RemoveBacklay("target_overlay"),de=Unicorn.AddBacklay("target_overlay","target_overlay",K,ee,{scale:{x:2,y:2}}),de.zIndex=11,de.anchor.set(.5)}if(i.target_front&&(ae&&Unicorn.RemoveOverlay("target_front"),ae=Unicorn.AddOverlay("target_front","target_front",K,ee,{scale:{x:2,y:2}}),ae.anchor.set(.5)),c.clouds&&0===he.length)for(let e=0;e<11;e++){B++;let e=i.clouds[w(i.clouds.length)],t=Unicorn.AddOverlay("cloud_"+B,e,w(f),w(500),{scale:{x:3,y:3}});t.alpha=c.overlay?.5:.9,t.anchor.set(.5),t.speed=.01+.1*Math.random(),t.zIndex=t.speed,he.push(t)}if(i.target_walls){ue.length>0&&(Unicorn.RemoveObject("TargetTop"),Unicorn.RemoveObject("TargetLeft"),Unicorn.RemoveObject("TargetRight"),ue=[]);let e=Unicorn.AddObject("TargetTop",{type:"rectangle",x:K,y:ee+i.target_walls/2+i.target_collide_land,width:Q-50,height:10,isStatic:!0});e.sprite.visible=!1;let t=Unicorn.AddObject("TargetLeft",{type:"rectangle",x:K-Q/2+27,y:ee+i.target_walls,width:10,height:100,isStatic:!0});t.sprite.visible=!1;let d=Unicorn.AddObject("TargetRight",{type:"rectangle",x:K+Q/2-27,y:ee+i.target_walls,width:10,height:100,isStatic:!0});d.sprite.visible=!1,ue.push(e),ue.push(t),ue.push(d)}c.hideTilDrop&&(he.forEach(e=>e.visible=!1),ue.forEach(e=>e.isSensor=!0),Array.isArray(i.target)&&!i.target_random?te.forEach(e=>{e.visible=!1}):te.visible=!1,de&&(Array.isArray(i.target_overlay)&&!i.target_random?de.forEach(e=>{e.visible=!1}):de.visible=!1),ae&&(ae.visible=!1));for(let e=0;e<me.length;e++){let t=me[e];Unicorn.RemoveBacklay(t.label)}me=[];for(let e=0;e<ye.length;e++){let t=ye[e];Unicorn.RemoveBacklay(t.label)}ye=[];for(let e=0;e<xe.length;e++){let t=xe[e];Unicorn.RemoveObject(t.charName)}if(xe=[],c.spawnZombies){const e=c.spawnZombies.split(",").map(e=>e.trim());be=e[w(e.length)];const t=1;for(let e=0;e<t;e++){let e=w(f);Math.abs(K-e)<Q/2+10&&(e=K+(e<K?-Q/2-10:Q/2+10));let t=u(e,p-40,110,{character:{id:be,path:be}});t.isSensor=!0,t.isStatic=!0,c.hideTilDrop&&(t.isHidden=!0,t.position.y=p+100),t.timeTilNextWalk=3e3+w(27e3),t.walkDirection=w(2)>0?"left":"right",Unicorn.PlayObjectAnimation(t.charName,t.walkDirection),_e.push(t)}}}function Pe(){if(PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,Unicorn.Load("bg",`${l}/assets/${i.bg}.png`),!c.overlay){let e=Unicorn.AddBacklay("bg","bg",0,p-1080);e.scale.x=3,e.scale.y=3}if(i.target_versions)Object.keys(i.target_versions).forEach(e=>{let t=i.target_versions[e];if(Array.isArray(t.target)){t.target.map((t,d)=>Unicorn.Load("target"+e+d,`${l}/assets/${t}.png`))}else{Unicorn.Load("target"+e,`${l}/assets/${t.target}.png`)}if(Array.isArray(t.target_overlay)){t.target_overlay.map((t,d)=>Unicorn.Load("target_overlay"+e+d,`${l}/assets/${t}.png`))}else{Unicorn.Load("target_overlay"+e,`${l}/assets/${t.target_overlay}.png`)}if(t.target_effect){t.target_effect.map((t,d)=>Unicorn.Load("target_effect"+e+d,`${l}/assets/${t}.png`))}});else{if(Array.isArray(i.target)){i.target.map((e,t)=>Unicorn.Load("target"+t,`${l}/assets/${e}.png`))}else{Unicorn.Load("target",`${l}/assets/${i.target}.png`)}if(Array.isArray(i.target_overlay)){i.target_overlay.map((e,t)=>Unicorn.Load("target_overlay"+t,`${l}/assets/${e}.png`))}else if(i.target_overlay){Unicorn.Load("target_overlay",`${l}/assets/${i.target_overlay}.png`)}if(i.target_effect){i.target_effect.map((e,t)=>Unicorn.Load("target_effect"+t,`${l}/assets/${e}.png`))}}i.target_front&&Unicorn.Load("target_front",`${l}/assets/${i.target_front}.png`),i.target_boosh&&i.target_boosh.forEach((e,t)=>{Unicorn.Load("target_boosh"+t,`${l}/assets/${e}.png`)}),i.target_splash&&i.target_splash.forEach((e,t)=>{Unicorn.Load("target_splash"+t,`${l}/assets/${e}.png`)}),i.target_floaty&&i.target_floaty.forEach((e,t)=>{Unicorn.Load("target_floaty"+t,`${l}/assets/${e}.png`)}),Unicorn.Load("star",l+"/assets/icons/star.png"),Z=Unicorn.AddOverlay("star","star",-1e3,-1e3,{scale:{x:3,y:3}}),Z.anchor.set(.5),i.parachutes.forEach(e=>Unicorn.Load(e,`${l}/assets/${e}.png`)),i.petparachutes?i.petparachutes.forEach(e=>Unicorn.Load(e,`${l}/assets/${e}.png`)):i.petparachutes=[],i.pridechutes&&Object.keys(i.pridechutes).forEach(e=>Unicorn.Load(i.pridechutes[e],`${l}/assets/${i.pridechutes[e]}.png`)),Object.keys(i.characters).forEach(e=>{k(e,"characters",i.characters[e],m.NumFrames)}),i.clouds.forEach(e=>Unicorn.Load(e,`${l}/assets/${e}.png`)),i.droplets.forEach(e=>{Array.isArray(e)?e.forEach(e=>Unicorn.Load(e,`${l}/assets/${e}.png`)):Unicorn.Load(e,`${l}/assets/${e}.png`)}),i.target_sound&&Unicorn.Load("sfx-target-drop",`${l}/assets/${i.target_sound}`),c.notifVolume&&Unicorn.Load("sfx-group-queue",`${l}/assets/${i.queue_sound}`),Unicorn.Load("sfx-parachute-drop",`${l}/assets/${i.drop_sound}`),Unicorn.Load("sfx-parachute-flap",`${l}/assets/${i.parachute_sound}`),Unicorn.AddObject("WallLeft",{type:"rectangle",x:-200,y:0,width:400,height:2*p,friction:0,frictionAir:0,frictionStatic:0,bounce:1,isStatic:!0}).sprite.visible=!1,Unicorn.AddObject("WallRight",{type:"rectangle",x:f+200,y:0,width:400,height:2*p,friction:0,frictionAir:0,frictionStatic:0,bounce:1.01,isStatic:!0}).sprite.visible=!1,Unicorn.AddObject("WallBottom",{type:"rectangle",x:.5*f,y:p+100,friction:0,frictionAir:0,frictionStatic:0,bounce:1.01,width:f,height:200,isStatic:!0}).sprite.visible=!1,Matter.Events.on(physics,"beforeUpdate",(function(e){const t=Object.keys(ie);for(let e=0;e<t.length;e++){const d=t[e],a=ie[d];a.player&&(a.player.position.y<.5*-p?a.player.velocity.y>10&&Matter.Body.setVelocity(a.player,{x:a.player.velocity.x,y:10}):a.player.position.y>300&&a.player.velocity.y>.5&&Matter.Body.setVelocity(a.player,{x:a.player.velocity.x,y:.5}))}})),Matter.Events.on(physics,"afterUpdate",(function(e){const t=Object.keys(ie);for(let e=0;e<t.length;e++){const d=t[e],a=ie[d];if(a.pet){let e=Math.min(3,Math.max(0,.3*(a.player.position.y-300)));a.petPara.scale.x=a.petPara.scale.y=e/2,a.petParaFlipDir&&a.player.velocity.x>0&&(a.petPara.scale.x=-e/2),a.pet.angle=a.player.angle,a.pet.position.x=Math.max(20,Math.min(f-20,a.player.position.x+a.petOffset)),a.pet.position.y=Math.min(a.player.position.y+20,p-46-50+(i.target_y_offset||0)),a.petPara.rotation=a.player.angle,a.petPara.position.x=a.pet.position.x,a.petPara.position.y=a.pet.position.y}}}))}function Te(e,t){const d=Object.keys(ie);for(let t=0;t<d.length;t++){const a=d[t],o=ie[a];if(o.player)if(o.isLanded){let e=a===le?1:.3;if(c.spawnZombies&&o.score<=0||(o.end.alpha=e,o.label.alpha=Math.round(e),o.scoreLabel.tint=o.label.tint=a===le?16777215:3355443),o.pet&&(o.petEnd.alpha=e),a===le?(o.end.zIndex=o.scoreLabel.zIndex=o.label.zIndex=9e3,o.pet&&(o.pet.zIndex=9001),o.label.position.x=o.player.position.x,o.label.position.y=o.player.position.y-80,o.scoreLabel.position.x=o.label.position.x+15,o.scoreLabel.position.y=o.label.position.y-30,o.label.style.fontSize=40,o.scoreLabel.style.fontSize=40,Z.x=o.scoreLabel.x-o.scoreLabel.width/2-15,Z.y=o.scoreLabel.y-5):(o.label.position.x=o.player.position.x,o.label.position.y=o.player.position.y-60,o.scoreLabel.position.y=o.label.position.y-30,o.scoreLabel.alpha=0,o.label.style.fontSize=34,o.scoreLabel.style.fontSize=34),c.spawnZombies&&!o.zombiefied)for(let e=0;e<_e.length;e++){const t=_e[e];if(o.end&&o.end.alpha>0&&Math.abs(o.end.x-t.position.x)<40){o.zombiefied=!0;const e={character:{id:be,path:be}};o.end.alpha=0;let t=u(o.end.x,p-40,110,e);t.isSensor=!0,t.isStatic=!0,t.timeTilNextWalk=3e3+w(27e3),t.walkDirection=w(2)>0?"left":"right",t.label=o.label,Unicorn.PlayObjectAnimation(t.charName,t.walkDirection);let d=PIXI.utils.string2hex(o.nameColor.brighten(50).toHexString());Object.keys(t.animations).forEach(e=>{t.animations[e].tint=d}),_e.push(t),i.target_particles&&we(i.target_particles[0],i.target_particles[1],o.end.x,p-40,10),i.target_boosh&&Se(o.end.x,p-40),i.target_splash&&$e(o.end.x,p-40),i.target_floaty&&Ue(o.end.x,p-40)}}}else{if(o.pet&&(o.pet.position.x=Math.max(20,Math.min(f-20,o.player.position.x+o.petOffset)),o.pet.position.y=Math.min(o.player.position.y+20,p-46-50+(i.target_y_offset||0)),o.petPara.position.x=o.pet.position.x,o.petPara.position.y=o.pet.position.y),o.player.position.y>p-46-50+(i.target_y_offset||0)||i.target_walls&&o.player.position.y>p-46-50+(i.target_collide_land||0)&&Q/2-20>Math.abs(K-o.player.position.x)){o.isLanded=!0,o.parachute.scale.x=o.parachute.scale.y=0,o.pet&&(o.petPara.scale.x=o.petPara.scale.y=0);let e=Unicorn.AddBacklay("end_"+a,o.player.endImage,o.player.position.x,o.player.position.y,{scale:{x:o.player.endScale,y:o.player.endScale}});if(o.player.animations&&(e.tint=o.player.animations.front.tint),e.anchor.set(.5),e.zIndex=20,o.player.isStatic=!0,i.target_walls?o.score=100*Math.max(0,Q/2-35-Math.abs(K-o.player.position.x))/(Q/2-35):o.score=100*Math.max(0,Q/2-Math.abs(K-o.player.position.x))/(Q/2),(!c.spawnZombies||o.score>0)&&(e.alpha=o.score>0?1:.3),o.end=e,o.pet){let e=Unicorn.AddBacklay("petend_"+a,o.petType+"_front0",o.pet.position.x,o.pet.position.y,{scale:{x:3,y:3}});o.pet.animations&&(e.tint=o.pet.animations.front.tint),e.anchor.set(.5),e.zIndex=30,o.pet.isStatic=!0,e.alpha=o.score>0?1:.3,o.petEnd=e}if(o.score>0){if(i.target_versions&&N(),i.target_effect){B++;const e="te_"+B;let t=Unicorn.AddObject(e,{type:"circle",scale:{x:2,y:2},animations:{front:{framerate:4/60,frames:Array.from({length:i.target_effect.length},(e,t)=>"target_effect"+t),loop:!1,onComplete:()=>{Unicorn.RemoveObject(e)}}},isSensor:!0,isStatic:!0,x:o.player.position.x,y:o.player.position.y,z:200,radius:.1});t.isSensor=!0,t.animations.front.anchor.y=1}if(se&&i.target_versions[se].target_effect){B++;const e="te_"+B;let t=Unicorn.AddObject(e,{type:"circle",scale:{x:2,y:2},animations:{front:{framerate:4/60,frames:Array.from({length:i.target_versions[se].target_effect.length},(e,t)=>`target_effect${se}${t}`),loop:!1,onComplete:()=>{Unicorn.RemoveObject(e)}}},isSensor:!0,isStatic:!0,x:o.player.position.x,y:o.player.position.y,z:200,radius:.1});t.isSensor=!0,t.animations.front.anchor.y=1}if(i.target_animate_on_landed&&N(2),i.target_particles&&we(i.target_particles[0],i.target_particles[1],o.player.position.x,o.player.position.y+40,10),i.target_boosh&&Se(o.player.position.x,o.player.position.y+40),i.target_splash&&$e(o.player.position.x,o.player.position.y+40),i.target_floaty&&Ue(o.player.position.x,o.player.position.y),i.target_sound&&Unicorn.PlaySound("sfx-target-drop",{volume:h}),o.scoreLabel.x=o.label.position.x,o.scoreLabel.y=o.label.position.y-30,o.scoreLabel.text=o.score.toFixed(2),i.hopper_trigger&&o.style&&o.style.pet){if(Object.keys(i.hopper_trigger).some(e=>o.style.pet[e]===i.hopper_trigger[e])){const e=i.special_hoppers[w(i.special_hoppers.length)];ke(o.pet.position.x,o.pet.position.y,{id:"pet_"+e,path:e,minIdle:200,maxIdle:800}),o.petEnd.visible=!1}}if(!a.startsWith("test_")){if(c.messageFormat){let e=c.messageFormat.replace("USERNAME",o.name).replace("POINTS",o.score.toFixed(2)).replace("SHORTPTS",Math.floor(o.score));setTimeout(()=>{ComfyJS.Say(e)},5e3)}A(o.name,o.score.toFixed(2),o.userId,a)}}o.score>ce&&(ce=o.score,le=a,e.zIndex=21),(!c.spawnZombies||o.score>0)&&(o.label.alpha=o.score>0?1:.3),Unicorn.RemoveObject(o.player.label),Unicorn.RemoveBacklay("para_"+a),o.pet&&(Unicorn.RemoveObject(o.pet.label),Unicorn.RemoveBacklay("petpara_"+a))}else if(o.player.position.y>300){let t=Math.min(3,Math.max(0,.3*(o.player.position.y-300)));0===o.parachute.scale.x&&t>0&&Unicorn.PlaySound("sfx-parachute-flap",{volume:h}),o.parachute.visible=!0,o.pet&&(o.petPara.visible=!0),o.parachute.scale.x=o.parachute.scale.y=t,o.paraFlipDir&&o.player.velocity.x>0&&(o.parachute.scale.x=-t),o.parachute.rotation=Math.sin(o.player.rotationOffset+e/1e3)*Math.PI/16,o.player.angle=Math.sin(o.player.rotationOffset+e/1e3)*Math.PI/16,o.parachute.position.x=o.player.position.x,o.parachute.position.y=o.player.position.y-10-(i.parachute_offset||0)}else o.parachute.visible=!1,o.parachute.scale.x=o.parachute.scale.y=0,o.pet&&(o.petPara.visible=!1,o.petPara.scale.x=o.petPara.scale.y=0);o.label.position.x=o.player.position.x,o.label.position.y=o.player.position.y-60}}for(let e=0;e<he.length;e++){let d=he[e];d.x-=t*d.speed,d.x+d.width/2<=0&&(d.x=f+d.width/2,d.y=w(500),d.speed=.01+.1*Math.random(),d.zIndex=d.speed)}for(let e=0;e<me.length;e++){let d=me[e];(d.vY<0||d.y<p-5)&&(d.x+=t/1e3*d.vX,d.y+=t/1e3*d.vY,d.vY<20&&(d.vY+=t/1e3*200))}for(let e=0;e<ye.length;e++){let d=ye[e];(d.vY<0||d.y<p-5)&&(d.x+=t/1e3*d.vX,d.y+=t/1e3*d.vY,d.vY+=t/1e3*200)}for(let e=0;e<xe.length;e++){let d=xe[e];if(d.position.x<-50||d.position.y>f+50)Unicorn.RemoveObject(d.charName),xe.splice(e,1),e--;else{const e=d.walkSpeed*("left"===d.walkDirection?-1:1);d.position.x+=e*t/1e3,Unicorn.SetPosition(d.charName,d.position.x,d.position.y)}}for(let e=0;e<ge.length;e++){let d=ge[e];d.lifetime>0&&(d.lifetime-=t/1e3,d.y-=80*t/1e3,d.x=d.refX+20*Math.sin(4*d.lifetime+d.timeOffset),d.lifetime<0&&(Unicorn.RemoveBacklay(d.label),ge.splice(e,1),e--))}for(let e=0;e<_e.length;e++){const d=_e[e];if(d.isHidden)continue;let a=!1;d.position.x<=20&&"left"===d.walkDirection&&(a=!0),d.position.x>=f-20&&"right"===d.walkDirection&&(a=!0),Math.abs(K-d.position.x)<Q/2+10&&(a=!0,d.position.x<K?d.position.x=K-Q/2-10:d.position.x=K+Q/2+10),d.timeTilNextWalk-=t,d.timeTilNextWalk<=0&&(a=!0),a&&(d.timeTilNextWalk=3e3+w(27e3),d.walkDirection="right"===d.walkDirection?"left":"right",Unicorn.PlayObjectAnimation(d.charName,d.walkDirection)),d.position.x+=50*t/1e3*("left"===d.walkDirection?-1:1),d.label&&(d.label.x=d.position.x)}z&&(R-=t,R<=0&&(R=60,Array.isArray(te)&&(te[oe].visible=!1,oe=(oe+1)%te.length,te[oe].visible=!0),de&&Array.isArray(de)&&(de[re].visible=!1,re=(re+1)%de.length,de[re].visible=!0))),M>0&&(M-=t,M<=0&&(z=!1,Array.isArray(te)&&(te[oe].visible=!1,oe=0,te[oe].visible=!0),de&&Array.isArray(de)&&(te[re].visible=!1,re=0,te[re].visible=!0)))}