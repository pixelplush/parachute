let e=0;function d(e,d){let t={};return h.Animations.forEach(a=>{t[a]={numFrames:d,prefix:`${e}_${a}`}}),t}function t({x:e,y:d,z:t,radius:a,scale:u=3,name:o,framerate:r=4/60,animations:s,suffix:n=""}={}){let i={};return Object.keys(s).forEach(e=>{i[e]={framerate:r,frames:Array.from({length:s[e].numFrames},(d,t)=>`${s[e].prefix}${n||t}`),loop:!0}}),Unicorn.AddObject(o,{type:"circle",scale:{x:u,y:u},friction:0,frictionAir:0,frictionStatic:0,bounce:1,animations:i,x:e,y:d,z:t,radius:a})}function a({x:e,y:d,z:t,scale:a=3,name:u,framerate:o=4/60,animations:r,suffix:s=""}={}){let n={};return Object.keys(r).forEach(e=>{n[e]={framerate:o,frames:Array.from({length:r[e].numFrames},(d,t)=>`${r[e].prefix}${s||t}`),loop:!0}}),Unicorn.AddSprite(u,{scale:{x:a,y:a},animations:n,x:e,y:d,z:t})}function u(a,u,o,r,s=null){n.playable;e++;const i="player_"+e;if(!n)throw"No GameTheme Defined";n.characters||(n.characters={});let c=!1;s&&n.playable.includes(s)||(r.character&&r.character.id?(s=r.character.id,c=!0):s=n.playable[v(n.playable.length)]),m[s]||(n.characters[s]=c?r.character.path:s,$(s,"characters",n.characters[s],h.NumFrames));let f=t({x:a,y:u,z:o,radius:36,name:i,animations:d(s,h.NumFrames)});return f.character=s,f.charName=i,f.endImage=s+"_front0",f.endScale=3,f}const o="https://api.pixelplush.dev/v1";let r="PixelPlush Game",s="unknown",n={},i={},c="",f=1920,l=1080,p=.5;const h={NumFrames:10,Animations:["front","left","back","right"]};let m={};var y="",g=!0;let b="",x=!0,_={};function v(e){return Math.floor(Math.random()*Math.floor(e))}function w(e){for(let d=e.length-1;d>0;d--){const t=Math.floor(Math.random()*(d+1));[e[d],e[t]]=[e[t],e[d]]}}async function S(e){let d=Object.keys(oe).length;return fetch(o+"/analytics/heartbeat",{method:"POST",body:JSON.stringify({session:y,game:s,theme:r,channel:i.channel,players:Object.keys(oe),count:d})}).then(e=>e.json())}function $(e,d,t,a,u=""){if(!m[e+u]){m[e+u]=!0;for(let o=0;o<a;o++)for(let a=0;a<h.Animations.length;a++){const r=h.Animations[a],s=`${t}_${r}`;u?Unicorn.Load(`${e}_${r}${u}`,`${c}/assets/${d}/${e}/${s}/${s}${u}.png`):Unicorn.Load(`${e}_${r}${o}`,`${c}/assets/${d}/${e}/${s}/${s}${o+1}.png`)}}}async function A(e,d,t,a){return i.oauth?fetch(o+"/scores/add",{method:"POST",body:JSON.stringify({token:i.oauth.replace("oauth:",""),channel:i.channel,game:s,theme:r,user:e,score:d,userId:t,username:a})}).then(e=>e.json()):{}}window.setupGame=function(e,d,t){if(r=e,n=d,i=t,c=n.path||"",i.clouds=void 0===i.clouds||null===i.clouds?!i.overlay:"true"===i.clouds,p=void 0===i.volume||null===i.volume?0:parseInt(i.volume)/100,f=Math.min(window.innerWidth,1920),l=Math.min(window.innerHeight,1080),i.variations&&!i.didRandom){const e=i.variations.split(","),d=v(e.length),t=`${window.location.protocol}//${window.location.host}${window.location.pathname.substr(0,window.location.pathname.lastIndexOf("/"))}/${e[d]}${window.location.search}&didRandom=1`;window.location.href=t}i.readyTime&&(x=!1,setTimeout(()=>{x=!0,ComfyJS.Say("Parachute Drop is ready!")},parseInt(i.readyTime||1e3)))},window.WebFontConfig={custom:{families:["Pixeltype"]},active(){!async function(){if(document.hidden)return void document.addEventListener("visibilitychange",()=>{location.reload()},!1);try{const e=(await fetch("https://www.pixelplush.dev/assets/shamelist.txt").then(e=>e.text())).split(",").map(e=>e.trim().toLowerCase());if(i.channel&&e&&e.includes(i.channel.toLowerCase())&&(console.log("This channel has been blocked for violating the PixelPlush Terms of Service."),g=!1),n.requires)try{if(account=await fetch(o+"/accounts",{headers:{Twitch:i.oauth?i.oauth.replace("oauth:",""):void 0}}).then(e=>e.json()),console.log(account),account.error)throw"Login Error";if(!account.owned.includes(n.requires))throw"Item not owned"}catch(e){return void console.log("Auth Validate Failed",e)}!async function(){s="parachute",i.cpDrop&&(_["Parachute Drop!"]={desc:"Drop into the PixelPlush Parachute Game!",color:"#F2C079",cost:parseInt(i.cpDropCost||50),callback:(e,d,t,a,u)=>{x&&(g?(N&&i.hideTilDrop&&(N=!1,ce.forEach(e=>e.visible=!0),ee.forEach(e=>e.isSensor=!1),Array.isArray(V)?(V[de].visible=!0,n.target_animate_on_landed||L()):V.visible=!0,Q&&(Array.isArray(Q)?(Q[te].visible=!0,n.target_animate_on_landed||L()):Q.visible=!0),K&&(K.visible=!0),i.spawnZombies&&he.forEach(e=>{e.isHidden=!1,e.position.y=l-40})),B?R.push({username:u.username,name:e,color:u.userColor||"#ffffff",message:a,emote:u.messageEmotes?Object.keys(u.messageEmotes)[0]:"",emoji:"",extra:u}):xe(u.username,e,u.userColor||"#ffffff",a,n.parachutes[v(n.parachutes.length)],n.petparachutes[v(n.petparachutes.length)],u.messageEmotes?Object.keys(u.messageEmotes)[0]:"","",u)):i.oauth&&ComfyJS.Say("The Parachute Drop game needs your attention. Please contact the PixelPlush team on Discord."))}});i.cpDroplets&&(_["Parachute Droplets"]={desc:"Add bouncing obstacles into the PixelPlush Parachute Game!",color:"#F2C079",cost:parseInt(i.cpDropletsCost||500),cooldown:parseInt(i.cpDropletsCD||5),callback:()=>{if(x)if(g)for(let e=0;e<5;e++)_e(100);else i.oauth&&ComfyJS.Say("The Parachute Drop game needs your attention. Please contact the PixelPlush team on Discord.")}});i.cpQueue&&(_["Group Parachute"]={desc:"Queue everyone for a group drop in the PixelPlush Parachute Game!",color:"#F2C079",cost:parseInt(i.cpQueueCost||500),cooldown:parseInt(i.cpQueueCD||120),callback:()=>{if(x)if(g)if(B)ComfyJS.Say("/me Group Drop is already queued.");else{i.queueSound&&Unicorn.PlaySound("sfx-group-queue",{volume:p}),B=!0,Object.keys(oe).forEach(e=>{Unicorn.RemoveBacklay("para_"+e),Unicorn.RemoveBacklay("petpara_"+e),Unicorn.RemoveObject(oe[e].player.charName),oe[e].pet&&Unicorn.RemoveObject(oe[e].pet.charName),Unicorn.RemoveText("name_"+e),Unicorn.RemoveBacklay("end_"+e),Unicorn.RemoveBacklay("petend_"+e),Unicorn.RemoveText(e+"_points"),delete oe[e]}),W.x=-1e3,W.y=-1e3,se="",re=0,X&&clearTimeout(X);const e=6e4;ComfyJS.Say(`/me Parachutes are queued for the next 60 seconds. !${i.command||"drop"} to join!`),setTimeout(()=>{ComfyJS.Say(`/me 30 seconds remaining. !${i.command||"drop"} to join!`)},e-3e4),setTimeout(()=>{ComfyJS.Say("/me 10 seconds. !"+(i.command||"drop"))},e-1e4),setTimeout(()=>{w(R),R.forEach(e=>{xe(e.username,e.name,e.color,e.message,e.selectedPara||n.parachutes[v(n.parachutes.length)],e.selectedPetPara||n.petparachutes[v(n.petparachutes.length)],e.emote,e.emoji,e.extra)}),R=[]},e)}else i.oauth&&ComfyJS.Say("The Parachute Drop game needs your attention. Please contact the PixelPlush team on Discord.")}})}()}catch(e){console.log(e)}Unicorn.Create("unicorn-display",{width:f,height:l,background:"transparent",init:ve,update:we,channel:i.channel,username:i.oauth?i.channel:void 0,password:i.oauth?i.oauth.replace("oauth:",""):void 0,onCommand:F,onChat:J,screenWalls:!1,gravity:{x:0,y:1}}),ComfyJS.onCheer=G,ComfyJS.onConnected=async(e,d,t)=>{if(t){!function(){Y=n.target_width||368,H=Y/2+v(f-Y),Z=l-47+(n.target_offset||0),n.target_walls&&(H<Y/2+70?H=Y/2+70:H>f-Y/2-70&&(H=f-Y/2-70));if(n.target_versions){const e=v(Object.keys(n.target_versions).length);Object.keys(n.target_versions).forEach((d,t)=>{e===t&&(ue=d);let a=n.target_versions[d];if(ae[d]={},Array.isArray(a.target))if(n.target_random){let e=v(a.target.length);V=Unicorn.AddBacklay("target"+d+e,"target"+d+e,H,Z,{scale:{x:2,y:2}}),V.zIndex=10,V.anchor.set(.5),V.visible=!1,ae[d].target=V}else{de=0,V=[];for(let e=0;e<a.target.length;e++){let t=Unicorn.AddBacklay("target"+d+e,"target"+d+e,H,Z,{scale:{x:2,y:2}});t.zIndex=10,t.anchor.set(.5),t.visible=!1,V.push(t)}ae[d].target=V,V[de].visible=!1,i.hideTilDrop||n.target_animate_on_landed||L()}else V=Unicorn.AddBacklay("target"+d,"target"+d,H,Z,{scale:{x:2,y:2}}),V.zIndex=10,V.anchor.set(.5),V.visible=!1,ae[d].target=V;if(a.target_overlay)if(Array.isArray(a.target_overlay)){te=0,Q=[];for(let e=0;e<a.target_overlay.length;e++){let t=Unicorn.AddBacklay("target_overlay"+d+e,"target_overlay"+d+e,H,Z,{scale:{x:2,y:2}});t.zIndex=11,t.anchor.set(.5),t.visible=!1,Q.push(t)}ae[d].target_overlay=Q,Q[te].visible=!1,i.hideTilDrop||n.target_animate_on_landed||L()}else Q=Unicorn.AddBacklay("target_overlay"+d,"target_overlay"+d,H,Z,{scale:{x:2,y:2}}),Q.zIndex=11,Q.anchor.set(.5),Q.visible=!1,ae[d].target_overlay=Q})}else{if(Array.isArray(n.target))if(n.target_random){let e=v(n.target.length);V=Unicorn.AddBacklay("target"+e,"target"+e,H,Z,{scale:{x:2,y:2}}),V.zIndex=10,V.anchor.set(.5)}else{de=0,V=[];for(let e=0;e<n.target.length;e++){let d=Unicorn.AddBacklay("target"+e,"target"+e,H,Z,{scale:{x:2,y:2}});d.zIndex=10,d.anchor.set(.5),d.visible=!1,V.push(d)}V[de].visible=!0,i.hideTilDrop||n.target_animate_on_landed||L()}else V=Unicorn.AddBacklay("target","target",H,Z,{scale:{x:2,y:2}}),V.zIndex=10,V.anchor.set(.5);if(n.target_overlay)if(Array.isArray(n.target_overlay)){te=0,Q=[];for(let e=0;e<n.target_overlay.length;e++){let d=Unicorn.AddBacklay("target_overlay"+e,"target_overlay"+e,H,Z,{scale:{x:2,y:2}});d.zIndex=11,d.anchor.set(.5),d.visible=!1,Q.push(d)}Q[te].visible=!0,i.hideTilDrop||n.target_animate_on_landed||L()}else Q=Unicorn.AddBacklay("target_overlay","target_overlay",H,Z,{scale:{x:2,y:2}}),Q.zIndex=11,Q.anchor.set(.5)}n.target_front&&(K=Unicorn.AddOverlay("target_front","target_front",H,Z,{scale:{x:2,y:2}}),K.anchor.set(.5));if(i.clouds)for(let e=0;e<11;e++){z++;let e=n.clouds[v(n.clouds.length)],d=Unicorn.AddOverlay("cloud_"+z,e,v(f),v(500),{scale:{x:3,y:3}});d.alpha=i.overlay?.5:.9,d.anchor.set(.5),d.speed=.01+.1*Math.random(),d.zIndex=d.speed,ce.push(d)}if(n.target_walls){let e=Unicorn.AddObject("TargetTop",{type:"rectangle",x:H,y:Z+n.target_walls/2+n.target_collide_land,width:Y-50,height:10,isStatic:!0});e.sprite.visible=!1;let d=Unicorn.AddObject("TargetLeft",{type:"rectangle",x:H-Y/2+27,y:Z+n.target_walls,width:10,height:100,isStatic:!0});d.sprite.visible=!1;let t=Unicorn.AddObject("TargetRight",{type:"rectangle",x:H+Y/2-27,y:Z+n.target_walls,width:10,height:100,isStatic:!0});t.sprite.visible=!1,ee.push(e),ee.push(d),ee.push(t)}i.hideTilDrop&&(ce.forEach(e=>e.visible=!1),ee.forEach(e=>e.isSensor=!0),Array.isArray(n.target)&&!n.target_random?V.forEach(e=>{e.visible=!1}):V.visible=!1,Q&&(Array.isArray(n.target_overlay)&&!n.target_random?Q.forEach(e=>{e.visible=!1}):Q.visible=!1),K&&(K.visible=!1));if(i.spawnZombies){const e=i.spawnZombies.split(",").map(e=>e.trim());pe=e[v(e.length)];const d=1;for(let e=0;e<d;e++){let e=v(f);Math.abs(H-e)<Y/2+10&&(e=H+(e<H?-Y/2-10:Y/2+10));let d=u(e,l-40,110,{character:{id:pe,path:pe}});d.isSensor=!0,d.isStatic=!0,i.hideTilDrop&&(d.isHidden=!0,d.position.y=l+100),d.timeTilNextWalk=3e3+v(27e3),d.walkDirection=v(2)>0?"left":"right",Unicorn.PlayObjectAnimation(d.charName,d.walkDirection),he.push(d)}}}();let e=await S();if(0!==e&&(y=e.session,setInterval(()=>{S()},6e4)),i.oauth){let e=await async function(e){return await fetch("https://id.twitch.tv/oauth2/validate",{headers:{Authorization:"OAuth "+e}}).then(e=>e.json()).catch(e=>({error:e}))}(i.oauth.replace("oauth:",""));b=e.client_id,["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every(d=>e.scopes.includes(d))||console.log("Need more permissions"),e.expires_in<1800&&console.log("Token expires soon. Need to generate new link")}let d=await ComfyJS.GetChannelRewards(b,!0),t=Object.keys(_);for(let e=0;e<t.length;e++){let a=t[e];if(!d.some(e=>e.title===a))try{await ComfyJS.CreateChannelReward(b,{title:a,prompt:_[a].desc,cost:_[a].cost,is_enabled:!0,background_color:_[a].color,is_user_input_required:!1,is_max_per_stream_enabled:!1,max_per_stream:0,is_max_per_user_per_stream_enabled:!1,max_per_user_per_stream:0,is_global_cooldown_enabled:!!_[a].cooldown,global_cooldown_seconds:_[a].cooldown,should_redemptions_skip_request_queue:!0})}catch(e){console.log(e)}}}},ComfyJS.onReward=(e,d,t,a,u)=>{_[d]&&_[d].callback(e,d,t,a,u)}}()}},function(){const e=document.createElement("script");e.src=("https:"===document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",e.type="text/javascript",e.async="true";const d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(e,d)}();const U={parse:function(e,d){var t=d&&d.assetType?d.assetType:"svg",a=d&&d.buildUrl?d.buildUrl:function(e,d){return"png"===d?"https://twemoji.maxcdn.com/2/72x72/"+e+".png":"https://twemoji.maxcdn.com/2/svg/"+e+".svg"},u=[];j.default.lastIndex=0;for(;;){var o=j.default.exec(e);if(!o)break;var r=o[0],s=C(I(r)).join("-");u.push({url:s?a(s,t):"",indices:[o.index,j.default.lastIndex],text:r,type:O})}return u}};U.toCodePoints=C;var k,j=(k=/(?:\ud83d\udc68\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c\udffb|\ud83d\udc68\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc]|\ud83d\udc68\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd]|\ud83d\udc68\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffc-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffd-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c\udffb|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb\udffc]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd\udfff]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffd]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffe]|\ud83e\uddd1\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c\udffb|\ud83e\uddd1\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb\udffc]|\ud83e\uddd1\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udffd]|\ud83e\uddd1\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udffe]|\ud83e\uddd1\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\u200d\ud83e\udd1d\u200d\ud83e\uddd1|\ud83d\udc6b\ud83c[\udffb-\udfff]|\ud83d\udc6c\ud83c[\udffb-\udfff]|\ud83d\udc6d\ud83c[\udffb-\udfff]|\ud83d[\udc6b-\udc6d])|(?:\ud83d[\udc68\udc69])(?:\ud83c[\udffb-\udfff])?\u200d(?:\u2695\ufe0f|\u2696\ufe0f|\u2708\ufe0f|\ud83c[\udf3e\udf73\udf93\udfa4\udfa8\udfeb\udfed]|\ud83d[\udcbb\udcbc\udd27\udd2c\ude80\ude92]|\ud83e[\uddaf-\uddb3\uddbc\uddbd])|(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75]|\u26f9)((?:\ud83c[\udffb-\udfff]|\ufe0f)\u200d[\u2640\u2642]\ufe0f)|(?:\ud83c[\udfc3\udfc4\udfca]|\ud83d[\udc6e\udc71\udc73\udc77\udc81\udc82\udc86\udc87\ude45-\ude47\ude4b\ude4d\ude4e\udea3\udeb4-\udeb6]|\ud83e[\udd26\udd35\udd37-\udd39\udd3d\udd3e\uddb8\uddb9\uddcd-\uddcf\uddd6-\udddd])(?:\ud83c[\udffb-\udfff])?\u200d[\u2640\u2642]\ufe0f|(?:\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f|\ud83c\udff3\ufe0f\u200d\ud83c\udf08|\ud83c\udff4\u200d\u2620\ufe0f|\ud83d\udc15\u200d\ud83e\uddba|\ud83d\udc41\u200d\ud83d\udde8|\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc6f\u200d\u2640\ufe0f|\ud83d\udc6f\u200d\u2642\ufe0f|\ud83e\udd3c\u200d\u2640\ufe0f|\ud83e\udd3c\u200d\u2642\ufe0f|\ud83e\uddde\u200d\u2640\ufe0f|\ud83e\uddde\u200d\u2642\ufe0f|\ud83e\udddf\u200d\u2640\ufe0f|\ud83e\udddf\u200d\u2642\ufe0f)|[#*0-9]\ufe0f?\u20e3|(?:[Â©Â®\u2122\u265f]\ufe0f)|(?:\ud83c[\udc04\udd70\udd71\udd7e\udd7f\ude02\ude1a\ude2f\ude37\udf21\udf24-\udf2c\udf36\udf7d\udf96\udf97\udf99-\udf9b\udf9e\udf9f\udfcd\udfce\udfd4-\udfdf\udff3\udff5\udff7]|\ud83d[\udc3f\udc41\udcfd\udd49\udd4a\udd6f\udd70\udd73\udd76-\udd79\udd87\udd8a-\udd8d\udda5\udda8\uddb1\uddb2\uddbc\uddc2-\uddc4\uddd1-\uddd3\udddc-\uddde\udde1\udde3\udde8\uddef\uddf3\uddfa\udecb\udecd-\udecf\udee0-\udee5\udee9\udef0\udef3]|[\u203c\u2049\u2139\u2194-\u2199\u21a9\u21aa\u231a\u231b\u2328\u23cf\u23ed-\u23ef\u23f1\u23f2\u23f8-\u23fa\u24c2\u25aa\u25ab\u25b6\u25c0\u25fb-\u25fe\u2600-\u2604\u260e\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262a\u262e\u262f\u2638-\u263a\u2640\u2642\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267b\u267f\u2692-\u2697\u2699\u269b\u269c\u26a0\u26a1\u26a7\u26aa\u26ab\u26b0\u26b1\u26bd\u26be\u26c4\u26c5\u26c8\u26cf\u26d1\u26d3\u26d4\u26e9\u26ea\u26f0-\u26f5\u26f8\u26fa\u26fd\u2702\u2708\u2709\u270f\u2712\u2714\u2716\u271d\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u2764\u27a1\u2934\u2935\u2b05-\u2b07\u2b1b\u2b1c\u2b50\u2b55\u3030\u303d\u3297\u3299])(?:\ufe0f|(?!\ufe0e))|(?:(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75\udd90]|[\u261d\u26f7\u26f9\u270c\u270d])(?:\ufe0f|(?!\ufe0e))|(?:\ud83c[\udf85\udfc2-\udfc4\udfc7\udfca]|\ud83d[\udc42\udc43\udc46-\udc50\udc66-\udc69\udc6e\udc70-\udc78\udc7c\udc81-\udc83\udc85-\udc87\udcaa\udd7a\udd95\udd96\ude45-\ude47\ude4b-\ude4f\udea3\udeb4-\udeb6\udec0\udecc]|\ud83e[\udd0f\udd18-\udd1c\udd1e\udd1f\udd26\udd30-\udd39\udd3d\udd3e\uddb5\uddb6\uddb8\uddb9\uddbb\uddcd-\uddcf\uddd1-\udddd]|[\u270a\u270b]))(?:\ud83c[\udffb-\udfff])?|(?:\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc73\udb40\udc63\udb40\udc74\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc77\udb40\udc6c\udb40\udc73\udb40\udc7f|\ud83c\udde6\ud83c[\udde8-\uddec\uddee\uddf1\uddf2\uddf4\uddf6-\uddfa\uddfc\uddfd\uddff]|\ud83c\udde7\ud83c[\udde6\udde7\udde9-\uddef\uddf1-\uddf4\uddf6-\uddf9\uddfb\uddfc\uddfe\uddff]|\ud83c\udde8\ud83c[\udde6\udde8\udde9\uddeb-\uddee\uddf0-\uddf5\uddf7\uddfa-\uddff]|\ud83c\udde9\ud83c[\uddea\uddec\uddef\uddf0\uddf2\uddf4\uddff]|\ud83c\uddea\ud83c[\udde6\udde8\uddea\uddec\udded\uddf7-\uddfa]|\ud83c\uddeb\ud83c[\uddee-\uddf0\uddf2\uddf4\uddf7]|\ud83c\uddec\ud83c[\udde6\udde7\udde9-\uddee\uddf1-\uddf3\uddf5-\uddfa\uddfc\uddfe]|\ud83c\udded\ud83c[\uddf0\uddf2\uddf3\uddf7\uddf9\uddfa]|\ud83c\uddee\ud83c[\udde8-\uddea\uddf1-\uddf4\uddf6-\uddf9]|\ud83c\uddef\ud83c[\uddea\uddf2\uddf4\uddf5]|\ud83c\uddf0\ud83c[\uddea\uddec-\uddee\uddf2\uddf3\uddf5\uddf7\uddfc\uddfe\uddff]|\ud83c\uddf1\ud83c[\udde6-\udde8\uddee\uddf0\uddf7-\uddfb\uddfe]|\ud83c\uddf2\ud83c[\udde6\udde8-\udded\uddf0-\uddff]|\ud83c\uddf3\ud83c[\udde6\udde8\uddea-\uddec\uddee\uddf1\uddf4\uddf5\uddf7\uddfa\uddff]|\ud83c\uddf4\ud83c\uddf2|\ud83c\uddf5\ud83c[\udde6\uddea-\udded\uddf0-\uddf3\uddf7-\uddf9\uddfc\uddfe]|\ud83c\uddf6\ud83c\udde6|\ud83c\uddf7\ud83c[\uddea\uddf4\uddf8\uddfa\uddfc]|\ud83c\uddf8\ud83c[\udde6-\uddea\uddec-\uddf4\uddf7-\uddf9\uddfb\uddfd-\uddff]|\ud83c\uddf9\ud83c[\udde6\udde8\udde9\uddeb-\udded\uddef-\uddf4\uddf7\uddf9\uddfb\uddfc\uddff]|\ud83c\uddfa\ud83c[\udde6\uddec\uddf2\uddf3\uddf8\uddfe\uddff]|\ud83c\uddfb\ud83c[\udde6\udde8\uddea\uddec\uddee\uddf3\uddfa]|\ud83c\uddfc\ud83c[\uddeb\uddf8]|\ud83c\uddfd\ud83c\uddf0|\ud83c\uddfe\ud83c[\uddea\uddf9]|\ud83c\uddff\ud83c[\udde6\uddf2\uddfc]|\ud83c[\udccf\udd8e\udd91-\udd9a\udde6-\uddff\ude01\ude32-\ude36\ude38-\ude3a\ude50\ude51\udf00-\udf20\udf2d-\udf35\udf37-\udf7c\udf7e-\udf84\udf86-\udf93\udfa0-\udfc1\udfc5\udfc6\udfc8\udfc9\udfcf-\udfd3\udfe0-\udff0\udff4\udff8-\udfff]|\ud83d[\udc00-\udc3e\udc40\udc44\udc45\udc51-\udc65\udc6a-\udc6d\udc6f\udc79-\udc7b\udc7d-\udc80\udc84\udc88-\udca9\udcab-\udcfc\udcff-\udd3d\udd4b-\udd4e\udd50-\udd67\udda4\uddfb-\ude44\ude48-\ude4a\ude80-\udea2\udea4-\udeb3\udeb7-\udebf\udec1-\udec5\uded0-\uded2\uded5\udeeb\udeec\udef4-\udefa\udfe0-\udfeb]|\ud83e[\udd0d\udd0e\udd10-\udd17\udd1d\udd20-\udd25\udd27-\udd2f\udd3a\udd3c\udd3f-\udd45\udd47-\udd71\udd73-\udd76\udd7a-\udda2\udda5-\uddaa\uddae-\uddb4\uddb7\uddba\uddbc-\uddca\uddd0\uddde-\uddff\ude70-\ude73\ude78-\ude7a\ude80-\ude82\ude90-\ude95]|[\u23e9-\u23ec\u23f0\u23f3\u267e\u26ce\u2705\u2728\u274c\u274e\u2753-\u2755\u2795-\u2797\u27b0\u27bf\ue50a])|\ufe0f/g)&&k.__esModule?k:{default:k};var O=U.TypeName="emoji";var P=/\uFE0F/g,T=String.fromCharCode(8205),I=function(e){return e.indexOf(T)<0?e.replace(P,""):e};function C(e){for(var d=[],t=0,a=0,u=0;u<e.length;)t=e.charCodeAt(u++),a?(d.push((65536+(a-55296<<10)+(t-56320)).toString(16)),a=0):t>55296&&t<=56319?a=t:d.push(t.toString(16));return d}let E=0,D=!1,M=0;function L(e=0){if(D=!0,n.target_versions){Object.keys(ae).forEach(e=>{Array.isArray(V)?ae[e].target.forEach(e=>{e.visible=!1}):ae[e].target.visible=!1,ae[e].target_overlay.forEach(e=>{e.visible=!1})});const e=v(Object.keys(ae).length);ue=Object.keys(ae)[e],V=ae[ue].target,Q=ae[ue].target_overlay,Array.isArray(V)?V[de].visible=!0:V.visible=!0,Q[te].visible=!0}e>0&&(E=1e3*e)}let z=0,N=!0,R=[],B=!1,q=null;async function F(e,d,t,a,u){if(document.hidden)return;if((a.broadcaster||a.mod)&&("resetparachute"===d||"resetdrop"===d))if(i.variations){const e=i.variations.split(","),d=v(e.length),t=`${window.location.protocol}//${window.location.host}${window.location.pathname.substr(0,window.location.pathname.lastIndexOf("/"))}/${e[d]}${window.location.search}`;window.location.href=t}else location.reload();if((a.broadcaster||a.mod)&&("deleteparachute"===d||"deletedrop"===d)){let e=await ComfyJS.GetChannelRewards(b,!0),d=Object.keys(_);for(let t=0;t<d.length;t++){let a=d[t],u=e.find(e=>e.title===a);u&&await ComfyJS.DeleteChannelReward(b,u.id)}}if((a.broadcaster||a.mod)&&"unqueuedrop"===d&&B&&(ComfyJS.Say("/me Group drop is no longer queued."),B=!1),(a.broadcaster||a.mod)&&"queuedrop"===d&&(B?"MySperrr"===e?ComfyJS.Say("/me Damn it, Sim. It's already queued!"):ComfyJS.Say("/me Group drop is already queued."):(B=!0,Object.keys(oe).forEach(e=>{Unicorn.RemoveBacklay("para_"+e),Unicorn.RemoveBacklay("petpara_"+e),Unicorn.RemoveObject(oe[e].player.charName),oe[e].pet&&Unicorn.RemoveObject(oe[e].pet.charName),Unicorn.RemoveText("name_"+e),Unicorn.RemoveBacklay("end_"+e),Unicorn.RemoveBacklay("petend_"+e),Unicorn.RemoveText(e+"_points"),delete oe[e]}),W.x=-1e3,W.y=-1e3,se="",re=0,X&&clearTimeout(X),ComfyJS.Say("/me Drops are queued this game. !startdrop to activate!"))),(a.broadcaster||a.mod)&&"startdrop"===d&&B&&(w(R),R.forEach(e=>{xe(e.username,e.name,e.color,e.message,e.selectedPara||n.parachutes[v(n.parachutes.length)],e.selectedPetPara||n.petparachutes[v(n.petparachutes.length)],e.emote,e.emoji,e.extra)}),R=[]),(a.broadcaster||a.mod)&&"testdrop"===d)for(var r=0;r<50;r++)z++,xe("test_"+z,"test_"+z,u.userColor||"#ffffff",Object.keys(n.characters)[v(Object.keys(n.characters).length)],n.parachutes[v(n.parachutes.length)],n.petparachutes[v(n.petparachutes.length)],"","",u);if((a.broadcaster||a.mod)&&"droplet"===d){let e=parseInt(t||Math.pow(10,v(6)));for(let d=0;d<5;d++)_e(e)}if(("drophigh"===d||"drophighscore"===d||"dropbest"===d)&&i.oauth){let e=await async function(){if(i.oauth){const e=new Date;e.setDate(e.getDate()-1);const d=e.toISOString().split("T")[0];return(await fetch(`${o}/scores/high?channel=${i.channel}&game=${s}&date=${d}`,{method:"GET"}).then(e=>e.json()))[0]}return null}();e&&e.score&&ComfyJS.Say(`/me The highest score in the past 24 hours is ${e.score} by ${e.user}`)}if(("droplow"===d||"droplowscore"===d||"dropworst"===d)&&i.oauth){let e=await async function(){if(i.oauth){const e=new Date;e.setDate(e.getDate()-1);const d=e.toISOString().split("T")[0];return(await fetch(`${o}/scores/low?channel=${i.channel}&game=${s}&date=${d}`,{method:"GET"}).then(e=>e.json()))[0]}return null}();e&&e.score&&ComfyJS.Say(`/me The lowest score in the past 24 hours is ${e.score} by ${e.user}`)}if(("droptop"===d||"droptopscores"===d||"dropleaderboard"===d||"dropscores"===d)&&i.oauth){let e=await async function(){if(i.oauth){const e=new Date;e.setDate(e.getDate()-1);const d=e.toISOString().split("T")[0];return await fetch(`${o}/scores/high?channel=${i.channel}&game=${s}&date=${d}`,{method:"GET"}).then(e=>e.json())}return[]}();if(e&&e.length>0){let d=Array.from(new Set(e.map(e=>e.userId))).slice(0,10).map(d=>e.find(e=>e.userId===d));ComfyJS.Say("/me Top players in the past 24 hours are "+d.map((e,d)=>`${d+1}. ${e.user} (${e.score})`).join(", "))}else ComfyJS.Say("/me There are no scores recorded in the past 24 hours")}if("droprecent"===d&&i.oauth){let e=await async function(){if(i.oauth){return await fetch(`${o}/scores/recent?channel=${i.channel}&game=${s}`,{method:"GET"}).then(e=>e.json())}return[]}();if(e&&e.length>0){let d=Array.from(new Set(e.map(e=>e.userId))).slice(0,10).map(d=>e.find(e=>e.userId===d));ComfyJS.Say("/me Latest scores are "+d.map((e,d)=>`${e.user} (${e.score})`).join(", "))}else ComfyJS.Say("/me There are no recent scores")}let c=!1;if(!i.commandOn&&i.cpDrop||!i.command||d!==i.command||(c=!0),!i.commandOn&&i.cpDrop||i.command||"drop"!==d||(c=!0),i.outfit&&"outfit"===d){c=!0,q||(q=await fetch("https://www.pixelplush.dev/assets/catalog_outfits.json").then(e=>e.json()));let e={};for(const d of q)e[d.type]||(e[d.type]=[]),e[d.type].push(d);let d={};if(Math.random()<.1){const t=e.equipment[v(e.equipment.length)];d.equipment={[t.group]:t.path}}const a=e.body.filter(e=>"skintones"===e.group),u=e.body.filter(e=>"expressions"===e.group),o=e.body.filter(e=>"hair"===e.group),r=a[v(a.length)],s=u[v(u.length)],n=o[v(o.length)];if(d.body={skintones:r.path,expressions:s.path,hair:n.path},Math.random()<.05);else{const t=e.outfits.filter(e=>"dresses"===e.group),a=e.outfits.filter(e=>"pants"===e.group),u=e.outfits.filter(e=>"shirts"===e.group);d.outfits={},Math.random()<.25&&(d.outfits.dresses=t[v(t.length)].path),Math.random()<.95&&(d.outfits.pants=a[v(a.length)].path),Math.random()<.95&&(d.outfits.shirts=u[v(u.length)].path)}let i={};for(const d of e.accessories)i[d.group]||(i[d.group]=[]),i[d.group].push(d);let f=Object.keys(i);d.accessories={};for(const e of f)Math.random()<.5&&(d.accessories[e]=i[e][v(i[e].length)].path);t=d}if(x)if(g){if(c){N&&i.hideTilDrop&&(N=!1,ce.forEach(e=>e.visible=!0),ee.forEach(e=>e.isSensor=!1),Array.isArray(V)?(V[de].visible=!0,n.target_animate_on_landed||L()):V.visible=!0,Q&&(Array.isArray(Q)?(Q[te].visible=!0,n.target_animate_on_landed||L()):Q.visible=!0),K&&(K.visible=!0),i.spawnZombies&&he.forEach(e=>{e.isHidden=!1,e.position.y=l-40}));const a=U.parse(t,{assetType:"png"});if(!u.messageEmotes&&a.length>0)B?R.push({username:u.username,name:e,color:u.userColor||"#ffffff",message:t,emote:"",emoji:a[0].url,extra:u}):xe(u.username,e,u.userColor||"#ffffff",t,n.parachutes[v(n.parachutes.length)],n.petparachutes[v(n.petparachutes.length)],"",a[0].url,u);else if(n.pridechutes){const a=Object.keys(n.pridechutes),o=u.messageEmotes?Object.keys(u.messageEmotes):[],r=o.map(e=>{const a=u.messageEmotes[e][0].split("-").map(e=>parseInt(e));return`!${d} ${t}`.substring(a[0],a[1]+1)}),s=r.filter(e=>e.toLowerCase().includes("pride"));let i=a.find(e=>s.some(d=>d.toLowerCase().includes(e)));if(i){const d=n.pridechutes[i];let a=o.find((e,d)=>!r[d].toLowerCase().includes(i));B?R.push({username:u.username,name:e,color:u.userColor||"#ffffff",message:t,selectedPara:d,selectedPetPara:d,emote:a,emoji:"",extra:u}):xe(u.username,e,u.userColor||"#ffffff",t,d,d,a,"",u)}else B?R.push({username:u.username,name:e,color:u.userColor||"#ffffff",message:t,emote:u.messageEmotes?Object.keys(u.messageEmotes)[0]:"",emoji:"",extra:u}):xe(u.username,e,u.userColor||"#ffffff",t,n.parachutes[v(n.parachutes.length)],n.petparachutes[v(n.petparachutes.length)],u.messageEmotes?Object.keys(u.messageEmotes)[0]:"","",u)}else B?R.push({username:u.username,name:e,color:u.userColor||"#ffffff",message:t,emote:u.messageEmotes?Object.keys(u.messageEmotes)[0]:"",emoji:"",extra:u}):xe(u.username,e,u.userColor||"#ffffff",t,n.parachutes[v(n.parachutes.length)],n.petparachutes[v(n.petparachutes.length)],u.messageEmotes?Object.keys(u.messageEmotes)[0]:"","",u)}}else c&&i.oauth&&ComfyJS.Say("The Parachute Drop game needs your attention. Please contact the PixelPlush team on Discord.")}function J(e,d,t,a,u){document.hidden}function G(e,d,t,a,u){if(!document.hidden&&x&&g)for(let e=0;e<5;e++)_e(d)}let W,X=null,Y=368,H=0,Z=0,V=null,Q=null,K=null,ee=[],de=0,te=0,ae={},ue=null,oe={},re=0,se="",ne={},ie={},ce=[],fe=[],le=[],pe="zombie",he=[],me=0;function ye(e,d,t,a,u,o=""){me++;let r=Math.min(Math.max(1,u),100);Unicorn.AddParticles("Splash_"+me,{blendMode:PIXI.BLEND_MODES.DEFAULT,shape:"cone",angle:-Math.PI/2,spread:Math.PI/2,startColor:e,endColor:d,intensity:r,minSpeed:.05,maxSpeed:.25,gravityX:0,gravityY:3.5,fadeOut:!0,decay:1,image:o||void 0},t,a),function(e,d=2e3){setTimeout(()=>{Unicorn.RemoveParticles(e)},d)}("Splash_"+me,150)}function ge(e,d,t,a=""){const u=n.target_boosh_scale||2;n.target_boosh.forEach((t,a)=>{for(let t=0;t<v(5);t++){me++;let a=Unicorn.AddBacklay("boosh_"+me,"target_boosh"+t,e,d+10,{scale:{x:u,y:u}});a.zIndex=11,a.vX=v(50)-25,a.vY=-350+v(100),a.anchor.set(.5),fe.push(a)}})}function be(e,d,t,a=""){const u=n.target_splash_scale||2;n.target_splash.forEach((t,a)=>{for(let t=0;t<v(5);t++){me++;let a=Unicorn.AddBacklay("splash_"+me,"target_splash"+t,e,d+10,{scale:{x:u,y:u}});a.zIndex=11,a.vX=v(100)-50,a.vY=-300+v(100),a.anchor.set(.5),le.push(a)}})}async function xe(r,s,c="#ffffff",l,y,g,b="",x="",_){let w=4/60;if(!oe[r]){oe[r]={};let A=null,U=null,k=null,j=tinycolor(c),O=await async function(e){let d={};try{if(!e)return d;let t=await fetch(`${o}/accounts/twitch/design?username=${e}`).then(e=>e.json());return t&&(d=t.style||{}),d}catch(e){console.log(e)}}(r);if(b){if(!ne[b]){if(ne[b]=!0,b.startsWith("emotesv2_")){let e=`https://static-cdn.jtvnw.net/emoticons/v2/${b}/default/dark/2.0`,d=await fetchGif(e);if(d.length>0){const e=function(e,d){const t=Math.min(...e.map(e=>e.delay)),a=Math.max(...e.map(e=>e.dims.width)),u=Math.max(...e.map(e=>e.dims.height)),o=a,r=u;let s=0;for(let r=0;r<e.length;r++){let n=document.createElement("canvas");n.width=a,n.height=u;let i=n.getContext("2d"),c=i.createImageData(a,u);if(1===e[r].disposalType){let d=r;for(let t=e[d].dims.top;t<u;t++)for(let u=e[d].dims.left;u<a;u++)t>=e[d].dims.top&&u>=e[d].dims.left&&t<e[d].dims.top+e[d].dims.height&&u<e[d].dims.left+e[d].dims.width&&e[d].pixels[t*o+u]!==e[d].transparentIndex?(c.data[t*o*4+4*u+0]=e[d].patch[t*o*4+4*u+0],c.data[t*o*4+4*u+1]=e[d].patch[t*o*4+4*u+1],c.data[t*o*4+4*u+2]=e[d].patch[t*o*4+4*u+2],c.data[t*o*4+4*u+3]=e[d].patch[t*o*4+4*u+3]):0===d&&(c.data[t*o*4+4*u+0]=e[0].patch[t*o*4+4*u+0],c.data[t*o*4+4*u+1]=e[0].patch[t*o*4+4*u+1],c.data[t*o*4+4*u+2]=e[0].patch[t*o*4+4*u+2],c.data[t*o*4+4*u+3]=e[0].patch[t*o*4+4*u+3])}else if(3===e[r].disposalType){let d=null;for(let t=0;t<=r;t++){for(let d=0;d<u;d++)for(let u=0;u<a;u++)if(d>=e[t].dims.top&&u>=e[t].dims.left&&d<e[t].dims.top+e[t].dims.height&&u<e[t].dims.left+e[t].dims.width){const a=(d-e[t].dims.top)*e[t].dims.width+(u-e[t].dims.left),r=(d-e[t].dims.top)*e[t].dims.width*4+4*(u-e[t].dims.left);e[t].pixels[a]!==e[t].transparentIndex?(c.data[d*o*4+4*u+0]=e[t].patch[r+0],c.data[d*o*4+4*u+1]=e[t].patch[r+1],c.data[d*o*4+4*u+2]=e[t].patch[r+2],c.data[d*o*4+4*u+3]=e[t].patch[r+3]):(c.data[d*o*4+4*u+0]=0,c.data[d*o*4+4*u+1]=0,c.data[d*o*4+4*u+2]=0,c.data[d*o*4+4*u+3]=0)}0===t&&(d=c.data.slice())}}else{let d=r;for(let t=e[d].dims.top;t<u;t++)for(let u=e[d].dims.left;u<a;u++){const a=(t-e[d].dims.top)*e[d].dims.width+(u-e[d].dims.left),r=(t-e[d].dims.top)*e[d].dims.width*4+4*(u-e[d].dims.left);t>=e[d].dims.top&&u>=e[d].dims.left&&t<e[d].dims.top+e[d].dims.height&&u<e[d].dims.left+e[d].dims.width&&e[d].pixels[a]!==e[d].transparentIndex&&(c.data[t*o*4+4*u+0]=e[d].patch[r+0],c.data[t*o*4+4*u+1]=e[d].patch[r+1],c.data[t*o*4+4*u+2]=e[d].patch[r+2],c.data[t*o*4+4*u+3]=e[d].patch[r+3])}}i.putImageData(c,0,0);for(let o=0;o<e[r].delay;o+=t)Unicorn.LoadCustom(`${d}${s}`,n,"texture",{width:a,height:u}),s++}return{frames:s,minDelay:t,width:o,height:r}}(d,"emote_"+b);ne[b]={frames:e.frames,framerate:1/60*(1e3/e.minDelay)},setTimeout(()=>{delete oe[r],xe(r,s,c,l,y,g,b,x,_)},500)}else Unicorn.Load(`emote_${b}0`,e),setTimeout(()=>{delete oe[r],xe(r,s,c,l,y,g,b,x,_)},500)}else{let e=`https://static-cdn.jtvnw.net/emoticons/v1/${b}/2.0`;Unicorn.Load(`emote_${b}0`,e),setTimeout(()=>{delete oe[r],xe(r,s,c,l,y,g,b,x,_)},500)}return}let e=[];if(b.startsWith("emotesv2_")&&"boolean"!=typeof ne[b]){w=ne[b].framerate;for(let d=0;d<ne[b].frames;d++)e.push(`emote_${b}${d}`)}else e=[`emote_${b}0`];A=t({x:v(f),y:-100-v(50),z:100,radius:36,scale:1.2,name:"player_"+r,framerate:ne[b].framerate,animations:{front:{numFrames:e.length,prefix:"emote_"+b}}}),A.charName="player_"+r,A.endImage=e[0],A.endScale=1.2}else if(x){if(!ie[x])return ie[x]=!0,Unicorn.Load(`emoji_${x}0`,x),void setTimeout(()=>{delete oe[r],xe(r,s,c,l,y,g,b,x,_)},500);A=t({x:v(f),y:-100-v(50),z:100,radius:36,scale:1,name:"player_"+r,animations:{front:{numFrames:1,prefix:"emoji_"+x}}}),A.charName="player_"+r,A.endImage=`emoji_${x}0`,A.endScale=1}else if(A="string"==typeof l?u(v(f),-100-v(50),100,O,l):function(u,o,r,s={}){e++;const i="player_"+e;if(!n)throw"No GameTheme Defined";let c=h.NumFrames,f="",l={};if(s.character){const e=s.character;m[e]||(n.characters[e]=e,$(e,"characters",n.characters[e],c)),l=t({x:u,y:o,z:r,radius:36,name:i,animations:d(e,c)}),l.character=e,l.charName=i,l.endImage=e+"_front0",l.endScale=3,l.sprites={}}else{if(s.equipment){const e=Object.keys(s.equipment);if(e.length>0){const d=e[0],t=s.equipment[d];c=1,f="_wheel",$(t,"skins/equipment/"+d,t,h.NumFrames)}}if(!s.body||!s.body.skintones)throw"No Body";{const e=s.body.skintones,n=s.body.expressions,p=s.body.hair;$(e,"skins/body/skintones",e,c,f),l=t({x:u,y:o,z:r,radius:36,name:i,animations:d(e,c),suffix:f}),l.character=e,l.charName=i,l.endImage=e+"_front0",l.endScale=3,l.sprites={},$(n,"skins/body/expressions",n,c,f),l.sprites.expr=a({x:u,y:o,z:r+1,name:i+"_expr",animations:d(n,c),suffix:f}),Unicorn.AttachSpriteToObject(i+"_expr",i),$(p,"skins/body/hair",p,c,f),l.sprites.hair=a({x:u,y:o,z:r+2,name:i+"_hair",animations:d(p,c),suffix:f}),Unicorn.AttachSpriteToObject(i+"_hair",i)}if(s.equipment){const e=Object.keys(s.equipment);if(e.length>0){const t=e[0],n=s.equipment[t];l.sprites.eq=a({x:u,y:o,z:r+10,name:i+"_eq",animations:d(n,h.NumFrames)}),Unicorn.AttachSpriteToObject(i+"_eq",i)}}}if(s.outfits){const e=s.outfits.pants,t=s.outfits.shirts,n=s.outfits.dresses;e&&($(e,"skins/outfits/pants",e,c,f),l.sprites.pants=a({x:u,y:o,z:r+3,name:i+"_pants",animations:d(e,c),suffix:f}),Unicorn.AttachSpriteToObject(i+"_pants",i)),t&&($(t,"skins/outfits/shirts",t,c,f),l.sprites.shirts=a({x:u,y:o,z:r+4,name:i+"_shirts",animations:d(t,c),suffix:f}),Unicorn.AttachSpriteToObject(i+"_shirts",i)),n&&($(n,"skins/outfits/dresses",n,c,f),l.sprites.dresses=a({x:u,y:o,z:r+5,name:i+"_dresses",animations:d(n,c),suffix:f}),Unicorn.AttachSpriteToObject(i+"_dresses",i))}if(s.accessories)for(const e in s.accessories){const t=s.accessories[e];$(t,"skins/accessories/"+e,t,c,f),l.sprites["acc_"+t]=a({x:u,y:o,z:r+10,name:i+"_acc_"+t,animations:d(t,c),suffix:f}),Unicorn.AttachSpriteToObject(i+"_acc_"+t,i)}return l}(v(f),-100-v(50),100,l),"boybear"===A.character||"girlbear"===A.character){var S=PIXI.utils.string2hex(j.brighten(50).toHexString());Object.keys(A.animations).forEach(e=>{A.animations[e].tint=S})}k=function(a,u,o,r){if(!r||!r.pet||"pet_none"===r.pet.id)return null;e++;const s="pet_"+e;if(!n)throw"No GameTheme Defined";n.pets||(n.pets={});let i=r.pet.id.replace("pet_","");m[i]||(n.pets[i]={path:r.pet.path,minIdle:r.pet.minIdle,maxIdle:r.pet.maxIdle},$(i,"pets",r.pet.path,h.NumFrames));let c=t({x:a,y:u,z:o,radius:24,name:s,animations:d(n.pets[i].path,h.NumFrames)});return c.isStatic=!0,c.isSensor=!0,c.petName=i,c.charName=s,c}(-1e3,-1e3,200,O),k&&(U=k.petName);let P=Unicorn.AddBacklay("para_"+r,y,{scale:{x:0,y:0},x:-50,y:0,z:50});P.visible=!1,P.zIndex=11,P.scale.x=0,P.scale.y=0,P.anchor.set(.5,1);let T=Unicorn.AddText("name_"+r,s,-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:40,fontWeight:"bold",fill:c,lineJoin:"round",stroke:tinycolor.isReadable(j.toString(),"#000000")?"#000000":"#ffffff",strokeThickness:6});T.anchor.set(.5);let I=Unicorn.AddText(r+"_points","",-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:40,fontWeight:"bold",fill:"#ffd700",lineJoin:"round",stroke:"#000000",strokeThickness:6});I.anchor.set(.5);let C=null;U&&(C=Unicorn.AddBacklay("petpara_"+r,g||y,{scale:{x:0,y:0},x:-50,y:0,z:150}),C.visible=!1,C.zIndex=11,C.scale.x=0,C.scale.y=0,C.anchor.set(.5,1)),A.restitution=1,A.friction=0,A.frictionStatic=0,A.frictionAir=0,A.torque=-5+v(10),A.rotationOffset=Math.random()*Math.PI,Unicorn.SetVelocity(A.charName,v(24)-12,0),oe[r]={parachute:P,player:A,pet:k,petPara:C,petType:U,petOffset:30*Math.random()+(Math.random()>.5?-150:70),label:T,scoreLabel:I,nameColor:j},_&&(oe[r].userId=_.userId,oe[r].name=_.displayName||_.username),y&&y.includes("chute_plane")&&(oe[r].paraFlipDir=!0),g&&g.includes("chute_plane")&&(oe[r].petParaFlipDir=!0),Unicorn.PlaySound("sfx-parachute-drop",{volume:p}),X&&clearTimeout(X),X=setTimeout(()=>{if(i.variations){const e=i.variations.split(","),d=v(e.length),t=`${window.location.protocol}//${window.location.host}${window.location.pathname.substr(0,window.location.pathname.lastIndexOf("/"))}/${e[d]}${window.location.search}`;window.location.href=t}else location.reload()},parseInt(i.cooldown||"90000"))}}async function _e(e){if(!i.droplets)return;me++;let d=null,t=0;t=v(6);let a=3;n.dropletSizes&&(a*=n.dropletSizes[t]);let u=n.droplets[t];Array.isArray(n.droplets[t])&&(u=n.droplets[t][v(n.droplets[t].length)]),d=Unicorn.AddObject("droplet_"+me,{type:"circle",sprite:u,scale:{x:a,y:a},x:v(f),y:-100-v(50),z:100,radius:t/5*4+20}),d.restitution=1,d.friction=.5*(5-t),d.frictionStatic=0,d.frictionAir=0,d.torque=-1+v(2),d.rotationOffset=Math.random()*Math.PI,Unicorn.SetVelocity("droplet_"+me,v(24)-12,0),setTimeout(()=>{Unicorn.RemoveObject(d.label)},3e4)}function ve(){if(PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,Unicorn.Load("bg",`${c}/assets/${n.bg}.png`),!i.overlay){let e=Unicorn.AddBacklay("bg","bg",0,l-1080);e.scale.x=3,e.scale.y=3}if(n.target_versions)Object.keys(n.target_versions).forEach(e=>{let d=n.target_versions[e];if(Array.isArray(d.target)){d.target.map((d,t)=>Unicorn.Load("target"+e+t,`${c}/assets/${d}.png`))}else{Unicorn.Load("target"+e,`${c}/assets/${d.target}.png`)}if(Array.isArray(d.target_overlay)){d.target_overlay.map((d,t)=>Unicorn.Load("target_overlay"+e+t,`${c}/assets/${d}.png`))}else{Unicorn.Load("target_overlay"+e,`${c}/assets/${d.target_overlay}.png`)}if(d.target_effect){d.target_effect.map((d,t)=>Unicorn.Load("target_effect"+e+t,`${c}/assets/${d}.png`))}});else{if(Array.isArray(n.target)){n.target.map((e,d)=>Unicorn.Load("target"+d,`${c}/assets/${e}.png`))}else{Unicorn.Load("target",`${c}/assets/${n.target}.png`)}if(Array.isArray(n.target_overlay)){n.target_overlay.map((e,d)=>Unicorn.Load("target_overlay"+d,`${c}/assets/${e}.png`))}else if(n.target_overlay){Unicorn.Load("target_overlay",`${c}/assets/${n.target_overlay}.png`)}if(n.target_effect){n.target_effect.map((e,d)=>Unicorn.Load("target_effect"+d,`${c}/assets/${e}.png`))}}n.target_front&&Unicorn.Load("target_front",`${c}/assets/${n.target_front}.png`),n.target_boosh&&n.target_boosh.forEach((e,d)=>{Unicorn.Load("target_boosh"+d,`${c}/assets/${e}.png`)}),n.target_splash&&n.target_splash.forEach((e,d)=>{Unicorn.Load("target_splash"+d,`${c}/assets/${e}.png`)}),Unicorn.Load("star",c+"/assets/icons/star.png"),W=Unicorn.AddOverlay("star","star",-1e3,-1e3,{scale:{x:3,y:3}}),W.anchor.set(.5),n.parachutes.forEach(e=>Unicorn.Load(e,`${c}/assets/${e}.png`)),n.petparachutes?n.petparachutes.forEach(e=>Unicorn.Load(e,`${c}/assets/${e}.png`)):n.petparachutes=[],n.pridechutes&&Object.keys(n.pridechutes).forEach(e=>Unicorn.Load(n.pridechutes[e],`${c}/assets/${n.pridechutes[e]}.png`)),Object.keys(n.characters).forEach(e=>{$(e,"characters",n.characters[e],h.NumFrames)}),n.clouds.forEach(e=>Unicorn.Load(e,`${c}/assets/${e}.png`)),n.droplets.forEach(e=>{Array.isArray(e)?e.forEach(e=>Unicorn.Load(e,`${c}/assets/${e}.png`)):Unicorn.Load(e,`${c}/assets/${e}.png`)}),n.target_sound&&Unicorn.Load("sfx-target-drop",`${c}/assets/${n.target_sound}`),i.queueSound&&Unicorn.Load("sfx-group-queue",`${c}/assets/${n.queue_sound}`),Unicorn.Load("sfx-parachute-drop",`${c}/assets/${n.drop_sound}`),Unicorn.Load("sfx-parachute-flap",`${c}/assets/${n.parachute_sound}`),Unicorn.AddObject("WallLeft",{type:"rectangle",x:-200,y:0,width:400,height:2*l,friction:0,frictionAir:0,frictionStatic:0,bounce:1,isStatic:!0}).sprite.visible=!1,Unicorn.AddObject("WallRight",{type:"rectangle",x:f+200,y:0,width:400,height:2*l,friction:0,frictionAir:0,frictionStatic:0,bounce:1.01,isStatic:!0}).sprite.visible=!1,Unicorn.AddObject("WallBottom",{type:"rectangle",x:.5*f,y:l+100,friction:0,frictionAir:0,frictionStatic:0,bounce:1.01,width:f,height:200,isStatic:!0}).sprite.visible=!1,Matter.Events.on(physics,"beforeUpdate",(function(e){const d=Object.keys(oe);for(let e=0;e<d.length;e++){const t=d[e],a=oe[t];a.player&&(a.player.position.y<.5*-l?a.player.velocity.y>10&&Matter.Body.setVelocity(a.player,{x:a.player.velocity.x,y:10}):a.player.position.y>300&&a.player.velocity.y>.5&&Matter.Body.setVelocity(a.player,{x:a.player.velocity.x,y:.5}))}})),Matter.Events.on(physics,"afterUpdate",(function(e){const d=Object.keys(oe);for(let e=0;e<d.length;e++){const t=d[e],a=oe[t];if(a.pet){let e=Math.min(3,Math.max(0,.3*(a.player.position.y-300)));a.petPara.scale.x=a.petPara.scale.y=e/2,a.petParaFlipDir&&a.player.velocity.x>0&&(a.petPara.scale.x=-e/2),a.pet.angle=a.player.angle,a.pet.position.x=Math.max(20,Math.min(f-20,a.player.position.x+a.petOffset)),a.pet.position.y=Math.min(a.player.position.y+20,l-46-50+(n.target_y_offset||0)),a.petPara.rotation=a.player.angle,a.petPara.position.x=a.pet.position.x,a.petPara.position.y=a.pet.position.y}}}))}function we(e,d){const t=Object.keys(oe);for(let d=0;d<t.length;d++){const a=t[d],o=oe[a];if(o.player)if(o.isLanded){let e=a===se?1:.3;if(i.spawnZombies&&o.score<=0||(o.end.alpha=e,o.label.alpha=Math.round(e),o.scoreLabel.tint=o.label.tint=a===se?16777215:3355443),o.pet&&(o.petEnd.alpha=e),a===se?(o.end.zIndex=o.scoreLabel.zIndex=o.label.zIndex=9e3,o.pet&&(o.pet.zIndex=9001),o.label.position.x=o.player.position.x,o.label.position.y=o.player.position.y-80,o.scoreLabel.position.x=o.label.position.x+15,o.scoreLabel.position.y=o.label.position.y-30,o.label.style.fontSize=46,o.scoreLabel.style.fontSize=46,W.x=o.scoreLabel.x-o.scoreLabel.width/2-15,W.y=o.scoreLabel.y-5):(o.label.position.x=o.player.position.x,o.label.position.y=o.player.position.y-60,o.scoreLabel.position.y=o.label.position.y-30,o.scoreLabel.alpha=0,o.label.style.fontSize=40,o.scoreLabel.style.fontSize=40),i.spawnZombies&&!o.zombiefied)for(let e=0;e<he.length;e++){const d=he[e];if(o.end&&o.end.alpha>0&&Math.abs(o.end.x-d.position.x)<40){o.zombiefied=!0;const e={character:{id:pe,path:pe}};o.end.alpha=0;let d=u(o.end.x,l-40,110,e);d.isSensor=!0,d.isStatic=!0,d.timeTilNextWalk=3e3+v(27e3),d.walkDirection=v(2)>0?"left":"right",d.label=o.label,Unicorn.PlayObjectAnimation(d.charName,d.walkDirection);let t=PIXI.utils.string2hex(o.nameColor.brighten(50).toHexString());Object.keys(d.animations).forEach(e=>{d.animations[e].tint=t}),he.push(d),n.target_particles&&ye(n.target_particles[0],n.target_particles[1],o.end.x,l-40,10),n.target_boosh&&ge(o.end.x,l-40),n.target_splash&&be(o.end.x,l-40)}}}else{if(o.pet&&(o.pet.position.x=Math.max(20,Math.min(f-20,o.player.position.x+o.petOffset)),o.pet.position.y=Math.min(o.player.position.y+20,l-46-50+(n.target_y_offset||0)),o.petPara.position.x=o.pet.position.x,o.petPara.position.y=o.pet.position.y),o.player.position.y>l-46-50+(n.target_y_offset||0)||n.target_walls&&o.player.position.y>l-46-50+(n.target_collide_land||0)&&Y/2-20>Math.abs(H-o.player.position.x)){o.isLanded=!0,o.parachute.scale.x=o.parachute.scale.y=0,o.pet&&(o.petPara.scale.x=o.petPara.scale.y=0);let e=Unicorn.AddBacklay("end_"+a,o.player.endImage,o.player.position.x,o.player.position.y,{scale:{x:o.player.endScale,y:o.player.endScale}});if(o.player.animations&&(e.tint=o.player.animations.front.tint),e.anchor.set(.5),e.zIndex=20,o.player.isStatic=!0,n.target_walls?o.score=100*Math.max(0,Y/2-20-Math.abs(H-o.player.position.x))/(Y/2-20):o.score=100*Math.max(0,Y/2-Math.abs(H-o.player.position.x))/(Y/2),(!i.spawnZombies||o.score>0)&&(e.alpha=o.score>0?1:.3),o.end=e,o.pet){let e=Unicorn.AddBacklay("petend_"+a,o.petType+"_front0",o.pet.position.x,o.pet.position.y,{scale:{x:3,y:3}});o.pet.animations&&(e.tint=o.pet.animations.front.tint),e.anchor.set(.5),e.zIndex=30,o.pet.isStatic=!0,e.alpha=o.score>0?1:.3,o.petEnd=e}if(o.score>0){if(n.target_versions&&L(),n.target_effect){z++;const e="te_"+z;let d=Unicorn.AddObject(e,{type:"circle",scale:{x:2,y:2},animations:{front:{framerate:4/60,frames:Array.from({length:n.target_effect.length},(e,d)=>"target_effect"+d),loop:!1,onComplete:()=>{Unicorn.RemoveObject(e)}}},isSensor:!0,isStatic:!0,x:o.player.position.x,y:o.player.position.y,z:200,radius:.1});d.isSensor=!0,d.animations.front.anchor.y=1}if(ue&&n.target_versions[ue].target_effect){z++;const e="te_"+z;let d=Unicorn.AddObject(e,{type:"circle",scale:{x:2,y:2},animations:{front:{framerate:4/60,frames:Array.from({length:n.target_versions[ue].target_effect.length},(e,d)=>`target_effect${ue}${d}`),loop:!1,onComplete:()=>{Unicorn.RemoveObject(e)}}},isSensor:!0,isStatic:!0,x:o.player.position.x,y:o.player.position.y,z:200,radius:.1});d.isSensor=!0,d.animations.front.anchor.y=1}if(n.target_animate_on_landed&&L(2),n.target_particles&&ye(n.target_particles[0],n.target_particles[1],o.player.position.x,o.player.position.y+40,10),n.target_boosh&&ge(o.player.position.x,o.player.position.y+40),n.target_splash&&be(o.player.position.x,o.player.position.y+40),n.target_sound&&Unicorn.PlaySound("sfx-target-drop",{volume:p}),o.scoreLabel.x=o.label.position.x,o.scoreLabel.y=o.label.position.y-30,o.scoreLabel.text=o.score.toFixed(2),!a.startsWith("test_")){if(i.messageFormat){let e=i.messageFormat.replace("USERNAME",o.name).replace("POINTS",o.score.toFixed(2)).replace("SHORTPTS",Math.floor(o.score));setTimeout(()=>{ComfyJS.Say(e)},5e3)}A(o.name,o.score.toFixed(2),o.userId,a)}}o.score>re&&(re=o.score,se=a,e.zIndex=21),(!i.spawnZombies||o.score>0)&&(o.label.alpha=o.score>0?1:.3),Unicorn.RemoveObject(o.player.label),Unicorn.RemoveBacklay("para_"+a),o.pet&&(Unicorn.RemoveObject(o.pet.label),Unicorn.RemoveBacklay("petpara_"+a))}else if(o.player.position.y>300){let d=Math.min(3,Math.max(0,.3*(o.player.position.y-300)));0===o.parachute.scale.x&&d>0&&Unicorn.PlaySound("sfx-parachute-flap",{volume:p}),o.parachute.visible=!0,o.pet&&(o.petPara.visible=!0),o.parachute.scale.x=o.parachute.scale.y=d,o.paraFlipDir&&o.player.velocity.x>0&&(o.parachute.scale.x=-d),o.parachute.rotation=Math.sin(o.player.rotationOffset+e/1e3)*Math.PI/16,o.player.angle=Math.sin(o.player.rotationOffset+e/1e3)*Math.PI/16,o.parachute.position.x=o.player.position.x,o.parachute.position.y=o.player.position.y-10-(n.parachute_offset||0)}else o.parachute.visible=!1,o.parachute.scale.x=o.parachute.scale.y=0,o.pet&&(o.petPara.visible=!1,o.petPara.scale.x=o.petPara.scale.y=0);o.label.position.x=o.player.position.x,o.label.position.y=o.player.position.y-60}}for(let e=0;e<ce.length;e++){let t=ce[e];t.x-=d*t.speed,t.x+t.width/2<=0&&(t.x=f+t.width/2,t.y=v(500),t.speed=.01+.1*Math.random(),t.zIndex=t.speed)}for(let e=0;e<fe.length;e++){let t=fe[e];(t.vY<0||t.y<l-5)&&(t.x+=d/1e3*t.vX,t.y+=d/1e3*t.vY,t.vY<20&&(t.vY+=d/1e3*200))}for(let e=0;e<le.length;e++){let t=le[e];(t.vY<0||t.y<l-5)&&(t.x+=d/1e3*t.vX,t.y+=d/1e3*t.vY,t.vY+=d/1e3*200)}for(let e=0;e<he.length;e++){const t=he[e];if(t.isHidden)continue;let a=!1;t.position.x<=20&&"left"===t.walkDirection&&(a=!0),t.position.x>=f-20&&"right"===t.walkDirection&&(a=!0),Math.abs(H-t.position.x)<Y/2+10&&(a=!0,t.position.x<H?t.position.x=H-Y/2-10:t.position.x=H+Y/2+10),t.timeTilNextWalk-=d,t.timeTilNextWalk<=0&&(a=!0),a&&(t.timeTilNextWalk=3e3+v(27e3),t.walkDirection="right"===t.walkDirection?"left":"right",Unicorn.PlayObjectAnimation(t.charName,t.walkDirection)),t.position.x+=50*d/1e3*("left"===t.walkDirection?-1:1),t.label&&(t.label.x=t.position.x)}D&&(M-=d,M<=0&&(M=60,Array.isArray(V)&&(V[de].visible=!1,de=(de+1)%V.length,V[de].visible=!0),Q&&Array.isArray(Q)&&(Q[te].visible=!1,te=(te+1)%Q.length,Q[te].visible=!0))),E>0&&(E-=d,E<=0&&(D=!1,Array.isArray(V)&&(V[de].visible=!1,de=0,V[de].visible=!0),Q&&Array.isArray(Q)&&(V[te].visible=!1,te=0,V[te].visible=!0)))}