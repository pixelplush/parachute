const e="https://api.pixelplush.dev/v1";let t="Pixel Parachute",a={},o={},r="",s=1920,n=1080,i=.5;function c(e){return Math.floor(Math.random()*Math.floor(e))}window.setupGame=function(e,c,l){t=e,a=c,o=l,r=a.path||"",o.clouds=void 0===o.clouds||null===o.clouds?!o.overlay:"true"===o.clouds,i=void 0===o.volume||null===o.volume?0:parseInt(o.volume)/100,s=Math.min(window.innerWidth,1920),n=Math.min(window.innerHeight,1080)},window.WebFontConfig={custom:{families:["Pixeltype"]},active(){!async function(){if(document.hidden)return void document.addEventListener("visibilitychange",()=>{location.reload()},!1);try{const t=(await fetch("https://www.pixelplush.dev/assets/shamelist.txt").then(e=>e.text())).split(",").map(e=>e.trim().toLowerCase());if(o.channel&&t&&t.includes(o.channel.toLowerCase())&&(console.log("This channel has been blocked for violating the PixelPlush Terms of Service."),p=!1),a.requires)try{if(account=await fetch(`${e}/accounts`,{headers:{Twitch:o.oauth?o.oauth.replace("oauth:",""):void 0}}).then(e=>e.json()),console.log(account),account.error)throw"Login Error";if(!account.owned.includes(a.requires))throw"Item not owned"}catch(e){return void console.log("Auth Validate Failed",e)}o.cpDrop&&(d["Parachute Drop!"]={desc:"Drop into the PixelPlush Parachute Game!",color:"#F2C079",cost:parseInt(o.cpDropCost||50),callback:(e,t,r,s,n)=>{p?(b&&o.hideTilDrop&&(b=!1,z.forEach(e=>e.visible=!0),Array.isArray(E)?(E[C].visible=!0,a.target_animate_on_landed||g()):E.visible=!0,A&&(A.visible=!0)),v?_.push({username:n.username,name:e,color:n.userColor||"#ffffff",message:s,emote:n.messageEmotes?Object.keys(n.messageEmotes)[0]:"",emoji:"",extra:n}):Y(n.username,e,n.userColor||"#ffffff",s,a.parachutes[c(a.parachutes.length)],a.petparachutes[c(a.petparachutes.length)],n.messageEmotes?Object.keys(n.messageEmotes)[0]:"","",n)):o.oauth&&ComfyJS.Say("PixelParachute is disabled in this channel for violating the Terms of Service. To re-enable the game, please contact the PixelPlush team on Discord.")}}),o.cpDroplets&&(d["Parachute Droplets"]={desc:"Add bouncing obstacles into the PixelPlush Parachute Game!",color:"#F2C079",cost:parseInt(o.cpDropletsCost||500),cooldown:parseInt(o.cpDropletsCD||5),callback:()=>{if(p)for(let e=0;e<5;e++)G(100);else o.oauth&&ComfyJS.Say("PixelParachute is disabled in this channel for violating the Terms of Service. To re-enable the game, please contact the PixelPlush team on Discord.")}})}catch(e){console.log(e)}Unicorn.Create("unicorn-display",{width:s,height:n,background:"transparent",init:W,update:X,channel:o.channel,username:o.oauth?o.channel:void 0,password:o.oauth?o.oauth.replace("oauth:",""):void 0,onCommand:$,onChat:S,screenWalls:!1,gravity:{x:0,y:1}}),ComfyJS.onCheer=w,ComfyJS.onConnected=async(e,t,r)=>{if(r){!function(){if(j=a.target_width||368,I=j/2+c(s-j),O=n-47+(a.target_offset||0),Array.isArray(a.target))if(a.target_random){let e=c(a.target.length);E=Unicorn.AddBacklay("target"+e,"target"+e,I,O,{scale:{x:2,y:2}}),E.zIndex=10,E.anchor.set(.5)}else{C=0,E=[];for(let e=0;e<a.target.length;e++){let t=Unicorn.AddBacklay("target"+e,"target"+e,I,O,{scale:{x:2,y:2}});t.zIndex=10,t.anchor.set(.5),t.visible=!1,E.push(t)}E[C].visible=!0,o.hideTilDrop||a.target_animate_on_landed||g()}else E=Unicorn.AddBacklay("target","target",I,O,{scale:{x:2,y:2}}),E.zIndex=10,E.anchor.set(.5);a.target_front&&(A=Unicorn.AddOverlay("target_front","target_front",I,O,{scale:{x:2,y:2}}),A.anchor.set(.5));if(o.clouds)for(let e=0;e<11;e++){x++;let e=a.clouds[c(a.clouds.length)],t=Unicorn.AddOverlay("cloud_"+x,e,c(s),c(500),{scale:{x:3,y:3}});t.alpha=o.overlay?.5:.9,t.anchor.set(.5),t.speed=.01+.1*Math.random(),t.zIndex=t.speed,z.push(t)}o.hideTilDrop&&(z.forEach(e=>e.visible=!1),Array.isArray(a.target)&&!a.target_random?E.forEach(e=>{e.visible=!1}):E.visible=!1,A.visible=!1)}();let e=await f();if(0!==e&&(l=e.session,setInterval(()=>{f()},6e4)),o.oauth){let e=await async function(e){return await fetch("https://id.twitch.tv/oauth2/validate",{headers:{Authorization:`OAuth ${e}`}}).then(e=>e.json()).catch(e=>({error:e}))}(o.oauth.replace("oauth:",""));h=e.client_id,["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every(t=>e.scopes.includes(t))||console.log("Need more permissions"),e.expires_in<1800&&console.log("Token expires soon. Need to generate new link")}let t=await ComfyJS.GetChannelRewards(h,!0),r=Object.keys(d);for(let e=0;e<r.length;e++){let a=r[e];t.some(e=>e.title===a)||await ComfyJS.CreateChannelReward(h,{title:a,prompt:d[a].desc,cost:d[a].cost,is_enabled:!0,background_color:d[a].color,is_user_input_required:!1,is_max_per_stream_enabled:!1,max_per_stream:0,is_max_per_user_per_stream_enabled:!1,max_per_user_per_stream:0,is_global_cooldown_enabled:!!d[a].cooldown,global_cooldown_seconds:d[a].cooldown,should_redemptions_skip_request_queue:!0})}}},ComfyJS.onReward=(e,t,a,o,r)=>{d[t]&&d[t].callback(e,t,a,o,r)}}()}},function(){const e=document.createElement("script");e.src=`${"https:"===document.location.protocol?"https":"http"}://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js`,e.type="text/javascript",e.async="true";const t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();var l="",p=!0;let h="";const d={};async function f(){let a=Object.keys(k).length;return fetch(`${e}/analytics/heartbeat`,{method:"POST",body:JSON.stringify({session:l,game:"parachute",theme:t,channel:o.channel,players:Object.keys(k),count:a})}).then(e=>e.json())}async function u(a,r,s,n){return o.oauth?fetch(`${e}/scores/add`,{method:"POST",body:JSON.stringify({token:o.oauth.replace("oauth:",""),channel:o.channel,game:"parachute",theme:t,user:a,score:r,userId:s,username:n})}).then(e=>e.json()):{}}let m=null,y=0;function g(e=0){m&&clearInterval(m),m=setInterval(()=>{E[C].visible=!1,C=(C+1)%E.length,E[C].visible=!0},60),e>0&&(y=1e3*e)}let x=0,b=!0,_=[],v=!1;async function $(t,r,s,n,i){if(document.hidden)return;if(!n.broadcaster&&!n.mod||"resetparachute"!==r&&"resetdrop"!==r||location.reload(),(n.broadcaster||n.mod)&&("deleteparachute"===r||"deletedrop"===r)){let e=await ComfyJS.GetChannelRewards(h,!0),t=Object.keys(d);for(let a=0;a<t.length;a++){let o=t[a],r=e.find(e=>e.title===o);r&&await ComfyJS.DeleteChannelReward(h,r.id)}}if((n.broadcaster||n.mod)&&"queuedrop"===r&&(v=!v,Object.keys(k).forEach(e=>{Unicorn.RemoveBacklay("para_"+e),Unicorn.RemoveBacklay("petpara_"+e),Unicorn.RemoveObject("player_"+e),Unicorn.RemoveObject("pet_"+e),Unicorn.RemoveText("name_"+e),Unicorn.RemoveBacklay("end_"+e),Unicorn.RemoveBacklay("petend_"+e),Unicorn.RemoveText(e+"_points"),delete k[e]}),U.x=-1e3,U.y=-1e3,P&&clearTimeout(P),v?ComfyJS.Say("/me Drops are queued this game. !startdrop to activate!"):ComfyJS.Say("/me Drops are no longer queued.")),(n.broadcaster||n.mod)&&"startdrop"===r&&v&&(!function(e){for(let t=e.length-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}}(_),_.forEach(e=>{Y(e.username,e.name,e.color,e.message,e.selectedPara||a.parachutes[c(a.parachutes.length)],e.selectedPetPara||a.petparachutes[c(a.petparachutes.length)],e.emote,e.emoji,e.extra)}),_=[]),(n.broadcaster||n.mod)&&"testdrop"===r)for(var l=0;l<50;l++)x++,Y("test_"+x,"test_"+x,i.userColor||"#ffffff",Object.keys(a.characters)[c(Object.keys(a.characters).length)],a.parachutes[c(a.parachutes.length)],a.petparachutes[c(a.petparachutes.length)],"","",i);if((n.broadcaster||n.mod)&&"droplet"===r){let e=parseInt(s||Math.pow(10,c(6)));for(let t=0;t<5;t++)G(e)}if(("drophigh"===r||"drophighscore"===r||"dropbest"===r)&&o.oauth){let t=await async function(){if(o.oauth){const t=new Date;t.setDate(t.getDate()-1);const a=t.toISOString().split("T")[0];return(await fetch(`${e}/scores/high?channel=${o.channel}&game=parachute&date=${a}`,{method:"GET"}).then(e=>e.json()))[0]}return null}();t&&t.score&&ComfyJS.Say(`/me The highest score in the past 24 hours is ${t.score} by ${t.user}`)}if(("droplow"===r||"droplowscore"===r||"dropworst"===r)&&o.oauth){let t=await async function(){if(o.oauth){const t=new Date;t.setDate(t.getDate()-1);const a=t.toISOString().split("T")[0];return(await fetch(`${e}/scores/low?channel=${o.channel}&game=parachute&date=${a}`,{method:"GET"}).then(e=>e.json()))[0]}return null}();t&&t.score&&ComfyJS.Say(`/me The lowest score in the past 24 hours is ${t.score} by ${t.user}`)}if(("droptop"===r||"droptopscores"===r||"dropleaderboard"===r||"dropscores"===r)&&o.oauth){let t=await async function(){if(o.oauth){const t=new Date;t.setDate(t.getDate()-1);const a=t.toISOString().split("T")[0];return await fetch(`${e}/scores/high?channel=${o.channel}&game=parachute&date=${a}`,{method:"GET"}).then(e=>e.json())}return[]}();if(t&&t.length>0){let e=Array.from(new Set(t.map(e=>e.userId))).slice(0,10).map(e=>t.find(t=>t.userId===e));ComfyJS.Say(`/me Top players in the past 24 hours are ${e.map((e,t)=>`${t+1}. ${e.user} (${e.score})`).join(", ")}`)}else ComfyJS.Say("/me There are no scores recorded in the past 24 hours")}if("droprecent"===r&&o.oauth){let t=await async function(){if(o.oauth){return await fetch(`${e}/scores/recent?channel=${o.channel}&game=parachute`,{method:"GET"}).then(e=>e.json())}return[]}();if(t&&t.length>0){let e=Array.from(new Set(t.map(e=>e.userId))).slice(0,10).map(e=>t.find(t=>t.userId===e));ComfyJS.Say(`/me Latest scores are ${e.map((e,t)=>`${e.user} (${e.score})`).join(", ")}`)}else ComfyJS.Say("/me There are no recent scores")}let f=!1;if(!o.commandOn&&o.cpDrop||!o.command||r!==o.command||(f=!0),!o.commandOn&&o.cpDrop||o.command||"drop"!==r||(f=!0),p){if(f){b&&o.hideTilDrop&&(b=!1,z.forEach(e=>e.visible=!0),Array.isArray(E)?(E[C].visible=!0,a.target_animate_on_landed||g()):E.visible=!0,A&&(A.visible=!0));const e=twemoji.parse(s,{assetType:"png"});if(!i.messageEmotes&&e.length>0)v?_.push({username:i.username,name:t,color:i.userColor||"#ffffff",message:s,emote:"",emoji:e[0].url,extra:i}):Y(i.username,t,i.userColor||"#ffffff",s,a.parachutes[c(a.parachutes.length)],a.petparachutes[c(a.petparachutes.length)],"",e[0].url,i);else if(a.pridechutes){const e=Object.keys(a.pridechutes),o=i.messageEmotes?Object.keys(i.messageEmotes):[],n=o.map(e=>{const t=i.messageEmotes[e][0].split("-").map(e=>parseInt(e));return`!${r} ${s}`.substring(t[0],t[1]+1)}),l=n.filter(e=>e.toLowerCase().includes("pride"));let p=e.find(e=>l.some(t=>t.toLowerCase().includes(e)));if(p){const e=a.pridechutes[p];let r=o.find((e,t)=>!n[t].toLowerCase().includes(p));v?_.push({username:i.username,name:t,color:i.userColor||"#ffffff",message:s,selectedPara:e,selectedPetPara:e,emote:r,emoji:"",extra:i}):Y(i.username,t,i.userColor||"#ffffff",s,e,e,r,"",i)}else v?_.push({username:i.username,name:t,color:i.userColor||"#ffffff",message:s,emote:i.messageEmotes?Object.keys(i.messageEmotes)[0]:"",emoji:"",extra:i}):Y(i.username,t,i.userColor||"#ffffff",s,a.parachutes[c(a.parachutes.length)],a.petparachutes[c(a.petparachutes.length)],i.messageEmotes?Object.keys(i.messageEmotes)[0]:"","",i)}else v?_.push({username:i.username,name:t,color:i.userColor||"#ffffff",message:s,emote:i.messageEmotes?Object.keys(i.messageEmotes)[0]:"",emoji:"",extra:i}):Y(i.username,t,i.userColor||"#ffffff",s,a.parachutes[c(a.parachutes.length)],a.petparachutes[c(a.petparachutes.length)],i.messageEmotes?Object.keys(i.messageEmotes)[0]:"","",i)}}else f&&o.oauth&&ComfyJS.Say("PixelParachute is disabled in this channel for violating the Terms of Service. To re-enable the game, please contact the PixelPlush team on Discord.")}function S(e,t,a,o,r){document.hidden}function w(e,t,a,o,r){if(!document.hidden&&p)for(let e=0;e<5;e++)G(t)}let U,P=null,j=368,I=0,O=0,E=null,A=null,C=0,k={},L=0,T="",M={},D={},z=[],J=[],R=[],B=0;function F(e,t,a,o,r,s=""){B++;let n=Math.min(Math.max(1,r),100);Unicorn.AddParticles("Splash_"+B,{blendMode:PIXI.BLEND_MODES.DEFAULT,shape:"cone",angle:-Math.PI/2,spread:Math.PI/2,startColor:e,endColor:t,intensity:n,minSpeed:.05,maxSpeed:.25,gravityX:0,gravityY:3.5,fadeOut:!0,decay:1,image:s||void 0},a,o),function(e,t=2e3){setTimeout(()=>{Unicorn.RemoveParticles(e)},t)}("Splash_"+B,150)}function q(e,t,o,r=""){const s=a.target_boosh_scale||2;a.target_boosh.forEach((a,o)=>{for(let a=0;a<c(5);a++){B++;let o=Unicorn.AddBacklay("boosh_"+B,"target_boosh"+a,e,t+10,{scale:{x:s,y:s}});o.zIndex=11,o.vX=c(50)-25,o.vY=-350+c(100),o.anchor.set(.5),J.push(o)}})}function N(e,t,o,r=""){const s=a.target_splash_scale||2;a.target_splash.forEach((a,o)=>{for(let a=0;a<c(5);a++){B++;let o=Unicorn.AddBacklay("splash_"+B,"target_splash"+a,e,t+10,{scale:{x:s,y:s}});o.zIndex=11,o.vX=c(100)-50,o.vY=-300+c(100),o.anchor.set(.5),R.push(o)}})}async function Y(t,n,l="#ffffff",p,h,d,f="",u="",m){if(!k[t]){let x=!1;0,k[t]={};let b=null,_=null,v=null,$=tinycolor(l),S={};try{let a=await fetch(`${e}/accounts/twitch/design?username=${t}`).then(e=>e.json());a&&(S=a.style||{})}catch(e){console.log(e)}if(S.pet&&S.pet.id&&"pet_none"!==S.pet.id&&(a.pets||(a.pets={}),_=S.pet.id.replace("pet_",""),!a.pets[_])){a.pets[_]={path:S.pet.path,minIdle:S.pet.minIdle,maxIdle:S.pet.maxIdle};for(let e=0;e<10;e++){let t=S.pet.path+"_front";Unicorn.Load(t+e,`${r}/assets/pets/${_}/${t}/${t}${e+1}.png`)}}if(f){if(!M[f]){M[f]=!0;var y=`https://static-cdn.jtvnw.net/emoticons/v1/${f}/2.0`;return Unicorn.Load(`emote_${f}`,y),void setTimeout(()=>{delete k[t],Y(t,n,l,p,h,d,f,u,m)},500)}b=x?Unicorn.AddObject(t,{type:"circle",scale:{x:1.2,y:1.2},animations:{front:{framerate:4/60,frames:[`emote_${f}`],loop:!0}},x:I,y:-100-c(50),z:100,radius:.1}):Unicorn.AddObject("player_"+t,{type:"circle",scale:{x:1.2,y:1.2},animations:{front:{framerate:4/60,frames:[`emote_${f}`],loop:!0}},x:c(s),y:-100-c(50),z:100,radius:36}),b.endImage=`emote_${f}`,b.endScale=1.2}else if(u){if(!D[u])return D[u]=!0,Unicorn.Load(`emoji_${u}`,u),void setTimeout(()=>{delete k[t],Y(t,n,l,p,h,d,f,u,m)},500);b=x?Unicorn.AddObject(t,{type:"circle",scale:{x:1,y:1},animations:{front:{framerate:4/60,frames:[`emoji_${u}`],loop:!0}},x:I,y:-100-c(50),z:100,radius:.1}):Unicorn.AddObject("player_"+t,{type:"circle",scale:{x:1,y:1},animations:{front:{framerate:4/60,frames:[`emoji_${u}`],loop:!0}},x:c(s),y:-100-c(50),z:100,radius:36}),b.endImage=`emoji_${u}`,b.endScale=1}else{if(!a.characters[p])if(S.character&&S.character.id){if(!a.characters[S.character.id]){a.characters[S.character.id]=S.character.path;for(let e=0;e<10;e++){let t=a.characters[S.character.id];Unicorn.Load(`${S.character.id}_${e}`,`${r}/assets/characters/${S.character.id}/${t}_front/${t}_front${e+1}.png`)}}p=S.character.id}else p=a.playable[Math.floor(a.playable.length*Math.random())];if(b=x?Unicorn.AddObject(t,{type:"circle",scale:{x:3,y:3},animations:{front:{framerate:4/60,frames:[...Array(10).keys()].map(e=>`${p}_${e}`),loop:!0}},x:I,y:-100-c(50),z:100,radius:.1}):Unicorn.AddObject("player_"+t,{type:"circle",scale:{x:3,y:3},animations:{front:{framerate:4/60,frames:[...Array(10).keys()].map(e=>`${p}_${e}`),loop:!0}},x:c(s),y:-100-c(50),z:100,radius:36}),b.endImage=`${p}_0`,b.endScale=3,"boybear"===p||"girlbear"===p){var g=PIXI.utils.string2hex($.brighten(50).toHexString());b.animations.front.tint=g}}if(_){let e={front:[]};for(let t=0;t<10;t++)Object.keys(e).forEach(o=>{e[o].push(a.pets[_].path+"_"+o+t)});v=Unicorn.AddObject("pet_"+t,{type:"circle",scale:{x:3,y:3},animations:{front:{framerate:4/60,frames:e.front,loop:!0}},x:-1e3,y:-1e3,z:200,radius:24,isStatic:!0}),v.isSensor=!0}let w=Unicorn.AddBacklay("para_"+t,h,{scale:{x:3,y:3},x:50,y:0,z:50});w.zIndex=11,w.scale.x=0,w.scale.y=0,w.anchor.set(.5,1);let U=Unicorn.AddText("name_"+t,n,-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:40,fontWeight:"bold",fill:l,lineJoin:"round",stroke:$.getLuminance()<.6?"#ffffff":"#000000",strokeThickness:6});U.anchor.set(.5);let j=Unicorn.AddText(t+"_points","",-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:40,fontWeight:"bold",fill:"#ffd700",lineJoin:"round",stroke:"#000000",strokeThickness:6});j.anchor.set(.5);let O=null;_&&(O=Unicorn.AddBacklay("petpara_"+t,d||h,{scale:{x:1,y:1},x:50,y:0,z:150}),O.zIndex=11,O.scale.x=0,O.scale.y=0,O.anchor.set(.5,1)),b.restitution=1,x?(b.friction=0,b.frictionStatic=0,b.frictionAir=0,b.torque=0,b.rotationOffset=0,Unicorn.SetVelocity(t,0,0)):(b.friction=0,b.frictionStatic=0,b.frictionAir=0,b.torque=-5+c(10),b.rotationOffset=Math.random()*Math.PI,Unicorn.SetVelocity("player_"+t,c(24)-12,0)),k[t]={parachute:w,player:b,pet:v,petPara:O,petType:_,petOffset:30*Math.random()+(Math.random()>.5?-150:70),label:U,scoreLabel:j},m&&(k[t].userId=m.userId,k[t].name=m.displayName||m.username),Unicorn.PlaySound("sfx-parachute-drop",{volume:i}),P&&clearTimeout(P),P=setTimeout(()=>{location.reload()},parseInt(o.cooldown||"90000"))}}async function G(e){if(!o.droplets)return;B++;let t=null,r=0;r=e<100?0:e<1e3?1:e<5e3?2:e<1e4?3:e<1e5?4:5;let n=3;a.dropletSizes&&(n*=a.dropletSizes[r]);let i=a.droplets[r];Array.isArray(a.droplets[r])&&(i=a.droplets[r][c(a.droplets[r].length)]),t=Unicorn.AddObject("droplet_"+B,{type:"circle",sprite:i,scale:{x:n,y:n},x:c(s),y:-100-c(50),z:100,radius:r/5*4+20}),t.restitution=1,t.friction=.5*(5-r),t.frictionStatic=0,t.frictionAir=0,t.torque=-1+c(2),t.rotationOffset=Math.random()*Math.PI,Unicorn.SetVelocity("droplet_"+B,c(24)-12,0),setTimeout(()=>{Unicorn.RemoveObject(t.label)},3e4)}function W(){if(PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,Unicorn.Load("map",`${r}/assets/${a.bg}.png`),!o.overlay){var e=Unicorn.AddBacklay("map","map",0,n-1080);e.scale.x=3,e.scale.y=3}if(Array.isArray(a.target)){a.target.map((e,t)=>Unicorn.Load("target"+t,`${r}/assets/${e}.png`))}else{Unicorn.Load("target",`${r}/assets/${a.target}.png`)}a.target_front&&Unicorn.Load("target_front",`${r}/assets/${a.target_front}.png`),a.target_boosh&&a.target_boosh.forEach((e,t)=>{Unicorn.Load("target_boosh"+t,`${r}/assets/${e}.png`)}),a.target_splash&&a.target_splash.forEach((e,t)=>{Unicorn.Load("target_splash"+t,`${r}/assets/${e}.png`)}),Unicorn.Load("star",`${r}/assets/icons/star.png`),U=Unicorn.AddOverlay("star","star",-1e3,-1e3,{scale:{x:3,y:3}}),U.anchor.set(.5),a.parachutes.forEach(e=>Unicorn.Load(e,`${r}/assets/${e}.png`)),a.petparachutes?a.petparachutes.forEach(e=>Unicorn.Load(e,`${r}/assets/${e}.png`)):a.petparachutes=[],a.pridechutes&&Object.keys(a.pridechutes).forEach(e=>Unicorn.Load(a.pridechutes[e],`${r}/assets/${a.pridechutes[e]}.png`)),Object.keys(a.characters).forEach(e=>{for(let t=0;t<10;t++){let o=a.characters[e];Unicorn.Load(`${e}_${t}`,`${r}/assets/characters/${e}/${o}_front/${o}_front${t+1}.png`)}}),a.clouds.forEach(e=>Unicorn.Load(e,`${r}/assets/${e}.png`)),a.droplets.forEach(e=>{Array.isArray(e)?e.forEach(e=>Unicorn.Load(e,`${r}/assets/${e}.png`)):Unicorn.Load(e,`${r}/assets/${e}.png`)}),a.target_sound&&Unicorn.Load("sfx-target-drop",`${r}/assets/${a.target_sound}`),Unicorn.Load("sfx-parachute-drop",`${r}/assets/${a.drop_sound}`),Unicorn.Load("sfx-parachute-flap",`${r}/assets/${a.parachute_sound}`),Unicorn.AddObject("WallLeft",{type:"rectangle",x:-200,y:0,width:400,height:2*n,isStatic:!0}).sprite.visible=!1,Unicorn.AddObject("WallRight",{type:"rectangle",x:s+200,y:0,width:400,height:2*n,isStatic:!0}).sprite.visible=!1,Unicorn.AddObject("WallBottom",{type:"rectangle",x:.5*s,y:n+100,width:s,height:200,isStatic:!0}).sprite.visible=!1,Matter.Events.on(physics,"beforeUpdate",(function(e){for(var t in k)k[t].player&&(k[t].player.position.y<.5*-n?k[t].player.velocity.y>10&&Matter.Body.setVelocity(k[t].player,{x:k[t].player.velocity.x,y:10}):k[t].player.position.y>300&&k[t].player.velocity.y>.5&&Matter.Body.setVelocity(k[t].player,{x:k[t].player.velocity.x,y:.5}))})),Matter.Events.on(physics,"afterUpdate",(function(e){for(var t in k)if(k[t].pet){let e=Math.min(3,Math.max(0,.3*(k[t].player.position.y-300)));k[t].petPara.scale.x=k[t].petPara.scale.y=e/2,k[t].pet.angle=k[t].player.angle,k[t].pet.position.x=Math.max(20,Math.min(s-20,k[t].player.position.x+k[t].petOffset)),k[t].pet.position.y=Math.min(k[t].player.position.y+20,n-46-50+(a.target_y_offset||0)),k[t].petPara.rotation=k[t].player.angle,k[t].petPara.position.x=k[t].pet.position.x,k[t].petPara.position.y=k[t].pet.position.y}}))}function X(e,t){for(var r in k)if(k[r].player)if(k[r].isLanded){let e=r===T?1:.3;k[r].end.alpha=e,k[r].label.alpha=Math.round(e),k[r].pet&&(k[r].petEnd.alpha=e),k[r].scoreLabel.tint=k[r].label.tint=r===T?16777215:3355443,r===T?(k[r].end.zIndex=k[r].scoreLabel.zIndex=k[r].label.zIndex=9e3,k[r].pet&&(k[r].pet.zIndex=9001),k[r].label.position.x=k[r].player.position.x,k[r].label.position.y=k[r].player.position.y-80,k[r].scoreLabel.position.x=k[r].label.position.x+15,k[r].scoreLabel.position.y=k[r].label.position.y-30,k[r].label.style.fontSize=46,k[r].scoreLabel.style.fontSize=46,U.x=k[r].scoreLabel.x-k[r].scoreLabel.width/2-15,U.y=k[r].scoreLabel.y-5):(k[r].label.position.x=k[r].player.position.x,k[r].label.position.y=k[r].player.position.y-60,k[r].scoreLabel.position.y=k[r].label.position.y-30,k[r].scoreLabel.alpha=0,k[r].label.style.fontSize=40,k[r].scoreLabel.style.fontSize=40)}else{if(k[r].pet&&(k[r].pet.position.x=Math.max(20,Math.min(s-20,k[r].player.position.x+k[r].petOffset)),k[r].pet.position.y=Math.min(k[r].player.position.y+20,n-46-50+(a.target_y_offset||0)),k[r].petPara.position.x=k[r].pet.position.x,k[r].petPara.position.y=k[r].pet.position.y),k[r].player.position.y>n-46-50+(a.target_y_offset||0)){k[r].isLanded=!0,k[r].parachute.scale.x=k[r].parachute.scale.y=0,k[r].pet&&(k[r].petPara.scale.x=k[r].petPara.scale.y=0);let e=Unicorn.AddBacklay("end_"+r,k[r].player.endImage,k[r].player.position.x,k[r].player.position.y,{scale:{x:k[r].player.endScale,y:k[r].player.endScale}});if(k[r].player.animations&&(e.tint=k[r].player.animations.front.tint),e.anchor.set(.5),e.zIndex=20,k[r].player.isStatic=!0,k[r].score=100*Math.max(0,j/2-Math.abs(I-k[r].player.position.x))/(j/2),e.alpha=k[r].score>0?1:.3,k[r].end=e,k[r].pet){let e=Unicorn.AddBacklay("petend_"+r,`${k[r].petType}_front0`,k[r].pet.position.x,k[r].pet.position.y,{scale:{x:3,y:3}});k[r].pet.animations&&(e.tint=k[r].pet.animations.front.tint),e.anchor.set(.5),e.zIndex=30,k[r].pet.isStatic=!0,e.alpha=k[r].score>0?1:.3,k[r].petEnd=e}if(k[r].score>0&&(a.target_animate_on_landed&&g(2),a.target_particles&&F(a.target_particles[0],a.target_particles[1],k[r].player.position.x,k[r].player.position.y+40,10),a.target_boosh&&q(k[r].player.position.x,k[r].player.position.y+40),a.target_splash&&N(k[r].player.position.x,k[r].player.position.y+40),a.target_sound&&Unicorn.PlaySound("sfx-target-drop",{volume:i}),k[r].scoreLabel.x=k[r].label.position.x,k[r].scoreLabel.y=k[r].label.position.y-30,k[r].scoreLabel.text=k[r].score.toFixed(2),!r.startsWith("test_"))){if(o.messageFormat){let e=o.messageFormat.replace("USERNAME",k[r].name).replace("POINTS",k[r].score.toFixed(2)).replace("SHORTPTS",Math.floor(k[r].score));setTimeout(()=>{ComfyJS.Say(e)},5e3)}u(k[r].name,k[r].score.toFixed(2),k[r].userId,r)}k[r].score>L&&(L=k[r].score,T=r),k[r].label.alpha=k[r].score>0?1:.3,Unicorn.RemoveObject(k[r].player.label),Unicorn.RemoveBacklay("para_"+r),k[r].pet&&(Unicorn.RemoveObject(k[r].pet.label),Unicorn.RemoveBacklay("petpara_"+r))}else if(k[r].player.position.y>300){let t=Math.min(3,Math.max(0,.3*(k[r].player.position.y-300)));k[r].parachute.scale.x<=0&&t>0&&Unicorn.PlaySound("sfx-parachute-flap",{volume:i}),k[r].parachute.scale.x=k[r].parachute.scale.y=t,k[r].parachute.rotation=Math.sin(k[r].player.rotationOffset+e/1e3)*Math.PI/16,k[r].player.angle=Math.sin(k[r].player.rotationOffset+e/1e3)*Math.PI/16,k[r].parachute.position.x=k[r].player.position.x,k[r].parachute.position.y=k[r].player.position.y-10-(a.parachute_offset||0)}else k[r].player.position.y<.5*-n||(k[r].parachute.scale.x=k[r].parachute.scale.y=0,k[r].pet&&(k[r].petPara.scale.x=k[r].petPara.scale.y=0));k[r].label.position.x=k[r].player.position.x,k[r].label.position.y=k[r].player.position.y-60}z.forEach((e,a)=>{e.x-=t*e.speed,e.x+e.width/2<=0&&(e.x=s+e.width/2,e.y=c(500),e.speed=.01+.1*Math.random(),e.zIndex=e.speed)}),J.forEach(e=>{(e.vY<0||e.y<n-5)&&(e.x+=t/1e3*e.vX,e.y+=t/1e3*e.vY,e.vY<20&&(e.vY+=t/1e3*200))}),R.forEach(e=>{(e.vY<0||e.y<n-5)&&(e.x+=t/1e3*e.vX,e.y+=t/1e3*e.vY,e.vY+=t/1e3*200)}),y>0&&(y-=t,y<=0&&(m&&clearInterval(m),E[C].visible=!1,C=0,E[C].visible=!0))}