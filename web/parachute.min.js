let e=0,t=["front","back","left","right"],a={};function r({x:e,y:t,z:a,radius:r,scale:o=3,name:s,framerate:n=4/60,animations:i}={}){let l={};return Object.keys(i).forEach(e=>{l[e]={framerate:n,frames:[...Array(i[e].numFrames).keys()].map(t=>`${i[e].prefix}${t}`),loop:!0}}),Unicorn.AddObject(s,{type:"circle",scale:{x:o,y:o},friction:0,frictionAir:0,frictionStatic:0,bounce:1,animations:l,x:e,y:t,z:a,radius:r})}const o="https://api.pixelplush.dev/v1";let s="Pixel Parachute",n={},i={},l="",c=1920,p=1080,d=.5;function h(e){return Math.floor(Math.random()*Math.floor(e))}window.setupGame=function(e,t,a){if(s=e,n=t,i=a,l=n.path||"",i.clouds=void 0===i.clouds||null===i.clouds?!i.overlay:"true"===i.clouds,d=void 0===i.volume||null===i.volume?0:parseInt(i.volume)/100,c=Math.min(window.innerWidth,1920),p=Math.min(window.innerHeight,1080),i.variations&&!i.didRandom){const e=i.variations.split(","),t=h(e.length),a=`${window.location.protocol}//${window.location.host}${window.location.pathname.substr(0,window.location.pathname.lastIndexOf("/"))}/${e[t]}${window.location.search}&didRandom=1`;window.location.href=a}},window.WebFontConfig={custom:{families:["Pixeltype"]},active(){!async function(){if(document.hidden)return void document.addEventListener("visibilitychange",()=>{location.reload()},!1);try{const e=(await fetch("https://www.pixelplush.dev/assets/shamelist.txt").then(e=>e.text())).split(",").map(e=>e.trim().toLowerCase());if(i.channel&&e&&e.includes(i.channel.toLowerCase())&&(console.log("This channel has been blocked for violating the PixelPlush Terms of Service."),m=!1),n.requires)try{if(account=await fetch(`${o}/accounts`,{headers:{Twitch:i.oauth?i.oauth.replace("oauth:",""):void 0}}).then(e=>e.json()),console.log(account),account.error)throw"Login Error";if(!account.owned.includes(n.requires))throw"Item not owned"}catch(e){return void console.log("Auth Validate Failed",e)}i.cpDrop&&(u["Parachute Drop!"]={desc:"Drop into the PixelPlush Parachute Game!",color:"#F2C079",cost:parseInt(i.cpDropCost||50),callback:(e,t,a,r,o)=>{m?(S&&i.hideTilDrop&&(S=!1,X.forEach(e=>e.visible=!0),z.forEach(e=>e.isSensor=!1),Array.isArray(L)?(L[R].visible=!0,n.target_animate_on_landed||v()):L.visible=!0,Array.isArray(M)?(M[B].visible=!0,n.target_animate_on_landed||v()):M.visible=!0,D&&(D.visible=!0)),A?U.push({username:o.username,name:e,color:o.userColor||"#ffffff",message:r,emote:o.messageEmotes?Object.keys(o.messageEmotes)[0]:"",emoji:"",extra:o}):te(o.username,e,o.userColor||"#ffffff",r,n.parachutes[h(n.parachutes.length)],n.petparachutes[h(n.petparachutes.length)],o.messageEmotes?Object.keys(o.messageEmotes)[0]:"","",o)):i.oauth&&ComfyJS.Say("PixelParachute is disabled in this channel for violating the Terms of Service. To re-enable the game, please contact the PixelPlush team on Discord.")}}),i.cpDroplets&&(u["Parachute Droplets"]={desc:"Add bouncing obstacles into the PixelPlush Parachute Game!",color:"#F2C079",cost:parseInt(i.cpDropletsCost||500),cooldown:parseInt(i.cpDropletsCD||5),callback:()=>{if(m)for(let e=0;e<5;e++)ae(100);else i.oauth&&ComfyJS.Say("PixelParachute is disabled in this channel for violating the Terms of Service. To re-enable the game, please contact the PixelPlush team on Discord.")}}),i.cpQueue&&(u["Group Parachute"]={desc:"Queue everyone for a group drop in the PixelPlush Parachute Game!",color:"#F2C079",cost:parseInt(i.cpQueueCost||500),cooldown:parseInt(i.cpQueueCD||120),callback:()=>{if(m){if(!A){A=!0,Object.keys(N).forEach(e=>{Unicorn.RemoveBacklay("para_"+e),Unicorn.RemoveBacklay("petpara_"+e),Unicorn.RemoveObject(N[e].player.charName),Unicorn.RemoveObject(N[e].pet.label),Unicorn.RemoveText("name_"+e),Unicorn.RemoveBacklay("end_"+e),Unicorn.RemoveBacklay("petend_"+e),Unicorn.RemoveText(e+"_points"),delete N[e]}),I.x=-1e3,I.y=-1e3,G=0,O&&clearTimeout(O);const e=6e4;ComfyJS.Say(`/me Parachutes are queued for the next 60 seconds. !${i.command||"drop"} to join!`),setTimeout(()=>{ComfyJS.Say(`/me 30 seconds remaining. !${i.command||"drop"} to join!`)},e-3e4),setTimeout(()=>{ComfyJS.Say(`/me 10 seconds. !${i.command||"drop"}`)},e-1e4),setTimeout(()=>{$(U),U.forEach(e=>{te(e.username,e.name,e.color,e.message,e.selectedPara||n.parachutes[h(n.parachutes.length)],e.selectedPetPara||n.petparachutes[h(n.petparachutes.length)],e.emote,e.emoji,e.extra)}),U=[]},e)}}else i.oauth&&ComfyJS.Say("PixelParachute is disabled in this channel for violating the Terms of Service. To re-enable the game, please contact the PixelPlush team on Discord.")}})}catch(e){console.log(e)}Unicorn.Create("unicorn-display",{width:c,height:p,background:"transparent",init:re,update:oe,channel:i.channel,username:i.oauth?i.channel:void 0,password:i.oauth?i.oauth.replace("oauth:",""):void 0,onCommand:P,onChat:k,screenWalls:!1,gravity:{x:0,y:1}}),ComfyJS.onCheer=j,ComfyJS.onConnected=async(e,t,a)=>{if(a){!function(){E=n.target_width||368,T=E/2+h(c-E),C=p-47+(n.target_offset||0),n.target_walls&&(T<E/2+70?T=E/2+70:T>c-E/2-70&&(T=c-E/2-70));if(n.target_versions){const e=h(Object.keys(n.target_versions).length);Object.keys(n.target_versions).forEach((t,a)=>{e===a&&(J=t);let r=n.target_versions[t];if(F[t]={},Array.isArray(r.target))if(n.target_random){let e=h(r.target.length);L=Unicorn.AddBacklay("target"+t+e,"target"+t+e,T,C,{scale:{x:2,y:2}}),L.zIndex=10,L.anchor.set(.5),L.visible=!1,F[t].target=L}else{R=0,L=[];for(let e=0;e<r.target.length;e++){let a=Unicorn.AddBacklay("target"+t+e,"target"+t+e,T,C,{scale:{x:2,y:2}});a.zIndex=10,a.anchor.set(.5),a.visible=!1,L.push(a)}F[t].target=L,L[R].visible=!1,i.hideTilDrop||n.target_animate_on_landed||v()}else L=Unicorn.AddBacklay("target"+t,"target"+t,T,C,{scale:{x:2,y:2}}),L.zIndex=10,L.anchor.set(.5),L.visible=!1,F[t].target=L;if(r.target_overlay)if(Array.isArray(r.target_overlay)){B=0,M=[];for(let e=0;e<r.target_overlay.length;e++){let a=Unicorn.AddBacklay("target_overlay"+t+e,"target_overlay"+t+e,T,C,{scale:{x:2,y:2}});a.zIndex=11,a.anchor.set(.5),a.visible=!1,M.push(a)}F[t].target_overlay=M,M[B].visible=!1,i.hideTilDrop||n.target_animate_on_landed||v()}else M=Unicorn.AddBacklay("target_overlay"+t,"target_overlay"+t,T,C,{scale:{x:2,y:2}}),M.zIndex=11,M.anchor.set(.5),M.visible=!1,F[t].target_overlay=M})}else{if(Array.isArray(n.target))if(n.target_random){let e=h(n.target.length);L=Unicorn.AddBacklay("target"+e,"target"+e,T,C,{scale:{x:2,y:2}}),L.zIndex=10,L.anchor.set(.5)}else{R=0,L=[];for(let e=0;e<n.target.length;e++){let t=Unicorn.AddBacklay("target"+e,"target"+e,T,C,{scale:{x:2,y:2}});t.zIndex=10,t.anchor.set(.5),t.visible=!1,L.push(t)}L[R].visible=!0,i.hideTilDrop||n.target_animate_on_landed||v()}else L=Unicorn.AddBacklay("target","target",T,C,{scale:{x:2,y:2}}),L.zIndex=10,L.anchor.set(.5);if(n.target_overlay)if(Array.isArray(n.target_overlay)){B=0,M=[];for(let e=0;e<n.target_overlay.length;e++){let t=Unicorn.AddBacklay("target_overlay"+e,"target_overlay"+e,T,C,{scale:{x:2,y:2}});t.zIndex=11,t.anchor.set(.5),t.visible=!1,M.push(t)}M[B].visible=!0,i.hideTilDrop||n.target_animate_on_landed||v()}else M=Unicorn.AddBacklay("target_overlay","target_overlay",T,C,{scale:{x:2,y:2}}),M.zIndex=11,M.anchor.set(.5)}n.target_front&&(D=Unicorn.AddOverlay("target_front","target_front",T,C,{scale:{x:2,y:2}}),D.anchor.set(.5));if(i.clouds)for(let e=0;e<11;e++){w++;let e=n.clouds[h(n.clouds.length)],t=Unicorn.AddOverlay("cloud_"+w,e,h(c),h(500),{scale:{x:3,y:3}});t.alpha=i.overlay?.5:.9,t.anchor.set(.5),t.speed=.01+.1*Math.random(),t.zIndex=t.speed,X.push(t)}if(n.target_walls){let e=Unicorn.AddObject("TargetTop",{type:"rectangle",x:T,y:C+n.target_walls/2+n.target_collide_land,width:E-50,height:10,isStatic:!0});e.sprite.visible=!1;let t=Unicorn.AddObject("TargetLeft",{type:"rectangle",x:T-E/2+27,y:C+n.target_walls,width:10,height:100,isStatic:!0});t.sprite.visible=!1;let a=Unicorn.AddObject("TargetRight",{type:"rectangle",x:T+E/2-27,y:C+n.target_walls,width:10,height:100,isStatic:!0});a.sprite.visible=!1,z.push(e),z.push(t),z.push(a),console.log(z)}i.hideTilDrop&&(X.forEach(e=>e.visible=!1),z.forEach(e=>e.isSensor=!0),Array.isArray(n.target)&&!n.target_random?L.forEach(e=>{e.visible=!1}):L.visible=!1,M&&(Array.isArray(n.target_overlay)&&!n.target_random?M.forEach(e=>{e.visible=!1}):M.visible=!1),D&&(D.visible=!1))}();let e=await g();if(0!==e&&(f=e.session,setInterval(()=>{g()},6e4)),i.oauth){let e=await async function(e){return await fetch("https://id.twitch.tv/oauth2/validate",{headers:{Authorization:`OAuth ${e}`}}).then(e=>e.json()).catch(e=>({error:e}))}(i.oauth.replace("oauth:",""));y=e.client_id,["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every(t=>e.scopes.includes(t))||console.log("Need more permissions"),e.expires_in<1800&&console.log("Token expires soon. Need to generate new link")}let t=await ComfyJS.GetChannelRewards(y,!0),a=Object.keys(u);for(let e=0;e<a.length;e++){let r=a[e];if(!t.some(e=>e.title===r))try{await ComfyJS.CreateChannelReward(y,{title:r,prompt:u[r].desc,cost:u[r].cost,is_enabled:!0,background_color:u[r].color,is_user_input_required:!1,is_max_per_stream_enabled:!1,max_per_stream:0,is_max_per_user_per_stream_enabled:!1,max_per_user_per_stream:0,is_global_cooldown_enabled:!!u[r].cooldown,global_cooldown_seconds:u[r].cooldown,should_redemptions_skip_request_queue:!0})}catch(e){console.log(e)}}}},ComfyJS.onReward=(e,t,a,r,o)=>{u[t]&&u[t].callback(e,t,a,r,o)}}()}},function(){const e=document.createElement("script");e.src=`${"https:"===document.location.protocol?"https":"http"}://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js`,e.type="text/javascript",e.async="true";const t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();var f="",m=!0;let y="";const u={};async function g(){let e=Object.keys(N).length;return fetch(`${o}/analytics/heartbeat`,{method:"POST",body:JSON.stringify({session:f,game:"parachute",theme:s,channel:i.channel,players:Object.keys(N),count:e})}).then(e=>e.json())}async function _(e,t,a,r){return i.oauth?fetch(`${o}/scores/add`,{method:"POST",body:JSON.stringify({token:i.oauth.replace("oauth:",""),channel:i.channel,game:"parachute",theme:s,user:e,score:t,userId:a,username:r})}).then(e=>e.json()):{}}let b=null,x=0;function v(e=0){if(b&&clearInterval(b),n.target_versions){Object.keys(F).forEach(e=>{Array.isArray(L)?F[e].target.forEach(e=>{e.visible=!1}):F[e].target.visible=!1,F[e].target_overlay.forEach(e=>{e.visible=!1})});const e=h(Object.keys(F).length);J=Object.keys(F)[e],L=F[J].target,M=F[J].target_overlay,Array.isArray(L)?L[R].visible=!0:L.visible=!0,M[B].visible=!0}b=setInterval(()=>{Array.isArray(L)&&(L[R].visible=!1,R=(R+1)%L.length,L[R].visible=!0),M&&Array.isArray(M)&&(M[B].visible=!1,B=(B+1)%M.length,M[B].visible=!0)},60),e>0&&(x=1e3*e)}function $(e){for(let t=e.length-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}}let w=0,S=!0,U=[],A=!1;async function P(e,t,a,r,s){if(document.hidden)return;if((r.broadcaster||r.mod)&&("resetparachute"===t||"resetdrop"===t))if(i.variations){const e=i.variations.split(","),t=h(e.length),a=`${window.location.protocol}//${window.location.host}${window.location.pathname.substr(0,window.location.pathname.lastIndexOf("/"))}/${e[t]}${window.location.search}`;window.location.href=a}else location.reload();if((r.broadcaster||r.mod)&&("deleteparachute"===t||"deletedrop"===t)){let e=await ComfyJS.GetChannelRewards(y,!0),t=Object.keys(u);for(let a=0;a<t.length;a++){let r=t[a],o=e.find(e=>e.title===r);o&&await ComfyJS.DeleteChannelReward(y,o.id)}}if((r.broadcaster||r.mod)&&"queuedrop"===t&&(A=!A,Object.keys(N).forEach(e=>{Unicorn.RemoveBacklay("para_"+e),Unicorn.RemoveBacklay("petpara_"+e),Unicorn.RemoveObject(N[e].player.charName),Unicorn.RemoveObject(N[e].pet.label),Unicorn.RemoveText("name_"+e),Unicorn.RemoveBacklay("end_"+e),Unicorn.RemoveBacklay("petend_"+e),Unicorn.RemoveText(e+"_points"),delete N[e]}),I.x=-1e3,I.y=-1e3,G=0,O&&clearTimeout(O),A?ComfyJS.Say("/me Drops are queued this game. !startdrop to activate!"):ComfyJS.Say("/me Drops are no longer queued.")),(r.broadcaster||r.mod)&&"startdrop"===t&&A&&($(U),U.forEach(e=>{te(e.username,e.name,e.color,e.message,e.selectedPara||n.parachutes[h(n.parachutes.length)],e.selectedPetPara||n.petparachutes[h(n.petparachutes.length)],e.emote,e.emoji,e.extra)}),U=[]),(r.broadcaster||r.mod)&&"testdrop"===t)for(var l=0;l<50;l++)w++,te("test_"+w,"test_"+w,s.userColor||"#ffffff",Object.keys(n.characters)[h(Object.keys(n.characters).length)],n.parachutes[h(n.parachutes.length)],n.petparachutes[h(n.petparachutes.length)],"","",s);if((r.broadcaster||r.mod)&&"droplet"===t){let e=parseInt(a||Math.pow(10,h(6)));for(let t=0;t<5;t++)ae(e)}if(("drophigh"===t||"drophighscore"===t||"dropbest"===t)&&i.oauth){let e=await async function(){if(i.oauth){const e=new Date;e.setDate(e.getDate()-1);const t=e.toISOString().split("T")[0];return(await fetch(`${o}/scores/high?channel=${i.channel}&game=parachute&date=${t}`,{method:"GET"}).then(e=>e.json()))[0]}return null}();e&&e.score&&ComfyJS.Say(`/me The highest score in the past 24 hours is ${e.score} by ${e.user}`)}if(("droplow"===t||"droplowscore"===t||"dropworst"===t)&&i.oauth){let e=await async function(){if(i.oauth){const e=new Date;e.setDate(e.getDate()-1);const t=e.toISOString().split("T")[0];return(await fetch(`${o}/scores/low?channel=${i.channel}&game=parachute&date=${t}`,{method:"GET"}).then(e=>e.json()))[0]}return null}();e&&e.score&&ComfyJS.Say(`/me The lowest score in the past 24 hours is ${e.score} by ${e.user}`)}if(("droptop"===t||"droptopscores"===t||"dropleaderboard"===t||"dropscores"===t)&&i.oauth){let e=await async function(){if(i.oauth){const e=new Date;e.setDate(e.getDate()-1);const t=e.toISOString().split("T")[0];return await fetch(`${o}/scores/high?channel=${i.channel}&game=parachute&date=${t}`,{method:"GET"}).then(e=>e.json())}return[]}();if(e&&e.length>0){let t=Array.from(new Set(e.map(e=>e.userId))).slice(0,10).map(t=>e.find(e=>e.userId===t));ComfyJS.Say(`/me Top players in the past 24 hours are ${t.map((e,t)=>`${t+1}. ${e.user} (${e.score})`).join(", ")}`)}else ComfyJS.Say("/me There are no scores recorded in the past 24 hours")}if("droprecent"===t&&i.oauth){let e=await async function(){if(i.oauth){return await fetch(`${o}/scores/recent?channel=${i.channel}&game=parachute`,{method:"GET"}).then(e=>e.json())}return[]}();if(e&&e.length>0){let t=Array.from(new Set(e.map(e=>e.userId))).slice(0,10).map(t=>e.find(e=>e.userId===t));ComfyJS.Say(`/me Latest scores are ${t.map((e,t)=>`${e.user} (${e.score})`).join(", ")}`)}else ComfyJS.Say("/me There are no recent scores")}let c=!1;if(!i.commandOn&&i.cpDrop||!i.command||t!==i.command||(c=!0),!i.commandOn&&i.cpDrop||i.command||"drop"!==t||(c=!0),m){if(c){S&&i.hideTilDrop&&(S=!1,X.forEach(e=>e.visible=!0),z.forEach(e=>e.isSensor=!1),Array.isArray(L)?(L[R].visible=!0,n.target_animate_on_landed||v()):L.visible=!0,M&&(Array.isArray(M)?(M[B].visible=!0,n.target_animate_on_landed||v()):M.visible=!0),D&&(D.visible=!0));const r=twemoji.parse(a,{assetType:"png"});if(!s.messageEmotes&&r.length>0)A?U.push({username:s.username,name:e,color:s.userColor||"#ffffff",message:a,emote:"",emoji:r[0].url,extra:s}):te(s.username,e,s.userColor||"#ffffff",a,n.parachutes[h(n.parachutes.length)],n.petparachutes[h(n.petparachutes.length)],"",r[0].url,s);else if(n.pridechutes){const r=Object.keys(n.pridechutes),o=s.messageEmotes?Object.keys(s.messageEmotes):[],i=o.map(e=>{const r=s.messageEmotes[e][0].split("-").map(e=>parseInt(e));return`!${t} ${a}`.substring(r[0],r[1]+1)}),l=i.filter(e=>e.toLowerCase().includes("pride"));let c=r.find(e=>l.some(t=>t.toLowerCase().includes(e)));if(c){const t=n.pridechutes[c];let r=o.find((e,t)=>!i[t].toLowerCase().includes(c));A?U.push({username:s.username,name:e,color:s.userColor||"#ffffff",message:a,selectedPara:t,selectedPetPara:t,emote:r,emoji:"",extra:s}):te(s.username,e,s.userColor||"#ffffff",a,t,t,r,"",s)}else A?U.push({username:s.username,name:e,color:s.userColor||"#ffffff",message:a,emote:s.messageEmotes?Object.keys(s.messageEmotes)[0]:"",emoji:"",extra:s}):te(s.username,e,s.userColor||"#ffffff",a,n.parachutes[h(n.parachutes.length)],n.petparachutes[h(n.petparachutes.length)],s.messageEmotes?Object.keys(s.messageEmotes)[0]:"","",s)}else A?U.push({username:s.username,name:e,color:s.userColor||"#ffffff",message:a,emote:s.messageEmotes?Object.keys(s.messageEmotes)[0]:"",emoji:"",extra:s}):te(s.username,e,s.userColor||"#ffffff",a,n.parachutes[h(n.parachutes.length)],n.petparachutes[h(n.petparachutes.length)],s.messageEmotes?Object.keys(s.messageEmotes)[0]:"","",s)}}else c&&i.oauth&&ComfyJS.Say("PixelParachute is disabled in this channel for violating the Terms of Service. To re-enable the game, please contact the PixelPlush team on Discord.")}function k(e,t,a,r,o){document.hidden}function j(e,t,a,r,o){if(!document.hidden&&m)for(let e=0;e<5;e++)ae(t)}let I,O=null,E=368,T=0,C=0,L=null,M=null,D=null,z=[],R=0,B=0,F={},J=null,N={},G=0,q="",W={},Y={},X=[],V=[],Q=[],H=0;function K(e,t,a,r,o,s=""){H++;let n=Math.min(Math.max(1,o),100);Unicorn.AddParticles("Splash_"+H,{blendMode:PIXI.BLEND_MODES.DEFAULT,shape:"cone",angle:-Math.PI/2,spread:Math.PI/2,startColor:e,endColor:t,intensity:n,minSpeed:.05,maxSpeed:.25,gravityX:0,gravityY:3.5,fadeOut:!0,decay:1,image:s||void 0},a,r),function(e,t=2e3){setTimeout(()=>{Unicorn.RemoveParticles(e)},t)}("Splash_"+H,150)}function Z(e,t,a,r=""){const o=n.target_boosh_scale||2;n.target_boosh.forEach((a,r)=>{for(let a=0;a<h(5);a++){H++;let r=Unicorn.AddBacklay("boosh_"+H,"target_boosh"+a,e,t+10,{scale:{x:o,y:o}});r.zIndex=11,r.vX=h(50)-25,r.vY=-350+h(100),r.anchor.set(.5),V.push(r)}})}function ee(e,t,a,r=""){const o=n.target_splash_scale||2;n.target_splash.forEach((a,r)=>{for(let a=0;a<h(5);a++){H++;let r=Unicorn.AddBacklay("splash_"+H,"target_splash"+a,e,t+10,{scale:{x:o,y:o}});r.zIndex=11,r.vX=h(100)-50,r.vY=-300+h(100),r.anchor.set(.5),Q.push(r)}})}async function te(s,p,f="#ffffff",m,y,u,g="",_="",b){let x=4/60;if(!N[s]){N[s]={};let $=null,w=null,S=null,U=tinycolor(f),A=await async function(e){let t={};try{if(!e)return t;let a=await fetch(`${o}/accounts/twitch/design?username=${e}`).then(e=>e.json());return a&&(t=a.style||{}),t}catch(e){console.log(e)}}(s);if(g){if(!W[g]){if(W[g]=!0,g.startsWith("emotesv2_")){let e=`https://static-cdn.jtvnw.net/emoticons/v2/${g}/default/dark/2.0`,t=await fetchGif(e);if(t.length>0){const e=Math.min(...t.map(e=>e.delay)),a=Math.max(...t.map(e=>e.dims.width)),r=Math.max(...t.map(e=>e.dims.height)),o=a;let n=0;for(let s=0;s<t.length;s++){let i=document.createElement("canvas");i.width=a,i.height=r;let l=i.getContext("2d"),c=l.createImageData(a,r);if(1===t[s].disposalType){let e=s;for(let s=t[e].dims.top;s<r;s++)for(let r=t[e].dims.left;r<a;r++)s>=t[e].dims.top&&r>=t[e].dims.left&&s<t[e].dims.top+t[e].dims.height&&r<t[e].dims.left+t[e].dims.width&&t[e].pixels[s*o+r]!==t[e].transparentIndex?(c.data[s*o*4+4*r+0]=t[e].patch[s*o*4+4*r+0],c.data[s*o*4+4*r+1]=t[e].patch[s*o*4+4*r+1],c.data[s*o*4+4*r+2]=t[e].patch[s*o*4+4*r+2],c.data[s*o*4+4*r+3]=t[e].patch[s*o*4+4*r+3]):0===e&&(c.data[s*o*4+4*r+0]=t[0].patch[s*o*4+4*r+0],c.data[s*o*4+4*r+1]=t[0].patch[s*o*4+4*r+1],c.data[s*o*4+4*r+2]=t[0].patch[s*o*4+4*r+2],c.data[s*o*4+4*r+3]=t[0].patch[s*o*4+4*r+3])}else if(3===t[s].disposalType){let e=null;for(let n=0;n<=s;n++){for(let e=0;e<r;e++)for(let r=0;r<a;r++)if(e>=t[n].dims.top&&r>=t[n].dims.left&&e<t[n].dims.top+t[n].dims.height&&r<t[n].dims.left+t[n].dims.width){const a=(e-t[n].dims.top)*t[n].dims.width+(r-t[n].dims.left),s=(e-t[n].dims.top)*t[n].dims.width*4+4*(r-t[n].dims.left);t[n].pixels[a]!==t[n].transparentIndex?(c.data[e*o*4+4*r+0]=t[n].patch[s+0],c.data[e*o*4+4*r+1]=t[n].patch[s+1],c.data[e*o*4+4*r+2]=t[n].patch[s+2],c.data[e*o*4+4*r+3]=t[n].patch[s+3]):(c.data[e*o*4+4*r+0]=0,c.data[e*o*4+4*r+1]=0,c.data[e*o*4+4*r+2]=0,c.data[e*o*4+4*r+3]=0)}0===n&&(e=c.data.slice())}}else{let e=s;for(let s=t[e].dims.top;s<r;s++)for(let r=t[e].dims.left;r<a;r++){const a=(s-t[e].dims.top)*t[e].dims.width+(r-t[e].dims.left),n=(s-t[e].dims.top)*t[e].dims.width*4+4*(r-t[e].dims.left);s>=t[e].dims.top&&r>=t[e].dims.left&&s<t[e].dims.top+t[e].dims.height&&r<t[e].dims.left+t[e].dims.width&&t[e].pixels[a]!==t[e].transparentIndex&&(c.data[s*o*4+4*r+0]=t[e].patch[n+0],c.data[s*o*4+4*r+1]=t[e].patch[n+1],c.data[s*o*4+4*r+2]=t[e].patch[n+2],c.data[s*o*4+4*r+3]=t[e].patch[n+3])}}l.putImageData(c,0,0);for(let o=0;o<t[s].delay;o+=e)Unicorn.LoadCustom(`emote_${g}${n}`,i,"texture",{width:a,height:r}),n++}W[g]={frames:n,framerate:1/60*(1e3/e)},setTimeout(()=>{delete N[s],te(s,p,f,m,y,u,g,_,b)},500)}else Unicorn.Load(`emote_${g}0`,e),setTimeout(()=>{delete N[s],te(s,p,f,m,y,u,g,_,b)},500)}else{let e=`https://static-cdn.jtvnw.net/emoticons/v1/${g}/2.0`;Unicorn.Load(`emote_${g}0`,e),setTimeout(()=>{delete N[s],te(s,p,f,m,y,u,g,_,b)},500)}return}let e=[];if(g.startsWith("emotesv2_")&&"boolean"!=typeof W[g]){x=W[g].framerate;for(let t=0;t<W[g].frames;t++)e.push(`emote_${g}${t}`)}else e=[`emote_${g}0`];$=r({x:h(c),y:-100-h(50),z:100,radius:36,scale:1.2,name:"player_"+s,framerate:W[g].framerate,animations:{front:{numFrames:e.length,prefix:`emote_${g}`}}}),$.charName="player_"+s,$.endImage=e[0],$.endScale=1.2}else if(_){if(!Y[_])return Y[_]=!0,Unicorn.Load(`emoji_${_}0`,_),void setTimeout(()=>{delete N[s],te(s,p,f,m,y,u,g,_,b)},500);$=r({x:h(c),y:-100-h(50),z:100,radius:36,scale:1,name:"player_"+s,animations:{front:{numFrames:1,prefix:`emoji_${_}`}}}),$.charName="player_"+s,$.endImage=`emoji_${_}0`,$.endScale=1}else if($=function(o,s,i,c,p=null){n.playable,e++;const d="player_"+e;if(!n)throw"No GameTheme Defined";n.characters||(n.characters={});let f=!1;if(p&&n.playable.includes(p)||(c.character&&c.character.id?(p=c.character.id,f=!0):p=n.playable[h(n.playable.length)]),!a[p]){a[p]=!0,n.characters[p]=f?c.character.path:p;for(let e=0;e<10;e++)for(let a=0;a<t.length;a++){const r=`${n.characters[p]}_${t[a]}`;Unicorn.Load(`${p}_${t[a]}${e}`,`${l}/assets/characters/${p}/${r}/${r}${e+1}.png`)}}let m=r({x:o,y:s,z:i,radius:36,name:d,animations:{front:{numFrames:10,prefix:`${p}_front`},left:{numFrames:10,prefix:`${p}_left`},right:{numFrames:10,prefix:`${p}_right`},back:{numFrames:10,prefix:`${p}_back`}}});return m.character=p,m.charName=d,m.endImage=`${p}_front0`,m.endScale=3,m}(h(c),-100-h(50),100,A,m),"boybear"===$.character||"girlbear"===$.character){var v=PIXI.utils.string2hex(U.brighten(50).toHexString());Object.keys($.animations).forEach(e=>{$.animations[e].tint=v})}S=function(o,s,i,c){if(!c||!c.pet||"pet_none"===c.pet.id)return null;e++;const p="pet_"+e;if(!n)throw"No GameTheme Defined";n.pets||(n.pets={});let d=c.pet.id.replace("pet_","");if(!a[d]){a[d]=!0,n.pets[d]={path:c.pet.path,minIdle:c.pet.minIdle,maxIdle:c.pet.maxIdle};for(let e=0;e<10;e++)for(let a=0;a<t.length;a++){const r=`${c.pet.path}_${t[a]}`;Unicorn.Load(r+e,`${l}/assets/pets/${d}/${r}/${r}${e+1}.png`)}}let h=r({x:o,y:s,z:i,radius:24,name:p,animations:{front:{numFrames:10,prefix:`${n.pets[d].path}_front`},left:{numFrames:10,prefix:`${n.pets[d].path}_left`},right:{numFrames:10,prefix:`${n.pets[d].path}_right`},back:{numFrames:10,prefix:`${n.pets[d].path}_back`}}});return h.isStatic=!0,h.isSensor=!0,h.petName=d,h.charName=p,h}(-1e3,-1e3,200,A),S&&(w=S.petName);let P=Unicorn.AddBacklay("para_"+s,y,{scale:{x:0,y:0},x:-50,y:0,z:50});P.visible=!1,P.zIndex=11,P.scale.x=0,P.scale.y=0,P.anchor.set(.5,1);let k=Unicorn.AddText("name_"+s,p,-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:40,fontWeight:"bold",fill:f,lineJoin:"round",stroke:U.getLuminance()<.6?"#ffffff":"#000000",strokeThickness:6});k.anchor.set(.5);let j=Unicorn.AddText(s+"_points","",-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:40,fontWeight:"bold",fill:"#ffd700",lineJoin:"round",stroke:"#000000",strokeThickness:6});j.anchor.set(.5);let I=null;w&&(I=Unicorn.AddBacklay("petpara_"+s,u||y,{scale:{x:0,y:0},x:-50,y:0,z:150}),I.visible=!1,I.zIndex=11,I.scale.x=0,I.scale.y=0,I.anchor.set(.5,1)),$.restitution=1,$.friction=0,$.frictionStatic=0,$.frictionAir=0,$.torque=-5+h(10),$.rotationOffset=Math.random()*Math.PI,Unicorn.SetVelocity($.charName,h(24)-12,0),N[s]={parachute:P,player:$,pet:S,petPara:I,petType:w,petOffset:30*Math.random()+(Math.random()>.5?-150:70),label:k,scoreLabel:j},b&&(N[s].userId=b.userId,N[s].name=b.displayName||b.username),y&&y.includes("chute_plane")&&(N[s].paraFlipDir=!0),u&&u.includes("chute_plane")&&(N[s].petParaFlipDir=!0),Unicorn.PlaySound("sfx-parachute-drop",{volume:d}),O&&clearTimeout(O),O=setTimeout(()=>{if(i.variations){const e=i.variations.split(","),t=h(e.length),a=`${window.location.protocol}//${window.location.host}${window.location.pathname.substr(0,window.location.pathname.lastIndexOf("/"))}/${e[t]}${window.location.search}`;window.location.href=a}else location.reload()},parseInt(i.cooldown||"90000"))}}async function ae(e){if(!i.droplets)return;H++;let t=null,a=0;a=h(6);let r=3;n.dropletSizes&&(r*=n.dropletSizes[a]);let o=n.droplets[a];Array.isArray(n.droplets[a])&&(o=n.droplets[a][h(n.droplets[a].length)]),t=Unicorn.AddObject("droplet_"+H,{type:"circle",sprite:o,scale:{x:r,y:r},x:h(c),y:-100-h(50),z:100,radius:a/5*4+20}),t.restitution=1,t.friction=.5*(5-a),t.frictionStatic=0,t.frictionAir=0,t.torque=-1+h(2),t.rotationOffset=Math.random()*Math.PI,Unicorn.SetVelocity("droplet_"+H,h(24)-12,0),setTimeout(()=>{Unicorn.RemoveObject(t.label)},3e4)}function re(){if(PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,Unicorn.Load("map",`${l}/assets/${n.bg}.png`),!i.overlay){var e=Unicorn.AddBacklay("map","map",0,p-1080);e.scale.x=3,e.scale.y=3}if(n.target_versions)Object.keys(n.target_versions).forEach(e=>{let t=n.target_versions[e];if(Array.isArray(t.target)){t.target.map((t,a)=>Unicorn.Load("target"+e+a,`${l}/assets/${t}.png`))}else{Unicorn.Load("target"+e,`${l}/assets/${t.target}.png`)}if(Array.isArray(t.target_overlay)){t.target_overlay.map((t,a)=>Unicorn.Load("target_overlay"+e+a,`${l}/assets/${t}.png`))}else{Unicorn.Load("target_overlay"+e,`${l}/assets/${t.target_overlay}.png`)}if(t.target_effect){t.target_effect.map((t,a)=>Unicorn.Load("target_effect"+e+a,`${l}/assets/${t}.png`))}});else{if(Array.isArray(n.target)){n.target.map((e,t)=>Unicorn.Load("target"+t,`${l}/assets/${e}.png`))}else{Unicorn.Load("target",`${l}/assets/${n.target}.png`)}if(Array.isArray(n.target_overlay)){n.target_overlay.map((e,t)=>Unicorn.Load("target_overlay"+t,`${l}/assets/${e}.png`))}else{Unicorn.Load("target_overlay",`${l}/assets/${n.target_overlay}.png`)}if(n.target_effect){n.target_effect.map((e,t)=>Unicorn.Load("target_effect"+t,`${l}/assets/${e}.png`))}}n.target_front&&Unicorn.Load("target_front",`${l}/assets/${n.target_front}.png`),n.target_boosh&&n.target_boosh.forEach((e,t)=>{Unicorn.Load("target_boosh"+t,`${l}/assets/${e}.png`)}),n.target_splash&&n.target_splash.forEach((e,t)=>{Unicorn.Load("target_splash"+t,`${l}/assets/${e}.png`)}),Unicorn.Load("star",`${l}/assets/icons/star.png`),I=Unicorn.AddOverlay("star","star",-1e3,-1e3,{scale:{x:3,y:3}}),I.anchor.set(.5),n.parachutes.forEach(e=>Unicorn.Load(e,`${l}/assets/${e}.png`)),n.petparachutes?n.petparachutes.forEach(e=>Unicorn.Load(e,`${l}/assets/${e}.png`)):n.petparachutes=[],n.pridechutes&&Object.keys(n.pridechutes).forEach(e=>Unicorn.Load(n.pridechutes[e],`${l}/assets/${n.pridechutes[e]}.png`)),Object.keys(n.characters).forEach(e=>{for(let t=0;t<10;t++){let a=n.characters[e];Unicorn.Load(`${e}_${t}`,`${l}/assets/characters/${e}/${a}_front/${a}_front${t+1}.png`)}}),n.clouds.forEach(e=>Unicorn.Load(e,`${l}/assets/${e}.png`)),n.droplets.forEach(e=>{Array.isArray(e)?e.forEach(e=>Unicorn.Load(e,`${l}/assets/${e}.png`)):Unicorn.Load(e,`${l}/assets/${e}.png`)}),n.target_sound&&Unicorn.Load("sfx-target-drop",`${l}/assets/${n.target_sound}`),Unicorn.Load("sfx-parachute-drop",`${l}/assets/${n.drop_sound}`),Unicorn.Load("sfx-parachute-flap",`${l}/assets/${n.parachute_sound}`),Unicorn.AddObject("WallLeft",{type:"rectangle",x:-200,y:0,width:400,height:2*p,friction:0,frictionAir:0,frictionStatic:0,bounce:1,isStatic:!0}).sprite.visible=!1,Unicorn.AddObject("WallRight",{type:"rectangle",x:c+200,y:0,width:400,height:2*p,friction:0,frictionAir:0,frictionStatic:0,bounce:1,isStatic:!0}).sprite.visible=!1,Unicorn.AddObject("WallBottom",{type:"rectangle",x:.5*c,y:p+100,friction:0,frictionAir:0,frictionStatic:0,bounce:1,width:c,height:200,isStatic:!0}).sprite.visible=!1,Matter.Events.on(physics,"beforeUpdate",(function(e){const t=Object.keys(N);for(let e=0;e<t.length;e++){const a=t[e],r=N[a];r.player&&(r.player.position.y<.5*-p?r.player.velocity.y>10&&Matter.Body.setVelocity(r.player,{x:r.player.velocity.x,y:10}):r.player.position.y>300&&r.player.velocity.y>.5&&Matter.Body.setVelocity(r.player,{x:r.player.velocity.x,y:.5}))}})),Matter.Events.on(physics,"afterUpdate",(function(e){const t=Object.keys(N);for(let e=0;e<t.length;e++){const a=t[e],r=N[a];if(r.pet){let e=Math.min(3,Math.max(0,.3*(r.player.position.y-300)));r.petPara.scale.x=r.petPara.scale.y=e/2,r.petParaFlipDir&&r.player.velocity.x>0&&(r.petPara.scale.x=-e/2),r.pet.angle=r.player.angle,r.pet.position.x=Math.max(20,Math.min(c-20,r.player.position.x+r.petOffset)),r.pet.position.y=Math.min(r.player.position.y+20,p-46-50+(n.target_y_offset||0)),r.petPara.rotation=r.player.angle,r.petPara.position.x=r.pet.position.x,r.petPara.position.y=r.pet.position.y}}}))}function oe(e,t){const a=Object.keys(N);for(let t=0;t<a.length;t++){const r=a[t],o=N[r];if(o.player)if(o.isLanded){let e=r===q?1:.3;o.end.alpha=e,o.label.alpha=Math.round(e),o.pet&&(o.petEnd.alpha=e),o.scoreLabel.tint=o.label.tint=r===q?16777215:3355443,r===q?(o.end.zIndex=o.scoreLabel.zIndex=o.label.zIndex=9e3,o.pet&&(o.pet.zIndex=9001),o.label.position.x=o.player.position.x,o.label.position.y=o.player.position.y-80,o.scoreLabel.position.x=o.label.position.x+15,o.scoreLabel.position.y=o.label.position.y-30,o.label.style.fontSize=46,o.scoreLabel.style.fontSize=46,I.x=o.scoreLabel.x-o.scoreLabel.width/2-15,I.y=o.scoreLabel.y-5):(o.label.position.x=o.player.position.x,o.label.position.y=o.player.position.y-60,o.scoreLabel.position.y=o.label.position.y-30,o.scoreLabel.alpha=0,o.label.style.fontSize=40,o.scoreLabel.style.fontSize=40)}else{if(o.pet&&(o.pet.position.x=Math.max(20,Math.min(c-20,o.player.position.x+o.petOffset)),o.pet.position.y=Math.min(o.player.position.y+20,p-46-50+(n.target_y_offset||0)),o.petPara.position.x=o.pet.position.x,o.petPara.position.y=o.pet.position.y),o.player.position.y>p-46-50+(n.target_y_offset||0)||n.target_walls&&o.player.position.y>p-46-50+(n.target_collide_land||0)&&E/2-20>Math.abs(T-o.player.position.x)){o.isLanded=!0,o.parachute.scale.x=o.parachute.scale.y=0,o.pet&&(o.petPara.scale.x=o.petPara.scale.y=0);let e=Unicorn.AddBacklay("end_"+r,o.player.endImage,o.player.position.x,o.player.position.y,{scale:{x:o.player.endScale,y:o.player.endScale}});if(o.player.animations&&(e.tint=o.player.animations.front.tint),e.anchor.set(.5),e.zIndex=20,o.player.isStatic=!0,n.target_walls?o.score=100*Math.max(0,E/2-20-Math.abs(T-o.player.position.x))/(E/2-20):o.score=100*Math.max(0,E/2-Math.abs(T-o.player.position.x))/(E/2),e.alpha=o.score>0?1:.3,o.end=e,o.pet){let e=Unicorn.AddBacklay("petend_"+r,`${o.petType}_front0`,o.pet.position.x,o.pet.position.y,{scale:{x:3,y:3}});o.pet.animations&&(e.tint=o.pet.animations.front.tint),e.anchor.set(.5),e.zIndex=30,o.pet.isStatic=!0,e.alpha=o.score>0?1:.3,o.petEnd=e}if(o.score>0){if(n.target_versions&&v(),n.target_effect){w++;const e=`te_${w}`;let t=Unicorn.AddObject(e,{type:"circle",scale:{x:2,y:2},animations:{front:{framerate:4/60,frames:Array.from({length:n.target_effect.length},(e,t)=>`target_effect${t}`),loop:!1,onComplete:()=>{Unicorn.RemoveObject(e)}}},isSensor:!0,isStatic:!0,x:o.player.position.x,y:o.player.position.y,z:200,radius:.1});t.isSensor=!0,t.animations.front.anchor.y=1}if(J&&n.target_versions[J].target_effect){w++;const e=`te_${w}`;let t=Unicorn.AddObject(e,{type:"circle",scale:{x:2,y:2},animations:{front:{framerate:4/60,frames:Array.from({length:n.target_versions[J].target_effect.length},(e,t)=>`target_effect${J}${t}`),loop:!1,onComplete:()=>{Unicorn.RemoveObject(e)}}},isSensor:!0,isStatic:!0,x:o.player.position.x,y:o.player.position.y,z:200,radius:.1});t.isSensor=!0,t.animations.front.anchor.y=1}if(n.target_animate_on_landed&&v(2),n.target_particles&&K(n.target_particles[0],n.target_particles[1],o.player.position.x,o.player.position.y+40,10),n.target_boosh&&Z(o.player.position.x,o.player.position.y+40),n.target_splash&&ee(o.player.position.x,o.player.position.y+40),n.target_sound&&Unicorn.PlaySound("sfx-target-drop",{volume:d}),o.scoreLabel.x=o.label.position.x,o.scoreLabel.y=o.label.position.y-30,o.scoreLabel.text=o.score.toFixed(2),!r.startsWith("test_")){if(i.messageFormat){let e=i.messageFormat.replace("USERNAME",o.name).replace("POINTS",o.score.toFixed(2)).replace("SHORTPTS",Math.floor(o.score));setTimeout(()=>{ComfyJS.Say(e)},5e3)}_(o.name,o.score.toFixed(2),o.userId,r)}}o.score>G&&(G=o.score,q=r),o.label.alpha=o.score>0?1:.3,Unicorn.RemoveObject(o.player.label),Unicorn.RemoveBacklay("para_"+r),o.pet&&(Unicorn.RemoveObject(o.pet.label),Unicorn.RemoveBacklay("petpara_"+r))}else if(o.player.position.y>300){let t=Math.min(3,Math.max(0,.3*(o.player.position.y-300)));0===o.parachute.scale.x&&t>0&&Unicorn.PlaySound("sfx-parachute-flap",{volume:d}),o.parachute.visible=!0,o.pet&&(o.petPara.visible=!0),o.parachute.scale.x=o.parachute.scale.y=t,o.paraFlipDir&&o.player.velocity.x>0&&(o.parachute.scale.x=-t),o.parachute.rotation=Math.sin(o.player.rotationOffset+e/1e3)*Math.PI/16,o.player.angle=Math.sin(o.player.rotationOffset+e/1e3)*Math.PI/16,o.parachute.position.x=o.player.position.x,o.parachute.position.y=o.player.position.y-10-(n.parachute_offset||0)}else o.parachute.visible=!1,o.parachute.scale.x=o.parachute.scale.y=0,o.pet&&(o.petPara.visible=!1,o.petPara.scale.x=o.petPara.scale.y=0);o.label.position.x=o.player.position.x,o.label.position.y=o.player.position.y-60}}X.forEach((e,a)=>{e.x-=t*e.speed,e.x+e.width/2<=0&&(e.x=c+e.width/2,e.y=h(500),e.speed=.01+.1*Math.random(),e.zIndex=e.speed)}),V.forEach(e=>{(e.vY<0||e.y<p-5)&&(e.x+=t/1e3*e.vX,e.y+=t/1e3*e.vY,e.vY<20&&(e.vY+=t/1e3*200))}),Q.forEach(e=>{(e.vY<0||e.y<p-5)&&(e.x+=t/1e3*e.vX,e.y+=t/1e3*e.vY,e.vY+=t/1e3*200)}),x>0&&(x-=t,x<=0&&(b&&clearInterval(b),Array.isArray(L)&&(L[R].visible=!1,R=0,L[R].visible=!0),M&&Array.isArray(M)&&(L[B].visible=!1,B=0,L[B].visible=!0)))}